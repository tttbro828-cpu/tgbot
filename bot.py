import asyncio
import random
import time
import sqlite3
import threading
from datetime import datetime, timedelta

from aiogram import Bot, Dispatcher
from aiogram.types import Message, InlineKeyboardMarkup, InlineKeyboardButton, CallbackQuery
from aiogram.filters import Command

# ================== –ù–ê–°–¢–†–û–ô–ö–ò ==================
TOKEN = "7960395324:AAHdKfvfDlcyPQSMLASinEY-fdaEz5-WMUA"
HUNT_COOLDOWN = 240  # 4 –º–∏–Ω—É—Ç—ã
EXP_PER_LEVEL = 500
ADMIN_ID = 6924481166  # –í–∞—à ID
ADMIN_USERNAME = "DeepSleep01"  # –í–∞—à username

# ================== –î–ê–ù–ù–´–ï ==================
LOCATIONS = {
    "–¢–∞–π–≥–∞": {"level": 0, "animals": {
        "–ú–µ–ª–æ—á—å": ["–ó–∞—è—Ü", "–ë–µ–ª–∫–∞", "–ë—É—Ä—É–Ω–¥—É–∫", "–†—è–±—á–∏–∫", "–í—ã–¥—Ä–∞", "–õ–∞—Å–∫–∞", "–ì–æ—Ä–Ω–æ—Å—Ç–∞–π"],
        "–°—Ä–µ–¥–Ω": ["–ë–æ–±—Ä", "–ì–ª—É—Ö–∞—Ä—å", "–°–µ–≤–µ—Ä–Ω—ã–π –æ–ª–µ–Ω—å", "–ö–æ—Å—É–ª—è"],
        "–û–ø–∞—Å–Ω": ["–ö–∞–±–∞–Ω", "–†—ã—Å—å", "–†–æ—Å–æ–º–∞—Ö–∞", "–°–µ—Ä—ã–π –≤–æ–ª–∫", "–ë—É—Ä—ã–π –º–µ–¥–≤–µ–¥—å"],
        "–¢—è–∂–µ–ª": ["–õ–æ—Å—å"],
        "–¢–∏—Ç–∞–Ω": ["–û–±–æ—Ä–æ—Ç–µ–Ω—å"]
    }},
    "–°–∞–≤–∞–Ω–Ω–∞": {"level": 10, "animals": {
        "–ú–µ–ª–æ—á—å": ["–î–∏–∫–æ–±—Ä–∞–∑", "–ú–∞–Ω–≥—É—Å—Ç", "–°—É—Ä–∏–∫–∞—Ç", "–ê–Ω—Ç–∏–ª–æ–ø –∑–∞—è—Ü"],
        "–°—Ä–µ–¥–Ω": ["–ó–µ–±—Ä–∞", "–®–∞–∫–∞–ª", "–ê–Ω—Ç–∏–ª–æ–ø–∞ –ì–Ω—É", "–ê–Ω—Ç–∏–ª –ò–º–ø–∞–ª–∞", "–°—Ç—Ä–∞—É—Å", "–ë–æ—Ä–æ–¥–∞–≤–æ—á–Ω–∏–∫", "–°–µ—Ä–≤–∞–ª"],
        "–û–ø–∞—Å–Ω": ["–ì–∏–µ–Ω–∞", "–ü—É–º–∞", "–õ–µ–≤"],
        "–¢—è–∂–µ–ª": ["–ñ–∏—Ä–∞—Ñ", "–ë—É–π–≤–æ–ª", "–°–ª–æ–Ω"],
        "–¢–∏—Ç–∞–Ω": ["–ì—Ä–æ—Ç—Å–ª–∞–Ω–≥"]
    }},
    "–ê—Ä–∫—Ç–∏–∫–∞": {"level": 25, "animals": {
        "–ú–µ–ª–æ—á—å": ["–õ–µ–º–º–∏–Ω–≥", "–ü–µ—Å–µ—Ü", "–ê—Ä–∫—Ç–∏–∫ –∑–∞—è—Ü"],
        "–°—Ä–µ–¥–Ω": ["–ü–æ–ª—è—Ä–Ω —Å–æ–≤–∞", "–¢—é–ª–µ–Ω—å", "–ö–∞—Ä–∏–±—É"],
        "–û–ø–∞—Å–Ω": ["–°–Ω–µ–∂–Ω –±–∞—Ä—Å", "–ë–µ–ª—ã–π –º–µ–¥–≤–µ–¥—å"],
        "–¢—è–∂–µ–ª": ["–ú–æ—Ä–∂", "–ë–µ–ª—É—Ö–∞", "–û–≤—Ü–µ–±—ã–∫", "–ö–æ—Å–∞—Ç–∫–∞"],
        "–¢–∏—Ç–∞–Ω": ["–ú–∞–º–æ–Ω—Ç", "–ô–µ—Ç–∏"]
    }},
    "–î–∂—É–Ω–≥–ª–∏": {"level": 50, "animals": {
        "–ú–µ–ª–æ—á—å": ["–ö–∞–ø–∏–±–∞—Ä–∞", "–õ–µ–Ω–∏–≤–µ—Ü"],
        "–°—Ä–µ–¥–Ω": ["–û–∫–∞–ø–∏", "–û–±–µ–∑—å—è–Ω–∞", "–ö–∞–∑—É–∞—Ä", "–¢–∞–ø–∏—Ä"],
        "–û–ø–∞—Å–Ω": ["–ö–æ–º–æ–¥—Å–∫–∏–π –≤–∞—Ä–∞–Ω", "–ö—Ä–æ–∫–æ–¥–∏–ª", "–ê–Ω–∞–∫–æ–Ω–¥–∞", "–Ø–≥—É–∞—Ä", "–ì–æ—Ä–∏–ª–ª–∞", "–¢–∏–≥—Ä", "–ü–∞–Ω—Ç–µ—Ä–∞"],
        "–¢—è–∂–µ–ª": ["–ù–æ—Å–æ—Ä–æ–≥"],
        "–¢–∏—Ç–∞–Ω": ["–ß—É–ø–∞–∫–∞–±—Ä–∞"]
    }},
    "–î—Ä–µ–≤–Ω–∏–π –º–∏—Ä": {"level": 80, "animals": {
        "–ú–µ–ª–æ—á—å": ["–ö–æ–º–ø—Å–æ–≥–Ω–∞—Ç", "–ò–±–µ—Ä–æ–º–µ–∑", "–ê—Ä—Ö–µ–æ–ø—Ç"],
        "–°—Ä–µ–¥–Ω": ["–í–µ–ª–æ—Ü–∏—Ä–∞–ø—Ç–æ—Ä", "–î–∏–Ω–æ–ø–∏—Ç–µ–∫"],
        "–û–ø–∞—Å–Ω": ["–°–º–∏–ª–æ–¥–æ–Ω", "–≠–Ω—Ç–µ–ª–æ–¥–æ–Ω—Ç", "–ö–µ–ª–µ–Ω–∫–µ–Ω", "–ì–∏–µ–Ω–æ–¥–æ–Ω"],
        "–¢—è–∂–µ–ª": ["–¢—Ä–∏—Ü–µ—Ä–∞—Ç–æ–ø—Å", "–°—Ç–µ–≥–æ–∑", "–ì–∞–¥—Ä–æ–∑–∞–≤—Ä", "–≠–ª–∞—Å–º–æ—Ç–µ—Ä–∏–∏", "–ú–∞–≥–µ–ª–∞–Ω–∏—è", "–®–µ—Ä—Å—Ç –Ω–æ—Å–æ—Ä–æ–≥"],
        "–¢–∏—Ç–∞–Ω": ["–¢–∏—Ä–∞–Ω–Ω–æ–∑–∞–≤—Ä", "–ë—Ä–∞—Ö–∏–æ–∑–∞–≤—Ä", "–ü—Ç–µ—Ä–æ–¥–∞–∫—Ç–∏–ª—å"]
    }},
    "–ì–æ—Ä—ã": {"level": 120, "animals": {
        "–ú–µ–ª–æ—á—å": ["–í–æ—Ä–æ–±–µ–π", "–ö–µ–¥—Ä–æ–≤–∫–∞", "–ì–æ–ª—É–±—å", "–°–∏–Ω–∏—Ü–∞"],
        "–°—Ä–µ–¥–Ω": ["–ö–µ–∫–ª–∏–∫", "–£–ª–∞—Ä", "–ö—É—Ä–æ–ø–∞—Ç–∫–∞"],
        "–û–ø–∞—Å–Ω": ["–°–∞–ø—Å–∞–Ω", "–ë–µ—Ä–∫—É—Ç", "–Ø—Å—Ç—Ä–µ–±"],
        "–¢—è–∂–µ–ª": ["–ß–µ—Ä–Ω—ã–π –≥—Ä–∏—Ñ", "–ö–æ–Ω–¥–æ—Ä"],
        "–¢–∏—Ç–∞–Ω": ["–û—Ä–µ–ª", "–†—É—Ö"]
    }},
    "–ü–æ–¥–≤–æ–¥–Ω—ã–π –º–∏—Ä": {"level": 200, "animals": {
        "–ú–µ–ª–æ—á—å": ["–†—ã–±–∞-—Å–≤–µ—Ç–ª—è–∫", "–ö—Ä–∞–±", "–†—ã–±–∞-–∫–ª–æ—É–Ω", "–ú–µ–¥—É–∑–∞"],
        "–°—Ä–µ–¥–Ω": ["–°–∫–∞—Ç", "–û—Å—å–º–∏–Ω–æ–≥", "–•–∏–º–µ—Ä–∞"],
        "–û–ø–∞—Å–Ω": ["–£–¥–∏–ª—å—â–∏–∫", "–ú—É—Ä–µ–Ω–∞", "–ë–∞—Ä—Ä–∞–∫—É–¥–∞"],
        "–¢—è–∂–µ–ª": ["–ú–∞–Ω—Ç–∞", "–ö–∞—à–∞–ª–æ—Ç", "–ê–∫—É–ª–∞"],
        "–¢–∏—Ç–∞–Ω": ["–ú–µ–≥–∞–ª–æ–¥–æ–Ω", "–ö—Ä–∞–∫–µ–Ω", "–õ–µ–≤–∏–∞—Ñ–∞–Ω"]
    }},
    "–ü—Ä–∏–∑—Ä–∞—á–Ω—ã–π –ª–µ—Å": {"level": 350, "animals": {
        "–ú–µ–ª–æ—á—å": ["–ü—Ä–∏–∑—Ä–∞–∫-–∑–∞—è—Ü", "–°–≤–µ—Ç–ª—è–∫"],
        "–°—Ä–µ–¥–Ω": ["–í–µ—Ä–≤–æ–ª—å—Ñ", "–¢–µ–Ω—å-–≤–æ—Ä–æ–Ω–∞"],
        "–û–ø–∞—Å–Ω": ["–ü—Ä–∏–∑—Ä–∞–∫", "–£–ø—ã—Ä—å"],
        "–¢—è–∂–µ–ª": ["–≠–Ω—Ç", "–ú–∞–Ω—Ç–∏–∫–æ—Ä–∞"],
        "–¢–∏—Ç–∞–Ω": ["–í–ª–∞–¥—ã–∫–∞ –ª–µ—Å–∞", "–í—Å–∞–¥–Ω–∏–∫"]
    }},
}

SEARCH_CHANCES = {
    "–ú–µ–ª–æ—á—å": 60,
    "–°—Ä–µ–¥–Ω": 45,
    "–û–ø–∞—Å–Ω": 20,
    "–¢—è–∂–µ–ª": 5,
    "–¢–∏—Ç–∞–Ω": 1
}

REWARDS = {
    "–ú–µ–ª–æ—á—å": (30, 50),
    "–°—Ä–µ–¥–Ω": (140, 250),
    "–û–ø–∞—Å–Ω": (600, 1000),
    "–¢—è–∂–µ–ª": (4000, 3000),
    "–¢–∏—Ç–∞–Ω": (20000, 10000)
}

WEAPONS = {
    "–†–µ–≤–æ–ª—å–≤–µ—Ä": {"chances": [55, 20, 3, 0.5, 0.01], "description": "–ë–∞–∑–æ–≤–æ–µ –æ—Ä—É–∂–∏–µ. –®–∞–Ω—Å—ã: 55%/20%/3%/0.5%/0.01%"},
    "–î—Ä–æ–±–æ–≤–∏–∫": {"chances": [65, 40, 8, 1, 0.1], "description": "–ú–æ—â–Ω—ã–π –¥—Ä–æ–±–æ–≤–∏–∫. –®–∞–Ω—Å—ã: 65%/40%/8%/1%/0.1%"},
    "–í–∏–Ω—Ç–æ–≤–∫–∞": {"chances": [25, 60, 20, 5, 0.5], "description": "–¢–æ—á–Ω–∞—è –≤–∏–Ω—Ç–æ–≤–∫–∞. –®–∞–Ω—Å—ã: 25%/60%/20%/5%/0.5%"},
    "–ö–∞—Ä–∞–±–∏–Ω": {"chances": [30, 50, 45, 10, 2], "description": "–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∫–∞—Ä–∞–±–∏–Ω. –®–∞–Ω—Å—ã: 30%/50%/45%/10%/2%"},
    "–®—Ç—É—Ü–µ—Ä": {"chances": [15, 35, 65, 30, 5], "description": "–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —à—Ç—É—Ü–µ—Ä. –®–∞–Ω—Å—ã: 15%/35%/65%/30%/5%"},
    "–°–ª–æ–Ω–æ–±–æ–π": {"chances": [10, 20, 40, 65, 15], "description": "–î–ª—è –∫—Ä—É–ø–Ω–æ–π –¥–∏—á–∏. –®–∞–Ω—Å—ã: 10%/20%/40%/65%/15%"},
    "–°–Ω–∞–π–ø–µ—Ä–∫–∞": {"chances": [30, 40, 55, 65, 55], "description": "–°–Ω–∞–π–ø–µ—Ä—Å–∫–∞—è –≤–∏–Ω—Ç–æ–≤–∫–∞. –®–∞–Ω—Å—ã: 30%/40%/55%/65%/55%"},
    "–¢–µ–Ω–µ–≤–æ–π –±–ª–∞—Å—Ç–µ—Ä": {"chances": [80, 80, 70, 70, 60], "description": "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–æ–µ –æ—Ä—É–∂–∏–µ. –®–∞–Ω—Å—ã: 80%/80%/70%/70%/60%"}
}

WEAPON_PRICES = {
    "–†–µ–≤–æ–ª—å–≤–µ—Ä": 0,
    "–î—Ä–æ–±–æ–≤–∏–∫": 1500,
    "–í–∏–Ω—Ç–æ–≤–∫–∞": 6000,
    "–ö–∞—Ä–∞–±–∏–Ω": 18000,
    "–®—Ç—É—Ü–µ—Ä": 45000,
    "–°–ª–æ–Ω–æ–±–æ–π": 100000,
    "–°–Ω–∞–π–ø–µ—Ä–∫–∞": 300000,
    "–¢–µ–Ω–µ–≤–æ–π –±–ª–∞—Å—Ç–µ—Ä": 1000000
}

# ================== –°–ù–ê–†–Ø–ñ–ï–ù–ò–ï ==================
EQUIPMENT = {
    "–ü—Ä–∏–º–∞–Ω–∫–∞": {
        "price": 500,
        "description": "+5% –∫ –ø–æ–∏—Å–∫—É –æ–ø–∞—Å–Ω—ã—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö",
        "bonus": {"–û–ø–∞—Å–Ω": 5}
    },
    "–ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞": {
        "price": 2000,
        "description": "+5% –∫ –ø–æ–∏—Å–∫—É –æ–ø–∞—Å–Ω—ã—Ö –∏ +5% –∫ –ø–æ–∏—Å–∫—É —Ç—è–∂–µ–ª—ã—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö",
        "bonus": {"–û–ø–∞—Å–Ω": 5, "–¢—è–∂–µ–ª": 5}
    },
    "–õ–æ–∫–∞—Ç–æ—Ä": {
        "price": 10000,
        "description": "+10% –∫ –ø–æ–∏—Å–∫—É –æ–ø–∞—Å–Ω—ã—Ö, +5% –∫ –ø–æ–∏—Å–∫—É —Ç—è–∂–µ–ª—ã—Ö –∏ +3% –∫ –ø–æ–∏—Å–∫—É —Ç–∏—Ç–∞–Ω–æ–≤",
        "bonus": {"–û–ø–∞—Å–Ω": 10, "–¢—è–∂–µ–ª": 5, "–¢–∏—Ç–∞–Ω": 3}
    },
    "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∏—Å–∫–∞—Ç–µ–ª—å": {
        "price": 150000,
        "description": "–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –∂–∏–≤–æ—Ç–Ω–æ–µ",
        "bonus": {"guaranteed_find": True}
    },
    "–†—é–∫–∑–∞–∫": {
        "price": 35000,
        "description": "+100 –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º—É –∑–¥–æ—Ä–æ–≤—å—é",
        "bonus": {"health": 100}
    },
    "–£–ª—É—á—à–µ–Ω–Ω—ã–µ –ª–æ–≤—É—à–∫–∏": {
        "price": 15000,
        "description": "5 –∂–∏–≤–æ—Ç–Ω—ã—Ö –≤–º–µ—Å—Ç–æ 3 –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –ª–æ–≤—à–µ–∫",
        "bonus": {"traps": 5}
    },
    "–í–∏—Ç–∞–º–∏–Ω—ã": {
        "price": 4000,
        "description": "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è –≤ 1.5 —Ä–∞–∑–∞",
        "bonus": {"healing_bonus": 1.5}
    }
}

# –ë–∞—Ñ—Ñ—ã (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ)
BUFFS = {
    "–ê–ø—Ç–µ—á–∫–∞": {
        "price": 750,
        "description": "–ü–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–¥–æ—Ä–æ–≤—å–µ",
        "effect": "full_heal"
    },
    "–ó–æ–ª–æ—Ç–∞—è –ø—É–ª—è": {
        "price": 1000,
        "description": "x2 —à–∞–Ω—Å –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ —Å–ª–µ–¥—É—é—â–µ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ (—Å–≥–æ—Ä–∞–µ—Ç –ø–æ—Å–ª–µ –≤—ã—Å—Ç—Ä–µ–ª–∞)",
        "effect": "golden_bullet"
    },
    "–î—Ä–æ–Ω": {
        "price": 2000,
        "description": "–ù–∞—Ö–æ–¥–∏—Ç 3 –∂–∏–≤–æ—Ç–Ω—ã—Ö –Ω–∞ –≤—ã–±–æ—Ä, +10% —à–∞–Ω—Å –Ω–∞–π—Ç–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ –Ω–∞ 30 –º–∏–Ω",
        "effect": "drone"
    }
}

# –§—Ä–∞–∑—ã –∫–æ–Ω—Ç—Ä–∞—Ç–∞–∫ –¥–ª—è –ö–ê–ñ–î–û–ì–û –∂–∏–≤–æ—Ç–Ω–æ–≥–æ
ANIMAL_ATTACK_PHRASES = {
    # –¢–∞–π–≥–∞
    "–ö–∞–±–∞–Ω": ["–ö–∞–±–∞–Ω —è—Ä–æ—Å—Ç–Ω–æ –±—Ä–æ—Å–∞–µ—Ç—Å—è –Ω–∞ –≤–∞—Å! -25HP", "–ö–∞–±–∞–Ω –±—å–µ—Ç –∫–ª—ã–∫–∞–º–∏! -25HP"],
    "–†—ã—Å—å": ["–†—ã—Å—å —Ü–∞—Ä–∞–ø–∞–µ—Ç –∫–æ–≥—Ç—è–º–∏! -25HP", "–†—ã—Å—å –ø—Ä—ã–≥–∞–µ—Ç –Ω–∞ –≤–∞—Å! -25HP"],
    "–†–æ—Å–æ–º–∞—Ö–∞": ["–†–æ—Å–æ–º–∞—Ö–∞ –≤–ø–∏–≤–∞–µ—Ç—Å—è –≤ —Ä—É–∫—É! -25HP", "–†–æ—Å–æ–º–∞—Ö–∞ –∞—Ç–∞–∫—É–µ—Ç! -25HP"],
    "–°–µ—Ä—ã–π –≤–æ–ª–∫": ["–í–æ–ª–∫ –≤–ø–∏–≤–∞–µ—Ç—Å—è –≤ —Ä—É–∫—É! -25HP", "–í–æ–ª–∫ —Å—Ç–∞–µ–π –æ–∫—Ä—É–∂–∞–µ—Ç –≤–∞—Å! -25HP"],
    "–ë—É—Ä—ã–π –º–µ–¥–≤–µ–¥—å": ["–ú–µ–¥–≤–µ–¥—å –Ω–∞–Ω–æ—Å–∏—Ç —Å–æ–∫—Ä—É—à–∏—Ç–µ–ª—å–Ω—ã–π —É–¥–∞—Ä! -25HP", "–ú–µ–¥–≤–µ–¥—å —Å–±–∏–≤–∞–µ—Ç —Å –Ω–æ–≥! -25HP"],
    "–õ–æ—Å—å": ["–õ–æ—Å—å –±—å–µ—Ç —Ä–æ–≥–∞–º–∏! -50HP", "–õ–æ—Å—å —Ç–æ–ø—á–µ—Ç –∫–æ–ø—ã—Ç–∞–º–∏! -50HP"],
    "–û–±–æ—Ä–æ—Ç–µ–Ω—å": ["–û–±–æ—Ä–æ—Ç–µ–Ω—å –≤–ø–∏–≤–∞–µ—Ç—Å—è –∫–ª—ã–∫–∞–º–∏ –≤ –≥–æ—Ä–ª–æ! -100HP", "–û–±–æ—Ä–æ—Ç–µ–Ω—å —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç –∫–æ–≥—Ç—è–º–∏! -100HP"],
    
    # –°–∞–≤–∞–Ω–Ω–∞
    "–ì–∏–µ–Ω–∞": ["–ì–∏–µ–Ω–∞ —Ö–≤–∞—Ç–∞–µ—Ç –∑–∞ –Ω–æ–≥—É! -25HP", "–ì–∏–µ–Ω–∞ —Å—Ç–∞–µ–π –Ω–∞–ø–∞–¥–∞–µ—Ç! -25HP"],
    "–ü—É–º–∞": ["–ü—É–º–∞ –ø—Ä—ã–≥–∞–µ—Ç –Ω–∞ –≤–∞—Å! -25HP", "–ü—É–º–∞ —Ü–∞—Ä–∞–ø–∞–µ—Ç! -25HP"],
    "–õ–µ–≤": ["–õ–µ–≤ —Å–±–∏–≤–∞–µ—Ç —Å –Ω–æ–≥ —É–¥–∞—Ä–æ–º –ª–∞–ø—ã! -25HP", "–õ–µ–≤ –≤–ø–∏–≤–∞–µ—Ç—Å—è –≤ –ø–ª–µ—á–æ! -25HP"],
    "–ñ–∏—Ä–∞—Ñ": ["–ñ–∏—Ä–∞—Ñ –±—å—ë—Ç –º–æ—â–Ω–æ–π —à–µ–µ–π! -50HP", "–ñ–∏—Ä–∞—Ñ —Å–±–∏–≤–∞–µ—Ç —É–¥–∞—Ä–æ–º –≥–æ–ª–æ–≤—ã! -50HP"],
    "–ë—É–π–≤–æ–ª": ["–ë—É–π–≤–æ–ª —Ç–æ–ø—á–µ—Ç –∫–æ–ø—ã—Ç–∞–º–∏! -50HP", "–ë—É–π–≤–æ–ª –±—å–µ—Ç —Ä–æ–≥–∞–º–∏! -50HP"],
    "–°–ª–æ–Ω": ["–°–ª–æ–Ω –ø–æ–¥–Ω–∏–º–∞–µ—Ç –≤–∞—Å —Ö–æ–±–æ—Ç–æ–º –∏ –±—Ä–æ—Å–∞–µ—Ç! -50HP", "–°–ª–æ–Ω —Ç–æ–ø—á–µ—Ç! -50HP"],
    "–ì—Ä–æ—Ç—Å–ª–∞–Ω–≥": ["–ì—Ä–æ—Ç—Å–ª–∞–Ω–≥ –æ–±–≤–∏–≤–∞–µ—Ç –≤–∞—Å —Å–≤–æ–∏–º –∑–º–µ–∏–Ω—ã–º —Ç–µ–ª–æ–º –∏ —Å —Ö—Ä—É—Å—Ç–æ–º —Å–¥–∞–≤–ª–∏–≤–∞–µ—Ç! -100HP", "–ì—Ä–æ—Ç—Å–ª–∞–Ω–≥ –∫—É—Å–∞–µ—Ç! -100HP"],
    
    # –ê—Ä–∫—Ç–∏–∫–∞
    "–°–Ω–µ–∂–Ω –±–∞—Ä—Å": ["–°–Ω–µ–∂–Ω—ã–π –±–∞—Ä—Å –ø—Ä—ã–≥–∞–µ—Ç –Ω–∞ –≤–∞—Å! -25HP", "–ë–∞—Ä—Å —Ü–∞—Ä–∞–ø–∞–µ—Ç! -25HP"],
    "–ë–µ–ª—ã–π –º–µ–¥–≤–µ–¥—å": ["–ë–µ–ª—ã–π –º–µ–¥–≤–µ–¥—å —Å–±–∏–≤–∞–µ—Ç –ª–∞–ø–æ–π! -25HP", "–ú–µ–¥–≤–µ–¥—å –∫—É—Å–∞–µ—Ç! -25HP"],
    "–ú–æ—Ä–∂": ["–ú–æ—Ä–∂ –∞—Ç–∞–∫—É–µ—Ç –∫–ª—ã–∫–∞–º–∏! -50HP", "–ú–æ—Ä–∂ –±—å–µ—Ç —Ç—É–ª–æ–≤–∏—â–µ–º! -50HP"],
    "–ë–µ–ª—É—Ö–∞": ["–ë–µ–ª—É—Ö–∞ –≤—ã–ø—Ä—ã–≥–∏–≤–∞–µ—Ç –∏–∑ –≤–æ–¥—ã! -50HP", "–ë–µ–ª—É—Ö–∞ —Ç–∞—Ä–∞–Ω–∏—Ç! -50HP"],
    "–û–≤—Ü–µ–±—ã–∫": ["–û–≤—Ü–µ–±—ã–∫ —Ç–∞—Ä–∞–Ω–∏—Ç –≤–∞—Å! -50HP", "–û–≤—Ü–µ–±—ã–∫ –±—å–µ—Ç —Ä–æ–≥–∞–º–∏! -50HP"],
    "–ö–æ—Å–∞—Ç–∫–∞": ["–ö–æ—Å–∞—Ç–∫–∞ –≤—ã–ø—Ä—ã–≥–∏–≤–∞–µ—Ç –∏–∑ –≤–æ–¥—ã! -50HP", "–ö–æ—Å–∞—Ç–∫–∞ —Ç–∞—Ä–∞–Ω–∏—Ç! -50HP"],
    "–ú–∞–º–æ–Ω—Ç": ["–ú–∞–º–æ–Ω—Ç —Å–º–∏–Ω–∞–µ—Ç –ø–æ–¥ —Å–æ–±–æ–π! -100HP", "–ú–∞–º–æ–Ω—Ç –±—å–µ—Ç –±–∏–≤–Ω—è–º–∏! -100HP"],
    "–ô–µ—Ç–∏": ["–ô–µ—Ç–∏ —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç –Ω–∞ —á–∞—Å—Ç–∏! -100HP", "–ô–µ—Ç–∏ —Å–¥–∏—Ä–∞–µ—Ç –∫–æ–∂—É! -100HP"],
    
    # –î–∂—É–Ω–≥–ª–∏
    "–ö–æ–º–æ–¥—Å–∫–∏–π –≤–∞—Ä–∞–Ω": ["–í–∞—Ä–∞–Ω –∫—É—Å–∞–µ—Ç —è–¥–æ–≤–∏—Ç—ã–º–∏ –∑—É–±–∞–º–∏! -25HP", "–í–∞—Ä–∞–Ω –±—å–µ—Ç —Ö–≤–æ—Å—Ç–æ–º! -25HP"],
    "–ö—Ä–æ–∫–æ–¥–∏–ª": ["–ö—Ä–æ–∫–æ–¥–∏–ª —Ö–≤–∞—Ç–∞–µ—Ç —á–µ–ª—é—Å—Ç—è–º–∏! -25HP", "–ö—Ä–æ–∫–æ–¥–∏–ª —Ç–∞—â–∏—Ç –ø–æ–¥ –≤–æ–¥—É! -25HP"],
    "–ê–Ω–∞–∫–æ–Ω–¥–∞": ["–ê–Ω–∞–∫–æ–Ω–¥–∞ –æ–±–≤–∏–≤–∞–µ—Ç –∏ –¥—É—à–∏—Ç! -25HP", "–ê–Ω–∞–∫–æ–Ω–¥–∞ —Å–∂–∏–º–∞–µ—Ç! -25HP"],
    "–Ø–≥—É–∞—Ä": ["–Ø–≥—É–∞—Ä –Ω–∞–ø–∞–¥–∞–µ—Ç –∏–∑ –∑–∞—Å–∞–¥—ã! -25HP", "–Ø–≥—É–∞—Ä –≤–ø–∏–≤–∞–µ—Ç—Å—è –∫–ª—ã–∫–∞–º–∏! -25HP"],
    "–ì–æ—Ä–∏–ª–ª–∞": ["–ì–æ—Ä–∏–ª–ª–∞ –±—å–µ—Ç –∫—É–ª–∞–∫–æ–º! -25HP", "–ì–æ—Ä–∏–ª–ª–∞ –ª–æ–º–∞–µ—Ç –∫–æ—Å—Ç–∏! -25HP"],
    "–¢–∏–≥—Ä": ["–¢–∏–≥—Ä –Ω–∞–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –≤–∞—Å! -25HP", "–¢–∏–≥—Ä —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç –∫–æ–≥—Ç—è–º–∏! -25HP"],
    "–ü–∞–Ω—Ç–µ—Ä–∞": ["–ü–∞–Ω—Ç–µ—Ä–∞ –ø—Ä—ã–≥–∞–µ—Ç —Å–æ –¥–µ—Ä–µ–≤–∞! -25HP", "–ü–∞–Ω—Ç–µ—Ä–∞ –∫—É—Å–∞–µ—Ç –∑–∞ —à–µ—é! -25HP"],
    "–ù–æ—Å–æ—Ä–æ–≥": ["–ù–æ—Å–æ—Ä–æ–≥ –ø—Ä–æ–±–∏–≤–∞–µ—Ç –±—Ä–µ—à—å –≤ –∑–∞—â–∏—Ç–µ! -50HP", "–ù–æ—Å–æ—Ä–æ–≥ —Ç–∞—Ä–∞–Ω–∏—Ç! -50HP"],
    "–ß—É–ø–∞–∫–∞–±—Ä–∞": ["–ß—É–ø–∞–∫–∞–±—Ä–∞ –≤—ã—Å–∞—Å—ã–≤–∞–µ—Ç –≤—Å—é –∫—Ä–æ–≤—å! -100HP", "–ß—É–ø–∞–∫–∞–±—Ä–∞ —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç –ø–ª–æ—Ç—å! -100HP"],
    
    # –î—Ä–µ–≤–Ω–∏–π –º–∏—Ä
    "–°–º–∏–ª–æ–¥–æ–Ω": ["–°–º–∏–ª–æ–¥–æ–Ω –≤–ø–∏–≤–∞–µ—Ç—Å—è –∫–ª—ã–∫–∞–º–∏! -25HP", "–°–∞–±–ª–µ–∑—É–±—ã–π —Ç–∏–≥—Ä –∞—Ç–∞–∫—É–µ—Ç! -25HP"],
    "–≠–Ω—Ç–µ–ª–æ–¥–æ–Ω—Ç": ["–≠–Ω—Ç–µ–ª–æ–¥–æ–Ω—Ç –∫—É—Å–∞–µ—Ç –º–æ—â–Ω—ã–º–∏ —á–µ–ª—é—Å—Ç—è–º–∏! -25HP", "–°–≤–∏–Ω–æ-–º–µ–¥–≤–µ–¥—å –∞—Ç–∞–∫—É–µ—Ç! -25HP"],
    "–ö–µ–ª–µ–Ω–∫–µ–Ω": ["–ö–µ–ª–µ–Ω–∫–µ–Ω –∫–ª—é–µ—Ç –æ–≥—Ä–æ–º–Ω—ã–º –∫–ª—é–≤–æ–º! -25HP", "–ò—Å–ø–æ–ª–∏–Ω—Å–∫–∞—è –ø—Ç–∏—Ü–∞ –∞—Ç–∞–∫—É–µ—Ç! -25HP"],
    "–ì–∏–µ–Ω–æ–¥–æ–Ω": ["–ì–∏–µ–Ω–æ–¥–æ–Ω —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç –ø–ª–æ—Ç—å! -25HP", "–î—Ä–µ–≤–Ω–∏–π —Ö–∏—â–Ω–∏–∫ –Ω–∞–ø–∞–¥–∞–µ—Ç! -25HP"],
    "–¢—Ä–∏—Ü–µ—Ä–∞—Ç–æ–ø—Å": ["–¢—Ä–∏—Ü–µ—Ä–∞—Ç–æ–ø—Å –∞—Ç–∞–∫—É–µ—Ç! -50HP", "–¢—Ä–∏—Ü–µ—Ä–∞—Ç–æ–ø—Å –ø—Ä–æ–∫–∞–ª—ã–≤–∞–µ—Ç —Ä–æ–≥–∞–º–∏! -50HP"],
    "–°—Ç–µ–≥–æ–∑": ["–°—Ç–µ–≥–æ–∑–∞–≤—Ä —É–¥–∞—Ä—è–µ—Ç —Ö–≤–æ—Å—Ç–æ–º! -50HP", "–°—Ç–µ–≥–æ–∑–∞–≤—Ä –±—å–µ—Ç —à–∏–ø–∞–º–∏! -50HP"],
    "–ì–∞–¥—Ä–æ–∑–∞–≤—Ä": ["–ì–∞–¥—Ä–æ–∑–∞–≤—Ä —Ç–æ–ø—á–µ—Ç! -50HP", "–£—Ç–∫–æ–Ω–æ—Å—ã–π –¥–∏–Ω–æ–∑–∞–≤—Ä –∞—Ç–∞–∫—É–µ—Ç! -50HP"],
    "–≠–ª–∞—Å–º–æ—Ç–µ—Ä–∏–∏": ["–≠–ª–∞—Å–º–æ—Ç–µ—Ä–∏–∏ –±—å–µ—Ç —Ä–æ–≥–æ–º! -50HP", "–ì–∏–≥–∞–Ω—Ç—Å–∫–∏–π –Ω–æ—Å–æ—Ä–æ–≥ —Ç–∞—Ä–∞–Ω–∏—Ç! -50HP"],
    "–ú–∞–≥–µ–ª–∞–Ω–∏—è": ["–ú–∞–≥–µ–ª–∞–Ω–∏—è –∫—É—Å–∞–µ—Ç! -50HP", "–ì–∏–≥–∞–Ω—Ç—Å–∫–∏–π –ª–µ–Ω–∏–≤–µ—Ü –∞—Ç–∞–∫—É–µ—Ç! -50HP"],
    "–®–µ—Ä—Å—Ç –Ω–æ—Å–æ—Ä–æ–≥": ["–®–µ—Ä—Å—Ç–∏—Å—Ç—ã–π –Ω–æ—Å–æ—Ä–æ–≥ –±—å–µ—Ç —Ä–æ–≥–æ–º! -50HP", "–ù–æ—Å–æ—Ä–æ–≥ –ª–µ–¥–Ω–∏–∫–æ–≤–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ –∞—Ç–∞–∫—É–µ—Ç! -50HP"],
    "–¢–∏—Ä–∞–Ω–Ω–æ–∑–∞–≤—Ä": ["–¢–∏—Ä–∞–Ω–Ω–æ–∑–∞–≤—Ä —Ö–≤–∞—Ç–∞–µ—Ç –≤–∞—Å –≤ –ø–∞—Å—Ç—å! -100HP", "–ö–æ—Ä–æ–ª—å –¥–∏–Ω–æ–∑–∞–≤—Ä–æ–≤ –¥—Ä–æ–±–∏—Ç –∫–æ—Å—Ç–∏! -100HP"],
    "–ë—Ä–∞—Ö–∏–æ–∑–∞–≤—Ä": ["–ë—Ä–∞—Ö–∏–æ–∑–∞–≤—Ä –Ω–∞—Å—Ç—É–ø–∞–µ—Ç –Ω–∞ –≤–∞—Å! -100HP", "–ì–∏–≥–∞–Ω—Ç—Å–∫–∏–π –∑–∞—É—Ä–æ–ø–æ–¥ –¥–∞–≤–∏—Ç! -100HP"],
    "–ü—Ç–µ—Ä–æ–¥–∞–∫—Ç–∏–ª—å": ["–ü—Ç–µ—Ä–æ–¥–∞–∫—Ç–∏–ª—å —Ö–≤–∞—Ç–∞–µ—Ç –∏ –±—Ä–æ—Å–∞–µ—Ç —Å –≤—ã—Å–æ—Ç—ã! -100HP", "–õ–µ—Ç–∞—é—â–∏–π —è—â–µ—Ä –∫–ª—é–µ—Ç! -100HP"],
    
    # –ì–æ—Ä—ã
    "–°–∞–ø—Å–∞–Ω": ["–°–∞–ø—Å–∞–Ω –ø–∏–∫–∏—Ä—É–µ—Ç –Ω–∞ –≤–∞—Å! -25HP", "–°–æ–∫–æ–ª –∫–ª—é–µ—Ç! -25HP"],
    "–ë–µ—Ä–∫—É—Ç": ["–ë–µ—Ä–∫—É—Ç —Ö–≤–∞—Ç–∞–µ—Ç –∫–æ–≥—Ç—è–º–∏! -25HP", "–ó–æ–ª–æ—Ç–æ–π –æ—Ä–µ–ª –∞—Ç–∞–∫—É–µ—Ç! -25HP"],
    "–Ø—Å—Ç—Ä–µ–±": ["–Ø—Å—Ç—Ä–µ–± —Ü–∞—Ä–∞–ø–∞–µ—Ç –∫–æ–≥—Ç—è–º–∏! -25HP", "–•–∏—â–Ω–∞—è –ø—Ç–∏—Ü–∞ –Ω–∞–ø–∞–¥–∞–µ—Ç! -25HP"],
    "–ß–µ—Ä–Ω—ã–π –≥—Ä–∏—Ñ": ["–ì—Ä–∏—Ñ –∫–ª—é–µ—Ç! -50HP", "–ü–∞–¥–∞–ª—å—â–∏–∫ –∞—Ç–∞–∫—É–µ—Ç! -50HP"],
    "–ö–æ–Ω–¥–æ—Ä": ["–ö–æ–Ω–¥–æ—Ä –±—å–µ—Ç –∫—Ä—ã–ª—å—è–º–∏! -50HP", "–ì–∏–≥–∞–Ω—Ç—Å–∫–∏–π –∫–æ–Ω–¥–æ—Ä –∞—Ç–∞–∫—É–µ—Ç! -50HP"],
    "–û—Ä–µ–ª": ["–û—Ä–µ–ª-–≤–µ–ª–∏–∫–∞–Ω —Ö–≤–∞—Ç–∞–µ—Ç –∫–æ–≥—Ç—è–º–∏! -100HP", "–ì–∏–≥–∞–Ω—Ç—Å–∫–∏–π –æ—Ä–µ–ª —É–Ω–æ—Å–∏—Ç –≤ –Ω–µ–±–æ! -100HP"],
    "–†—É—Ö": ["–†—É—Ö —Ö–≤–∞—Ç–∞–µ—Ç –∏ –ø–æ–¥–Ω–∏–º–∞–µ—Ç –Ω–∞ –æ–≥—Ä–æ–º–Ω—É—é –≤—ã—Å–æ—Ç—É! -100HP", "–ú–∏—Ñ–∏—á–µ—Å–∫–∞—è –ø—Ç–∏—Ü–∞ –∞—Ç–∞–∫—É–µ—Ç! -100HP"],
    
    # –ü–æ–¥–≤–æ–¥–Ω—ã–π –º–∏—Ä
    "–£–¥–∏–ª—å—â–∏–∫": ["–£–¥–∏–ª—å—â–∏–∫ –∫—É—Å–∞–µ—Ç —Å–≤–µ—Ç—è—â–∏–º–∏—Å—è –∑—É–±–∞–º–∏! -25HP", "–ì–ª—É–±–æ–∫–æ–≤–æ–¥–Ω—ã–π —Ö–∏—â–Ω–∏–∫ –∞—Ç–∞–∫—É–µ—Ç! -25HP"],
    "–ú—É—Ä–µ–Ω–∞": ["–ú—É—Ä–µ–Ω–∞ –≤–ø–∏–≤–∞–µ—Ç—Å—è –∑—É–±–∞–º–∏! -25HP", "–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∞—è –º—É—Ä–µ–Ω–∞ –±—å–µ—Ç —Ç–æ–∫–æ–º! -25HP"],
    "–ë–∞—Ä—Ä–∞–∫—É–¥–∞": ["–ë–∞—Ä—Ä–∞–∫—É–¥–∞ –ø—Ä–æ–Ω–∑–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å—é! -25HP", "–ú–æ—Ä—Å–∫–∞—è —â—É–∫–∞ –∫—É—Å–∞–µ—Ç! -25HP"],
    "–ú–∞–Ω—Ç–∞": ["–ú–∞–Ω—Ç–∞ –±—å–µ—Ç —Ö–≤–æ—Å—Ç–æ–º! -50HP", "–ì–∏–≥–∞–Ω—Ç—Å–∫–∏–π —Å–∫–∞—Ç –Ω–∞–∫—Ä—ã–≤–∞–µ—Ç! -50HP"],
    "–ö–∞—à–∞–ª–æ—Ç": ["–ö–∞—à–∞–ª–æ—Ç –æ–≥–ª—É—à–∞–µ—Ç –∑–≤—É–∫–æ–º! -50HP", "–ì–∏–≥–∞–Ω—Ç—Å–∫–∏–π –∫–∏—Ç —Ç–∞—Ä–∞–Ω–∏—Ç! -50HP"],
    "–ê–∫—É–ª–∞": ["–ê–∫—É–ª–∞ –∫—É—Å–∞–µ—Ç! -50HP", "–ë–æ–ª—å—à–∞—è –±–µ–ª–∞—è –∞–∫—É–ª–∞ –∞—Ç–∞–∫—É–µ—Ç! -50HP"],
    "–ú–µ–≥–∞–ª–æ–¥–æ–Ω": ["–ú–µ–≥–∞–ª–æ–¥–æ–Ω –ø–µ—Ä–µ–∫—É—Å—ã–≤–∞–µ—Ç –ø–æ–ø–æ–ª–∞–º! -100HP", "–î–æ–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∞—è –∞–∫—É–ª–∞ –ø–æ–∂–∏—Ä–∞–µ—Ç! -100HP"],
    "–ö—Ä–∞–∫–µ–Ω": ["–ö—Ä–∞–∫–µ–Ω –æ–±–≤–∏–≤–∞–µ—Ç —â—É–ø–∞–ª—å—Ü–∞–º–∏! -100HP", "–ú–æ—Ä—Å–∫–æ–µ —á—É–¥–æ–≤–∏—â–µ —Ç—è–Ω–µ—Ç –Ω–∞ –¥–Ω–æ! -100HP"],
    "–õ–µ–≤–∏–∞—Ñ–∞–Ω": ["–õ–µ–≤–∏–∞—Ñ–∞–Ω –ø—Ä–æ–≥–ª–∞—Ç—ã–≤–∞–µ—Ç —Ü–µ–ª–∏–∫–æ–º! -100HP", "–ë–∏–±–ª–µ–π—Å–∫–æ–µ —á—É–¥–æ–≤–∏—â–µ —Ä–∞–∑—Ä—É—à–∞–µ—Ç! -100HP"],
    
    # –ü—Ä–∏–∑—Ä–∞—á–Ω—ã–π –ª–µ—Å
    "–í–µ—Ä–≤–æ–ª—å—Ñ": ["–í–µ—Ä–≤–æ–ª—å—Ñ –≤–ø–∏–≤–∞–µ—Ç—Å—è –∫–ª—ã–∫–∞–º–∏! -25HP", "–û–±–æ—Ä–æ—Ç–µ–Ω—å-–≤–æ–ª–∫ —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç! -25HP"],
    "–¢–µ–Ω—å-–≤–æ—Ä–æ–Ω–∞": ["–¢–µ–Ω—å-–≤–æ—Ä–æ–Ω–∞ –∫–ª—é–µ—Ç –ø—Ä–∏–∑—Ä–∞—á–Ω—ã–º –∫–ª—é–≤–æ–º! -25HP", "–¢–µ–º–Ω–∞—è –ø—Ç–∏—Ü–∞ –∞—Ç–∞–∫—É–µ—Ç! -25HP"],
    "–ü—Ä–∏–∑—Ä–∞–∫": ["–ü—Ä–∏–∑—Ä–∞–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç —Å–∫–≤–æ–∑—å –≤–∞—Å! -25HP", "–ü—Ä–∏–∑—Ä–∞—á–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å –≤—ã—Å–∞—Å—ã–≤–∞–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—É—é —Å–∏–ª—É! -25HP"],
    "–£–ø—ã—Ä—å": ["–£–ø—ã—Ä—å –∫—É—Å–∞–µ—Ç –≤–∞–º–ø–∏—Ä—Å–∫–∏–º–∏ –∫–ª—ã–∫–∞–º–∏! -25HP", "–ù–æ—á–Ω–æ–π –æ—Ö–æ—Ç–Ω–∏–∫ –∞—Ç–∞–∫—É–µ—Ç! -25HP"],
    "–≠–Ω—Ç": ["–≠–Ω—Ç –±—å–µ—Ç –≤–µ—Ç–≤—è–º–∏! -50HP", "–î—Ä–µ–≤–æ–¥–µ—Ä–µ–≤–æ —Å–æ–∫—Ä—É—à–∞–µ—Ç! -50HP"],
    "–ú–∞–Ω—Ç–∏–∫–æ—Ä–∞": ["–ú–∞–Ω—Ç–∏–∫–æ—Ä–∞ –∂–∞–ª–∏—Ç —è–¥–æ–≤–∏—Ç—ã–º —Ö–≤–æ—Å—Ç–æ–º! -50HP", "–ú–∏—Ñ–∏—á–µ—Å–∫–∏–π –∑–≤–µ—Ä—å –∞—Ç–∞–∫—É–µ—Ç! -50HP"],
    "–í–ª–∞–¥—ã–∫–∞ –ª–µ—Å–∞": ["–í–ª–∞–¥—ã–∫–∞ –ª–µ—Å–∞ –Ω–∞—Å—ã–ª–∞–µ—Ç –ø—Ä–æ–∫–ª—è—Ç–∏–µ! -100HP", "–î—É—Ö –ª–µ—Å–∞ —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç! -100HP"],
    "–í—Å–∞–¥–Ω–∏–∫": ["–í—Å–∞–¥–Ω–∏–∫ –±–µ–∑ –≥–æ–ª–æ–≤—ã –ø—Ä–æ–Ω–æ—Å–∏—Ç—Å—è —Å–∫–≤–æ–∑—å –≤–∞—Å! -100HP", "–ü—Ä–∏–∑—Ä–∞—á–Ω—ã–π –≤—Å–∞–¥–Ω–∏–∫ –∞—Ç–∞–∫—É–µ—Ç! -100HP"],
}

CONTRATTACK_DAMAGE = {
    "–û–ø–∞—Å–Ω": 25,
    "–¢—è–∂–µ–ª": 50, 
    "–¢–∏—Ç–∞–Ω": 100
}

# ================== –î–û–°–¢–ò–ñ–ï–ù–ò–Ø ==================
ACHIEVEMENTS = {
    "–ó–∞–π—á—å—è —à–∫—É—Ä–∞": {
        "description": "–£–±–∏—Ç—å 20 –∑–∞–π—Ü–µ–≤",
        "reward_coins": 500,
        "reward_exp": 1000,
        "title": "üêá –ó–∞–π—Ü–µ–ª–æ–≤",
        "condition_type": "animal_kills",
        "condition_value": ("–ó–∞—è—Ü", 20)
    },
    "–¢–∏—Ç–∞–Ω–æ–≤—ã–π –±–æ–≥": {
        "description": "–£–±–∏—Ç—å 3 —Ç–∏—Ç–∞–Ω–∞",
        "reward_coins": 10000,
        "reward_exp": 5000,
        "title": "üëë –£–±–∏–π—Ü–∞ —Ç–∏—Ç–∞–Ω–æ–≤",
        "condition_type": "titan_kills",
        "condition_value": 3
    },
    "–ë–æ–≥–∞—á": {
        "description": "–ù–∞–∫–æ–ø–∏—Ç—å 50,000 –º–æ–Ω–µ—Ç",
        "reward_coins": 10000,
        "reward_exp": 0,
        "title": "üí∞ –ë–æ–≥–∞—á",
        "condition_type": "coins",
        "condition_value": 50000
    },
    "–ü–æ–ª—è—Ä–Ω—ã–π —Ä–µ–π–Ω–¥–∂–µ—Ä": {
        "description": "–£–±–∏—Ç—å 30 –∞—Ä–∫—Ç–∏—á–µ—Å–∫–∏—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö",
        "reward_coins": 5000,
        "reward_exp": 3000,
        "title": "‚ùÑÔ∏è –ü–æ–ª—è—Ä–Ω—ã–π —Ä–µ–π–Ω–¥–∂–µ—Ä",
        "condition_type": "location_kills",
        "condition_value": ("–ê—Ä–∫—Ç–∏–∫–∞", 30)
    },
    "–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä": {
        "description": "–£–±–∏—Ç—å 40 —Ä–∞–∑–Ω—ã—Ö –≤–∏–¥–æ–≤ –∂–∏–≤–æ—Ç–Ω—ã—Ö",
        "reward_coins": 8000,
        "reward_exp": 0,
        "title": "üìö –ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä",
        "condition_type": "unique_animals",
        "condition_value": 40
    },
    "–°–Ω–∞–π–ø–µ—Ä": {
        "description": "10 —É—Å–ø–µ—à–Ω—ã—Ö –≤—ã—Å—Ç—Ä–µ–ª–æ–≤ –ø–æ–¥—Ä—è–¥ –±–µ–∑ –ø—Ä–æ–º–∞—Ö–∞",
        "reward_coins": 3000,
        "reward_exp": 0,
        "title": "üî´ –ú–µ—Ç–∫–∏–π —Å—Ç—Ä–µ–ª–æ–∫",
        "condition_type": "streak",
        "condition_value": 10
    },
    "üí™ –ó–¥–æ—Ä–æ–≤—è–∫": {
        "description": "–ò–º–µ—Ç—å 250 –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ HP",
        "reward_coins": 5000,
        "reward_exp": 0,
        "title": "üí™ –ö–∞—á–æ–∫",
        "condition_type": "max_health",
        "condition_value": 250
    },
    "üõ°Ô∏è –ù–µ–ø—Ä–æ–±–∏–≤–∞–µ–º—ã–π": {
        "description": "–í—ã–¥–µ—Ä–∂–∞—Ç—å 10 –∫–æ–Ω—Ç—Ä–∞—Ç–∞–∫ –ø–æ–¥—Ä—è–¥ –±–µ–∑ –ª–µ—á–µ–Ω–∏—è",
        "reward_coins": 3000,
        "reward_exp": 0,
        "title": "üõ°Ô∏è –°—Ç–∞–ª—å–Ω–∞—è –≤–æ–ª—è",
        "condition_type": "counterattack_streak",
        "condition_value": 10
    },
    "üèÉ –ú–∞—Å—Ç–µ—Ä –ø–æ–±–µ–≥–∞": {
        "description": "–£–±–µ–∂–∞—Ç—å –æ—Ç 5 —Ç–∏—Ç–∞–Ω–æ–≤ –ø–æ–¥—Ä—è–¥",
        "reward_coins": 4000,
        "reward_exp": 0,
        "title": "üèÉ –ü—Ä–∏–∑—Ä–∞–∫",
        "condition_type": "titan_escape_streak",
        "condition_value": 5
    },
    "üíÄ –°–º–µ—Ä—Ç–Ω–∏–∫": {
        "description": "–£–º–µ—Ä–µ—Ç—å 5 —Ä–∞–∑",
        "reward_coins": 2000,
        "reward_exp": 0,
        "title": "üíÄ –ë–µ—Å—Å–º–µ—Ä—Ç–Ω—ã–π",
        "condition_type": "deaths",
        "condition_value": 5
    },
    "üéØ –õ–æ–≤–µ—Ü —É–¥–∞—á–∏": {
        "description": "–ü–æ–π–º–∞—Ç—å —Ç—è–∂—ë–ª–æ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ –≤ –ª–æ–≤—É—à–∫—É",
        "reward_coins": 5000,
        "reward_exp": 0,
        "title": "üéØ –°—á–∞—Å—Ç–ª–∏–≤—á–∏–∫",
        "condition_type": "trap_heavy",
        "condition_value": 1
    },
    "üêü –†—ã–±–∞–∫": {
        "description": "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–≤—É—à–∫–∏ 30 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥",
        "reward_coins": 8000,
        "reward_exp": 0,
        "title": "üêü –°—Ç–∞—Ä—ã–π —Ä—ã–±–∞–∫",
        "condition_type": "trap_days_streak",
        "condition_value": 30
    }
}

RANKS = {
    0: {"name": "üê£ –ù–æ–≤–∏—á–æ–∫", "bonus_exp": 0, "bonus_coins": 0},
    15: {"name": "üéØ –ù–∞—á–∏–Ω–∞—é—â–∏–π –æ—Ö–æ—Ç–Ω–∏–∫", "bonus_exp": 1, "bonus_coins": 0},
    35: {"name": "üèπ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –æ—Ö–æ—Ç–Ω–∏–∫", "bonus_exp": 3, "bonus_coins": 0},
    75: {"name": "‚öîÔ∏è –ú–∞—Å—Ç–µ—Ä –æ—Ö–æ—Ç—ã", "bonus_exp": 5, "bonus_coins": 2},
    150: {"name": "üêâ –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –æ—Ö–æ—Ç–Ω–∏–∫", "bonus_exp": 10, "bonus_coins": 5},
    500: {"name": "üëë –ö–æ—Ä–æ–ª—å –∑–≤–µ—Ä–µ–π", "bonus_exp": 15, "bonus_coins": 8},
    1000: {"name": "üåü –ë–æ–∂–µ—Å—Ç–≤–æ –æ—Ö–æ—Ç—ã", "bonus_exp": 20, "bonus_coins": 10}
}

PRESTIGES = {
    1: {"name": "ü•â –ë—Ä–æ–Ω–∑–∞", "requirements": {"level": 20, "kills": 100, "coins": 20000}},
    2: {"name": "ü•à –°–µ—Ä–µ–±—Ä–æ", "requirements": {"level": 30, "kills": 250, "coins": 50000, "unique_animals": 15}},
    3: {"name": "ü•á –ó–æ–ª–æ—Ç–æ", "requirements": {"level": 40, "kills": 500, "coins": 100000, "titans": 1}},
    4: {"name": "üíé –ü–ª–∞—Ç–∏–Ω–∞", "requirements": {"level": 50, "kills": 750, "coins": 200000, "dangerous": 5}},
    5: {"name": "üîÆ –°–∞–ø—Ñ–∏—Ä", "requirements": {"level": 60, "kills": 1000, "coins": 300000, "titans": 3}},
    6: {"name": "‚ùÑÔ∏è –ö—Ä–∏—Å—Ç–∞–ª–ª", "requirements": {"level": 70, "kills": 1500, "coins": 500000, "arctic": 10}},
    7: {"name": "üåô –û–±—Å–∏–¥–∏–∞–Ω", "requirements": {"level": 80, "kills": 2000, "coins": 750000, "all_locations": True}},
    8: {"name": "‚òÄÔ∏è –ê–º–µ—Ç–∏—Å—Ç", "requirements": {"level": 90, "kills": 3000, "coins": 1000000, "titans": 15}},
    9: {"name": "‚≠ê –¢–æ–ø–∞–∑", "requirements": {"level": 100, "kills": 5000, "coins": 2000000, "all_weapons": True}},
    10: {"name": "üëë –ê–ª–º–∞–∑", "requirements": {"level": 150, "kills": 10000, "coins": 5000000, "all_titans": 5}}
}

STICKERS = {"–ó–∞—è—Ü": "", "–ë–µ–ª–∫–∞": "", "–ë–æ–±—Ä": "", "–ö–∞–±–∞–Ω": "", "–õ–µ–≤": "", "–¢–∏—Ä–∞–Ω–Ω–æ–∑–∞–≤—Ä": ""}

# ================== –ë–ê–ó–ê –î–ê–ù–ù–´–• ==================
db = sqlite3.connect("hunt.db", check_same_thread=False)
sql = db.cursor()

# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü —Å –ø–æ–ª–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
sql.execute("""
CREATE TABLE IF NOT EXISTS users (
    user_id INTEGER PRIMARY KEY,
    coins INTEGER DEFAULT 0,
    exp INTEGER DEFAULT 0,
    weapon TEXT DEFAULT '–†–µ–≤–æ–ª—å–≤–µ—Ä',
    location TEXT DEFAULT '–¢–∞–π–≥–∞',
    last_hunt INTEGER DEFAULT 0,
    daily_kills INTEGER DEFAULT 0,
    total_kills INTEGER DEFAULT 0,
    username TEXT,
    current_title TEXT DEFAULT '',
    prestige INTEGER DEFAULT 0,
    achievement_streak INTEGER DEFAULT 0,
    achievements_completed TEXT DEFAULT '{}',
    health INTEGER DEFAULT 100,
    max_health INTEGER DEFAULT 100,
    deaths INTEGER DEFAULT 0,
    counterattack_streak INTEGER DEFAULT 0,
    titan_escape_streak INTEGER DEFAULT 0,
    trap_days_streak INTEGER DEFAULT 0,
    last_trap_use INTEGER DEFAULT 0,
    traps_used INTEGER DEFAULT 0,
    heavy_traps INTEGER DEFAULT 0,
    last_achievement_check INTEGER DEFAULT 0,
    golden_bullet INTEGER DEFAULT 0,
    drone_target TEXT DEFAULT '',
    drone_expires INTEGER DEFAULT 0,
    last_daily_gift INTEGER DEFAULT 0
)
""")

sql.execute("""
CREATE TABLE IF NOT EXISTS trophies (
    user_id INTEGER,
    animal TEXT,
    count INTEGER DEFAULT 0,
    UNIQUE(user_id, animal),
    FOREIGN KEY (user_id) REFERENCES users(user_id)
)
""")

sql.execute("""
CREATE TABLE IF NOT EXISTS user_weapons (
    user_id INTEGER,
    weapon TEXT,
    UNIQUE(user_id, weapon),
    FOREIGN KEY (user_id) REFERENCES users(user_id)
)
""")

sql.execute("""
CREATE TABLE IF NOT EXISTS user_equipment (
    user_id INTEGER,
    equipment TEXT,
    UNIQUE(user_id, equipment),
    FOREIGN KEY (user_id) REFERENCES users(user_id)
)
""")

sql.execute("""
CREATE TABLE IF NOT EXISTS stats_daily (
    user_id INTEGER,
    date TEXT,
    kills INTEGER DEFAULT 0,
    UNIQUE(user_id, date),
    FOREIGN KEY (user_id) REFERENCES users(user_id)
)
""")

# ================== –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï HP ==================
class HealthRegenerator:
    """–ö–ª–∞—Å—Å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è"""
    
    def __init__(self):
        self.is_running = False
        self.regeneration_thread = None
    
    def start_regeneration(self):
        """–ó–∞–ø—É—Å–∫ –ø–æ—Ç–æ–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è"""
        if self.is_running:
            return
        
        self.is_running = True
        self.regeneration_thread = threading.Thread(target=self._regeneration_loop, daemon=True)
        self.regeneration_thread.start()
        print("ü©∫ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ HP –∑–∞–ø—É—â–µ–Ω–æ")
    
    def stop_regeneration(self):
        """–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è"""
        self.is_running = False
        if self.regeneration_thread:
            self.regeneration_thread.join(timeout=2)
        print("ü©∫ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ HP –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ")
    
    def _regeneration_loop(self):
        """–û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è"""
        while self.is_running:
            try:
                self._regenerate_all_players()
                time.sleep(60)  # –ñ–¥–µ–º 1 –º–∏–Ω—É—Ç—É
            except Exception as e:
                print(f"‚ùå –û—à–∏–±–∫–∞ –≤ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ HP: {e}")
                time.sleep(60)
    
    def _regenerate_all_players(self):
        """–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å HP –≤—Å–µ–º –∏–≥—Ä–æ–∫–∞–º"""
        try:
            all_users = sql.execute("SELECT user_id, health, max_health FROM users").fetchall()
            
            for user in all_users:
                user_id, current_hp, max_hp = user
                
                # –ü–æ–ª—É—á–∞–µ–º –±–æ–Ω—É—Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç –≤–∏—Ç–∞–º–∏–Ω–æ–≤
                healing_rate = 1  # –±–∞–∑–æ–≤–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
                equipment = get_user_equipment(user_id)
                if "–í–∏—Ç–∞–º–∏–Ω—ã" in equipment:
                    healing_rate = 1.5  # x1.5 —Å–∫–æ—Ä–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
                
                # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º HP —Å —É—á–µ—Ç–æ–º –±–æ–Ω—É—Å–∞
                if current_hp < max_hp:
                    new_hp = current_hp + healing_rate
                    if new_hp > max_hp:
                        new_hp = max_hp
                    
                    sql.execute("UPDATE users SET health = ? WHERE user_id = ?", (new_hp, user_id))
            
            db.commit()
            
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ HP: {e}")
            db.rollback()

# –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ–ª—è –∑–¥–æ—Ä–æ–≤—å—è
health_regenerator = HealthRegenerator()

# ================== –§–£–ù–ö–¶–ò–ò ==================
def get_level(exp: int) -> int:
    return exp // EXP_PER_LEVEL

def ensure_user(user_id: int, username: str = None):
    user = sql.execute("SELECT * FROM users WHERE user_id = ?", (user_id,)).fetchone()
    if not user:
        sql.execute(
            """INSERT INTO users 
               (user_id, username, coins, exp, weapon, location, last_hunt, 
                daily_kills, total_kills, current_title, prestige, 
                achievement_streak, achievements_completed, health, max_health,
                deaths, counterattack_streak, titan_escape_streak, trap_days_streak,
                last_trap_use, traps_used, heavy_traps, last_achievement_check,
                golden_bullet, drone_target, drone_expires, last_daily_gift) 
               VALUES (?, ?, 0, 0, '–†–µ–≤–æ–ª—å–≤–µ—Ä', '–¢–∞–π–≥–∞', 0, 0, 0, '', 0, 0, '{}', 100, 100, 0, 0, 0, 0, 0, 0, 0, 0, 0, '', 0, 0)""",
            (user_id, username)
        )
        sql.execute(
            "INSERT OR IGNORE INTO user_weapons VALUES (?, ?)",
            (user_id, "–†–µ–≤–æ–ª—å–≤–µ—Ä")
        )
        db.commit()
        user = sql.execute("SELECT * FROM users WHERE user_id = ?", (user_id,)).fetchone()
    elif username and username != user[8]:
        sql.execute("UPDATE users SET username = ? WHERE user_id = ?", (username, user_id))
        db.commit()
    return user

def get_user_health(user_id: int):
    """–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ –∏–≥—Ä–æ–∫–∞"""
    user = ensure_user(user_id)
    return user[13], user[14]

def update_health(user_id: int, change: int):
    """–ò–∑–º–µ–Ω–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ –∏–≥—Ä–æ–∫–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º)"""
    user = ensure_user(user_id)
    current_hp = user[13]
    max_hp = user[14]
    
    new_hp = current_hp + change
    if new_hp > max_hp:
        new_hp = max_hp
    if new_hp < 0:
        new_hp = 0
    
    sql.execute("UPDATE users SET health = ? WHERE user_id = ?", (new_hp, user_id))
    db.commit()
    
    # –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ —É–º–µ—Ä
    if new_hp <= 0:
        sql.execute("UPDATE users SET deaths = deaths + 1 WHERE user_id = ?", (user_id,))
        db.commit()
        print(f"üíÄ –ò–≥—Ä–æ–∫ {user_id} —É–º–µ—Ä. –¢–µ–∫—É—â–µ–µ –∑–¥–æ—Ä–æ–≤—å–µ: 0/{max_hp}")
    
    return new_hp

def heal_user(user_id: int, amount: int = None):
    """–ü–æ–ª–Ω–æ—Å—Ç—å—é –≤—ã–ª–µ—á–∏—Ç—å –∏–≥—Ä–æ–∫–∞ –∏–ª–∏ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ"""
    user = ensure_user(user_id)
    max_hp = user[14]
    
    if amount is None:
        sql.execute("UPDATE users SET health = ? WHERE user_id = ?", (max_hp, user_id))
    else:
        current_hp = user[13]
        new_hp = current_hp + amount
        if new_hp > max_hp:
            new_hp = max_hp
        sql.execute("UPDATE users SET health = ? WHERE user_id = ?", (new_hp, user_id))
    
    db.commit()

def can_hunt(user_id: int) -> tuple:
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –º–æ–∂–µ—Ç –ª–∏ –∏–≥—Ä–æ–∫ –æ—Ö–æ—Ç–∏—Ç—å—Å—è"""
    user = ensure_user(user_id)
    current_hp = user[13]
    
    # –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ —É–º–µ—Ä (HP = 0), –Ω—É–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å 100 HP –¥–ª—è –æ—Ö–æ—Ç—ã
    if current_hp <= 0:
        return False, "‚ùå –í—ã —Å–ª–∏—à–∫–æ–º —Å–ª–∞–±—ã –¥–ª—è –æ—Ö–æ—Ç—ã! –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å 100 HP.\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–ø—Ç–µ—á–∫—É –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞ –∏–ª–∏ –ø–æ–¥–æ–∂–¥–∏—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è."
    else:
        # –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –∂–∏–≤ (HP > 0), –º–æ–∂–Ω–æ –æ—Ö–æ—Ç–∏—Ç—å—Å—è –¥–∞–∂–µ —Å 1 HP
        return True, "‚úÖ –ú–æ–∂–Ω–æ –æ—Ö–æ—Ç–∏—Ç—å—Å—è"

def get_user_equipment(user_id: int):
    equipment = sql.execute(
        "SELECT equipment FROM user_equipment WHERE user_id = ?", 
        (user_id,)
    ).fetchall()
    return [eq[0] for eq in equipment]

def get_equipment_bonuses(user_id: int):
    equipment = get_user_equipment(user_id)
    bonuses = {"–ú–µ–ª–æ—á—å": 0, "–°—Ä–µ–¥–Ω": 0, "–û–ø–∞—Å–Ω": 0, "–¢—è–∂–µ–ª": 0, "–¢–∏—Ç–∞–Ω": 0}
    
    for eq_name in equipment:
        if eq_name in EQUIPMENT:
            for group, bonus in EQUIPMENT[eq_name].get("bonus", {}).items():
                if group in bonuses:
                    bonuses[group] += bonus
    return bonuses

def get_max_health_from_equipment(user_id: int):
    """–ü–æ–ª—É—á–∏—Ç—å –±–æ–Ω—É—Å –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º—É –∑–¥–æ—Ä–æ–≤—å—é –æ—Ç —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è"""
    equipment = get_user_equipment(user_id)
    bonus_hp = 100  # –±–∞–∑–æ–≤–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ
    
    for eq_name in equipment:
        if eq_name in EQUIPMENT and "bonus" in EQUIPMENT[eq_name]:
            if "health" in EQUIPMENT[eq_name]["bonus"]:
                bonus_hp += EQUIPMENT[eq_name]["bonus"]["health"]
    
    return bonus_hp

def update_max_health(user_id: int):
    """–û–±–Ω–æ–≤–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è"""
    new_max_hp = get_max_health_from_equipment(user_id)
    sql.execute("UPDATE users SET max_health = ? WHERE user_id = ?", (new_max_hp, user_id))
    
    current_hp, _ = get_user_health(user_id)
    if current_hp > new_max_hp:
        sql.execute("UPDATE users SET health = ? WHERE user_id = ?", (new_max_hp, user_id))
    
    db.commit()
    return new_max_hp

def choose_animal(location: str, user_id: int):
    available_groups = [g for g in SEARCH_CHANCES if LOCATIONS[location]["animals"].get(g) and LOCATIONS[location]["animals"][g]]
    if not available_groups:
        return None, None
    
    bonuses = get_equipment_bonuses(user_id)
    equipment = get_user_equipment(user_id)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥—Ä–æ–Ω-–±–æ–Ω—É—Å
    user = ensure_user(user_id)
    drone_target = user[24] if len(user) > 24 else ''
    drone_expires = user[25] if len(user) > 25 else 0
    
    if drone_target and drone_expires > int(time.time()):
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ü–µ–ª–µ–≤–æ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ –≤ —ç—Ç–æ–π –ª–æ–∫–∞—Ü–∏–∏
        target_in_location = False
        target_group = None
        for group, animals in LOCATIONS[location]["animals"].items():
            if drone_target in animals:
                target_in_location = True
                target_group = group
                break
        
        if target_in_location:
            # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —à–∞–Ω—Å –Ω–∞–π—Ç–∏ —Ü–µ–ª–µ–≤–æ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ –Ω–∞ 10%
            if random.randint(1, 100) <= 10:
                return target_group, drone_target
    
    # –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∏—Å–∫–∞—Ç–µ–ª—å - –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –Ω–∞—Ö–æ–¥–∏–º –∂–∏–≤–æ—Ç–Ω–æ–µ
    if "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∏—Å–∫–∞—Ç–µ–ª—å" in equipment:
        group = random.choice(available_groups)
        animal = random.choice(LOCATIONS[location]["animals"][group])
        return group, animal
    
    # –û–±—ã—á–Ω—ã–π –ø–æ–∏—Å–∫ —Å —É—á–µ—Ç–æ–º –±–æ–Ω—É—Å–æ–≤
    weights = []
    for g in available_groups:
        base_chance = SEARCH_CHANCES[g]
        bonus = bonuses.get(g, 0)
        weights.append(base_chance + bonus)
    
    group = random.choices(available_groups, weights=weights)[0]
    
    search_chance = SEARCH_CHANCES[group] + bonuses.get(group, 0)
    if random.randint(1, 100) > search_chance:
        return None, None
    
    animal = random.choice(LOCATIONS[location]["animals"][group])
    return group, animal

def check_hit(weapon: str, group: str, user_id: int = None):
    groups = ["–ú–µ–ª–æ—á—å", "–°—Ä–µ–¥–Ω", "–û–ø–∞—Å–Ω", "–¢—è–∂–µ–ª", "–¢–∏—Ç–∞–Ω"]
    if group not in groups:
        return False
    
    idx = groups.index(group)
    
    # –ü–æ–ª—É—á–∞–µ–º –±–∞–∑–æ–≤—ã–π —à–∞–Ω—Å
    weapon_data = WEAPONS.get(weapon, WEAPONS["–†–µ–≤–æ–ª—å–≤–µ—Ä"])
    chance = weapon_data["chances"][idx]
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–æ–ª–æ—Ç—É—é –ø—É–ª—é
    if user_id:
        user = ensure_user(user_id)
        has_golden_bullet = user[23] if len(user) > 23 else 0
        if has_golden_bullet:
            chance *= 2  # x2 —à–∞–Ω—Å –ø–æ–ø–∞–¥–∞–Ω–∏—è
            sql.execute("UPDATE users SET golden_bullet = 0 WHERE user_id = ?", (user_id,))
            db.commit()
    
    return random.uniform(0, 100) <= chance

def can_use_location(user_level: int, location_name: str) -> bool:
    return user_level >= LOCATIONS[location_name]["level"]

def reset_daily_stats():
    today = datetime.now().strftime("%Y-%m-%d")
    sql.execute("UPDATE users SET daily_kills = 0")
    sql.execute("DELETE FROM stats_daily WHERE date != ?", (today,))
    db.commit()

def get_user_rank(total_kills: int):
    sorted_thresholds = sorted(RANKS.keys(), reverse=True)
    for threshold in sorted_thresholds:
        if total_kills >= threshold:
            return RANKS[threshold]
    return RANKS[0]

def get_completed_achievements(user_id: int):
    result = sql.execute("SELECT achievements_completed FROM users WHERE user_id = ?", (user_id,)).fetchone()
    if result and result[0]:
        try:
            return eval(result[0])
        except:
            return {}
    return {}

def check_prestige_requirements(user_id: int, prestige_level: int):
    if prestige_level not in PRESTIGES:
        return False, "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –ø—Ä–µ—Å—Ç–∏–∂–∞"
    
    user = ensure_user(user_id)
    requirements = PRESTIGES[prestige_level]["requirements"]
    total_kills = user[7]
    level = get_level(user[2])
    coins = user[1]
    
    if level < requirements.get("level", 0):
        return False, f"–¢—Ä–µ–±—É–µ—Ç—Å—è —É—Ä–æ–≤–µ–Ω—å {requirements.get('level', 0)}"
    if total_kills < requirements.get("kills", 0):
        return False, f"–¢—Ä–µ–±—É–µ—Ç—Å—è {requirements.get('kills', 0)} —É–±–∏–π—Å—Ç–≤"
    if coins < requirements.get("coins", 0):
        return False, f"–¢—Ä–µ–±—É–µ—Ç—Å—è {requirements.get('coins', 0)} –º–æ–Ω–µ—Ç"
    
    if "unique_animals" in requirements:
        unique_count = len(sql.execute("SELECT COUNT(DISTINCT animal) FROM trophies WHERE user_id = ?", (user_id,)).fetchone())
        if unique_count < requirements["unique_animals"]:
            return False, f"–¢—Ä–µ–±—É–µ—Ç—Å—è {requirements['unique_animals']} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö"
    
    if "titans" in requirements:
        titan_animals = []
        for loc in LOCATIONS.values():
            titan_animals.extend(loc["animals"].get("–¢–∏—Ç–∞–Ω", []))
        titan_kills = 0
        for animal in titan_animals:
            result = sql.execute("SELECT count FROM trophies WHERE user_id = ? AND animal = ?", (user_id, animal)).fetchone()
            if result:
                titan_kills += result[0]
        if titan_kills < requirements["titans"]:
            return False, f"–¢—Ä–µ–±—É–µ—Ç—Å—è —É–±–∏—Ç—å {requirements['titans']} —Ç–∏—Ç–∞–Ω–æ–≤"
    
    return True, "–í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã"

def use_traps(user_id: int):
    now = int(time.time())
    user = ensure_user(user_id)
    last_use = user[19] if len(user) > 19 else 0
    
    if last_use > 0 and (now - last_use) < 86400:
        hours_left = (86400 - (now - last_use)) // 3600
        minutes_left = ((86400 - (now - last_use)) % 3600) // 60
        return False, f"‚è≥ –õ–æ–≤—É—à–∫–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ {hours_left}—á {minutes_left}–º"
    
    animal_count = 3
    if "–£–ª—É—á—à–µ–Ω–Ω—ã–µ –ª–æ–≤—É—à–∫–∏" in get_user_equipment(user_id):
        animal_count = 5
    
    location = user[4]
    caught_animals = []
    
    for _ in range(animal_count):
        rand = random.randint(1, 100)
        if rand <= 50:
            group = "–ú–µ–ª–æ—á—å"
        elif rand <= 90:
            group = "–°—Ä–µ–¥–Ω"
        elif rand <= 98:
            group = "–û–ø–∞—Å–Ω"
        else:
            group = "–¢—è–∂–µ–ª"
        
        if group in LOCATIONS[location]["animals"] and LOCATIONS[location]["animals"][group]:
            animal = random.choice(LOCATIONS[location]["animals"][group])
            caught_animals.append((group, animal))
            
            if group == "–¢—è–∂–µ–ª":
                sql.execute("UPDATE users SET heavy_traps = heavy_traps + 1 WHERE user_id = ?", (user_id,))
    
    sql.execute("UPDATE users SET last_trap_use = ?, traps_used = traps_used + 1, trap_days_streak = trap_days_streak + 1 WHERE user_id = ?", 
                (now, user_id))
    db.commit()
    
    return True, caught_animals

def get_animal_attack_phrase(animal: str) -> str:
    """–ü–æ–ª—É—á–∏—Ç—å —Ñ—Ä–∞–∑—É –∞—Ç–∞–∫–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∂–∏–≤–æ—Ç–Ω–æ–≥–æ"""
    phrases = ANIMAL_ATTACK_PHRASES.get(animal, [])
    if phrases:
        return random.choice(phrases)
    
    # –ï—Å–ª–∏ –Ω–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π —Ñ—Ä–∞–∑—ã, —Å–æ–∑–¥–∞–µ–º –æ–±—â—É—é
    group = None
    for loc in LOCATIONS.values():
        for g, animals in loc["animals"].items():
            if animal in animals:
                group = g
                break
        if group:
            break
    
    damage = CONTRATTACK_DAMAGE.get(group, 25)
    return f"{animal} –∞—Ç–∞–∫—É–µ—Ç! -{damage}HP"

def check_achievements(user_id: int):
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –≤—ã–¥–∞—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏–≥—Ä–æ–∫—É"""
    user = ensure_user(user_id)
    completed = get_completed_achievements(user_id)
    new_achievements = []
    
    # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞
    coins = user[1]
    exp = user[2]
    total_kills = user[7]
    current_hp, max_hp = get_user_health(user_id)
    deaths = user[15] if len(user) > 15 else 0
    counterattack_streak = user[16] if len(user) > 16 else 0
    titan_escape_streak = user[17] if len(user) > 17 else 0
    trap_days_streak = user[18] if len(user) > 18 else 0
    heavy_traps = user[21] if len(user) > 21 else 0
    achievement_streak = user[11] if len(user) > 11 else 0
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
    for achievement_name, achievement_data in ACHIEVEMENTS.items():
        if achievement_name in completed:
            continue
            
        condition_met = False
        
        if achievement_data["condition_type"] == "animal_kills":
            animal_name, required_count = achievement_data["condition_value"]
            result = sql.execute("SELECT count FROM trophies WHERE user_id = ? AND animal = ?", (user_id, animal_name)).fetchone()
            if result and result[0] >= required_count:
                condition_met = True
                
        elif achievement_data["condition_type"] == "titan_kills":
            titan_animals = []
            for loc in LOCATIONS.values():
                titan_animals.extend(loc["animals"].get("–¢–∏—Ç–∞–Ω", []))
            titan_kills = 0
            for animal in titan_animals:
                result = sql.execute("SELECT count FROM trophies WHERE user_id = ? AND animal = ?", (user_id, animal)).fetchone()
                if result:
                    titan_kills += result[0]
            if titan_kills >= achievement_data["condition_value"]:
                condition_met = True
                
        elif achievement_data["condition_type"] == "coins":
            if coins >= achievement_data["condition_value"]:
                condition_met = True
                
        elif achievement_data["condition_type"] == "location_kills":
            location_name, required_count = achievement_data["condition_value"]
            # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö –∏–∑ —ç—Ç–æ–π –ª–æ–∫–∞—Ü–∏–∏
            location_animals = []
            for group, animals in LOCATIONS[location_name]["animals"].items():
                location_animals.extend(animals)
            
            location_kills = 0
            for animal in location_animals:
                result = sql.execute("SELECT count FROM trophies WHERE user_id = ? AND animal = ?", (user_id, animal)).fetchone()
                if result:
                    location_kills += result[0]
            if location_kills >= required_count:
                condition_met = True
                
        elif achievement_data["condition_type"] == "unique_animals":
            unique_count = len(sql.execute("SELECT COUNT(DISTINCT animal) FROM trophies WHERE user_id = ?", (user_id,)).fetchone())
            if unique_count >= achievement_data["condition_value"]:
                condition_met = True
                
        elif achievement_data["condition_type"] == "streak":
            if achievement_streak >= achievement_data["condition_value"]:
                condition_met = True
                
        elif achievement_data["condition_type"] == "max_health":
            if max_hp >= achievement_data["condition_value"]:
                condition_met = True
                
        elif achievement_data["condition_type"] == "counterattack_streak":
            if counterattack_streak >= achievement_data["condition_value"]:
                condition_met = True
                
        elif achievement_data["condition_type"] == "titan_escape_streak":
            if titan_escape_streak >= achievement_data["condition_value"]:
                condition_met = True
                
        elif achievement_data["condition_type"] == "deaths":
            if deaths >= achievement_data["condition_value"]:
                condition_met = True
                
        elif achievement_data["condition_type"] == "trap_heavy":
            if heavy_traps >= achievement_data["condition_value"]:
                condition_met = True
                
        elif achievement_data["condition_type"] == "trap_days_streak":
            if trap_days_streak >= achievement_data["condition_value"]:
                condition_met = True
        
        # –ï—Å–ª–∏ —É—Å–ª–æ–≤–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ, –≤—ã–¥–∞–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ
        if condition_met:
            # –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–ø–∏—Å–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö
            completed[achievement_name] = {
                "completed_at": int(time.time()),
                "reward_coins": achievement_data["reward_coins"],
                "reward_exp": achievement_data["reward_exp"],
                "title": achievement_data["title"]
            }
            
            # –í—ã–¥–∞–µ–º –Ω–∞–≥—Ä–∞–¥—ã
            sql.execute("UPDATE users SET coins = coins + ?, exp = exp + ? WHERE user_id = ?", 
                       (achievement_data["reward_coins"], achievement_data["reward_exp"], user_id))
            
            new_achievements.append(achievement_name)
    
    # –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
    if new_achievements:
        sql.execute("UPDATE users SET achievements_completed = ? WHERE user_id = ?", 
                   (str(completed), user_id))
        sql.execute("UPDATE users SET last_achievement_check = ? WHERE user_id = ?", 
                   (int(time.time()), user_id))
        db.commit()
    
    return new_achievements

def get_daily_gift(user_id: int):
    """–ü–æ–ª—É—á–∏—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫"""
    user = ensure_user(user_id)
    last_gift = user[26] if len(user) > 26 else 0
    now = int(time.time())
    
    if last_gift > 0 and (now - last_gift) < 86400:
        hours_left = (86400 - (now - last_gift)) // 3600
        minutes_left = ((86400 - (now - last_gift)) % 3600) // 60
        return False, f"‚è≥ –°–ª–µ–¥—É—é—â–∏–π –ø–æ–¥–∞—Ä–æ–∫ —á–µ—Ä–µ–∑ {hours_left}—á {minutes_left}–º"
    
    # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é –Ω–∞–≥—Ä–∞–¥—É
    rewards = [
        ("üí∞ 100 –º–æ–Ω–µ—Ç", 100, 0),
        ("üí∞ 200 –º–æ–Ω–µ—Ç", 200, 0),
        ("üí∞ 250 –º–æ–Ω–µ—Ç", 250, 0),
        ("‚≠ê 200 –æ–ø—ã—Ç–∞", 0, 200),
        ("‚≠ê 300 –æ–ø—ã—Ç–∞", 0, 300),
        ("‚≠ê 400 –æ–ø—ã—Ç–∞", 0, 400),
    ]
    
    reward_text, coins, exp = random.choice(rewards)
    
    # –í—ã–¥–∞–µ–º –Ω–∞–≥—Ä–∞–¥—É
    sql.execute("UPDATE users SET coins = coins + ?, exp = exp + ?, last_daily_gift = ? WHERE user_id = ?",
                (coins, exp, now, user_id))
    db.commit()
    
    return True, reward_text

# ================== –ë–û–¢ ==================
bot = Bot(TOKEN)
dp = Dispatcher()

# ================== –ê–î–ú–ò–ù –ö–û–ú–ê–ù–î–´ ==================
@dp.message(lambda msg: msg.text and msg.text.startswith("–¥–∏–ø—Å–∫–∏–ø"))
async def admin_skip(msg: Message):
    """–°–±—Ä–æ—Å–∏—Ç—å —Ç–∞–π–º–µ—Ä –æ—Ö–æ—Ç—ã –¥–ª—è –∏–≥—Ä–æ–∫–∞"""
    try:
        if msg.from_user.id != ADMIN_ID and msg.from_user.username != ADMIN_USERNAME:
            await msg.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã")
            return
            
        parts = msg.text.split()
        if len(parts) >= 2 and "@" in parts[1]:
            username = parts[1].replace("@", "").strip()
            user = sql.execute("SELECT user_id FROM users WHERE username = ?", (username,)).fetchone()
            if user:
                sql.execute("UPDATE users SET last_hunt = 0 WHERE user_id = ?", (user[0],))
                db.commit()
                await msg.answer(f"‚úÖ –¢–∞–π–º–µ—Ä —Å–±—Ä–æ—à–µ–Ω –¥–ª—è @{username}")
                print(f"üîß –ê–¥–º–∏–Ω {msg.from_user.id} —Å–±—Ä–æ—Å–∏–ª —Ç–∞–π–º–µ—Ä –¥–ª—è @{username}")
            else:
                await msg.answer(f"‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å @{username} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ")
        else:
            await msg.answer("‚ùå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –¥–∏–ø—Å–∫–∏–ø @username\n–ü—Ä–∏–º–µ—Ä: –¥–∏–ø—Å–∫–∏–ø @player123")
    except Exception as e:
        await msg.answer(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

@dp.message(lambda msg: msg.text and msg.text.startswith("–¥–∏–ø–º–æ–Ω–µ—Ç—ã"))
async def admin_coins(msg: Message):
    """–í—ã–¥–∞—Ç—å –º–æ–Ω–µ—Ç—ã –∏–≥—Ä–æ–∫—É"""
    try:
        if msg.from_user.id != ADMIN_ID and msg.from_user.username != ADMIN_USERNAME:
            await msg.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã")
            return
            
        parts = msg.text.split()
        if len(parts) >= 3 and "@" in parts[2]:
            amount = int(parts[1])
            username = parts[2].replace("@", "").strip()
            user = sql.execute("SELECT user_id FROM users WHERE username = ?", (username,)).fetchone()
            if user:
                sql.execute("UPDATE users SET coins = coins + ? WHERE user_id = ?", (amount, user[0]))
                db.commit()
                await msg.answer(f"‚úÖ –í—ã–¥–∞–Ω–æ {amount} –º–æ–Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é @{username}")
                print(f"üîß –ê–¥–º–∏–Ω {msg.from_user.id} –≤—ã–¥–∞–ª {amount} –º–æ–Ω–µ—Ç @{username}")
            else:
                await msg.answer(f"‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å @{username} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ")
        else:
            await msg.answer("‚ùå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –¥–∏–ø–º–æ–Ω–µ—Ç—ã 100 @username\n–ü—Ä–∏–º–µ—Ä: –¥–∏–ø–º–æ–Ω–µ—Ç—ã 500 @player123")
    except ValueError:
        await msg.answer("‚ùå –û—à–∏–±–∫–∞: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–Ω–µ—Ç –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–∏—Å–ª–æ–º")
    except Exception as e:
        await msg.answer(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

@dp.message(lambda msg: msg.text and msg.text.startswith("–¥–∏–ø–æ–ø—ã—Ç"))
async def admin_exp(msg: Message):
    """–í—ã–¥–∞—Ç—å –æ–ø—ã—Ç –∏–≥—Ä–æ–∫—É"""
    try:
        if msg.from_user.id != ADMIN_ID and msg.from_user.username != ADMIN_USERNAME:
            await msg.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã")
            return
            
        parts = msg.text.split()
        if len(parts) >= 3 and "@" in parts[2]:
            amount = int(parts[1])
            username = parts[2].replace("@", "").strip()
            user = sql.execute("SELECT user_id FROM users WHERE username = ?", (username,)).fetchone()
            if user:
                sql.execute("UPDATE users SET exp = exp + ? WHERE user_id = ?", (amount, user[0]))
                db.commit()
                await msg.answer(f"‚úÖ –í—ã–¥–∞–Ω–æ {amount} –æ–ø—ã—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é @{username}")
                print(f"üîß –ê–¥–º–∏–Ω {msg.from_user.id} –≤—ã–¥–∞–ª {amount} –æ–ø—ã—Ç–∞ @{username}")
            else:
                await msg.answer(f"‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å @{username} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ")
        else:
            await msg.answer("‚ùå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –¥–∏–ø–æ–ø—ã—Ç 500 @username\n–ü—Ä–∏–º–µ—Ä: –¥–∏–ø–æ–ø—ã—Ç 1000 @player123")
    except ValueError:
        await msg.answer("‚ùå –û—à–∏–±–∫–∞: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø—ã—Ç–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–∏—Å–ª–æ–º")
    except Exception as e:
        await msg.answer(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

@dp.message(lambda msg: msg.text and msg.text.startswith("–¥–∏–ø—É—Ä–æ–≤–Ω–∏"))
async def admin_level(msg: Message):
    """–í—ã–¥–∞—Ç—å —É—Ä–æ–≤–Ω–∏ –∏–≥—Ä–æ–∫—É"""
    try:
        if msg.from_user.id != ADMIN_ID and msg.from_user.username != ADMIN_USERNAME:
            await msg.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã")
            return
            
        parts = msg.text.split()
        if len(parts) >= 3 and "@" in parts[2]:
            levels = int(parts[1])
            username = parts[2].replace("@", "").strip()
            user = sql.execute("SELECT user_id FROM users WHERE username = ?", (username,)).fetchone()
            if user:
                exp_needed = levels * EXP_PER_LEVEL
                sql.execute("UPDATE users SET exp = exp + ? WHERE user_id = ?", (exp_needed, user[0]))
                db.commit()
                await msg.answer(f"‚úÖ –í—ã–¥–∞–Ω–æ {levels} —É—Ä–æ–≤–Ω–µ–π ({exp_needed} –æ–ø—ã—Ç–∞) –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é @{username}")
                print(f"üîß –ê–¥–º–∏–Ω {msg.from_user.id} –≤—ã–¥–∞–ª {levels} —É—Ä–æ–≤–Ω–µ–π @{username}")
            else:
                await msg.answer(f"‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å @{username} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ")
        else:
            await msg.answer("‚ùå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –¥–∏–ø—É—Ä–æ–≤–Ω–∏ 5 @username\n–ü—Ä–∏–º–µ—Ä: –¥–∏–ø—É—Ä–æ–≤–Ω–∏ 3 @player123")
    except ValueError:
        await msg.answer("‚ùå –û—à–∏–±–∫–∞: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Ä–æ–≤–Ω–µ–π –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–∏—Å–ª–æ–º")
    except Exception as e:
        await msg.answer(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

@dp.message(lambda msg: msg.text and msg.text.startswith("–¥–∏–ø–∑–¥"))
async def admin_hp(msg: Message):
    """–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ –∏–≥—Ä–æ–∫—É"""
    try:
        if msg.from_user.id != ADMIN_ID and msg.from_user.username != ADMIN_USERNAME:
            await msg.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã")
            return
            
        parts = msg.text.split()
        if len(parts) >= 3 and "@" in parts[2]:
            hp_amount = int(parts[1])
            username = parts[2].replace("@", "").strip()
            user = sql.execute("SELECT user_id FROM users WHERE username = ?", (username,)).fetchone()
            if user:
                max_hp_result = sql.execute("SELECT max_health FROM users WHERE user_id = ?", (user[0],)).fetchone()
                max_hp = max_hp_result[0] if max_hp_result else 100
                
                if hp_amount > max_hp:
                    hp_amount = max_hp
                
                sql.execute("UPDATE users SET health = ? WHERE user_id = ?", (hp_amount, user[0]))
                db.commit()
                await msg.answer(f"‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ {hp_amount} HP –¥–ª—è @{username}")
                print(f"üîß –ê–¥–º–∏–Ω {msg.from_user.id} —É—Å—Ç–∞–Ω–æ–≤–∏–ª {hp_amount} HP –¥–ª—è @{username}")
            else:
                await msg.answer(f"‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å @{username} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ")
        else:
            await msg.answer("‚ùå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –¥–∏–ø–∑–¥ <–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_HP> @username\n–ü—Ä–∏–º–µ—Ä: –¥–∏–ø–∑–¥ 1000 @player123")
    except ValueError:
        await msg.answer("‚ùå –û—à–∏–±–∫–∞: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ HP –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–∏—Å–ª–æ–º")
    except Exception as e:
        await msg.answer(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

@dp.message(lambda msg: msg.text and msg.text.startswith("–¥–∏–ø–Ω–æ–ª—å"))
async def admin_reset(msg: Message):
    """–ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å –ø—Ä–æ—Ñ–∏–ª—è –∏–≥—Ä–æ–∫–∞"""
    try:
        if msg.from_user.id != ADMIN_ID and msg.from_user.username != ADMIN_USERNAME:
            await msg.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã")
            return
            
        parts = msg.text.split()
        if len(parts) >= 2 and "@" in parts[1]:
            username = parts[1].replace("@", "").strip()
            user = sql.execute("SELECT user_id FROM users WHERE username = ?", (username,)).fetchone()
            if user:
                user_id = user[0]
                
                sql.execute("""
                    UPDATE users SET 
                    coins = 0, exp = 0, weapon = '–†–µ–≤–æ–ª—å–≤–µ—Ä', location = '–¢–∞–π–≥–∞',
                    last_hunt = 0, daily_kills = 0, total_kills = 0, current_title = '',
                    prestige = 0, achievement_streak = 0, achievements_completed = '{}',
                    health = 100, max_health = 100, deaths = 0, counterattack_streak = 0,
                    titan_escape_streak = 0, trap_days_streak = 0, last_trap_use = 0,
                    traps_used = 0, heavy_traps = 0, last_achievement_check = 0,
                    golden_bullet = 0, drone_target = '', drone_expires = 0, last_daily_gift = 0
                    WHERE user_id = ?
                """, (user_id,))
                
                sql.execute("DELETE FROM trophies WHERE user_id = ?", (user_id,))
                sql.execute("DELETE FROM user_equipment WHERE user_id = ?", (user_id,))
                sql.execute("DELETE FROM user_weapons WHERE user_id = ? AND weapon != '–†–µ–≤–æ–ª—å–≤–µ—Ä'", (user_id,))
                sql.execute("DELETE FROM stats_daily WHERE user_id = ?", (user_id,))
                
                db.commit()
                await msg.answer(f"‚úÖ –ü—Ä–æ—Ñ–∏–ª—å @{username} –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–±—Ä–æ—à–µ–Ω!")
                print(f"üîß –ê–¥–º–∏–Ω {msg.from_user.id} —Å–±—Ä–æ—Å–∏–ª –ø—Ä–æ—Ñ–∏–ª—å @{username}")
            else:
                await msg.answer(f"‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å @{username} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ")
        else:
            await msg.answer("‚ùå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –¥–∏–ø–Ω–æ–ª—å @username\n–ü—Ä–∏–º–µ—Ä: –¥–∏–ø–Ω–æ–ª—å @player123")
    except Exception as e:
        await msg.answer(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

# ================== –û–°–ù–û–í–ù–´–ï –ö–û–ú–ê–ù–î–´ ==================
@dp.message(Command("start"))
async def start(msg: Message):
    ensure_user(msg.from_user.id, msg.from_user.username)
    await msg.answer(
        "üèπ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –æ—Ö–æ—Ç—É!\n\n"
        "üìã –ö–æ–º–∞–Ω–¥—ã:\n"
        "‚Ä¢ –•–∞–Ω—Ç ‚Äî –Ω–∞—á–∞—Ç—å –æ—Ö–æ—Ç—É\n"
        "‚Ä¢ –°–æ—Å—Ç–æ—è–Ω–∏–µ ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ\n" 
        "‚Ä¢ –ò–Ω–≤ ‚Äî –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–Ω–∞—Ä—è–∂–µ–Ω–∏–µ\n"
        "‚Ä¢ –ú–∞–≥–∞–∑–∏–Ω ‚Äî –∫—É–ø–∏—Ç—å –æ—Ä—É–∂–∏–µ –∏ —Å–Ω–∞—Ä—è–∂–µ–Ω–∏–µ\n"
        "‚Ä¢ –õ–æ–∫–∞—Ü–∏–∏ ‚Äî –≤—ã–±—Ä–∞—Ç—å –ª–æ–∫–∞—Ü–∏—é\n"
        "‚Ä¢ –¢–æ–ø—ã ‚Äî —Ç–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤\n"
        "‚Ä¢ –°–ø—Ä–∞–≤–∫–∞ ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ\n"
        "‚Ä¢ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è ‚Äî –≤–∞—à–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è\n"
        "‚Ä¢ –¢–∏—Ç—É–ª—ã ‚Äî –≤—ã–±—Ä–∞—Ç—å —Ç–∏—Ç—É–ª\n"
        "‚Ä¢ –ü—Ä–µ—Å—Ç–∏–∂ ‚Äî –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–µ—Å—Ç–∏–∂\n"
        "‚Ä¢ –õ–æ–≤—É—à–∫–∏ ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–≤—É—à–∫–∏ (—Ä–∞–∑ –≤ 24—á)\n"
        "‚Ä¢ –ü–æ–¥–∞—Ä–æ–∫ ‚Äî –ø–æ–ª—É—á–∏—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫\n"
    )

@dp.message(lambda msg: msg.text and msg.text.lower() == "—Å–ø—Ä–∞–≤–∫–∞")
async def help_command(msg: Message):
    await msg.answer("–ï—Å–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã/–ø—Ä–æ–±–ª–µ–º—ã —Å –±–æ—Ç–æ–º/–∏–¥–µ–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Ç–æ –Ω–∞–ø–∏—à–∏ @DeepSleep01")

@dp.message(lambda msg: msg.text and msg.text.lower() == "—Å–æ—Å—Ç–æ—è–Ω–∏–µ")
async def health_status(msg: Message):
    """–ü–æ–∫–∞–∑–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—å—è –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏"""
    user = ensure_user(msg.from_user.id, msg.from_user.username)
    current_hp, max_hp = get_user_health(msg.from_user.id)
    deaths = user[15] if len(user) > 15 else 0
    
    status_text = f"‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ: {current_hp}/{max_hp}\n"
    
    if current_hp <= 0:
        status_text += f"üíÄ –í—ã –º–µ—Ä—Ç–≤—ã! –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å 100 HP –¥–ª—è –æ—Ö–æ—Ç—ã.\n"
        hp_needed = 100 - current_hp
        status_text += f"üìâ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ: 1 HP –≤ –º–∏–Ω—É—Ç—É\n"
        status_text += f"üîÑ –î–æ –≤–æ–∑—Ä–æ–∂–¥–µ–Ω–∏—è –æ—Å—Ç–∞–ª–æ—Å—å: {hp_needed} –º–∏–Ω—É—Ç\n\n"
        status_text += "üí° –°–æ–≤–µ—Ç: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–ø—Ç–µ—á–∫—É –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ª–µ—á–µ–Ω–∏—è!"
    elif current_hp < max_hp:
        healing_rate = 1
        equipment = get_user_equipment(msg.from_user.id)
        if "–í–∏—Ç–∞–º–∏–Ω—ã" in equipment:
            healing_rate = 1.5
            status_text += "üíä –ë–æ–Ω—É—Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: x1.5 (–≤–∏—Ç–∞–º–∏–Ω—ã)\n"
        
        minutes_to_full = (max_hp - current_hp) / healing_rate
        status_text += f"üìà –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ: {healing_rate} HP –≤ –º–∏–Ω—É—Ç—É\n"
        status_text += f"üïê –î–æ –ø–æ–ª–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: {int(minutes_to_full)} –º–∏–Ω—É—Ç\n"
    else:
        status_text += "‚úÖ –í—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–¥–æ—Ä–æ–≤—ã!\n"
    
    status_text += f"\nüìä –°–º–µ—Ä—Ç–µ–π: {deaths}"
    
    await msg.answer(status_text)

@dp.message(lambda msg: msg.text and msg.text.lower() == "–ø–æ–¥–∞—Ä–æ–∫")
async def daily_gift(msg: Message):
    """–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫"""
    success, result = get_daily_gift(msg.from_user.id)
    if success:
        await msg.answer(f"üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫!\n\n–í—ã –ø–æ–ª—É—á–∏–ª–∏: {result}")
    else:
        await msg.answer(result)

# ================== –•–ê–ù–¢ ==================
@dp.message(lambda msg: msg.text and msg.text.lower() == "—Ö–∞–Ω—Ç")
async def hunt(msg: Message):
    can_hunt_result, message = can_hunt(msg.from_user.id)
    if not can_hunt_result:
        await msg.answer(message)
        return
    
    user = ensure_user(msg.from_user.id, msg.from_user.username)
    now = int(time.time())
    
    if now - user[5] < HUNT_COOLDOWN:
        wait = HUNT_COOLDOWN - (now - user[5])
        minutes = wait // 60
        seconds = wait % 60
        
        kb = InlineKeyboardMarkup(inline_keyboard=[[
            InlineKeyboardButton(text=f"üîÑ –û–±–Ω—É–ª–∏—Ç—å —Ç–∞–π–º–µ—Ä –∑–∞ 450üí∞", callback_data=f"reset_cooldown:{msg.from_user.id}")
        ]])
        
        await msg.answer(f"‚è≥ –ü–æ–¥–æ–∂–¥–∏ {minutes} –º–∏–Ω {seconds} —Å–µ–∫.", reply_markup=kb)
        return
    
    sql.execute("UPDATE users SET last_hunt = ? WHERE user_id = ?", (now, msg.from_user.id))
    db.commit()
    
    group, animal = choose_animal(user[4], msg.from_user.id)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∏—Å–∫–∞—Ç–µ–ª—å
    equipment = get_user_equipment(msg.from_user.id)
    if "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∏—Å–∫–∞—Ç–µ–ª—å" in equipment and not animal:
        # –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –Ω–∞—Ö–æ–¥–∏–º –∂–∏–≤–æ—Ç–Ω–æ–µ
        available_groups = [g for g in SEARCH_CHANCES if LOCATIONS[user[4]]["animals"].get(g) and LOCATIONS[user[4]]["animals"][g]]
        if available_groups:
            group = random.choice(available_groups)
            animal = random.choice(LOCATIONS[user[4]]["animals"][group])
    
    if not animal:
        await msg.answer(f"–¢—ã –±–ª—É–∂–¥–∞–µ—à—å –ø–æ {user[4]}, –Ω–æ –ø–æ–∏—Å–∫–∏ –±–µ–∑—É—Å–ø–µ—à–Ω—ã.")
        return
    
    # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö
    hunt_data = f"{msg.from_user.id}|{group}|{animal}|{int(time.time())}"
    
    kb = InlineKeyboardMarkup(inline_keyboard=[[InlineKeyboardButton(
        text="üî´ –í—ã—Å—Ç—Ä–µ–ª",
        callback_data=f"shoot|{hunt_data}"
    )]])
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–æ–ª–æ—Ç—É—é –ø—É–ª—é
    has_golden_bullet = user[23] if len(user) > 23 else 0
    if has_golden_bullet:
        await msg.answer(f"üí´ –ó–æ–ª–æ—Ç–∞—è –ø—É–ª—è –∞–∫—Ç–∏–≤–Ω–∞! –®–∞–Ω—Å –ø–æ–ø–∞–¥–∞–Ω–∏—è x2\n–¢—ã –±–ª—É–∂–¥–∞–µ—à—å –ø–æ {user[4]} –∏ –≤–Ω–µ–∑–∞–ø–Ω–æ –∑–∞–º–µ—á–∞–µ—à—å {animal}!", reply_markup=kb)
    else:
        await msg.answer(f"–¢—ã –±–ª—É–∂–¥–∞–µ—à—å –ø–æ {user[4]} –∏ –≤–Ω–µ–∑–∞–ø–Ω–æ –∑–∞–º–µ—á–∞–µ—à—å {animal}!", reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("reset_cooldown"))
async def reset_cooldown(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 2:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id = int(data_parts[1])
    
    if user_id != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à —Ç–∞–π–º–µ—Ä!", show_alert=True)
        return
    
    user = ensure_user(call.from_user.id)
    
    if user[1] < 450:
        await call.answer("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç! –ù—É–∂–Ω–æ 450üí∞", show_alert=True)
        return
    
    sql.execute("UPDATE users SET coins = coins - 450, last_hunt = 0 WHERE user_id = ?", (call.from_user.id,))
    db.commit()
    
    await call.message.edit_text("‚úÖ –¢–∞–π–º–µ—Ä –æ—Ö–æ—Ç—ã –æ–±–Ω—É–ª–µ–Ω! –ú–æ–∂–µ—Ç–µ —Å–Ω–æ–≤–∞ –æ—Ö–æ—Ç–∏—Ç—å—Å—è.")
    
    group, animal = choose_animal(user[4], call.from_user.id)
    if not animal:
        await call.message.answer(f"–¢—ã –±–ª—É–∂–¥–∞–µ—à—å –ø–æ {user[4]}, –Ω–æ –ø–æ–∏—Å–∫–∏ –±–µ–∑—É—Å–ø–µ—à–Ω—ã.")
        return
    
    hunt_data = f"{call.from_user.id}|{group}|{animal}|{int(time.time())}"
    
    kb = InlineKeyboardMarkup(inline_keyboard=[[InlineKeyboardButton(
        text="üî´ –í—ã—Å—Ç—Ä–µ–ª",
        callback_data=f"shoot|{hunt_data}"
    )]])
    await call.message.answer(f"–¢—ã –±–ª—É–∂–¥–∞–µ—à—å –ø–æ {user[4]} –∏ –≤–Ω–µ–∑–∞–ø–Ω–æ –∑–∞–º–µ—á–∞–µ—à—å {animal}!", reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("shoot|"))
async def shoot(call: CallbackQuery):
    try:
        data_part = call.data.split("|", 1)[1]
        parts = data_part.split("|")
        
        if len(parts) < 4:
            await call.answer("‚ùå –û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
            return
        
        user_id_str, group, animal, hunt_time = parts
        user_id = int(user_id_str)
        
        if user_id != call.from_user.id:
            await call.answer("‚ùå –≠—Ç–æ –Ω–µ —Ç–≤–æ—è –æ—Ö–æ—Ç–∞!", show_alert=True)
            return
        
        user = ensure_user(call.from_user.id)
        current_hp, max_hp = get_user_health(call.from_user.id)
        
        # –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ë–ê–ì–ê: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–≥—Ä–æ–∫ —É–º–µ—Ä (HP = 0)
        if current_hp <= 0:
            await call.message.edit_text("‚ùå –í—ã —Å–ª–∏—à–∫–æ–º —Å–ª–∞–±—ã –¥–ª—è –æ—Ö–æ—Ç—ã! –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å 100 HP.")
            return
        
        hit_success = check_hit(user[3], group, call.from_user.id)
        
        if hit_success:
            # –£–°–ü–ï–®–ù–´–ô –í–´–°–¢–†–ï–õ
            sql.execute("UPDATE users SET achievement_streak = achievement_streak + 1 WHERE user_id = ?", (call.from_user.id,))
            
            if group not in REWARDS:
                await call.message.edit_text("‚ùå –û—à–∏–±–∫–∞ –Ω–∞–≥—Ä–∞–¥—ã")
                return
            
            rank = get_user_rank(user[7])
            coins_bonus = rank["bonus_coins"]
            exp_bonus = rank["bonus_exp"]
            
            base_coins, base_exp = REWARDS[group]
            coins = base_coins + int(base_coins * coins_bonus / 100)
            exp = base_exp + int(base_exp * exp_bonus / 100)
            
            sql.execute("UPDATE users SET coins = coins + ?, exp = exp + ?, daily_kills = daily_kills + 1, total_kills = total_kills + 1 WHERE user_id = ?", 
                        (coins, exp, call.from_user.id))
            
            today = datetime.now().strftime("%Y-%m-%d")
            stats = sql.execute("SELECT kills FROM stats_daily WHERE user_id = ? AND date = ?", (call.from_user.id, today)).fetchone()
            if stats:
                sql.execute("UPDATE stats_daily SET kills = kills + 1 WHERE user_id = ? AND date = ?", (call.from_user.id, today))
            else:
                sql.execute("INSERT INTO stats_daily VALUES (?, ?, ?)", (call.from_user.id, today, 1))
            
            trophy = sql.execute("SELECT count FROM trophies WHERE user_id = ? AND animal = ?", (call.from_user.id, animal)).fetchone()
            if trophy:
                sql.execute("UPDATE trophies SET count = count + 1 WHERE user_id = ? AND animal = ?", (call.from_user.id, animal))
            else:
                sql.execute("INSERT INTO trophies VALUES (?, ?, ?)", (call.from_user.id, animal, 1))
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
            new_achievements = check_achievements(call.from_user.id)
            achievements_text = ""
            if new_achievements:
                achievements_text = "\n\nüéâ –ù–æ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:\n"
                for achievement_name in new_achievements:
                    achievements_text += f"‚Ä¢ {achievement_name}\n"
            
            db.commit()
            
            if animal in STICKERS and STICKERS[animal]:
                await call.message.answer_sticker(STICKERS[animal])
            
            result_text = f"üéØ –ü—Ä—è–º–æ–µ –ø–æ–ø–∞–¥–∞–Ω–∏–µ!\n\n–¢—Ä–æ—Ñ–µ–π: \"{animal}\"\nüí∞ –ú–æ–Ω–µ—Ç—ã: +{coins}\n‚≠ê –û–ø—ã—Ç: +{exp}"
            if new_achievements:
                result_text += achievements_text
            
            await call.message.edit_text(result_text)
            
        else:
            # –ü–†–û–ú–ê–•
            sql.execute("UPDATE users SET achievement_streak = 0 WHERE user_id = ?", (call.from_user.id,))
            
            if group in ["–û–ø–∞—Å–Ω", "–¢—è–∂–µ–ª", "–¢–∏—Ç–∞–Ω"]:
                # –ö–û–ù–¢–†–ê–¢–ê–ö–ê
                damage = CONTRATTACK_DAMAGE.get(group, 0)
                new_hp = update_health(call.from_user.id, -damage)
                current_hp, max_hp = get_user_health(call.from_user.id)
                
                if new_hp > 0:
                    sql.execute("UPDATE users SET counterattack_streak = counterattack_streak + 1 WHERE user_id = ?", 
                              (call.from_user.id,))
                else:
                    sql.execute("UPDATE users SET counterattack_streak = 0 WHERE user_id = ?", 
                              (call.from_user.id,))
                
                # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é —Ñ—Ä–∞–∑—É –¥–ª—è –∂–∏–≤–æ—Ç–Ω–æ–≥–æ
                attack_phrase = get_animal_attack_phrase(animal)
                
                if current_hp <= 0:
                    await call.message.edit_text(
                        f"{attack_phrase}\n\n"
                        f"üíÄ –í—ã –ø–æ–≥–∏–±–ª–∏! –ó–¥–æ—Ä–æ–≤—å–µ: 0/{max_hp}\n"
                        f"–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –æ—Ö–æ—Ç–∏—Ç—å—Å—è –¥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è 100 HP.\n"
                        f"–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–ø—Ç–µ—á–∫—É –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞ –∏–ª–∏ –ø–æ–¥–æ–∂–¥–∏—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è."
                    )
                    db.commit()
                    return
                
                # –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –æ—Ç–≤–µ—Ç–∞
                hunt_data_new = f"{call.from_user.id}|{group}|{animal}|{hunt_time}"
                
                if group == "–¢–∏—Ç–∞–Ω":
                    kb = InlineKeyboardMarkup(inline_keyboard=[
                        [InlineKeyboardButton(text="‚öîÔ∏è –î–æ–±–∏—Ç—å (—Ä–∏—Å–∫!)", callback_data=f"finish|{hunt_data_new}|1")],
                        [InlineKeyboardButton(text="üèÉ –ë–µ–∂–∞—Ç—å (50% —à–∞–Ω—Å)", callback_data=f"run|{hunt_data_new}")]
                    ])
                else:
                    kb = InlineKeyboardMarkup(inline_keyboard=[
                        [InlineKeyboardButton(text="‚öîÔ∏è –î–æ–±–∏—Ç—å (—Ä–∏—Å–∫!)", callback_data=f"finish|{hunt_data_new}|1")],
                        [InlineKeyboardButton(text="üèÉ –ë–µ–∂–∞—Ç—å", callback_data=f"run|{hunt_data_new}")]
                    ])
                
                await call.message.edit_text(
                    f"{attack_phrase}\n"
                    f"‚ù§Ô∏è –û—Å—Ç–∞–ª–æ—Å—å –∑–¥–æ—Ä–æ–≤—å—è: {current_hp}/{max_hp}\n\n"
                    f"–ß—Ç–æ –±—É–¥–µ—Ç–µ –¥–µ–ª–∞—Ç—å?",
                    reply_markup=kb
                )
            else:
                await call.message.edit_text("‚ùå –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –≤—ã –ø—Ä–æ–º–∞—Ö–Ω—É–ª–∏—Å—å.")
        
        db.commit()
        
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –≤ shoot: {e}")
        import traceback
        traceback.print_exc()
        await call.answer("‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Å—Ç—Ä–µ–ª–µ", show_alert=True)

@dp.callback_query(lambda c: c.data.startswith("finish|"))
async def finish_animal(call: CallbackQuery):
    try:
        data_part = call.data.split("|", 1)[1]
        parts = data_part.split("|")
        
        if len(parts) < 5:
            await call.answer("‚ùå –û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
            return
        
        user_id_str, group, animal, hunt_time, try_count_str = parts
        user_id = int(user_id_str)
        try_count = int(try_count_str)
        
        if user_id != call.from_user.id:
            await call.answer("‚ùå –≠—Ç–æ –Ω–µ —Ç–≤–æ—è –æ—Ö–æ—Ç–∞!", show_alert=True)
            return
        
        user = ensure_user(call.from_user.id)
        current_hp, max_hp = get_user_health(call.from_user.id)
        
        # –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ë–ê–ì–ê: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–≥—Ä–æ–∫ —É–º–µ—Ä (HP = 0)
        if current_hp <= 0:
            await call.message.edit_text("‚ùå –í—ã —Å–ª–∏—à–∫–æ–º —Å–ª–∞–±—ã –¥–ª—è –æ—Ö–æ—Ç—ã! –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å 100 HP.")
            return
        
        hit_success = check_hit(user[3], group, call.from_user.id)
        
        if hit_success:
            # –£–°–ü–ï–®–ù–û–ï –î–û–ë–ò–í–ê–ù–ò–ï
            if group not in REWARDS:
                await call.message.edit_text("‚ùå –û—à–∏–±–∫–∞ –Ω–∞–≥—Ä–∞–¥—ã")
                return
            
            rank = get_user_rank(user[7])
            coins_bonus = rank["bonus_coins"]
            exp_bonus = rank["bonus_exp"]
            
            base_coins, base_exp = REWARDS[group]
            coins = (base_coins // 2) + int((base_coins // 2) * coins_bonus / 100)
            exp = (base_exp // 2) + int((base_exp // 2) * exp_bonus / 100)
            
            sql.execute("UPDATE users SET coins = coins + ?, exp = exp + ?, daily_kills = daily_kills + 1, total_kills = total_kills + 1 WHERE user_id = ?", 
                        (coins, exp, call.from_user.id))
            
            today = datetime.now().strftime("%Y-%m-%d")
            stats = sql.execute("SELECT kills FROM stats_daily WHERE user_id = ? AND date = ?", (call.from_user.id, today)).fetchone()
            if stats:
                sql.execute("UPDATE stats_daily SET kills = kills + 1 WHERE user_id = ? AND date = ?", (call.from_user.id, today))
            else:
                sql.execute("INSERT INTO stats_daily VALUES (?, ?, ?)", (call.from_user.id, today, 1))
            
            trophy = sql.execute("SELECT count FROM trophies WHERE user_id = ? AND animal = ?", (call.from_user.id, animal)).fetchone()
            if trophy:
                sql.execute("UPDATE trophies SET count = count + 1 WHERE user_id = ? AND animal = ?", (call.from_user.id, animal))
            else:
                sql.execute("INSERT INTO trophies VALUES (?, ?, ?)", (call.from_user.id, animal, 1))
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
            new_achievements = check_achievements(call.from_user.id)
            
            db.commit()
            
            if animal in STICKERS and STICKERS[animal]:
                await call.message.answer_sticker(STICKERS[animal])
            
            result_text = f"üéØ –í—ã –¥–æ–±–∏–ª–∏ –∂–∏–≤–æ—Ç–Ω–æ–µ!\n\n–¢—Ä–æ—Ñ–µ–π: \"{animal}\"\nüí∞ –ú–æ–Ω–µ—Ç—ã: +{coins}\n‚≠ê –û–ø—ã—Ç: +{exp}"
            if new_achievements:
                achievements_text = "\n\nüéâ –ù–æ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:\n"
                for achievement_name in new_achievements:
                    achievements_text += f"‚Ä¢ {achievement_name}\n"
                result_text += achievements_text
            
            await call.message.edit_text(result_text)
            
        else:
            # –ù–û–í–ê–Ø –ö–û–ù–¢–†–ê–¢–ê–ö–ê
            damage = CONTRATTACK_DAMAGE.get(group, 0) + (25 * try_count)
            new_hp = update_health(call.from_user.id, -damage)
            current_hp, max_hp = get_user_health(call.from_user.id)
            
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é —Ñ—Ä–∞–∑—É –¥–ª—è –∂–∏–≤–æ—Ç–Ω–æ–≥–æ
            attack_phrase = get_animal_attack_phrase(animal)
            
            if current_hp <= 0:
                await call.message.edit_text(
                    f"{attack_phrase}\n\n"
                    f"üíÄ –í—ã –ø–æ–≥–∏–±–ª–∏! –ó–¥–æ—Ä–æ–≤—å–µ: 0/{max_hp}\n"
                    f"–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –æ—Ö–æ—Ç–∏—Ç—å—Å—è –¥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è 100 HP."
                )
                return
            
            try_count += 1
            hunt_data_new = f"{call.from_user.id}|{group}|{animal}|{hunt_time}"
            
            if group == "–¢–∏—Ç–∞–Ω":
                kb = InlineKeyboardMarkup(inline_keyboard=[
                    [InlineKeyboardButton(text=f"‚öîÔ∏è –î–æ–±–∏—Ç—å (–µ—â–µ —Ä–∏—Å–∫!)", callback_data=f"finish|{hunt_data_new}|{try_count}")],
                    [InlineKeyboardButton(text="üèÉ –ë–µ–∂–∞—Ç—å (50% —à–∞–Ω—Å)", callback_data=f"run|{hunt_data_new}")]
                ])
            else:
                kb = InlineKeyboardMarkup(inline_keyboard=[
                    [InlineKeyboardButton(text=f"‚öîÔ∏è –î–æ–±–∏—Ç—å (–µ—â–µ —Ä–∏—Å–∫!)", callback_data=f"finish|{hunt_data_new}|{try_count}")],
                    [InlineKeyboardButton(text="üèÉ –ë–µ–∂–∞—Ç—å", callback_data=f"run|{hunt_data_new}")]
                ])
            
            await call.message.edit_text(
                f"{attack_phrase}\n"
                f"‚ù§Ô∏è –û—Å—Ç–∞–ª–æ—Å—å –∑–¥–æ—Ä–æ–≤—å—è: {current_hp}/{max_hp}\n\n"
                f"–ß—Ç–æ –±—É–¥–µ—Ç–µ –¥–µ–ª–∞—Ç—å?",
                reply_markup=kb
            )
            
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –≤ finish_animal: {e}")
        import traceback
        traceback.print_exc()
        await call.answer("‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞", show_alert=True)

@dp.callback_query(lambda c: c.data.startswith("run|"))
async def run_from_animal(call: CallbackQuery):
    try:
        data_part = call.data.split("|", 1)[1]
        parts = data_part.split("|")
        
        if len(parts) < 4:
            await call.answer("‚ùå –û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
            return
        
        user_id_str, group, animal, hunt_time = parts
        user_id = int(user_id_str)
        
        if user_id != call.from_user.id:
            await call.answer("‚ùå –≠—Ç–æ –Ω–µ —Ç–≤–æ—è –æ—Ö–æ—Ç–∞!", show_alert=True)
            return
        
        user = ensure_user(call.from_user.id)
        
        if group == "–¢–∏—Ç–∞–Ω":
            if random.random() < 0.5:
                sql.execute("UPDATE users SET titan_escape_streak = titan_escape_streak + 1 WHERE user_id = ?", 
                          (call.from_user.id,))
                await call.message.edit_text("üèÉ –í–∞–º —É–¥–∞–ª–æ—Å—å —É–±–µ–∂–∞—Ç—å –æ—Ç —Ç–∏—Ç–∞–Ω–∞! –≠—Ç–æ –±—ã–ª–æ –æ–ø–∞—Å–Ω–æ...")
            else:
                damage = 100
                update_health(call.from_user.id, -damage)
                sql.execute("UPDATE users SET titan_escape_streak = 0 WHERE user_id = ?", 
                          (call.from_user.id,))
                
                current_hp, max_hp = get_user_health(call.from_user.id)
                if current_hp <= 0:
                    await call.message.edit_text(
                        f"üíÄ –¢–∏—Ç–∞–Ω–∞ –¥–æ–≥–Ω–∞–ª –≤–∞—Å! –í—ã –ø–æ–≥–∏–±–ª–∏...\n"
                        f"–ó–¥–æ—Ä–æ–≤—å–µ: 0/{max_hp}\n"
                        f"–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –æ—Ö–æ—Ç–∏—Ç—å—Å—è –¥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è 100 HP."
                    )
                else:
                    await call.message.edit_text(
                        f"üí• –¢–∏—Ç–∞–Ω–∞ –¥–æ–≥–æ–Ω–∏—Ç –≤–∞—Å! -100HP\n"
                        f"‚ù§Ô∏è –û—Å—Ç–∞–ª–æ—Å—å –∑–¥–æ—Ä–æ–≤—å—è: {current_hp}/{max_hp}\n"
                        f"–í–∞–º —É–¥–∞–ª–æ—Å—å –≤—ã–∂–∏—Ç—å, –Ω–æ —ç—Ç–æ –±—ã–ª–æ –±–ª–∏–∑–∫–æ..."
                    )
        else:
            await call.message.edit_text("üèÉ –í—ã —É—Å–ø–µ—à–Ω–æ —É–±–µ–∂–∞–ª–∏.")
            
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –≤ run: {e}")
        import traceback
        traceback.print_exc()
        await call.answer("‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞", show_alert=True)

# ================== –ò–ù–í–ï–ù–¢–ê–†–¨ ==================
@dp.message(lambda msg: msg.text and msg.text.lower() in ["–∏–Ω–≤", "–∏–Ω–≤–µ–Ω", "–∏–Ω–≤–µ–Ω—Ç–∞—Ä—å"])
async def inventory(msg: Message):
    user = ensure_user(msg.from_user.id, msg.from_user.username)
    
    rank = get_user_rank(user[7])
    prestige_level = user[10] if len(user) > 10 else 0
    current_title = user[9] if len(user) > 9 and user[9] else "‚ùå –ù–µ—Ç"
    
    current_hp, max_hp = get_user_health(msg.from_user.id)
    
    trophies = sql.execute("SELECT animal, count FROM trophies WHERE user_id = ?", (msg.from_user.id,)).fetchall()
    
    equipment = get_user_equipment(msg.from_user.id)
    equipment_bonuses = get_equipment_bonuses(msg.from_user.id)
    
    groups = ["–ú–µ–ª–æ—á—å", "–°—Ä–µ–¥–Ω", "–û–ø–∞—Å–Ω", "–¢—è–∂–µ–ª", "–¢–∏—Ç–∞–Ω"]
    grouped_trophies = {g: [] for g in groups}
    
    for animal, count in trophies:
        animal_found = False
        for location_name, location_data in LOCATIONS.items():
            for group, animals_list in location_data["animals"].items():
                if animal in animals_list:
                    grouped_trophies[group].append((animal, count))
                    animal_found = True
                    break
            if animal_found:
                break
    
    text = f"üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å\n\n"
    text += f"{rank['name']}\n"
    if current_title != "‚ùå –ù–µ—Ç":
        text += f"{current_title}\n"
    text += f"‚≠ê –ü—Ä–µ—Å—Ç–∏–∂: {prestige_level}\n\n"
    text += f"‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ: {current_hp}/{max_hp}\n"
    
    text += f"üî´ –û—Ä—É–∂–∏–µ: {user[3]}\n"
    text += f"üìç –õ–æ–∫–∞—Ü–∏—è: {user[4]}\n"
    text += f"üí∞ –ú–æ–Ω–µ—Ç—ã: {user[1]}\n"
    text += f"üìä –£—Ä–æ–≤–µ–Ω—å: {get_level(user[2])}\n"
    text += f"üéØ –£–±–∏–π—Å—Ç–≤ —Å–µ–≥–æ–¥–Ω—è: {user[6]}\n"
    text += f"üéØ –í—Å–µ–≥–æ —É–±–∏–π—Å—Ç–≤: {user[7]}\n"
    text += f"üíÄ –°–º–µ—Ä—Ç–µ–π: {user[15] if len(user) > 15 else 0}\n\n"
    
    if equipment:
        text += f"üé© –°–Ω–∞—Ä—è–∂–µ–Ω–∏–µ: {', '.join(equipment)}\n\n"
        
        has_bonuses = False
        bonus_text = "üìà –ë–æ–Ω—É—Å—ã –æ—Ç —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è:\n"
        for group in groups:
            bonus = equipment_bonuses.get(group, 0)
            if bonus > 0:
                bonus_text += f"‚Ä¢ {group}: +{bonus}%\n"
                has_bonuses = True
        
        if has_bonuses:
            text += bonus_text + "\n"
    else:
        text += "üé© –°–Ω–∞—Ä—è–∂–µ–Ω–∏–µ: –Ω–µ—Ç\n\n"
    
    if rank["bonus_exp"] > 0 or rank["bonus_coins"] > 0:
        text += f"üìä –ë–æ–Ω—É—Å—ã –æ—Ç –∑–≤–∞–Ω–∏—è:\n"
        if rank["bonus_exp"] > 0:
            text += f"‚Ä¢ +{rank['bonus_exp']}% –∫ –æ–ø—ã—Ç—É\n"    
        if rank["bonus_coins"] > 0:
            text += f"‚Ä¢ +{rank['bonus_coins']}% –∫ –º–æ–Ω–µ—Ç–∞–º\n"
        text += "\n"
    
    text += "üèÜ –¢—Ä–æ—Ñ–µ–∏:\n"
    
    has_trophies = False
    for group in groups:
        if grouped_trophies[group]:
            has_trophies = True
            text += f"\n{group}:\n"
            for animal_name, count in grouped_trophies[group]:
                text += f"  \"{animal_name}\" ‚Äî {count} —à—Ç.\n"
    
    if not has_trophies:
        text += "\n‚Äî –ø–æ–∫–∞ –Ω–µ—Ç —Ç—Ä–æ—Ñ–µ–µ–≤ ‚Äî"
    
    await msg.answer(text)

# ================== –î–û–°–¢–ò–ñ–ï–ù–ò–Ø ==================
@dp.message(lambda msg: msg.text and msg.text.lower() == "–¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è")
async def achievements_command(msg: Message):
    user = ensure_user(msg.from_user.id, msg.from_user.username)
    completed = get_completed_achievements(msg.from_user.id)
    
    check_achievements(msg.from_user.id)
    completed = get_completed_achievements(msg.from_user.id)
    
    text = "üèÜ –í–∞—à–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:\n\n"
    
    for achievement_name, achievement_data in ACHIEVEMENTS.items():
        status = "‚úÖ" if achievement_name in completed else "‚ùå"
        
        progress = ""
        if achievement_name not in completed:
            if achievement_data["condition_type"] == "animal_kills":
                animal_name, required_count = achievement_data["condition_value"]
                result = sql.execute("SELECT count FROM trophies WHERE user_id = ? AND animal = ?", 
                                   (msg.from_user.id, animal_name)).fetchone()
                current = result[0] if result else 0
                progress = f" [{current}/{required_count}]"
                
            elif achievement_data["condition_type"] == "titan_kills":
                titan_animals = []
                for loc in LOCATIONS.values():
                    titan_animals.extend(loc["animals"].get("–¢–∏—Ç–∞–Ω", []))
                titan_kills = 0
                for animal in titan_animals:
                    result = sql.execute("SELECT count FROM trophies WHERE user_id = ? AND animal = ?", 
                                       (msg.from_user.id, animal)).fetchone()
                    if result:
                        titan_kills += result[0]
                progress = f" [{titan_kills}/{achievement_data['condition_value']}]"
                
            elif achievement_data["condition_type"] == "coins":
                progress = f" [{user[1]}/{achievement_data['condition_value']}]"
                
            elif achievement_data["condition_type"] == "location_kills":
                location_name, required_count = achievement_data["condition_value"]
                location_animals = []
                for group, animals in LOCATIONS[location_name]["animals"].items():
                    location_animals.extend(animals)
                location_kills = 0
                for animal in location_animals:
                    result = sql.execute("SELECT count FROM trophies WHERE user_id = ? AND animal = ?", 
                                       (msg.from_user.id, animal)).fetchone()
                    if result:
                        location_kills += result[0]
                progress = f" [{location_kills}/{required_count}]"
                
            elif achievement_data["condition_type"] == "unique_animals":
                unique_count = len(sql.execute("SELECT COUNT(DISTINCT animal) FROM trophies WHERE user_id = ?", 
                                             (msg.from_user.id,)).fetchone())
                progress = f" [{unique_count}/{achievement_data['condition_value']}]"
                
            elif achievement_data["condition_type"] == "streak":
                progress = f" [{user[11] if len(user) > 11 else 0}/{achievement_data['condition_value']}]"
                
            elif achievement_data["condition_type"] == "max_health":
                current_hp, max_hp = get_user_health(msg.from_user.id)
                progress = f" [{max_hp}/{achievement_data['condition_value']}]"
                
            elif achievement_data["condition_type"] == "counterattack_streak":
                progress = f" [{user[16] if len(user) > 16 else 0}/{achievement_data['condition_value']}]"
                
            elif achievement_data["condition_type"] == "titan_escape_streak":
                progress = f" [{user[17] if len(user) > 17 else 0}/{achievement_data['condition_value']}]"
                
            elif achievement_data["condition_type"] == "deaths":
                progress = f" [{user[15] if len(user) > 15 else 0}/{achievement_data['condition_value']}]"
                
            elif achievement_data["condition_type"] == "trap_heavy":
                progress = f" [{user[21] if len(user) > 21 else 0}/{achievement_data['condition_value']}]"
                
            elif achievement_data["condition_type"] == "trap_days_streak":
                progress = f" [{user[18] if len(user) > 18 else 0}/{achievement_data['condition_value']}]"
        
        text += f"{status} {achievement_name}{progress}\n"
        text += f"   –£—Å–ª–æ–≤–∏–µ: {achievement_data['description']}\n"
        text += f"   –ù–∞–≥—Ä–∞–¥–∞: {achievement_data['reward_coins']}üí∞"
        if achievement_data['reward_exp'] > 0:
            text += f", {achievement_data['reward_exp']}‚≠ê"
        if achievement_data['title']:
            text += f"\n   –¢–∏—Ç—É–ª: {achievement_data['title']}"
        text += "\n\n"
    
    text += f"üìä –í—ã–ø–æ–ª–Ω–µ–Ω–æ: {len(completed)}/{len(ACHIEVEMENTS)}"
    
    await msg.answer(text)

# ================== –¢–ò–¢–£–õ–´ ==================
@dp.message(lambda msg: msg.text and msg.text.lower() == "—Ç–∏—Ç—É–ª—ã")
async def titles_command(msg: Message):
    user = ensure_user(msg.from_user.id, msg.from_user.username)
    completed = get_completed_achievements(msg.from_user.id)
    current_title = user[9] if len(user) > 9 and user[9] else "‚ùå –ù–µ—Ç"
    
    text = f"üëë –í–∞—à–∏ —Ç–∏—Ç—É–ª—ã (—Ç–µ–∫—É—â–∏–π: {current_title}):\n\n"
    
    available_titles = []
    
    for achievement_name, achievement_data in ACHIEVEMENTS.items():
        if achievement_name in completed and achievement_data['title']:
            available_titles.append(achievement_data['title'])
    
    if not available_titles:
        text += "–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ç–∏—Ç—É–ª–æ–≤. –í—ã–ø–æ–ª–Ω—è–π—Ç–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è!\n\n"
        text += "–î–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É: –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è"
        await msg.answer(text)
        return
    
    buttons = []
    for title in available_titles:
        if title == current_title:
            buttons.append([InlineKeyboardButton(text=f"‚úÖ {title} (–≤—ã–±—Ä–∞–Ω)", callback_data="no_action")])
        else:
            buttons.append([InlineKeyboardButton(text=f"üëë {title}", callback_data=f"select_title:{msg.from_user.id}:{title}")])
    
    if current_title != "‚ùå –ù–µ—Ç":
        buttons.append([InlineKeyboardButton(text="‚ùå –°–Ω—è—Ç—å —Ç–∏—Ç—É–ª", callback_data=f"remove_title:{msg.from_user.id}")])
    
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
    
    text = f"üëë –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏—Ç—É–ª (—Ç–µ–∫—É—â–∏–π: {current_title}):"
    await msg.answer(text, reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("select_title"))
async def select_title_callback(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, title = data_parts[1:]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à —Ç–∏—Ç—É–ª!", show_alert=True)
        return
    
    sql.execute("UPDATE users SET current_title = ? WHERE user_id = ?", (title, call.from_user.id))
    db.commit()
    
    await call.message.edit_text(f"‚úÖ –¢–∏—Ç—É–ª –∏–∑–º–µ–Ω—ë–Ω –Ω–∞: {title}")

@dp.callback_query(lambda c: c.data.startswith("remove_title"))
async def remove_title_callback(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 2:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id = data_parts[1]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à —Ç–∏—Ç—É–ª!", show_alert=True)
        return
    
    sql.execute("UPDATE users SET current_title = '' WHERE user_id = ?", (call.from_user.id,))
    db.commit()
    
    await call.message.edit_text("‚úÖ –¢–∏—Ç—É–ª —Å–Ω—è—Ç")

@dp.callback_query(lambda c: c.data == "no_action")
async def no_action(call: CallbackQuery):
    await call.answer("‚úÖ –≠—Ç–æ—Ç —Ç–∏—Ç—É–ª —É–∂–µ –≤—ã–±—Ä–∞–Ω", show_alert=True)

# ================== –ü–†–ï–°–¢–ò–ñ ==================
@dp.message(lambda msg: msg.text and msg.text.lower() == "–ø—Ä–µ—Å—Ç–∏–∂")
async def prestige_command(msg: Message):
    user = ensure_user(msg.from_user.id, msg.from_user.username)
    prestige_level = user[10] if len(user) > 10 else 0
    
    if prestige_level >= 10:
        await msg.answer("üéñÔ∏è –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –ø—Ä–µ—Å—Ç–∏–∂–∞ (10)!")
        return
    
    next_prestige = prestige_level + 1
    prestige_data = PRESTIGES.get(next_prestige, {})
    
    if not prestige_data:
        await msg.answer("‚ùå –û—à–∏–±–∫–∞: —Å–ª–µ–¥—É—é—â–∏–π –ø—Ä–µ—Å—Ç–∏–∂ –Ω–µ –Ω–∞–π–¥–µ–Ω")
        return
    
    requirements = prestige_data.get("requirements", {})
    
    text = f"üéñÔ∏è –ü—Ä–µ—Å—Ç–∏–∂ {next_prestige}: {prestige_data['name']}\n\n"
    text += "üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:\n"
    text += f"‚Ä¢ –£—Ä–æ–≤–µ–Ω—å: {requirements.get('level', 0)}+\n"
    text += f"‚Ä¢ –£–±–∏–π—Å—Ç–≤: {requirements.get('kills', 0)}+\n"
    text += f"‚Ä¢ –ú–æ–Ω–µ—Ç: {requirements.get('coins', 0)}+\n"
    
    if "unique_animals" in requirements:
        text += f"‚Ä¢ –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö: {requirements['unique_animals']}+\n"
    if "titans" in requirements:
        text += f"‚Ä¢ –¢–∏—Ç–∞–Ω–æ–≤: {requirements['titans']}+\n"
    if "dangerous" in requirements:
        text += f"‚Ä¢ –û–ø–∞—Å–Ω—ã—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö: {requirements['dangerous']}+\n"
    if "arctic" in requirements:
        text += f"‚Ä¢ –ê—Ä–∫—Ç–∏—á–µ—Å–∫–∏—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö: {requirements['arctic']}+\n"
    if "all_locations" in requirements:
        text += f"‚Ä¢ –ñ–∏–≤–æ—Ç–Ω—ã–µ –∏–∑ –≤—Å–µ—Ö –ª–æ–∫–∞—Ü–∏–π: –î–∞\n"
    if "all_weapons" in requirements:
        text += f"‚Ä¢ –í—Å–µ –≤–∏–¥—ã –æ—Ä—É–∂–∏—è: –î–∞\n"
    if "all_titans" in requirements:
        text += f"‚Ä¢ –ü–æ 5 –∫–∞–∂–¥–æ–≥–æ —Ç–∏—Ç–∞–Ω–∞: –î–∞\n"
    
    text += f"\nüèÜ –í–∞—à —Ç–µ–∫—É—â–∏–π –ø—Ä–µ—Å—Ç–∏–∂: {prestige_level}"
    
    can_prestige, message = check_prestige_requirements(msg.from_user.id, next_prestige)
    
    if can_prestige:
        kb = InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="üéñÔ∏è –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–µ—Å—Ç–∏–∂", callback_data=f"get_prestige:{msg.from_user.id}:{next_prestige}")]
        ])
        text += f"\n\n‚úÖ {message}"
        await msg.answer(text, reply_markup=kb)
    else:
        text += f"\n\n‚ùå {message}"
        await msg.answer(text)

@dp.callback_query(lambda c: c.data.startswith("get_prestige"))
async def get_prestige_callback(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, prestige_level = data_parts[1:]
    prestige_level = int(prestige_level)
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à –ø—Ä–µ—Å—Ç–∏–∂!", show_alert=True)
        return
    
    can_prestige, message = check_prestige_requirements(call.from_user.id, prestige_level)
    
    if not can_prestige:
        await call.answer(f"‚ùå {message}", show_alert=True)
        return
    
    sql.execute("UPDATE users SET prestige = ? WHERE user_id = ?", (prestige_level, call.from_user.id))
    db.commit()
    
    prestige_data = PRESTIGES.get(prestige_level, {})
    await call.message.edit_text(f"üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –ø–æ–ª—É—á–∏–ª–∏ –ø—Ä–µ—Å—Ç–∏–∂ {prestige_level}: {prestige_data.get('name', '')}")

# ================== –ú–ê–ì–ê–ó–ò–ù ==================
@dp.message(lambda msg: msg.text and msg.text.lower() == "–º–∞–≥–∞–∑–∏–Ω")
async def shop(msg: Message):
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üî´ –û—Ä—É–∂–∏–µ", callback_data=f"shop_weapons:{msg.from_user.id}")],
        [InlineKeyboardButton(text="üé© –°–Ω–∞—Ä—è–∂–µ–Ω–∏–µ", callback_data=f"shop_equipment:{msg.from_user.id}")],
        [InlineKeyboardButton(text="‚ö° –ë–∞—Ñ—Ñ—ã", callback_data=f"shop_buffs:{msg.from_user.id}")]
    ])
    await msg.answer("–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:", reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("shop_weapons"))
async def shop_weapons(call: CallbackQuery):
    user_id = call.data.split(":")[1]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à –º–∞–≥–∞–∑–∏–Ω!", show_alert=True)
        return
    
    user = ensure_user(call.from_user.id)
    
    buttons = []
    for weapon, price in WEAPON_PRICES.items():
        owned = sql.execute("SELECT 1 FROM user_weapons WHERE user_id = ? AND weapon = ?", 
                          (call.from_user.id, weapon)).fetchone()
        status = "‚úÖ " if owned else ""
        buttons.append([InlineKeyboardButton(
            text=f"{status}{weapon} ‚Äî {price}üí∞",
            callback_data=f"view_weapon:{call.from_user.id}:{weapon}"
        )])
    
    buttons.append([InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"shop_back:{call.from_user.id}")])
    
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
    await call.message.edit_text(f"üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å: {user[1]} –º–æ–Ω–µ—Ç\n\nüî´ –í—ã–±–µ—Ä–∏—Ç–µ –æ—Ä—É–∂–∏–µ:", reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("view_weapon"))
async def view_weapon(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, weapon = data_parts[1:]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à –º–∞–≥–∞–∑–∏–Ω!", show_alert=True)
        return
    
    if weapon not in WEAPONS:
        await call.message.edit_text("‚ùå –≠—Ç–æ –æ—Ä—É–∂–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.")
        return
    
    weapon_data = WEAPONS[weapon]
    user = ensure_user(call.from_user.id)
    price = WEAPON_PRICES.get(weapon, 0)
    
    owned = sql.execute("SELECT 1 FROM user_weapons WHERE user_id = ? AND weapon = ?", 
                       (call.from_user.id, weapon)).fetchone()
    
    chances = weapon_data["chances"]
    description = weapon_data["description"]
    
    if owned:
        kb = InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="‚úÖ –£–∂–µ –∫—É–ø–ª–µ–Ω–æ", callback_data="no_action")],
            [InlineKeyboardButton(text="üîÑ –í—ã–±—Ä–∞—Ç—å –æ—Ä—É–∂–∏–µ", callback_data=f"select_weapon:{call.from_user.id}:{weapon}")],
            [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"shop_weapons:{call.from_user.id}")]
        ])
        status_text = "‚úÖ –≠—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç —É–∂–µ –∫—É–ø–ª–µ–Ω"
    else:
        kb = InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text=f"üí∞ –ö—É–ø–∏—Ç—å –∑–∞ {price} –º–æ–Ω–µ—Ç", callback_data=f"buy_weapon:{call.from_user.id}:{weapon}")],
            [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"shop_weapons:{call.from_user.id}")]
        ])
        status_text = f"üí≥ –í–∞—à –±–∞–ª–∞–Ω—Å: {user[1]} –º–æ–Ω–µ—Ç\n{'‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤' if user[1] < price else '‚úÖ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤'}"
    
    await call.message.edit_text(
        f"üî´ {weapon}\n\n"
        f"üìù –û–ø–∏—Å–∞–Ω–∏–µ: {description}\n"
        f"üéØ –®–∞–Ω—Å—ã –ø–æ–ø–∞–¥–∞–Ω–∏—è:\n"
        f"‚Ä¢ –ú–µ–ª–æ—á—å: {chances[0]}%\n"
        f"‚Ä¢ –°—Ä–µ–¥–Ω: {chances[1]}%\n"
        f"‚Ä¢ –û–ø–∞—Å–Ω: {chances[2]}%\n"
        f"‚Ä¢ –¢—è–∂–µ–ª: {chances[3]}%\n"
        f"‚Ä¢ –¢–∏—Ç–∞–Ω: {chances[4]}%\n\n"
        f"üí∞ –¶–µ–Ω–∞: {price} –º–æ–Ω–µ—Ç\n"
        f"{status_text}",
        reply_markup=kb
    )

@dp.callback_query(lambda c: c.data.startswith("select_weapon"))
async def select_weapon(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, weapon = data_parts[1:]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à –º–∞–≥–∞–∑–∏–Ω!", show_alert=True)
        return
    
    sql.execute("UPDATE users SET weapon = ? WHERE user_id = ?", (weapon, call.from_user.id))
    db.commit()
    
    await call.message.edit_text(f"üîÑ –í—ã –≤—ã–±—Ä–∞–ª–∏ –æ—Ä—É–∂–∏–µ: {weapon}")

@dp.callback_query(lambda c: c.data.startswith("buy_weapon"))
async def buy_weapon(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, weapon = data_parts[1:]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à–∞ –ø–æ–∫—É–ø–∫–∞!", show_alert=True)
        return
    
    user = ensure_user(call.from_user.id)
    
    owned = sql.execute("SELECT 1 FROM user_weapons WHERE user_id = ? AND weapon = ?", 
                       (call.from_user.id, weapon)).fetchone()

    if owned:
        await call.message.edit_text("‚úÖ –í—ã —É–∂–µ –∫—É–ø–∏–ª–∏ —ç—Ç–æ –æ—Ä—É–∂–∏–µ!")
        return

    price = WEAPON_PRICES.get(weapon, 0)
    if user[1] < price:
        await call.message.edit_text("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç.")
        return

    # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="‚úÖ –î–∞, –∫—É–ø–∏—Ç—å", callback_data=f"confirm_buy_weapon:{call.from_user.id}:{weapon}")],
        [InlineKeyboardButton(text="‚ùå –û—Ç–º–µ–Ω–∞", callback_data=f"view_weapon:{call.from_user.id}:{weapon}")]
    ])
    
    await call.message.edit_text(
        f"‚ùì –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∫—É–ø–∏—Ç—å {weapon} –∑–∞ {price} –º–æ–Ω–µ—Ç?\n\n"
        f"üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å: {user[1]} –º–æ–Ω–µ—Ç\n"
        f"üí∞ –ü–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏: {user[1] - price} –º–æ–Ω–µ—Ç",
        reply_markup=kb
    )

@dp.callback_query(lambda c: c.data.startswith("confirm_buy_weapon"))
async def confirm_buy_weapon(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, weapon = data_parts[1:]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à–∞ –ø–æ–∫—É–ø–∫–∞!", show_alert=True)
        return
    
    user = ensure_user(call.from_user.id)
    price = WEAPON_PRICES.get(weapon, 0)
    
    if user[1] < price:
        await call.message.edit_text("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç.")
        return

    sql.execute("UPDATE users SET coins = coins - ? WHERE user_id = ?", (price, call.from_user.id))
    sql.execute("INSERT INTO user_weapons VALUES (?, ?)", (call.from_user.id, weapon))
    sql.execute("UPDATE users SET weapon = ? WHERE user_id = ?", (weapon, call.from_user.id))
    db.commit()

    await call.message.edit_text(f"‚úÖ –í—ã –∫—É–ø–∏–ª–∏ {weapon} –∑–∞ {price} –º–æ–Ω–µ—Ç –∏ –≤—ã–±—Ä–∞–ª–∏ –µ–≥–æ!")

@dp.callback_query(lambda c: c.data.startswith("shop_equipment"))
async def shop_equipment(call: CallbackQuery):
    user_id = call.data.split(":")[1]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à –º–∞–≥–∞–∑–∏–Ω!", show_alert=True)
        return
    
    user = ensure_user(call.from_user.id)
    owned_equipment = get_user_equipment(call.from_user.id)
    
    buttons = []
    for eq_name, eq_data in EQUIPMENT.items():
        owned = "‚úÖ " if eq_name in owned_equipment else ""
        buttons.append([InlineKeyboardButton(
            text=f"{owned}{eq_name} ‚Äî {eq_data['price']}üí∞",
            callback_data=f"view_eq:{call.from_user.id}:{eq_name}"
        )])
    
    buttons.append([InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"shop_back:{call.from_user.id}")])
    
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
    await call.message.edit_text(f"üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å: {user[1]} –º–æ–Ω–µ—Ç\n\nüé© –í—ã–±–µ—Ä–∏—Ç–µ —Å–Ω–∞—Ä—è–∂–µ–Ω–∏–µ:", reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("shop_buffs"))
async def shop_buffs(call: CallbackQuery):
    user_id = call.data.split(":")[1]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à –º–∞–≥–∞–∑–∏–Ω!", show_alert=True)
        return
    
    user = ensure_user(call.from_user.id)
    
    buttons = []
    for buff_name, buff_data in BUFFS.items():
        buttons.append([InlineKeyboardButton(
            text=f"{buff_name} ‚Äî {buff_data['price']}üí∞",
            callback_data=f"view_buff:{call.from_user.id}:{buff_name}"
        )])
    
    buttons.append([InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"shop_back:{call.from_user.id}")])
    
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
    await call.message.edit_text(f"üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å: {user[1]} –º–æ–Ω–µ—Ç\n\n‚ö° –í—ã–±–µ—Ä–∏—Ç–µ –±–∞—Ñ—Ñ:", reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("view_buff"))
async def view_buff(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, buff_name = data_parts[1:]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à –º–∞–≥–∞–∑–∏–Ω!", show_alert=True)
        return
    
    if buff_name not in BUFFS:
        await call.message.edit_text("‚ùå –≠—Ç–æ—Ç –±–∞—Ñ—Ñ –Ω–µ –Ω–∞–π–¥–µ–Ω.")
        return
    
    buff_data = BUFFS[buff_name]
    user = ensure_user(call.from_user.id)
    
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text=f"üí∞ –ö—É–ø–∏—Ç—å –∑–∞ {buff_data['price']} –º–æ–Ω–µ—Ç", callback_data=f"buy_buff:{call.from_user.id}:{buff_name}")],
        [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"shop_buffs:{call.from_user.id}")]
    ])
    
    status_text = f"üí≥ –í–∞—à –±–∞–ª–∞–Ω—Å: {user[1]} –º–æ–Ω–µ—Ç\n{'‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤' if user[1] < buff_data['price'] else '‚úÖ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤'}"
    
    await call.message.edit_text(
        f"‚ö° {buff_name}\n\n"
        f"üìù –û–ø–∏—Å–∞–Ω–∏–µ: {buff_data['description']}\n\n"
        f"üí∞ –¶–µ–Ω–∞: {buff_data['price']} –º–æ–Ω–µ—Ç\n"
        f"{status_text}",
        reply_markup=kb
    )

@dp.callback_query(lambda c: c.data.startswith("view_eq"))
async def view_equipment(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, eq_name = data_parts[1:]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à –º–∞–≥–∞–∑–∏–Ω!", show_alert=True)
        return
    
    if eq_name not in EQUIPMENT:
        await call.message.edit_text("‚ùå –≠—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω.")
        return
    
    eq_data = EQUIPMENT[eq_name]
    user = ensure_user(call.from_user.id)
    owned_equipment = get_user_equipment(call.from_user.id)
    
    if eq_name in owned_equipment:
        kb = InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="‚úÖ –£–∂–µ –∫—É–ø–ª–µ–Ω–æ", callback_data="no_action")],
            [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"shop_equipment:{call.from_user.id}")]
        ])
        status_text = "‚úÖ –≠—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç —É–∂–µ –∫—É–ø–ª–µ–Ω"
    else:
        kb = InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text=f"üí∞ –ö—É–ø–∏—Ç—å –∑–∞ {eq_data['price']} –º–æ–Ω–µ—Ç", callback_data=f"buy_eq:{call.from_user.id}:{eq_name}")],
            [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"shop_equipment:{call.from_user.id}")]
        ])
        status_text = f"üí≥ –í–∞—à –±–∞–ª–∞–Ω—Å: {user[1]} –º–æ–Ω–µ—Ç\n{'‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤' if user[1] < eq_data['price'] else '‚úÖ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤'}"
    
    await call.message.edit_text(
        f"üé© {eq_name}\n\n"
        f"üìù –û–ø–∏—Å–∞–Ω–∏–µ: {eq_data['description']}\n\n"
        f"üí∞ –¶–µ–Ω–∞: {eq_data['price']} –º–æ–Ω–µ—Ç\n"
        f"{status_text}",
        reply_markup=kb
    )

@dp.callback_query(lambda c: c.data.startswith("buy_eq"))
async def buy_equipment(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, eq_name = data_parts[1:]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à–∞ –ø–æ–∫—É–ø–∫–∞!", show_alert=True)
        return
    
    if eq_name not in EQUIPMENT:
        await call.message.edit_text("‚ùå –≠—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω.")
        return
    
    eq_data = EQUIPMENT[eq_name]
    user = ensure_user(call.from_user.id)
    
    owned = sql.execute("SELECT 1 FROM user_equipment WHERE user_id = ? AND equipment = ?",
                       (call.from_user.id, eq_name)).fetchone()
    
    if owned:
        await call.message.edit_text("‚úÖ –í—ã —É–∂–µ –∫—É–ø–∏–ª–∏ —ç—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç!")
        return
    
    if user[1] < eq_data['price']:
        await call.message.edit_text("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç.")
        return
    
    # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="‚úÖ –î–∞, –∫—É–ø–∏—Ç—å", callback_data=f"confirm_buy_eq:{call.from_user.id}:{eq_name}")],
        [InlineKeyboardButton(text="‚ùå –û—Ç–º–µ–Ω–∞", callback_data=f"view_eq:{call.from_user.id}:{eq_name}")]
    ])
    
    await call.message.edit_text(
        f"‚ùì –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∫—É–ø–∏—Ç—å {eq_name} –∑–∞ {eq_data['price']} –º–æ–Ω–µ—Ç?\n\n"
        f"üìù {eq_data['description']}\n\n"
        f"üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å: {user[1]} –º–æ–Ω–µ—Ç\n"
        f"üí∞ –ü–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏: {user[1] - eq_data['price']} –º–æ–Ω–µ—Ç",
        reply_markup=kb
    )

@dp.callback_query(lambda c: c.data.startswith("confirm_buy_eq"))
async def confirm_buy_eq(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, eq_name = data_parts[1:]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à–∞ –ø–æ–∫—É–ø–∫–∞!", show_alert=True)
        return
    
    if eq_name not in EQUIPMENT:
        await call.message.edit_text("‚ùå –≠—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω.")
        return
    
    eq_data = EQUIPMENT[eq_name]
    user = ensure_user(call.from_user.id)
    
    if user[1] < eq_data['price']:
        await call.message.edit_text("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç.")
        return
    
    sql.execute("UPDATE users SET coins = coins - ? WHERE user_id = ?",
               (eq_data['price'], call.from_user.id))
    sql.execute("INSERT INTO user_equipment VALUES (?, ?)",
               (call.from_user.id, eq_name))
    db.commit()
    
    if "—Ä—é–∫–∑–∞–∫" in eq_name.lower():
        update_max_health(call.from_user.id)
    
    await call.message.edit_text(f"‚úÖ –í—ã –∫—É–ø–∏–ª–∏ {eq_name}!\n\n{eq_data['description']}\n\n–ë–æ–Ω—É—Å—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.")

@dp.callback_query(lambda c: c.data.startswith("buy_buff"))
async def buy_buff(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, buff_name = data_parts[1:]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à–∞ –ø–æ–∫—É–ø–∫–∞!", show_alert=True)
        return
    
    if buff_name not in BUFFS:
        await call.message.edit_text("‚ùå –≠—Ç–æ—Ç –±–∞—Ñ—Ñ –Ω–µ –Ω–∞–π–¥–µ–Ω.")
        return
    
    buff_data = BUFFS[buff_name]
    user = ensure_user(call.from_user.id)
    
    if user[1] < buff_data['price']:
        await call.message.edit_text("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç.")
        return
    
    # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="‚úÖ –î–∞, –∫—É–ø–∏—Ç—å", callback_data=f"confirm_buy_buff:{call.from_user.id}:{buff_name}")],
        [InlineKeyboardButton(text="‚ùå –û—Ç–º–µ–Ω–∞", callback_data=f"view_buff:{call.from_user.id}:{buff_name}")]
    ])
    
    await call.message.edit_text(
        f"‚ùì –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∫—É–ø–∏—Ç—å {buff_name} –∑–∞ {buff_data['price']} –º–æ–Ω–µ—Ç?\n\n"
        f"üìù {buff_data['description']}\n\n"
        f"üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å: {user[1]} –º–æ–Ω–µ—Ç\n"
        f"üí∞ –ü–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏: {user[1] - buff_data['price']} –º–æ–Ω–µ—Ç",
        reply_markup=kb
    )

@dp.callback_query(lambda c: c.data.startswith("confirm_buy_buff"))
async def confirm_buy_buff(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, buff_name = data_parts[1:]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à–∞ –ø–æ–∫—É–ø–∫–∞!", show_alert=True)
        return
    
    if buff_name not in BUFFS:
        await call.message.edit_text("‚ùå –≠—Ç–æ—Ç –±–∞—Ñ—Ñ –Ω–µ –Ω–∞–π–¥–µ–Ω.")
        return
    
    buff_data = BUFFS[buff_name]
    user = ensure_user(call.from_user.id)
    
    if user[1] < buff_data['price']:
        await call.message.edit_text("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç.")
        return
    
    # –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç –±–∞—Ñ—Ñ–∞
    if buff_data['effect'] == "full_heal":
        heal_user(call.from_user.id)
        effect_text = "‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!"
    elif buff_data['effect'] == "golden_bullet":
        sql.execute("UPDATE users SET golden_bullet = 1 WHERE user_id = ?", (call.from_user.id,))
        effect_text = "üí´ –ó–æ–ª–æ—Ç–∞—è –ø—É–ª—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞! –°–ª–µ–¥—É—é—â–∏–π –≤—ã—Å—Ç—Ä–µ–ª –±—É–¥–µ—Ç —Å x2 —à–∞–Ω—Å–æ–º –ø–æ–ø–∞–¥–∞–Ω–∏—è."
    elif buff_data['effect'] == "drone":
        # –î—Ä–æ–Ω - –Ω–∞—Ö–æ–¥–∏–º 3 –∂–∏–≤–æ—Ç–Ω—ã—Ö –Ω–∞ –≤—ã–±–æ—Ä
        user_data = ensure_user(call.from_user.id)
        location = user_data[4]
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º 3 –∂–∏–≤–æ—Ç–Ω—ã—Ö –ø–æ –∑–∞–¥–∞–Ω–Ω—ã–º —à–∞–Ω—Å–∞–º
        found_animals = []
        for _ in range(3):
            rand = random.randint(1, 1000)  # –î–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏ –¥–æ 0.1%
            if rand <= 600:  # 60% - –°—Ä–µ–¥–Ω
                group = "–°—Ä–µ–¥–Ω"
            elif rand <= 950:  # 35% - –û–ø–∞—Å–Ω (600+350=950)
                group = "–û–ø–∞—Å–Ω"
            elif rand <= 999:  # 4.9% - –¢—è–∂–µ–ª (950+49=999)
                group = "–¢—è–∂–µ–ª"
            else:  # 0.1% - –¢–∏—Ç–∞–Ω
                group = "–¢–∏—Ç–∞–Ω"
            
            if group in LOCATIONS[location]["animals"] and LOCATIONS[location]["animals"][group]:
                animal = random.choice(LOCATIONS[location]["animals"][group])
                found_animals.append((group, animal))
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ –∂–∏–≤–æ—Ç–Ω—ã—Ö –¥–ª—è –≤—ã–±–æ—Ä–∞
        # –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã —Å–æ—Ö—Ä–∞–Ω–∏–º –∫–∞–∫ —Å—Ç—Ä–æ–∫—É, —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—É—é –∑–∞–ø—è—Ç—ã–º–∏
        animals_str = ",".join([f"{group}:{animal}" for group, animal in found_animals])
        
        # –í—Ä–µ–º–µ–Ω–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
        sql.execute("UPDATE users SET drone_target = ? WHERE user_id = ?", (animals_str, call.from_user.id))
        
        # –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞
        buttons = []
        for i, (group, animal) in enumerate(found_animals):
            buttons.append([InlineKeyboardButton(
                text=f"{animal} ({group})",
                callback_data=f"select_drone:{call.from_user.id}:{animal}"
            )])
        
        kb = InlineKeyboardMarkup(inline_keyboard=buttons)
        
        sql.execute("UPDATE users SET coins = coins - ? WHERE user_id = ?",
                   (buff_data['price'], call.from_user.id))
        db.commit()
        
        await call.message.edit_text(
            "üõ∏ –î—Ä–æ–Ω –∑–∞–ø—É—â–µ–Ω! –ù–∞–π–¥–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –∂–∏–≤–æ—Ç–Ω—ã–µ:\n\n"
            "–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω–æ –∂–∏–≤–æ—Ç–Ω–æ–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è (+10% —à–∞–Ω—Å –Ω–∞–π—Ç–∏ –µ–≥–æ –≤ —Ç–µ—á–µ–Ω–∏–µ 30 –º–∏–Ω—É—Ç):",
            reply_markup=kb
        )
        return
    
    sql.execute("UPDATE users SET coins = coins - ? WHERE user_id = ?",
               (buff_data['price'], call.from_user.id))
    db.commit()
    
    await call.message.edit_text(f"‚úÖ –í—ã –∫—É–ø–∏–ª–∏ {buff_name}!\n\n{effect_text}")

@dp.callback_query(lambda c: c.data.startswith("select_drone"))
async def select_drone_target(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, animal = data_parts[1:]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à –≤—ã–±–æ—Ä!", show_alert=True)
        return
    
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–µ–ª—å –¥—Ä–æ–Ω–∞ –Ω–∞ 30 –º–∏–Ω—É—Ç
    expires_at = int(time.time()) + 1800  # 30 –º–∏–Ω—É—Ç
    
    sql.execute("UPDATE users SET drone_target = ?, drone_expires = ? WHERE user_id = ?",
               (animal, expires_at, call.from_user.id))
    db.commit()
    
    await call.message.edit_text(f"‚úÖ –î—Ä–æ–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ {animal}!\n\n"
                               f"üìà +10% —à–∞–Ω—Å –Ω–∞–π—Ç–∏ —ç—Ç–æ –∂–∏–≤–æ—Ç–Ω–æ–µ –≤ —Ç–µ—á–µ–Ω–∏–µ 30 –º–∏–Ω—É—Ç.")

@dp.callback_query(lambda c: c.data.startswith("shop_back"))
async def shop_back(call: CallbackQuery):
    user_id = call.data.split(":")[1]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à –º–∞–≥–∞–∑–∏–Ω!", show_alert=True)
        return
    
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üî´ –û—Ä—É–∂–∏–µ", callback_data=f"shop_weapons:{call.from_user.id}")],
        [InlineKeyboardButton(text="üé© –°–Ω–∞—Ä—è–∂–µ–Ω–∏–µ", callback_data=f"shop_equipment:{call.from_user.id}")],
        [InlineKeyboardButton(text="‚ö° –ë–∞—Ñ—Ñ—ã", callback_data=f"shop_buffs:{call.from_user.id}")]
    ])
    await call.message.edit_text("–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:", reply_markup=kb)

# ================== –¢–û–ü ==================
@dp.message(lambda msg: msg.text and msg.text.lower() == "—Ç–æ–ø—ã")
async def top(msg: Message):
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üèÜ –¢–æ–ø –ø–æ —É–±–∏–π—Å—Ç–≤–∞–º (–≤—Å–µ –≤—Ä–µ–º—è)", callback_data=f"top_total:{msg.from_user.id}")],
        [InlineKeyboardButton(text="üìä –¢–æ–ø –ø–æ —É–±–∏–π—Å—Ç–≤–∞–º (–∑–∞ –¥–µ–Ω—å)", callback_data=f"top_daily:{msg.from_user.id}")],
        [InlineKeyboardButton(text="‚≠ê –¢–æ–ø –ø–æ –æ–ø—ã—Ç—É", callback_data=f"top_exp:{msg.from_user.id}")],
        [InlineKeyboardButton(text="üí∞ –¢–æ–ø –ø–æ –º–æ–Ω–µ—Ç–∞–º", callback_data=f"top_coins:{msg.from_user.id}")],
        [InlineKeyboardButton(text="üéØ –¢–æ–ø –ø–æ —Ç–∏—Ç–∞–Ω–∞–º", callback_data=f"top_titans:{msg.from_user.id}")]
    ])
    await msg.answer("–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç–æ–ø–∞:", reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("top_total"))
async def top_total(call: CallbackQuery):
    user_id = call.data.split(":")[1]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à —Ç–æ–ø!", show_alert=True)
        return
    
    top_users = sql.execute(
        "SELECT username, total_kills FROM users WHERE username IS NOT NULL AND total_kills > 0 ORDER BY total_kills DESC LIMIT 10"
    ).fetchall()
    
    if not top_users:
        await call.message.edit_text("üì≠ –ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.")
        return
    
    text = "üèÜ –¢–æ–ø –ø–æ —É–±–∏–π—Å—Ç–≤–∞–º (–≤—Å–µ –≤—Ä–µ–º—è):\n\n"
    for i, (username, kills) in enumerate(top_users, 1):
        text += f"{i}. @{username} ‚Äî {kills} —É–±–∏–π—Å—Ç–≤\n"
    
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"top_back:{call.from_user.id}")]
    ])
    
    await call.message.edit_text(text, reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("top_daily"))
async def top_daily(call: CallbackQuery):
    user_id = call.data.split(":")[1]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à —Ç–æ–ø!", show_alert=True)
        return
    
    today = datetime.now().strftime("%Y-%m-%d")
    top_users = sql.execute(
        "SELECT u.username, s.kills FROM users u "
        "JOIN stats_daily s ON u.user_id = s.user_id "
        "WHERE s.date = ? AND u.username IS NOT NULL AND s.kills > 0 "
        "ORDER BY s.kills DESC LIMIT 10",
        (today,)
    ).fetchall()
    
    if not top_users:
        await call.message.edit_text("üì≠ –ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.")
        return
    
    text = f"üìä –¢–æ–ø –ø–æ —É–±–∏–π—Å—Ç–≤–∞–º (–∑–∞ –¥–µ–Ω—å, {today}):\n\n"
    for i, (username, kills) in enumerate(top_users, 1):
        text += f"{i}. @{username} ‚Äî {kills} —É–±–∏–π—Å—Ç–≤\n"
    
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"top_back:{call.from_user.id}")]
    ])
    
    await call.message.edit_text(text, reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("top_exp"))
async def top_exp(call: CallbackQuery):
    user_id = call.data.split(":")[1]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à —Ç–æ–ø!", show_alert=True)
        return
    
    top_users = sql.execute(
        "SELECT username, exp, exp/500 as level FROM users "
        "WHERE username IS NOT NULL AND exp > 0 ORDER BY exp DESC LIMIT 10"
    ).fetchall()
    
    if not top_users:
        await call.message.edit_text("üì≠ –ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.")
        return
    
    text = "‚≠ê –¢–æ–ø –ø–æ –æ–ø—ã—Ç—É (–∏ —É—Ä–æ–≤–Ω—é):\n\n"
    for i, (username, exp, level) in enumerate(top_users, 1):
        text += f"{i}. @{username} ‚Äî –û–ø—ã—Ç: {exp} (–£—Ä–æ–≤–µ–Ω—å: {int(level)})\n"
    
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"top_back:{call.from_user.id}")]
    ])
    
    await call.message.edit_text(text, reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("top_coins"))
async def top_coins(call: CallbackQuery):
    user_id = call.data.split(":")[1]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à —Ç–æ–ø!", show_alert=True)
        return
    
    top_users = sql.execute(
        "SELECT username, coins FROM users "
        "WHERE username IS NOT NULL AND coins > 0 ORDER BY coins DESC LIMIT 10"
    ).fetchall()
    
    if not top_users:
        await call.message.edit_text("üì≠ –ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.")
        return
    
    text = "üí∞ –¢–æ–ø –ø–æ –º–æ–Ω–µ—Ç–∞–º:\n\n"
    for i, (username, coins) in enumerate(top_users, 1):
        text += f"{i}. @{username} ‚Äî {coins} –º–æ–Ω–µ—Ç\n"
    
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"top_back:{call.from_user.id}")]
    ])
    
    await call.message.edit_text(text, reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("top_titans"))
async def top_titans(call: CallbackQuery):
    user_id = call.data.split(":")[1]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à —Ç–æ–ø!", show_alert=True)
        return
    
    titan_animals = []
    for location_name, location_data in LOCATIONS.items():
        if "–¢–∏—Ç–∞–Ω" in location_data["animals"]:
            titan_animals.extend(location_data["animals"]["–¢–∏—Ç–∞–Ω"])
    
    if not titan_animals:
        await call.message.edit_text("üéØ –í –∏–≥—Ä–µ –ø–æ–∫–∞ –Ω–µ—Ç —Ç–∏—Ç–∞–Ω–æ–≤.")
        return
    
    titan_counts = {}
    
    for username, user_id in sql.execute("SELECT username, user_id FROM users WHERE username IS NOT NULL").fetchall():
        total_titans = 0
        for animal in titan_animals:
            result = sql.execute("SELECT count FROM trophies WHERE user_id = ? AND animal = ?",
                               (user_id, animal)).fetchone()
            if result:
                total_titans += result[0]
        
        if total_titans > 0:
            titan_counts[username] = total_titans
    
    if not titan_counts:
        await call.message.edit_text("üéØ –ü–æ–∫–∞ –Ω–∏–∫—Ç–æ –Ω–µ —É–±–∏–ª –Ω–∏ –æ–¥–Ω–æ–≥–æ —Ç–∏—Ç–∞–Ω–∞.")
        return
    
    sorted_titans = sorted(titan_counts.items(), key=lambda x: x[1], reverse=True)[:10]
    
    text = "üéØ –¢–æ–ø –ø–æ —É–±–∏–π—Å—Ç–≤—É —Ç–∏—Ç–∞–Ω–æ–≤:\n\n"
    for i, (username, count) in enumerate(sorted_titans, 1):
        text += f"{i}. @{username} ‚Äî {count} —Ç–∏—Ç–∞–Ω–æ–≤\n"
    
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"top_back:{call.from_user.id}")]
    ])
    
    await call.message.edit_text(text, reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("top_back"))
async def top_back(call: CallbackQuery):
    user_id = call.data.split(":")[1]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à —Ç–æ–ø!", show_alert=True)
        return
    
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üèÜ –¢–æ–ø –ø–æ —É–±–∏–π—Å—Ç–≤–∞–º (–≤—Å–µ –≤—Ä–µ–º—è)", callback_data=f"top_total:{call.from_user.id}")],
        [InlineKeyboardButton(text="üìä –¢–æ–ø –ø–æ —É–±–∏–π—Å—Ç–≤–∞–º (–∑–∞ –¥–µ–Ω—å)", callback_data=f"top_daily:{call.from_user.id}")],
        [InlineKeyboardButton(text="‚≠ê –¢–æ–ø –ø–æ –æ–ø—ã—Ç—É", callback_data=f"top_exp:{call.from_user.id}")],
        [InlineKeyboardButton(text="üí∞ –¢–æ–ø –ø–æ –º–æ–Ω–µ—Ç–∞–º", callback_data=f"top_coins:{call.from_user.id}")],
        [InlineKeyboardButton(text="üéØ –¢–æ–ø –ø–æ —Ç–∏—Ç–∞–Ω–∞–º", callback_data=f"top_titans:{call.from_user.id}")]
    ])
    await call.message.edit_text("–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç–æ–ø–∞:", reply_markup=kb)

# ================== –õ–û–ö–ê–¶–ò–ò ==================
@dp.message(lambda msg: msg.text and msg.text.lower() == "–ª–æ–∫–∞—Ü–∏–∏")
async def choose_location(msg: Message):
    user = ensure_user(msg.from_user.id, msg.from_user.username)
    level = get_level(user[2])
    
    buttons = []
    for name, data in LOCATIONS.items():
        available = level >= data["level"]
        status = "üìç " if user[4] == name else ""
        lock = "üîí " if not available else ""
        level_req = f" (—É—Ä. {data['level']}+)" if not available else ""
        
        if available:
            buttons.append([InlineKeyboardButton(
                text=f"{status}{lock}{name}{level_req}",
                callback_data=f"loc_set:{msg.from_user.id}:{name}"
            )])
        else:
            buttons.append([InlineKeyboardButton(
                text=f"{lock}{name}{level_req}",
                callback_data="loc_locked"
            )])
    
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
    await msg.answer(f"üìç –í—ã–±–µ—Ä–∏—Ç–µ –ª–æ–∫–∞—Ü–∏—é (–í–∞—à —É—Ä–æ–≤–µ–Ω—å: {level}):", reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("loc_set"))
async def set_location(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    owner_id, location = data_parts[1:]
    
    if int(owner_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ —Ç–≤–æ—è –ª–æ–∫–∞—Ü–∏—è!", show_alert=True)
        return
    
    user = ensure_user(call.from_user.id)
    level = get_level(user[2])
    
    if location not in LOCATIONS:
        await call.message.edit_text("‚ùå –≠—Ç–∞ –ª–æ–∫–∞—Ü–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.")
        return
    
    if not can_use_location(level, location):
        await call.message.edit_text(f"‚ùå –≠—Ç–∞ –ª–æ–∫–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Å —É—Ä–æ–≤–Ω—è {LOCATIONS[location]['level']}.")
        return
    
    sql.execute("UPDATE users SET location = ? WHERE user_id = ?", (location, call.from_user.id))
    db.commit()
    
    animals_text = "\n\nüêæ –ñ–∏–≤–æ—Ç–Ω—ã–µ –≤ —ç—Ç–æ–π –ª–æ–∫–∞—Ü–∏–∏:\n"
    
    for group_name, animals_list in LOCATIONS[location]["animals"].items():
        if animals_list:
            animals_text += f"\n{group_name}:\n"
            animals_text += "‚Ä¢ " + "\n‚Ä¢ ".join(animals_list) + "\n"
    
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥ –∫ –ª–æ–∫–∞—Ü–∏—è–º", callback_data=f"loc_back:{call.from_user.id}")]
    ])
    
    await call.message.edit_text(
        f"‚úÖ –õ–æ–∫–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞ {location}!\n\n"
        f"üìä –£—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–∞: {LOCATIONS[location]['level']}+"
        f"{animals_text}",
        reply_markup=kb
    )

@dp.callback_query(lambda c: c.data == "loc_locked")
async def loc_locked(call: CallbackQuery):
    await call.answer("‚ùå –≠—Ç–∞ –ª–æ–∫–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ –≤–∞—à–µ–º —É—Ä–æ–≤–Ω–µ!", show_alert=True)

@dp.callback_query(lambda c: c.data.startswith("loc_back"))
async def location_back(call: CallbackQuery):
    user_id = call.data.split(":")[1]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à–µ –º–µ–Ω—é!", show_alert=True)
        return
    
    user = ensure_user(call.from_user.id)
    level = get_level(user[2])
    
    buttons = []
    for name, data in LOCATIONS.items():
        available = level >= data["level"]
        status = "üìç " if user[4] == name else ""
        lock = "üîí " if not available else ""
        level_req = f" (—É—Ä. {data['level']}+)" if not available else ""
        
        if available:
            buttons.append([InlineKeyboardButton(
                text=f"{status}{lock}{name}{level_req}",
                callback_data=f"loc_set:{call.from_user.id}:{name}"
            )])
        else:
            buttons.append([InlineKeyboardButton(
                text=f"{lock}{name}{level_req}",
                callback_data="loc_locked"
            )])
    
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
    await call.message.edit_text(f"üìç –í—ã–±–µ—Ä–∏—Ç–µ –ª–æ–∫–∞—Ü–∏—é (–í–∞—à —É—Ä–æ–≤–µ–Ω—å: {level}):", reply_markup=kb)

# ================== –õ–û–í–£–®–ö–ò ==================
@dp.message(lambda msg: msg.text and msg.text.lower() in ["–ª–æ–≤—É—à–∫–∏", "–ª–æ–≤—É—à–∫–∞"])
async def traps_command(msg: Message):
    user = ensure_user(msg.from_user.id, msg.from_user.username)
    
    success, result = use_traps(msg.from_user.id)
    
    if not success:
        await msg.answer(result)
        return
    
    caught_animals = result
    
    if not caught_animals:
        await msg.answer("ü™§ –í—ã –ø–æ—Å—Ç–∞–≤–∏–ª–∏ –ª–æ–≤—É—à–∫–∏, –Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–π–º–∞–ª–∏.")
        return
    
    total_coins = 0
    total_exp = 0
    animals_text = "ü™§ –í—ã –ø–æ–π–º–∞–ª–∏ –≤ –ª–æ–≤—É—à–∫–∏:\n\n"
    
    for group, animal in caught_animals:
        if group in REWARDS:
            base_coins, base_exp = REWARDS[group]
            coins = base_coins // 2
            exp = base_exp // 2
            
            total_coins += coins
            total_exp += exp
            
            animals_text += f"‚Ä¢ {animal} ({group}) ‚Äî {coins}üí∞, {exp}‚≠ê\n"
            
            trophy = sql.execute("SELECT count FROM trophies WHERE user_id = ? AND animal = ?", (msg.from_user.id, animal)).fetchone()
            if trophy:
                sql.execute("UPDATE trophies SET count = count + 1 WHERE user_id = ? AND animal = ?", (msg.from_user.id, animal))
            else:
                sql.execute("INSERT INTO trophies VALUES (?, ?, ?)", (msg.from_user.id, animal, 1))
    
    sql.execute("UPDATE users SET coins = coins + ?, exp = exp + ? WHERE user_id = ?", 
                (total_coins, total_exp, msg.from_user.id))
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ª–æ–≤—É—à–µ–∫
    new_achievements = check_achievements(msg.from_user.id)
    
    db.commit()
    
    if new_achievements:
        achievements_text = "\n\nüéâ –ù–æ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:\n"
        for achievement_name in new_achievements:
            achievements_text += f"‚Ä¢ {achievement_name}\n"
        animals_text += achievements_text
    
    animals_text += f"\nüí∞ –í—Å–µ–≥–æ: {total_coins} –º–æ–Ω–µ—Ç, {total_exp} –æ–ø—ã—Ç–∞"
    
    await msg.answer(animals_text)

# ================== –§–£–ù–ö–¶–ò–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø –ë–î ==================
def update_database():
    """–û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏"""
    columns_to_add = [
        ("daily_kills", "INTEGER DEFAULT 0"),
        ("total_kills", "INTEGER DEFAULT 0"),
        ("username", "TEXT"),
        ("current_title", "TEXT DEFAULT ''"),
        ("prestige", "INTEGER DEFAULT 0"),
        ("achievement_streak", "INTEGER DEFAULT 0"),
        ("achievements_completed", "TEXT DEFAULT '{}'"),
        ("health", "INTEGER DEFAULT 100"),
        ("max_health", "INTEGER DEFAULT 100"),
        ("deaths", "INTEGER DEFAULT 0"),
        ("counterattack_streak", "INTEGER DEFAULT 0"),
        ("titan_escape_streak", "INTEGER DEFAULT 0"),
        ("trap_days_streak", "INTEGER DEFAULT 0"),
        ("last_trap_use", "INTEGER DEFAULT 0"),
        ("traps_used", "INTEGER DEFAULT 0"),
        ("heavy_traps", "INTEGER DEFAULT 0"),
        ("last_achievement_check", "INTEGER DEFAULT 0"),
        ("golden_bullet", "INTEGER DEFAULT 0"),
        ("drone_target", "TEXT DEFAULT ''"),
        ("drone_expires", "INTEGER DEFAULT 0"),
        ("last_daily_gift", "INTEGER DEFAULT 0")
    ]
    
    for column_name, column_type in columns_to_add:
        try:
            sql.execute(f"SELECT {column_name} FROM users LIMIT 1")
        except sqlite3.OperationalError:
            sql.execute(f"ALTER TABLE users ADD COLUMN {column_name} {column_type}")
            print(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ {column_name}")
    
    db.commit()

# ================== –ó–ê–ü–£–°–ö ==================
async def main():
    print("=" * 50)
    print("üîß –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...")
    update_database()
    
    print("üîÑ –°–±—Ä–æ—Å –¥–Ω–µ–≤–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...")
    reset_daily_stats()
    
    print("ü©∫ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—å—è –∏–≥—Ä–æ–∫–æ–≤...")
    all_users = sql.execute("SELECT user_id FROM users").fetchall()
    for user in all_users:
        update_max_health(user[0])
    
    print("üíñ –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è...")
    health_regenerator.start_regeneration()
    
    print("ü§ñ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω! –û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π...")
    print(f"üëë –ê–¥–º–∏–Ω ID: {ADMIN_ID}")
    print(f"üëë –ê–¥–º–∏–Ω Username: @{ADMIN_USERNAME}")
    print("=" * 50)
    print("üìä –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:")
    print("‚Ä¢ /start - –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã")
    print("‚Ä¢ –°–æ—Å—Ç–æ—è–Ω–∏–µ - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ")
    print("‚Ä¢ –•–∞–Ω—Ç - –ù–∞—á–∞—Ç—å –æ—Ö–æ—Ç—É (—Å –∫–Ω–æ–ø–∫–æ–π –æ–±–Ω—É–ª–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞ –∑–∞ 450üí∞)")
    print("‚Ä¢ –ò–Ω–≤ - –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç)")
    print("‚Ä¢ –ú–∞–≥–∞–∑–∏–Ω - –ú–∞–≥–∞–∑–∏–Ω –æ—Ä—É–∂–∏—è –∏ —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è (—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –ø–æ–∫—É–ø–∫–∏)")
    print("‚Ä¢ –õ–æ–∫–∞—Ü–∏–∏ - –í—ã–±–æ—Ä –ª–æ–∫–∞—Ü–∏–∏ (–¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ: –ì–æ—Ä—ã, –ü–æ–¥–≤–æ–¥–Ω—ã–π –º–∏—Ä, –ü—Ä–∏–∑—Ä–∞—á–Ω—ã–π –ª–µ—Å)")
    print("‚Ä¢ –¢–æ–ø—ã - –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤")
    print("‚Ä¢ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è - –í–∞—à–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è")
    print("‚Ä¢ –¢–∏—Ç—É–ª—ã - –í—ã–±—Ä–∞—Ç—å —Ç–∏—Ç—É–ª")
    print("‚Ä¢ –ü—Ä–µ—Å—Ç–∏–∂ - –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–µ—Å—Ç–∏–∂")
    print("‚Ä¢ –õ–æ–≤—É—à–∫–∏ - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–≤—É—à–∫–∏ (—Ä–∞–∑ –≤ 24—á)")
    print("‚Ä¢ –ü–æ–¥–∞—Ä–æ–∫ - –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫")
    print("‚Ä¢ –°–ø—Ä–∞–≤–∫–∞ - –ü–æ–º–æ—â—å")
    print("=" * 50)
    print("üÜï –ù–û–í–´–ï –§–£–ù–ö–¶–ò–ò:")
    print("‚Ä¢ –ó–æ–ª–æ—Ç–∞—è –ø—É–ª—è - x2 —à–∞–Ω—Å –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ —Å–ª–µ–¥—É—é—â–µ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ")
    print("‚Ä¢ –î—Ä–æ–Ω - –ù–∞—Ö–æ–¥–∏—Ç 3 –∂–∏–≤–æ—Ç–Ω—ã—Ö –Ω–∞ –≤—ã–±–æ—Ä, +10% —à–∞–Ω—Å –Ω–∞–π—Ç–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ")
    print("‚Ä¢ –í–∏—Ç–∞–º–∏–Ω—ã - x1.5 —Å–∫–æ—Ä–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è")
    print("‚Ä¢ –¢–µ–Ω–µ–≤–æ–π –±–ª–∞—Å—Ç–µ—Ä - –ù–æ–≤–æ–µ –æ—Ä—É–∂–∏–µ –∑–∞ 1,000,000 –º–æ–Ω–µ—Ç")
    print("‚Ä¢ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫ - –ü–æ–ª—É—á–∞–π—Ç–µ –Ω–∞–≥—Ä–∞–¥—ã –∫–∞–∂–¥—ã–µ 24 —á–∞—Å–∞")
    print("‚Ä¢ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∏—Å–∫–∞—Ç–µ–ª—å - –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç–µ –∂–∏–≤–æ—Ç–Ω–æ–µ")
    print("‚Ä¢ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Ñ—Ä–∞–∑—ã –∞—Ç–∞–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∂–∏–≤–æ—Ç–Ω–æ–≥–æ")
    print("=" * 50)
    print("üîß –ê–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥—ã:")
    print("‚Ä¢ –¥–∏–ø–∑–¥ <HP> @username - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ")
    print("‚Ä¢ –¥–∏–ø–Ω–æ–ª—å @username - –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å –ø—Ä–æ—Ñ–∏–ª—è")
    print("‚Ä¢ –¥–∏–ø—Å–∫–∏–ø @username - –°–±—Ä–æ—Å–∏—Ç—å —Ç–∞–π–º–µ—Ä –æ—Ö–æ—Ç—ã")
    print("‚Ä¢ –¥–∏–ø–º–æ–Ω–µ—Ç—ã <—Å—É–º–º–∞> @username - –í—ã–¥–∞—Ç—å –º–æ–Ω–µ—Ç—ã")
    print("‚Ä¢ –¥–∏–ø–æ–ø—ã—Ç <—Å—É–º–º–∞> @username - –í—ã–¥–∞—Ç—å –æ–ø—ã—Ç")
    print("‚Ä¢ –¥–∏–ø—É—Ä–æ–≤–Ω–∏ <—É—Ä–æ–≤–Ω–∏> @username - –í—ã–¥–∞—Ç—å —É—Ä–æ–≤–Ω–∏")
    print("=" * 50)
    
    try:
        await dp.start_polling(bot)
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞: {e}")
    finally:
        health_regenerator.stop_regeneration()
        await bot.session.close()

if __name__ == "__main__":
    asyncio.run(main())
