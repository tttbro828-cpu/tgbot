import asyncio
import random
import time
import sqlite3
import threading
import json
from datetime import datetime, timedelta

from aiogram import Bot, Dispatcher
from aiogram.types import Message, InlineKeyboardMarkup, InlineKeyboardButton, CallbackQuery
from aiogram.filters import Command

# ================== –ù–ê–°–¢–†–û–ô–ö–ò ==================
TOKEN = "8537764396:AAEZFTs7mgHqTjQbDh6eSyKtQJvwlPnJazY"
HUNT_COOLDOWN = 240  # 4 –º–∏–Ω—É—Ç—ã
EXP_PER_LEVEL = 500
ADMIN_ID = 6924481166  # –í–∞—à ID
ADMIN_USERNAME = "DeepSleep01"  # –í–∞—à username

# ================== –î–ê–ù–ù–´–ï ==================
LOCATIONS = {
    "–¢–∞–π–≥–∞": {"level": 0, "animals": {
        "–ú–µ–ª–æ—á—å": ["–ó–∞—è—Ü", "–ë–µ–ª–∫–∞", "–ë—É—Ä—É–Ω–¥—É–∫", "–†—è–±—á–∏–∫", "–í—ã–¥—Ä–∞", "–õ–∞—Å–∫–∞", "–ì–æ—Ä–Ω–æ—Å—Ç–∞–π", "–°–æ–±–æ–ª—å", "–ë–∞—Ä—Å—É–∫", "–ó–µ–º–ª–µ—Ä–æ–π–∫–∞" ],
        "–°—Ä–µ–¥–Ω": ["–ë–æ–±—Ä", "–ì–ª—É—Ö–∞—Ä—å", "–°–µ–≤ –æ–ª–µ–Ω—å", "–ö–æ—Å—É–ª—è", "–õ–∏—Å–∞", "–ï–Ω–æ—Ç", "–£–∂" ],
        "–û–ø–∞—Å–Ω": ["–ö–∞–±–∞–Ω", "–†—ã—Å—å", "–†–æ—Å–æ–º–∞—Ö–∞", "–°–µ—Ä—ã–π –≤–æ–ª–∫", "–ë—É—Ä—ã–π –º–µ–¥–≤–µ–¥—å", "–ì–∞–¥—é–∫–∞", "–ì—Ä–∏–∑–ª–∏"],
        "–¢—è–∂–µ–ª": ["–õ–æ—Å—å", "–ó—É–±—Ä", "–ê–º—É—Ä –¢–∏–≥—Ä"],
        "–¢–∏—Ç–∞–Ω": ["–û–±–æ—Ä–æ—Ç–µ–Ω—å", "–í–µ–Ω–¥–∏–≥–æ", "–í–∞—Å–∏–ª–∏—Å–∫"]
    }},
    "–°–∞–≤–∞–Ω–Ω–∞": {"level": 10, "animals": {
        "–ú–µ–ª–æ—á—å": ["–î–∏–∫–æ–±—Ä–∞–∑", "–ú–∞–Ω–≥—É—Å—Ç", "–°—É—Ä–∏–∫–∞—Ç", "–ê–Ω—Ç–∏–ª–æ–ø –∑–∞—è—Ü", "–°—É—Å–ª–∏–∫", "–î–∞–º–∞–Ω", "–ü–µ—Å—á–∞–Ω–∫–∞", "–ì–µ–∫–∫–æ–Ω", "–®–∏–ø–æ—Ö–≤–æ—Å—Ç", "–•–∞–º–µ–ª–ª–µ–æ–Ω"],
        "–°—Ä–µ–¥–Ω": ["–ó–µ–±—Ä–∞", "–®–∞–∫–∞–ª", "–ê–Ω—Ç–∏–ª–æ–ø–∞ –ì–Ω—É", "–ê–Ω—Ç–∏–ª –ò–º–ø–∞–ª–∞", "–°—Ç—Ä–∞—É—Å", "–ë–æ—Ä–æ–¥–∞–≤–æ—á–Ω–∏–∫", "–°–µ—Ä–≤–∞–ª"],
        "–û–ø–∞—Å–Ω": ["–ì–∏–µ–Ω–∞", "–ü—É–º–∞", "–õ–µ–≤", "–õ–µ–æ–ø–∞—Ä–¥", "–ì–µ–ø–∞—Ä–¥", "–ú–∞–º–±–∞"],
        "–¢—è–∂–µ–ª": ["–ñ–∏—Ä–∞—Ñ", "–ë—É–π–≤–æ–ª", "–ê –°–ª–æ–Ω", "–ë–µ–≥–µ–º–æ—Ç"],
        "–¢–∏—Ç–∞–Ω": ["–ì—Ä–æ—Ç—Å–ª–∞–Ω–≥", "–ö–∏–∫–∏—è–æ–Ω", "–ù–∞–Ω–¥–∏"]
    }},
    "–ê—Ä–∫—Ç–∏–∫–∞": {"level": 25, "animals": {
        "–ú–µ–ª–æ—á—å": ["–õ–µ–º–º–∏–Ω–≥", "–ü–µ—Å–µ—Ü", "–ê—Ä–∫—Ç–∏–∫ –∑–∞—è—Ü", "–ü—É–Ω–æ—á–∫–∞", "–ì–∞–≥–∞", "–°–∏–±. –ü–æ–ª—ë–≤–∫–∞", "–ö—É—Ä–æ–ø–∞—Ç–∫–∞"],
        "–°—Ä–µ–¥–Ω": ["–ü–æ–ª—è—Ä–Ω —Å–æ–≤–∞", "–¢—é–ª–µ–Ω—å", "–ö–∞—Ä–∏–±—É", "–õ–∞—Ö—Ç–∞–∫"],
        "–û–ø–∞—Å–Ω": ["–°–Ω–µ–∂–Ω –±–∞—Ä—Å", "–ë–µ–ª—ã–π –º–µ–¥–≤–µ–¥—å", "–ú –ª–µ–æ–ø–∞—Ä–¥"],
        "–¢—è–∂–µ–ª": ["–ú–æ—Ä–∂", "–ë–µ–ª—É—Ö–∞", "–û–≤—Ü–µ–±—ã–∫", "–ö–æ—Å–∞—Ç–∫–∞", "–ú —Å–ª–æ–Ω"],
        "–¢–∏—Ç–∞–Ω": ["–ú–∞–º–æ–Ω—Ç", "–ô–µ—Ç–∏", "–°–Ω–µ–∂ –¥—Ä–∞–∫–æ–Ω"]
    }},
    "–î–∂—É–Ω–≥–ª–∏": {"level": 50, "animals": {
        "–ú–µ–ª–æ—á—å": ["–ö–∞–ø–∏–±–∞—Ä–∞", "–õ–µ–Ω–∏–≤–µ—Ü", "–î–æ–ª–≥–æ–ø—è—Ç", "–¢—É–∫–∞–Ω", "–ú–∞—Ä–∞", "–ê–≥—É—Ç–∏"],
        "–°—Ä–µ–¥–Ω": ["–û–∫–∞–ø–∏", "–û–±–µ–∑—å—è–Ω–∞", "–ö–∞–∑—É–∞—Ä", "–¢–∞–ø–∏—Ä", "–ë—Ä–æ–Ω–µ–Ω–æ—Å–µ—Ü", "–†–µ–≤—É–Ω"],
        "–û–ø–∞—Å–Ω": ["–ö–æ–º–æ–¥—Å –≤–∞—Ä–∞–Ω", "–ö—Ä–æ–∫–æ–¥–∏–ª", "–ê–Ω–∞–∫–æ–Ω–¥–∞", "–Ø–≥—É–∞—Ä", "–ì–æ—Ä–∏–ª–ª–∞", "–¢–∏–≥—Ä", "–ü–∞–Ω—Ç–µ—Ä–∞"],
        "–¢—è–∂–µ–ª": ["–ù–æ—Å–æ—Ä–æ–≥", "–õ –°–ª–æ–Ω", "–ì–∞—É—Ä"],
        "–¢–∏—Ç–∞–Ω": ["–ß—É–ø–∞–∫–∞–±—Ä–∞", "–ë–æ–π—Ç–∞—Ç–∞", "–Ø–∫—É–º–∞–º–∞"]
    }},
    "–î—Ä–µ–≤–Ω–∏–π –º–∏—Ä": {"level": 80, "animals": {
        "–ú–µ–ª–æ—á—å": ["–ö–æ–º–ø—Å–æ–≥–Ω–∞—Ç", "–ò–±–µ—Ä–æ–º–µ–∑", "–ê—Ä—Ö–µ–æ–ø—Ç", "–≠–æ–º–∞–π—è", "–ì–∞—Ç—Ç–µ—Ä–∏—è", "–•–∞—Ä–∞–º–∏—è", "–®—É–æ—Ç–µ—Ä–∏–π", "–î–æ–∫–æ–¥–æ–Ω", "–ö—é–Ω–µ–æ—Ç–µ—Ä–∏–π", "–¢—Ä–∏–Ω–∞–∫—Å–æ–¥–æ–Ω"],
        "–°—Ä–µ–¥–Ω": ["–í–µ–ª–æ—Ü–∏—Ä–∞–ø—Ç–æ—Ä", "–î–∏–Ω–æ–ø–∏—Ç–µ–∫", "–î–µ–π–Ω–æ–Ω–∏—Ö", "–¢—Ä–æ–æ–¥–æ–Ω", "–¶–µ–ª—É—Ä", "–†–µ–ø–µ–Ω–æ–º–∞–º", "–≠—Ä–∏—Ç—Ä–æ–∑—É—Ö"],
        "–û–ø–∞—Å–Ω": ["–°–º–∏–ª–æ–¥–æ–Ω", "–≠–Ω—Ç–µ–ª–æ–¥–æ–Ω—Ç", "–ö–µ–ª–µ–Ω–∫–µ–Ω", "–ì–∏–µ–Ω–æ–¥–æ–Ω"],
        "–¢—è–∂–µ–ª": ["–¢—Ä–∏—Ü–µ—Ä–∞—Ç–æ–ø—Å", "–°—Ç–µ–≥–æ–∑", "–ì–∞–¥—Ä–æ–∑–∞–≤—Ä", "–≠–ª–∞—Å–º–æ—Ç–µ—Ä–∏–∏", "–ú–∞–≥–µ–ª–∞–Ω–∏—è", "–®–µ—Ä—Å—Ç –Ω–æ—Å–æ—Ä–æ–≥"],
        "–¢–∏—Ç–∞–Ω": ["–¢–∏—Ä–∞–Ω–Ω–æ–∑–∞–≤—Ä", "–ë—Ä–∞—Ö–∏–æ–∑–∞–≤—Ä", "–ü—Ç–µ—Ä–æ–¥–∞–∫—Ç–∏–ª—å", "–ì–æ–¥–∑–∏–ª–ª–∞"]
    }},
    "–ì–æ—Ä—ã": {"level": 140, "animals": {
        "–ú–µ–ª–æ—á—å": ["–í–æ—Ä–æ–±–µ–π", "–ö–µ–¥—Ä–æ–≤–∫–∞", "–ì–æ–ª—É–±—å", "–°–∏–Ω–∏—Ü–∞", "–ö–æ—Ä–æ–ª—ë–∫", "–ö—Ä–∞–ø–∏–≤–Ω–∏–∫", "–ß–∏–∂", "–ó—è–±–ª–∏–∫", "–ó–∞—Ä—è–Ω–∫–∞"],
        "–°—Ä–µ–¥–Ω": ["–ö–µ–∫–ª–∏–∫", "–£–ª–∞—Ä", "–ö—É—Ä–æ–ø–∞—Ç–∫–∞", "–î—è—Ç–µ–ª", "–¢–µ—Ç–µ—Ä–µ–≤", "–§–∞–∑–∞–Ω", "–°–æ–π–∫–∞"],
        "–û–ø–∞—Å–Ω": ["–°–∞–ø—Å–∞–Ω", "–ë–µ—Ä–∫—É—Ç", "–Ø—Å—Ç—Ä–µ–±", "–ë–æ—Ä–æ–¥–∞—á", ],
        "–¢—è–∂–µ–ª": ["–ß–µ—Ä–Ω—ã–π –≥—Ä–∏—Ñ", "–ö–æ–Ω–¥–æ—Ä", "–ü–µ–ª–∏–∫–∞–Ω"],
        "–¢–∏—Ç–∞–Ω": ["–û—Ä–µ–ª", "–†—É—Ö", "–ó–∏–∑"]
    }},
    "–ü–æ–¥–≤–æ–¥–Ω—ã–π –º–∏—Ä": {"level": 245, "animals": {
        "–ú–µ–ª–æ—á—å": ["–†—ã–±–∞-—Å–≤–µ—Ç–ª—è–∫", "–ö—Ä–∞–±", "–†—ã–±–∞-–∫–ª–æ—É–Ω", "–ú–µ–¥—É–∑–∞", "–ê–Ω—á–æ—É—Å", "–û—Ñ–∏—É—Ä–∞", "–ö–∞–ª—å–º–∞—Ä", "–†—ã–±–∞-–ö–∞–ø–ª—è"],
        "–°—Ä–µ–¥–Ω": ["–°–∫–∞—Ç", "–û—Å—å–º–∏–Ω–æ–≥", "–•–∏–º–µ—Ä–∞", "–†—ã–±–∞-—Ñ—É–≥—É"],
        "–û–ø–∞—Å–Ω": ["–£–¥–∏–ª—å—â–∏–∫", "–ú—É—Ä–µ–Ω–∞", "–ë–∞—Ä—Ä–∞–∫—É–¥–∞", "–ö—Ä—ã–ª–∞—Ç–∫–∞", "–ü–∏—Ä–∞–Ω—å—è"],
        "–¢—è–∂–µ–ª": ["–ú–∞–Ω—Ç–∞", "–ö–∞—à–∞–ª–æ—Ç", "–ê–∫—É–ª–∞", "–ö–∏—Ç"],
        "–¢–∏—Ç–∞–Ω": ["–ú–µ–≥–∞–ª–æ–¥–æ–Ω", "–ö—Ä–∞–∫–µ–Ω", "–õ–µ–≤–∏–∞—Ñ–∞–Ω", "–ì–µ–ª–∏–∫–æ–ø—Ä–∏–æ–Ω"]
    }},
    "–ü—Ä–∏–∑—Ä–∞—á–Ω—ã–π –ª–µ—Å": {"level": 400, "animals": {
        "–ú–µ–ª–æ—á—å": ["–ü—Ä–∏–∑—Ä–∞–∫-–∑–∞—è—Ü", "–°–≤–µ—Ç–ª—è–∫", "–ü–ª–∞–∫–∞–ª—å—â–∏—Ü–∞", "–ò–≥–ª–æ–ª–∞–ø"],
        "–°—Ä–µ–¥–Ω": ["–í–µ—Ä–≤–æ–ª—å—Ñ", "–¢–µ–Ω—å-–í–æ—Ä–æ–Ω", "–°–∫–µ–ª–µ—Ç", "–ì–∞—Ä–ø–∏—è"],
        "–û–ø–∞—Å–Ω": ["–ü—Ä–∏–∑—Ä–∞–∫", "–£–ø—ã—Ä—å", "–í–∞–º–ø–∏—Ä", "–õ–æ—Ä–¥ –¢—É–º–∞–Ω–∞" ],
        "–¢—è–∂–µ–ª": ["–≠–Ω—Ç", "–ú–∞–Ω—Ç–∏–∫–æ—Ä–∞", "–ú–∏–Ω–æ—Ç–∞–≤—Ä", "–ì–æ—Ä–≥—É–ª—å—è"],
        "–¢–∏—Ç–∞–Ω": ["–í–ª–∞–¥—ã–∫–∞ –ª–µ—Å–∞", "–í—Å–∞–¥–Ω–∏–∫", "–í–µ–ª–∏–∫–∏–π –ª–∏—á", "–ß–µ—Ä–Ω –î—Ä–∞–∫–æ–Ω"]
    }},
}

SEARCH_CHANCES = {
    "–ú–µ–ª–æ—á—å": 60,
    "–°—Ä–µ–¥–Ω": 45,
    "–û–ø–∞—Å–Ω": 20,
    "–¢—è–∂–µ–ª": 5,
    "–¢–∏—Ç–∞–Ω": 1
}

REWARDS = {
    "–ú–µ–ª–æ—á—å": (30, 50),
    "–°—Ä–µ–¥–Ω": (140, 250),
    "–û–ø–∞—Å–Ω": (600, 1000),
    "–¢—è–∂–µ–ª": (4000, 3000),
    "–¢–∏—Ç–∞–Ω": (20000, 10000)
}

WEAPONS = {
    "–†–µ–≤–æ–ª—å–≤–µ—Ä": {"chances": [55, 20, 3, 0.5, 0.01], "description": "–ë–∞–∑–æ–≤–æ–µ –æ—Ä—É–∂–∏–µ. –®–∞–Ω—Å—ã: 55%/20%/3%/0.5%/0.01%"},
    "–î—Ä–æ–±–æ–≤–∏–∫": {"chances": [65, 40, 8, 1, 0.1], "description": "–ú–æ—â–Ω—ã–π –¥—Ä–æ–±–æ–≤–∏–∫. –®–∞–Ω—Å—ã: 65%/40%/8%/1%/0.1%"},
    "–í–∏–Ω—Ç–æ–≤–∫–∞": {"chances": [25, 60, 20, 5, 0.5], "description": "–¢–æ—á–Ω–∞—è –≤–∏–Ω—Ç–æ–≤–∫–∞. –®–∞–Ω—Å—ã: 25%/60%/20%/5%/0.5%"},
    "–ö–∞—Ä–∞–±–∏–Ω": {"chances": [30, 50, 45, 10, 2], "description": "–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∫–∞—Ä–∞–±–∏–Ω. –®–∞–Ω—Å—ã: 30%/50%/45%/10%/2%"},
    "–®—Ç—É—Ü–µ—Ä": {"chances": [15, 35, 65, 30, 5], "description": "–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —à—Ç—É—Ü–µ—Ä. –®–∞–Ω—Å—ã: 15%/35%/65%/30%/5%"},
    "–°–ª–æ–Ω–æ–±–æ–π": {"chances": [10, 20, 40, 65, 15], "description": "–î–ª—è –∫—Ä—É–ø–Ω–æ–π –¥–∏—á–∏. –®–∞–Ω—Å—ã: 10%/20%/40%/65%/15%"},
    "–°–Ω–∞–π–ø–µ—Ä–∫–∞": {"chances": [30, 40, 55, 65, 55], "description": "–°–Ω–∞–π–ø–µ—Ä—Å–∫–∞—è –≤–∏–Ω—Ç–æ–≤–∫–∞. –®–∞–Ω—Å—ã: 30%/40%/55%/65%/55%"},
    "–¢–µ–Ω–µ–≤–æ–π –±–ª–∞—Å—Ç–µ—Ä": {"chances": [80, 80, 70, 70, 60], "description": "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–æ–µ –æ—Ä—É–∂–∏–µ. –®–∞–Ω—Å—ã: 80%/80%/70%/70%/60%"}
}

WEAPON_PRICES = {
    "–†–µ–≤–æ–ª—å–≤–µ—Ä": 0,
    "–î—Ä–æ–±–æ–≤–∏–∫": 1500,
    "–í–∏–Ω—Ç–æ–≤–∫–∞": 6000,
    "–ö–∞—Ä–∞–±–∏–Ω": 18000,
    "–®—Ç—É—Ü–µ—Ä": 45000,
    "–°–ª–æ–Ω–æ–±–æ–π": 100000,
    "–°–Ω–∞–π–ø–µ—Ä–∫–∞": 300000,
    "–¢–µ–Ω–µ–≤–æ–π –±–ª–∞—Å—Ç–µ—Ä": 1000000
}

# ================== –§–†–ê–ó–´ –ü–†–ò –ü–†–û–ú–ê–•–ï ==================
MISS_PHRASES = [
    "–ü—É–ª—è —Ä–µ—à–∏–ª–∞ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –¥–µ—Ä–µ–≤–æ–º –≤–º–µ—Å—Ç–æ —Ü–µ–ª–∏! üå≥",
    "–ñ–∏–≤–æ—Ç–Ω–æ–µ —Å–¥–µ–ª–∞–ª–æ –≥—Ä–∞—Ü–∏–æ–∑–Ω—ã–π –ø–∏—Ä—É—ç—Ç –∏ —É–∫–ª–æ–Ω–∏–ª–æ—Å—å! üíÉ",
    "–í–∞—à –≤—ã—Å—Ç—Ä–µ–ª –±—ã–ª —Ç–∞–∫ –∂–µ –±–ª–∏–∑–∫–æ, –∫–∞–∫ –õ—É–Ω–∞ –∫ –ó–µ–º–ª–µ! üåô",
    "–ó–≤–µ—Ä—å –ø—Ä–æ—è–≤–∏–ª —á—É–¥–µ—Å–∞ –∞–∫—Ä–æ–±–∞—Ç–∏–∫–∏! ü§∏",
    "–ü—É–ª—è –æ—Ç–ø—Ä–∞–≤–∏–ª–∞—Å—å –≤ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ! üß≠",
    "–ú–∏–º–æ! –ù–æ –∑–∞—Ç–æ –∫—Ä–∞—Å–∏–≤–∞—è —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—è! ‚ú®",
    "–ñ–∏–≤–æ—Ç–Ω–æ–µ –ø–æ–π–º–∞–ª–æ –≤–∞—à—É –ø—É–ª—é –Ω–∞ –ª–µ—Ç—É –∏ –≤–µ—Ä–Ω—É–ª–æ! ü•é",
    "–í—ã—Å—Ç—Ä–µ–ª –±—ã–ª —ç—Ñ—Ñ–µ–∫—Ç–Ω—ã–º, –Ω–æ –Ω–µ —Ç–æ—á–Ω—ã–º! üé≠",
    "–ó–≤–µ—Ä—å —É—Å–ª—ã—à–∞–ª –≤—ã—Å—Ç—Ä–µ–ª –∏ —ç–ª–µ–≥–∞–Ω—Ç–Ω–æ —É–≤–µ—Ä–Ω—É–ª—Å—è! üï∫",
    "–í–∞—à–∞ –ø—É–ª—è —Ä–µ—à–∏–ª–∞, —á—Ç–æ —Å–µ–≥–æ–¥–Ω—è –µ–µ –≤—ã—Ö–æ–¥–Ω–æ–π! üèñÔ∏è",
    "–ú–∏—à–µ–Ω—å –æ–∫–∞–∑–∞–ª–∞—Å—å –º–∞—Å—Ç–µ—Ä–æ–º —Ç–∞–π-—á–∏! ü•ã",
    "–ü—É–ª—è –ø—Ä–µ–¥–ø–æ—á–ª–∞ –ø–æ–ª—é–±–æ–≤–∞—Ç—å—Å—è –ø–µ–π–∑–∞–∂–µ–º! üèûÔ∏è",
    "–ñ–∏–≤–æ—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ —Ç–µ—Ö–Ω–∏–∫—É '–Ω–µ–≤–∏–¥–∏–º–æ–µ –ø–æ–ª–µ'! üõ°Ô∏è",
    "–í—ã—Å—Ç—Ä–µ–ª –±—ã–ª –±–ª–∏–∑–æ–∫, –Ω–æ –Ω–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ! üìè",
    "–ó–≤–µ—Ä—å –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª —Ñ–µ–Ω–æ–º–µ–Ω–∞–ª—å–Ω—É—é —Ä–µ–∞–∫—Ü–∏—é! ‚ö°"
]

# ================== –°–ù–ê–†–Ø–ñ–ï–ù–ò–ï ==================
EQUIPMENT = {
    "–ü—Ä–∏–º–∞–Ω–∫–∞": {
        "price": 1000,
        "description": "+5% –∫ –ø–æ–∏—Å–∫—É –æ–ø–∞—Å–Ω—ã—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö",
        "bonus": {"–û–ø–∞—Å–Ω": 5}
    },
    "–ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞": {
        "price": 3000,
        "description": "+5% –∫ –ø–æ–∏—Å–∫—É –æ–ø–∞—Å–Ω—ã—Ö –∏ +5% –∫ –ø–æ–∏—Å–∫—É —Ç—è–∂–µ–ª—ã—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö",
        "bonus": {"–û–ø–∞—Å–Ω": 5, "–¢—è–∂–µ–ª": 5}
    },
    "–õ–æ–∫–∞—Ç–æ—Ä": {
        "price": 12500,
        "description": "+10% –∫ –ø–æ–∏—Å–∫—É –æ–ø–∞—Å–Ω—ã—Ö, +5% –∫ –ø–æ–∏—Å–∫—É —Ç—è–∂–µ–ª—ã—Ö –∏ +3% –∫ –ø–æ–∏—Å–∫—É —Ç–∏—Ç–∞–Ω–æ–≤",
        "bonus": {"–û–ø–∞—Å–Ω": 10, "–¢—è–∂–µ–ª": 5, "–¢–∏—Ç–∞–Ω": 3}
    },
    "–†—é–∫–∑–∞–∫": {
        "price": 20000,
        "description": "+100 –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º—É –∑–¥–æ—Ä–æ–≤—å—é",
        "bonus": {"health": 100}
    },
    "–£–ª—É—á—à–µ–Ω–Ω—ã–µ –ª–æ–≤—É—à–∫–∏": {
        "price": 20000,
        "description": "–í—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ 5 –∂–∏–≤–æ—Ç–Ω—ã—Ö –≤–º–µ—Å—Ç–æ 3, –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –ª–æ–≤—É—à–µ–∫",
        "bonus": {"traps": 5}
    },
    "–í–∏—Ç–∞–º–∏–Ω—ã": {
        "price": 5000,
        "description": "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è –≤ 1.5 —Ä–∞–∑–∞",
        "bonus": {"healing_bonus": 1.5}
    }
}

# ================== –ü–†–ï–î–ú–ï–¢–´ –î–õ–Ø –í–´–ñ–ò–í–ê–ù–ò–Ø ==================
SURVIVAL_ITEMS = {
    # –¢–∞–π–≥–∞
    "–¢–µ–ø–ª—ã–µ –≤–∞—Ä–µ–∂–∫–∏": {
        "location": "–¢–∞–π–≥–∞",
        "price": 500,
        "description": "+5% –∫ –ø–æ–∏—Å–∫—É –∂–∏–≤–æ—Ç–Ω—ã—Ö –≤ –¢–∞–π–≥–µ",
        "bonus": {"search_bonus": 5}
    },
    "–ö–æ–º–ø–∞—Å –æ—Ö–æ—Ç–Ω–∏–∫–∞": {
        "location": "–¢–∞–π–≥–∞",
        "price": 1500,
        "description": "+3% –∫–æ –≤—Å–µ–º —à–∞–Ω—Å–∞–º –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ –¢–∞–π–≥–µ",
        "bonus": {"hit_bonus": 3}
    },
    
    # –°–∞–≤–∞–Ω–Ω–∞
    "–§–ª—è–≥–∞ —Å –≤–æ–¥–æ–π": {
        "location": "–°–∞–≤–∞–Ω–Ω–∞",
        "price": 2500,
        "description": "–ó–∞—â–∏—â–∞–µ—Ç –æ—Ç –∂–∞—Ä—ã –≤ –°–∞–≤–∞–Ω–Ω–µ",
        "survival": True
    },
    "–®–ª—è–ø–∞ –æ—Ç —Å–æ–ª–Ω—Ü–∞": {
        "location": "–°–∞–≤–∞–Ω–Ω–∞",
        "price": 3500,
        "description": "+5% –∫ –ø–æ–∏—Å–∫—É –∂–∏–≤–æ—Ç–Ω—ã—Ö –≤ –°–∞–≤–∞–Ω–Ω–µ",
        "bonus": {"search_bonus": 5}
    },
    
    # –ê—Ä–∫—Ç–∏–∫–∞
    "–ú–µ—Ö–æ–≤–æ–π –∫–æ—Å—Ç—é–º": {
        "location": "–ê—Ä–∫—Ç–∏–∫–∞",
        "price": 4000,
        "description": "–ó–∞—â–∏—â–∞–µ—Ç –æ—Ç —Ö–æ–ª–æ–¥–∞ –≤ –ê—Ä–∫—Ç–∏–∫–µ",
        "survival": True
    },
    "–¢–µ—Ä–º–æ—Å": {
        "location": "–ê—Ä–∫—Ç–∏–∫–∞",
        "price": 2500,
        "description": "+3% –∫ –æ–ø—ã—Ç—É –∑–∞ –∂–∏–≤–æ—Ç–Ω—ã—Ö –≤ –ê—Ä–∫—Ç–∏–∫–µ",
        "bonus": {"exp_bonus": 3}
    },
    
    # –î–∂—É–Ω–≥–ª–∏
    "–ê–Ω—Ç–∏–º–æ—Å–∫–∏—Ç–Ω–∞—è —Å–µ—Ç–∫–∞": {
        "location": "–î–∂—É–Ω–≥–ª–∏",
        "price": 3000,
        "description": "–ó–∞—â–∏—â–∞–µ—Ç –æ—Ç —è–¥–æ–≤ –≤ –î–∂—É–Ω–≥–ª—è—Ö",
        "survival": True
    },
    "–ú–∞—á–µ—Ç–µ": {
        "location": "–î–∂—É–Ω–≥–ª–∏",
        "price": 4500,
        "description": "+5% –∫ –ø–æ–∏—Å–∫—É –∂–∏–≤–æ—Ç–Ω—ã—Ö –≤ –î–∂—É–Ω–≥–ª—è—Ö",
        "bonus": {"search_bonus": 5}
    },
    
    # –î—Ä–µ–≤–Ω–∏–π
    "–°—Ç–∞–±–∏–ª–∏–∑–∞—Ç–æ—Ä": {
        "location": "–î—Ä–µ–≤–Ω–∏–π –º–∏—Ä",
        "price": 12500,
        "description": "–ó–∞—â–∏—â–∞–µ—Ç –æ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∞–Ω–æ–º–∞–ª–∏–π",
        "survival": True
    },

    "–ê—Ä—Ö –ö–∏—Å—Ç—å": {
        "location": "–î—Ä–µ–≤–Ω–∏–π –º–∏—Ä",
        "price": 8000,
        "description": "+5% –∫ –æ–ø—ã—Ç—É –∑–∞ –¥—Ä–µ–≤–Ω–∏—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö",
        "bonus": {"exp_bonus": 5}
    },
    
    # –ì–æ—Ä—ã
    "–ö–∏—Å–ª–æ—Ä–æ–¥ –ë": {
        "location": "–ì–æ—Ä—ã",
        "price": 6000,
        "description": "–ó–∞—â–∏—â–∞–µ—Ç –æ—Ç –≤—ã—Å–æ—Ç–Ω–æ–π –±–æ–ª–µ–∑–Ω–∏",
        "survival": True
    },
    "–õ–µ–¥–æ—Ä—É–±": {
        "location": "–ì–æ—Ä—ã",
        "price": 4000,
        "description": "+3% –∫ —à–∞–Ω—Å—É –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ –ì–æ—Ä–∞—Ö",
        "bonus": {"hit_bonus": 3}
    },
    
    # –ü–æ–¥–≤–æ–¥–Ω—ã–π –º–∏—Ä
    "–ê–∫–≤–∞–ª–∞–Ω–≥": {
        "location": "–ü–æ–¥–≤–æ–¥–Ω—ã–π –º–∏—Ä",
        "price": 15000,
        "description": "–ü–æ–∑–≤–æ–ª—è–µ—Ç –¥—ã—à–∞—Ç—å –ø–æ–¥ –≤–æ–¥–æ–π",
        "survival": True
    },
    "–ì–∏–¥—Ä–æ–∫–æ—Å—Ç—é–º": {
        "location": "–ü–æ–¥–≤–æ–¥–Ω—ã–π –º–∏—Ä",
        "price": 8000,
        "description": "+5% –∫ –ø–æ–∏—Å–∫—É –∂–∏–≤–æ—Ç–Ω—ã—Ö –ø–æ–¥ –≤–æ–¥–æ–π",
        "bonus": {"search_bonus": 5}
    },
    
    # –ü—Ä–∏–∑—Ä–∞—á–Ω—ã–π –ª–µ—Å
    "–ê–º—É–ª–µ—Ç –ª—É–Ω—ã": {
        "location": "–ü—Ä–∏–∑—Ä–∞—á–Ω—ã–π –ª–µ—Å",
        "price": 25000,
        "description": "–ó–∞—â–∏—â–∞–µ—Ç –æ—Ç –ø—Ä–∏–∑—Ä–∞—á–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–∏",
        "survival": True
    },
    "–°–≤–µ—á–∞ –¥—É—à–∏": {
        "location": "–ü—Ä–∏–∑—Ä–∞—á–Ω—ã–π –ª–µ—Å",
        "price": 12000,
        "description": "+5% –∫ —à–∞–Ω—Å—É –ø–æ–ø–∞–¥–∞–Ω–∏—è –ø–æ –ø—Ä–∏–∑—Ä–∞—á–Ω—ã–º —Å—É—â–µ—Å—Ç–≤–∞–º",
        "bonus": {"hit_bonus": 5}
    }
}

# –§—Ä–∞–∑—ã –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ HP –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø—Ä–µ–¥–º–µ—Ç–∞ –≤—ã–∂–∏–≤–∞–Ω–∏—è
SURVIVAL_DAMAGE_PHRASES = {
    "–°–∞–≤–∞–Ω–Ω–∞": [
        "üî• –ù–µ–≤—ã–Ω–æ—Å–∏–º–∞—è –∂–∞—Ä–∞ –≤ –°–∞–≤–∞–Ω–Ω–µ –∏—Å—Å—É—à–∞–µ—Ç –≤–∞—à–∏ —Å–∏–ª—ã! -80HP",
        "‚òÄÔ∏è –°–æ–ª–Ω—Ü–µ –ø–∞–ª–∏—Ç –Ω–µ—â–∞–¥–Ω–æ! –ë–µ–∑ –≤–æ–¥—ã –≤—ã —Å–ª–∞–±–µ–µ—Ç–µ. -80HP"
    ],
    "–ê—Ä–∫—Ç–∏–∫–∞": [
        "‚ùÑÔ∏è –õ—é—Ç—ã–π —Ö–æ–ª–æ–¥ –ê—Ä–∫—Ç–∏–∫–∏ –ø—Ä–æ–Ω–∏–∑—ã–≤–∞–µ—Ç –¥–æ –∫–æ—Å—Ç–µ–π! -80HP",
        "üå¨Ô∏è –õ–µ–¥—è–Ω–æ–π –≤–µ—Ç–µ—Ä –≤—ã—Å–∞—Å—ã–≤–∞–µ—Ç –∏–∑ –≤–∞—Å —Ç–µ–ø–ª–æ. -80HP"
    ],
    "–î–∂—É–Ω–≥–ª–∏": [
        "üêç –Ø–¥–æ–≤–∏—Ç—ã–µ –∏—Å–ø–∞—Ä–µ–Ω–∏—è –¥–∂—É–Ω–≥–ª–µ–π –æ—Ç—Ä–∞–≤–ª—è—é—Ç –≤–∞—Å! -80HP",
        "ü¶ü –¢—Ä–æ–ø–∏—á–µ—Å–∫–∏–µ –±–æ–ª–µ–∑–Ω–∏ –ø–æ–¥—Ä—ã–≤–∞—é—Ç –∑–¥–æ—Ä–æ–≤—å–µ. -80HP"
    ],
    "–î—Ä–µ–≤–Ω–∏–π –º–∏—Ä": [
        "üåÄ –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∞–Ω–æ–º–∞–ª–∏–∏ —Ä–∞–∑—Ä—É—à–∞—é—Ç –≤–∞—à—É —Å—É—â–Ω–æ—Å—Ç—å! -80HP",
        "‚è≥ –ò—Å–∫–∞–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Å–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –∑–¥–æ—Ä–æ–≤—å–µ. -80HP"
    ],
    "–ì–æ—Ä—ã": [
        "‚õ∞Ô∏è –í—ã—Å–æ—Ç–Ω–∞—è –±–æ–ª–µ–∑–Ω—å —Å–∂–∏–º–∞–µ—Ç –≤–∞—à–∏ –ª–µ–≥–∫–∏–µ! -80HP",
        "üí® –ù–µ—Ö–≤–∞—Ç–∫–∞ –∫–∏—Å–ª–æ—Ä–æ–¥–∞ –Ω–∞ –≤—ã—Å–æ—Ç–µ –æ—Å–ª–∞–±–ª—è–µ—Ç –≤–∞—Å. -80HP"
    ],
    "–ü–æ–¥–≤–æ–¥–Ω—ã–π –º–∏—Ä": [
        "üåä –ë–µ–∑ –∞–∫–≤–∞–ª–∞–Ω–≥–∞ –≤—ã –∑–∞–¥—ã—Ö–∞–µ—Ç–µ—Å—å –ø–æ–¥ –≤–æ–¥–æ–π! -80HP",
        "üíß –î–∞–≤–ª–µ–Ω–∏–µ –≤–æ–¥—ã —Ä–∞–∑—Ä—É—à–∞–µ—Ç –≤–∞—à –æ—Ä–≥–∞–Ω–∏–∑–º. -80HP"
    ],
    "–ü—Ä–∏–∑—Ä–∞—á–Ω—ã–π –ª–µ—Å": [
        "üëª –ü—Ä–∏–∑—Ä–∞—á–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –≤—ã—Å–∞—Å—ã–≤–∞—é—Ç –∂–∏–∑–Ω–µ–Ω–Ω—É—é —ç–Ω–µ—Ä–≥–∏—é! -80HP",
        "üïØÔ∏è –¢–µ–º–Ω–∞—è –º–∞–≥–∏—è –ª–µ—Å–∞ –∏—Å—Ç–æ—â–∞–µ—Ç –≤–∞—à–∏ —Å–∏–ª—ã. -80HP"
    ]
}

# –ë–∞—Ñ—Ñ—ã (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ)
BUFFS = {
    "–ê–ø—Ç–µ—á–∫–∞": {
        "price": 750,
        "description": "–ü–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–¥–æ—Ä–æ–≤—å–µ",
        "effect": "full_heal"
    },
    "–ó–æ–ª–æ—Ç–∞—è –ø—É–ª—è": {
        "price": 2000,
        "description": "x2 —à–∞–Ω—Å –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ —Å–ª–µ–¥—É—é—â–µ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ (—Å–≥–æ—Ä–∞–µ—Ç –ø–æ—Å–ª–µ –≤—ã—Å—Ç—Ä–µ–ª–∞)",
        "effect": "golden_bullet"
    },
    "–î—Ä–æ–Ω": {
        "price": 2000,
        "description": "–ù–∞—Ö–æ–¥–∏—Ç 3 –∂–∏–≤–æ—Ç–Ω—ã—Ö –Ω–∞ –≤—ã–±–æ—Ä, +10% —à–∞–Ω—Å –Ω–∞–π—Ç–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ –Ω–∞ 30 –º–∏–Ω",
        "effect": "drone"
    },
    "–ü–æ—Å–æ—Ö –±–µ—Å—Å–º–µ—Ä—Ç–∏—è": {
        "price": 4000,
        "description": "–ó–∞—â–∏—â–∞–µ—Ç –æ—Ç –∫–æ–Ω—Ç—Ä–∞—Ç–∞–∫–∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ –∂–∏–≤–æ—Ç–Ω–æ–≥–æ",
        "effect": "immortality_staff"
    },
    "–ê–ª–º–∞–∑–Ω–∞—è –ø—É–ª—è": {
        "price": 5000,
        "description": "+20% —à–∞–Ω—Å –ø–æ–ø–∞—Å—Ç—å –≤ —Å–ª–µ–¥—É—é—â–µ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ",
        "effect": "diamond_bullet"
    }
}

# –§—Ä–∞–∑—ã –∫–æ–Ω—Ç—Ä–∞—Ç–∞–∫ –¥–ª—è –ö–ê–ñ–î–û–ì–û –∂–∏–≤–æ—Ç–Ω–æ–≥–æ (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï)
ANIMAL_ATTACK_PHRASES = {
    # –¢–∞–π–≥–∞
    "–ö–∞–±–∞–Ω": ["–ö–∞–±–∞–Ω —è—Ä–æ—Å—Ç–Ω–æ –±—Ä–æ—Å–∞–µ—Ç—Å—è –Ω–∞ –≤–∞—Å! -25HP", "–ö–∞–±–∞–Ω –±—å–µ—Ç –∫–ª—ã–∫–∞–º–∏! -25HP"],
    "–†—ã—Å—å": ["–†—ã—Å—å —Ü–∞—Ä–∞–ø–∞–µ—Ç –∫–æ–≥—Ç—è–º–∏! -25HP", "–†—ã—Å—å –ø—Ä—ã–≥–∞–µ—Ç –Ω–∞ –≤–∞—Å! -25HP"],
    "–†–æ—Å–æ–º–∞—Ö–∞": ["–†–æ—Å–æ–º–∞—Ö–∞ –≤–ø–∏–≤–∞–µ—Ç—Å—è –≤ —Ä—É–∫—É! -25HP", "–†–æ—Å–æ–º–∞—Ö–∞ –∞—Ç–∞–∫—É–µ—Ç! -25HP"],
    "–°–µ—Ä—ã–π –≤–æ–ª–∫": ["–í–æ–ª–∫ –≤–ø–∏–≤–∞–µ—Ç—Å—è –≤ —Ä—É–∫—É! -25HP", "–í–æ–ª–∫ —Å—Ç–∞–µ–π –æ–∫—Ä—É–∂–∞–µ—Ç –≤–∞—Å! -25HP"],
    "–ë—É—Ä—ã–π –º–µ–¥–≤–µ–¥—å": ["–ë—É—Ä—ã–π –º–µ–¥–≤–µ–¥—å –Ω–∞–Ω–æ—Å–∏—Ç —Å–æ–∫—Ä—É—à–∏—Ç–µ–ª—å–Ω—ã–π —É–¥–∞—Ä! -25HP", "–ë—É—Ä—ã–π –º–µ–¥–≤–µ–¥—å —Å–±–∏–≤–∞–µ—Ç —Å –Ω–æ–≥! -25HP"],
    "–õ–æ—Å—å": ["–õ–æ—Å—å –±—å–µ—Ç —Ä–æ–≥–∞–º–∏! -50HP", "–õ–æ—Å—å —Ç–æ–ø—á–µ—Ç –∫–æ–ø—ã—Ç–∞–º–∏! -50HP"],
    "–û–±–æ—Ä–æ—Ç–µ–Ω—å": ["–û–±–æ—Ä–æ—Ç–µ–Ω—å –≤–ø–∏–≤–∞–µ—Ç—Å—è –∫–ª—ã–∫–∞–º–∏ –≤ –≥–æ—Ä–ª–æ! -100HP", "–û–±–æ—Ä–æ—Ç–µ–Ω—å —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç –∫–æ–≥—Ç—è–º–∏! -100HP"],
    
    # –°–∞–≤–∞–Ω–Ω–∞
    "–ì–∏–µ–Ω–∞": ["–ì–∏–µ–Ω–∞ —Ö–≤–∞—Ç–∞–µ—Ç –∑–∞ –Ω–æ–≥—É! -25HP", "–ì–∏–µ–Ω–∞ —Å—Ç–∞–µ–π –Ω–∞–ø–∞–¥–∞–µ—Ç! -25HP"],
    "–ü—É–º–∞": ["–ü—É–º–∞ –ø—Ä—ã–≥–∞–µ—Ç –Ω–∞ –≤–∞—Å! -25HP", "–ü—É–º–∞ —Ü–∞—Ä–∞–ø–∞–µ—Ç! -25HP"],
    "–õ–µ–≤": ["–õ–µ–≤ —Å–±–∏–≤–∞–µ—Ç —Å –Ω–æ–≥ —É–¥–∞—Ä–æ–º –ª–∞–ø—ã! -25HP", "–õ–µ–≤ –≤–ø–∏–≤–∞–µ—Ç—Å—è –≤ –ø–ª–µ—á–æ! -25HP"],
    "–ñ–∏—Ä–∞—Ñ": ["–ñ–∏—Ä–∞—Ñ –±—å—ë—Ç –º–æ—â–Ω–æ–π —à–µ–µ–π! -50HP", "–ñ–∏—Ä–∞—Ñ —Å–±–∏–≤–∞–µ—Ç —É–¥–∞—Ä–æ–º –≥–æ–ª–æ–≤—ã! -50HP"],
    "–ë—É–π–≤–æ–ª": ["–ë—É–π–≤–æ–ª —Ç–æ–ø—á–µ—Ç –∫–æ–ø—ã—Ç–∞–º–∏! -50HP", "–ë—É–π–≤–æ–ª –±—å–µ—Ç —Ä–æ–≥–∞–º–∏! -50HP"],
    "–°–ª–æ–Ω": ["–°–ª–æ–Ω –ø–æ–¥–Ω–∏–º–∞–µ—Ç –≤–∞—Å —Ö–æ–±–æ—Ç–æ–º –∏ –±—Ä–æ—Å–∞–µ—Ç! -50HP", "–°–ª–æ–Ω —Ç–æ–ø—á–µ—Ç! -50HP"],
    "–ì—Ä–æ—Ç—Å–ª–∞–Ω–≥": ["–ì—Ä–æ—Ç—Å–ª–∞–Ω–≥ –æ–±–≤–∏–≤–∞–µ—Ç –≤–∞—Å —Å–≤–æ–∏–º –∑–º–µ–∏–Ω—ã–º —Ç–µ–ª–æ–º –∏ —Å —Ö—Ä—É—Å—Ç–æ–º —Å–¥–∞–≤–ª–∏–≤–∞–µ—Ç! -100HP", "–ì—Ä–æ—Ç—Å–ª–∞–Ω–≥ –∫—É—Å–∞–µ—Ç! -100HP"],
    
    # –ê—Ä–∫—Ç–∏–∫–∞
    "–°–Ω–µ–∂–Ω –±–∞—Ä—Å": ["–°–Ω–µ–∂–Ω—ã–π –±–∞—Ä—Å –ø—Ä—ã–≥–∞–µ—Ç –Ω–∞ –≤–∞—Å! -25HP", "–°–Ω–µ–∂–Ω—ã–π –±–∞—Ä—Å —Ü–∞—Ä–∞–ø–∞–µ—Ç! -25HP"],
    "–ë–µ–ª—ã–π –º–µ–¥–≤–µ–¥—å": ["–ë–µ–ª—ã–π –º–µ–¥–≤–µ–¥—å —Å–±–∏–≤–∞–µ—Ç –ª–∞–ø–æ–π! -25HP", "–ë–µ–ª—ã–π –º–µ–¥–≤–µ–¥—å –∫—É—Å–∞–µ—Ç! -25HP"],
    "–ú–æ—Ä–∂": ["–ú–æ—Ä–∂ –∞—Ç–∞–∫—É–µ—Ç –∫–ª—ã–∫–∞–º–∏! -50HP", "–ú–æ—Ä–∂ –±—å–µ—Ç —Ç—É–ª–æ–≤–∏—â–µ–º! -50HP"],
    "–ë–µ–ª—É—Ö–∞": ["–ë–µ–ª—É—Ö–∞ –≤—ã–ø—Ä—ã–≥–∏–≤–∞–µ—Ç –∏–∑ –≤–æ–¥—ã! -50HP", "–ë–µ–ª—É—Ö–∞ —Ç–∞—Ä–∞–Ω–∏—Ç! -50HP"],
    "–û–≤—Ü–µ–±—ã–∫": ["–û–≤—Ü–µ–±—ã–∫ —Ç–∞—Ä–∞–Ω–∏—Ç –≤–∞—Å! -50HP", "–û–≤—Ü–µ–±—ã–∫ –±—å–µ—Ç —Ä–æ–≥–∞–º–∏! -50HP"],
    "–ö–æ—Å–∞—Ç–∫–∞": ["–ö–æ—Å–∞—Ç–∫–∞ –≤—ã–ø—Ä—ã–≥–∏–≤–∞–µ—Ç –∏–∑ –≤–æ–¥—ã! -50HP", "–ö–æ—Å–∞—Ç–∫–∞ —Ç–∞—Ä–∞–Ω–∏—Ç! -50HP"],
    "–ú–∞–º–æ–Ω—Ç": ["–ú–∞–º–æ–Ω—Ç —Å–º–∏–Ω–∞–µ—Ç –ø–æ–¥ —Å–æ–±–æ–π! -100HP", "–ú–∞–º–æ–Ω—Ç –±—å–µ—Ç –±–∏–≤–Ω—è–º–∏! -100HP"],
    "–ô–µ—Ç–∏": ["–ô–µ—Ç–∏ —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç –Ω–∞ —á–∞—Å—Ç–∏! -100HP", "–ô–µ—Ç–∏ —Å–¥–∏—Ä–∞–µ—Ç –∫–æ–∂—É! -100HP"],
    
    # –î–∂—É–Ω–≥–ª–∏
    "–ö–æ–º–æ–¥—Å –≤–∞—Ä–∞–Ω": ["–ö–æ–º–æ–¥—Å–∫–∏–π –≤–∞—Ä–∞–Ω –∫—É—Å–∞–µ—Ç —è–¥–æ–≤–∏—Ç—ã–º–∏ –∑—É–±–∞–º–∏! -25HP", "–ö–æ–º–æ–¥—Å–∫–∏–π –≤–∞—Ä–∞–Ω –±—å–µ—Ç —Ö–≤–æ—Å—Ç–æ–º! -25HP"],
    "–ö—Ä–æ–∫–æ–¥–∏–ª": ["–ö—Ä–æ–∫–æ–¥–∏–ª —Ö–≤–∞—Ç–∞–µ—Ç —á–µ–ª—é—Å—Ç—è–º–∏! -25HP", "–ö—Ä–æ–∫–æ–¥–∏–ª —Ç–∞—â–∏—Ç –ø–æ–¥ –≤–æ–¥—É! -25HP"],
    "–ê–Ω–∞–∫–æ–Ω–¥–∞": ["–ê–Ω–∞–∫–æ–Ω–¥–∞ –æ–±–≤–∏–≤–∞–µ—Ç –∏ –¥—É—à–∏—Ç! -25HP", "–ê–Ω–∞–∫–æ–Ω–¥–∞ —Å–∂–∏–º–∞–µ—Ç! -25HP"],
    "–Ø–≥—É–∞—Ä": ["–Ø–≥—É–∞—Ä –Ω–∞–ø–∞–¥–∞–µ—Ç –∏–∑ –∑–∞—Å–∞–¥—ã! -25HP", "–Ø–≥—É–∞—Ä –≤–ø–∏–≤–∞–µ—Ç—Å—è –∫–ª—ã–∫–∞–º–∏! -25HP"],
    "–ì–æ—Ä–∏–ª–ª–∞": ["–ì–æ—Ä–∏–ª–ª–∞ –±—å–µ—Ç –∫—É–ª–∞–∫–æ–º! -25HP", "–ì–æ—Ä–∏–ª–ª–∞ –ª–æ–º–∞–µ—Ç –∫–æ—Å—Ç–∏! -25HP"],
    "–¢–∏–≥—Ä": ["–¢–∏–≥—Ä –Ω–∞–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –≤–∞—Å! -25HP", "–¢–∏–≥—Ä —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç –∫–æ–≥—Ç—è–º–∏! -25HP"],
    "–ü–∞–Ω—Ç–µ—Ä–∞": ["–ü–∞–Ω—Ç–µ—Ä–∞ –ø—Ä—ã–≥–∞–µ—Ç —Å–æ –¥–µ—Ä–µ–≤–∞! -25HP", "–ü–∞–Ω—Ç–µ—Ä–∞ –∫—É—Å–∞–µ—Ç –∑–∞ —à–µ—é! -25HP"],
    "–ù–æ—Å–æ—Ä–æ–≥": ["–ù–æ—Å–æ—Ä–æ–≥ –ø—Ä–æ–±–∏–≤–∞–µ—Ç –±—Ä–µ—à—å –≤ –∑–∞—â–∏—Ç–µ! -50HP", "–ù–æ—Å–æ—Ä–æ–≥ —Ç–∞—Ä–∞–Ω–∏—Ç! -50HP"],
    "–ß—É–ø–∞–∫–∞–±—Ä–∞": ["–ß—É–ø–∞–∫–∞–±—Ä–∞ –≤—ã—Å–∞—Å—ã–≤–∞–µ—Ç –≤—Å—é –∫—Ä–æ–≤—å! -100HP", "–ß—É–ø–∞–∫–∞–±—Ä–∞ —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç –ø–ª–æ—Ç—å! -100HP"],
    
    # –î—Ä–µ–≤–Ω–∏–π –º–∏—Ä
    "–°–º–∏–ª–æ–¥–æ–Ω": ["–°–º–∏–ª–æ–¥–æ–Ω –≤–ø–∏–≤–∞–µ—Ç—Å—è –∫–ª—ã–∫–∞–º–∏! -25HP", "–°–∞–±–ª–µ–∑—É–±—ã–π —Ç–∏–≥—Ä –∞—Ç–∞–∫—É–µ—Ç! -25HP"],
    "–≠–Ω—Ç–µ–ª–æ–¥–æ–Ω—Ç": ["–≠–Ω—Ç–µ–ª–æ–¥–æ–Ω—Ç –∫—É—Å–∞–µ—Ç –º–æ—â–Ω—ã–º–∏ —á–µ–ª—é—Å—Ç—è–º–∏! -25HP", "–°–≤–∏–Ω–æ-–º–µ–¥–≤–µ–¥—å –∞—Ç–∞–∫—É–µ—Ç! -25HP"],
    "–ö–µ–ª–µ–Ω–∫–µ–Ω": ["–ö–µ–ª–µ–Ω–∫–µ–Ω –∫–ª—é–µ—Ç –æ–≥—Ä–æ–º–Ω—ã–º –∫–ª—é–≤–æ–º! -25HP", "–ò—Å–ø–æ–ª–∏–Ω—Å–∫–∞—è –ø—Ç–∏—Ü–∞ –∞—Ç–∞–∫—É–µ—Ç! -25HP"],
    "–ì–∏–µ–Ω–æ–¥–æ–Ω": ["–ì–∏–µ–Ω–æ–¥–æ–Ω —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç –ø–ª–æ—Ç—å! -25HP", "–î—Ä–µ–≤–Ω–∏–π —Ö–∏—â–Ω–∏–∫ –Ω–∞–ø–∞–¥–∞–µ—Ç! -25HP"],
    "–¢—Ä–∏—Ü–µ—Ä–∞—Ç–æ–ø—Å": ["–¢—Ä–∏—Ü–µ—Ä–∞—Ç–æ–ø—Å –∞—Ç–∞–∫—É–µ—Ç! -50HP", "–¢—Ä–∏—Ü–µ—Ä–∞—Ç–æ–ø—Å –ø—Ä–æ–∫–∞–ª—ã–≤–∞–µ—Ç —Ä–æ–≥–∞–º–∏! -50HP"],
    "–°—Ç–µ–≥–æ–∑": ["–°—Ç–µ–≥–æ–∑–∞–≤—Ä —É–¥–∞—Ä—è–µ—Ç —Ö–≤–æ—Å—Ç–æ–º! -50HP", "–°—Ç–µ–≥–æ–∑–∞–≤—Ä –±—å–µ—Ç —à–∏–ø–∞–º–∏! -50HP"],
    "–ì–∞–¥—Ä–æ–∑–∞–≤—Ä": ["–ì–∞–¥—Ä–æ–∑–∞–≤—Ä —Ç–æ–ø—á–µ—Ç! -50HP", "–£—Ç–∫–æ–Ω–æ—Å—ã–π –¥–∏–Ω–æ–∑–∞–≤—Ä –∞—Ç–∞–∫—É–µ—Ç! -50HP"],
    "–≠–ª–∞—Å–º–æ—Ç–µ—Ä–∏–∏": ["–≠–ª–∞—Å–º–æ—Ç–µ—Ä–∏–∏ –±—å–µ—Ç —Ä–æ–≥–æ–º! -50HP", "–ì–∏–≥–∞–Ω—Ç—Å–∫–∏–π –Ω–æ—Å–æ—Ä–æ–≥ —Ç–∞—Ä–∞–Ω–∏—Ç! -50HP"],
    "–ú–∞–≥–µ–ª–∞–Ω–∏—è": ["–ú–∞–≥–µ–ª–∞–Ω–∏—è –∫—É—Å–∞–µ—Ç! -50HP", "–ì–∏–≥–∞–Ω—Ç—Å–∫–∏–π –ª–µ–Ω–∏–≤–µ—Ü –∞—Ç–∞–∫—É–µ—Ç! -50HP"],
    "–®–µ—Ä—Å—Ç –Ω–æ—Å–æ—Ä–æ–≥": ["–®–µ—Ä—Å—Ç–∏—Å—Ç—ã–π –Ω–æ—Å–æ—Ä–æ–≥ –±—å–µ—Ç —Ä–æ–≥–æ–º! -50HP", "–®–µ—Ä—Å—Ç–∏—Å—Ç—ã–π –Ω–æ—Å–æ—Ä–æ–≥ –ª–µ–¥–Ω–∏–∫–æ–≤–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ –∞—Ç–∞–∫—É–µ—Ç! -50HP"],
    "–¢–∏—Ä–∞–Ω–Ω–æ–∑–∞–≤—Ä": ["–¢–∏—Ä–∞–Ω–Ω–æ–∑–∞–≤—Ä —Ö–≤–∞—Ç–∞–µ—Ç –≤–∞—Å –≤ –ø–∞—Å—Ç—å! -100HP", "–ö–æ—Ä–æ–ª—å –¥–∏–Ω–æ–∑–∞–≤—Ä–æ–≤ –¥—Ä–æ–±–∏—Ç –∫–æ—Å—Ç–∏! -100HP"],
    "–ë—Ä–∞—Ö–∏–æ–∑–∞–≤—Ä": ["–ë—Ä–∞—Ö–∏–æ–∑–∞–≤—Ä –Ω–∞—Å—Ç—É–ø–∞–µ—Ç –Ω–∞ –≤–∞—Å! -100HP", "–ì–∏–≥–∞–Ω—Ç—Å–∫–∏–π –∑–∞—É—Ä–æ–ø–æ–¥ –¥–∞–≤–∏—Ç! -100HP"],
    "–ü—Ç–µ—Ä–æ–¥–∞–∫—Ç–∏–ª—å": ["–ü—Ç–µ—Ä–æ–¥–∞–∫—Ç–∏–ª—å —Ö–≤–∞—Ç–∞–µ—Ç –∏ –±—Ä–æ—Å–∞–µ—Ç —Å –≤—ã—Å–æ—Ç—ã! -100HP", "–õ–µ—Ç–∞—é—â–∏–π —è—â–µ—Ä –∫–ª—é–µ—Ç! -100HP"],
    
    # –ì–æ—Ä—ã
    "–°–∞–ø—Å–∞–Ω": ["–°–∞–ø—Å–∞–Ω –ø–∏–∫–∏—Ä—É–µ—Ç –Ω–∞ –≤–∞—Å! -25HP", "–°–æ–∫–æ–ª –∫–ª—é–µ—Ç! -25HP"],
    "–ë–µ—Ä–∫—É—Ç": ["–ë–µ—Ä–∫—É—Ç —Ö–≤–∞—Ç–∞–µ—Ç –∫–æ–≥—Ç—è–º–∏! -25HP", "–ó–æ–ª–æ—Ç–æ–π –æ—Ä–µ–ª –∞—Ç–∞–∫—É–µ—Ç! -25HP"],
    "–Ø—Å—Ç—Ä–µ–±": ["–Ø—Å—Ç—Ä–µ–± —Ü–∞—Ä–∞–ø–∞–µ—Ç –∫–æ–≥—Ç—è–º–∏! -25HP", "–•–∏—â–Ω–∞—è –ø—Ç–∏—Ü–∞ –Ω–∞–ø–∞–¥–∞–µ—Ç! -25HP"],
    "–ß–µ—Ä–Ω—ã–π –≥—Ä–∏—Ñ": ["–ß–µ—Ä–Ω—ã–π –≥—Ä–∏—Ñ –∫–ª—é–µ—Ç! -50HP", "–ì—Ä–∏—Ñ-–ø–∞–¥–∞–ª—å—â–∏–∫ –∞—Ç–∞–∫—É–µ—Ç! -50HP"],
    "–ö–æ–Ω–¥–æ—Ä": ["–ö–æ–Ω–¥–æ—Ä –±—å–µ—Ç –∫—Ä—ã–ª—å—è–º–∏! -50HP", "–ì–∏–≥–∞–Ω—Ç—Å–∫–∏–π –∫–æ–Ω–¥–æ—Ä –∞—Ç–∞–∫—É–µ—Ç! -50HP"],
    "–û—Ä–µ–ª": ["–û—Ä–µ–ª-–≤–µ–ª–∏–∫–∞–Ω —Ö–≤–∞—Ç–∞–µ—Ç –∫–æ–≥—Ç—è–º–∏! -100HP", "–ì–∏–≥–∞–Ω—Ç—Å–∫–∏–π –æ—Ä–µ–ª —É–Ω–æ—Å–∏—Ç –≤ –Ω–µ–±–æ! -100HP"],
    "–†—É—Ö": ["–†—É—Ö —Ö–≤–∞—Ç–∞–µ—Ç –∏ –ø–æ–¥–Ω–∏–º–∞–µ—Ç –Ω–∞ –æ–≥—Ä–æ–º–Ω—É—é –≤—ã—Å–æ—Ç—É! -100HP", "–ú–∏—Ñ–∏—á–µ—Å–∫–∞—è –ø—Ç–∏—Ü–∞ –∞—Ç–∞–∫—É–µ—Ç! -100HP"],
    
    # –ü–æ–¥–≤–æ–¥–Ω—ã–π –º–∏—Ä
    "–£–¥–∏–ª—å—â–∏–∫": ["–£–¥–∏–ª—å—â–∏–∫ –∫—É—Å–∞–µ—Ç —Å–≤–µ—Ç—è—â–∏–º–∏—Å—è –∑—É–±–∞–º–∏! -25HP", "–ì–ª—É–±–æ–∫–æ–≤–æ–¥–Ω—ã–π —Ö–∏—â–Ω–∏–∫ –∞—Ç–∞–∫—É–µ—Ç! -25HP"],
    "–ú—É—Ä–µ–Ω–∞": ["–ú—É—Ä–µ–Ω–∞ –≤–ø–∏–≤–∞–µ—Ç—Å—è –∑—É–±–∞–º–∏! -25HP", "–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∞—è –º—É—Ä–µ–Ω–∞ –±—å–µ—Ç —Ç–æ–∫–æ–º! -25HP"],
    "–ë–∞—Ä—Ä–∞–∫—É–¥–∞": ["–ë–∞—Ä—Ä–∞–∫—É–¥–∞ –ø—Ä–æ–Ω–∑–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å—é! -25HP", "–ë–∞—Ä—Ä–∞–∫—É–¥–∞ –∫—É—Å–∞–µ—Ç! -25HP"],
    "–ú–∞–Ω—Ç–∞": ["–ú–∞–Ω—Ç–∞ –±—å–µ—Ç —Ö–≤–æ—Å—Ç–æ–º! -50HP", "–ì–∏–≥–∞–Ω—Ç—Å–∫–∏–π —Å–∫–∞—Ç –Ω–∞–∫—Ä—ã–≤–∞–µ—Ç! -50HP"],
    "–ö–∞—à–∞–ª–æ—Ç": ["–ö–∞—à–∞–ª–æ—Ç –æ–≥–ª—É—à–∞–µ—Ç –∑–≤—É–∫–æ–º! -50HP", "–ì–∏–≥–∞–Ω—Ç—Å–∫–∏–π –∫–∏—Ç —Ç–∞—Ä–∞–Ω–∏—Ç! -50HP"],
    "–ê–∫—É–ª–∞": ["–ê–∫—É–ª–∞ –∫—É—Å–∞–µ—Ç! -50HP", "–ë–æ–ª—å—à–∞—è –±–µ–ª–∞—è –∞–∫—É–ª–∞ –∞—Ç–∞–∫—É–µ—Ç! -50HP"],
    "–ú–µ–≥–∞–ª–æ–¥–æ–Ω": ["–ú–µ–≥–∞–ª–æ–¥–æ–Ω –ø–µ—Ä–µ–∫—É—Å—ã–≤–∞–µ—Ç –ø–æ–ø–æ–ª–∞–º! -100HP", "–î–æ–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∞—è –∞–∫—É–ª–∞ –ø–æ–∂–∏—Ä–∞–µ—Ç! -100HP"],
    "–ö—Ä–∞–∫–µ–Ω": ["–ö—Ä–∞–∫–µ–Ω –æ–±–≤–∏–≤–∞–µ—Ç —â—É–ø–∞–ª—å—Ü–∞–º–∏! -100HP", "–ú–æ—Ä—Å–∫–æ–µ —á—É–¥–æ–≤–∏—â–µ —Ç—è–Ω–µ—Ç –Ω–∞ –¥–Ω–æ! -100HP"],
    "–õ–µ–≤–∏–∞—Ñ–∞–Ω": ["–õ–µ–≤–∏–∞—Ñ–∞–Ω –ø—Ä–æ–≥–ª–∞—Ç—ã–≤–∞–µ—Ç —Ü–µ–ª–∏–∫–æ–º! -100HP", "–ë–∏–±–ª–µ–π—Å–∫–æ–µ —á—É–¥–æ–≤–∏—â–µ —Ä–∞–∑—Ä—É—à–∞–µ—Ç! -100HP"],
    
    # –ü—Ä–∏–∑—Ä–∞—á–Ω—ã–π –ª–µ—Å
    "–í–µ—Ä–≤–æ–ª—å—Ñ": ["–í–µ—Ä–≤–æ–ª—å—Ñ –≤–ø–∏–≤–∞–µ—Ç—Å—è –∫–ª—ã–∫–∞–º–∏! -25HP", "–û–±–æ—Ä–æ—Ç–µ–Ω—å-–≤–æ–ª–∫ —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç! -25HP"],
    "–¢–µ–Ω—å-–≤–æ—Ä–æ–Ω–∞": ["–¢–µ–Ω—å-–≤–æ—Ä–æ–Ω–∞ –∫–ª—é–µ—Ç –ø—Ä–∏–∑—Ä–∞—á–Ω—ã–º –∫–ª—é–≤–æ–º! -25HP", "–¢–µ–º–Ω–∞—è –ø—Ç–∏—Ü–∞ –∞—Ç–∞–∫—É–µ—Ç! -25HP"],
    "–ü—Ä–∏–∑—Ä–∞–∫": ["–ü—Ä–∏–∑—Ä–∞–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç —Å–∫–≤–æ–∑—å –≤–∞—Å! -25HP", "–ü—Ä–∏–∑—Ä–∞—á–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å –≤—ã—Å–∞—Å—ã–≤–∞–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—É—é —Å–∏–ª—É! -25HP"],
    "–£–ø—ã—Ä—å": ["–£–ø—ã—Ä—å –∫—É—Å–∞–µ—Ç –≤–∞–º–ø–∏—Ä—Å–∫–∏–º–∏ –∫–ª—ã–∫–∞–º–∏! -25HP", "–ù–æ—á–Ω–æ–π –æ—Ö–æ—Ç–Ω–∏–∫ –∞—Ç–∞–∫—É–µ—Ç! -25HP"],
    "–≠–Ω—Ç": ["–≠–Ω—Ç –±—å–µ—Ç –≤–µ—Ç–≤—è–º–∏! -50HP", "–î—Ä–µ–≤–æ–¥–µ—Ä–µ–≤–æ —Å–æ–∫—Ä—É—à–∞–µ—Ç! -50HP"],
    "–ú–∞–Ω—Ç–∏–∫–æ—Ä–∞": ["–ú–∞–Ω—Ç–∏–∫–æ—Ä–∞ –∂–∞–ª–∏—Ç —è–¥–æ–≤–∏—Ç—ã–º —Ö–≤–æ—Å—Ç–æ–º! -50HP", "–ú–∏—Ñ–∏—á–µ—Å–∫–∏–π –∑–≤–µ—Ä—å –∞—Ç–∞–∫—É–µ—Ç! -50HP"],
    "–í–ª–∞–¥—ã–∫–∞ –ª–µ—Å–∞": ["–í–ª–∞–¥—ã–∫–∞ –ª–µ—Å–∞ –Ω–∞—Å—ã–ª–∞–µ—Ç –ø—Ä–æ–∫–ª—è—Ç–∏–µ! -100HP", "–î—É—Ö –ª–µ—Å–∞ —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç! -100HP"],
    "–í—Å–∞–¥–Ω–∏–∫": ["–í—Å–∞–¥–Ω–∏–∫ –±–µ–∑ –≥–æ–ª–æ–≤—ã –ø—Ä–æ–Ω–æ—Å–∏—Ç—Å—è —Å–∫–≤–æ–∑—å –≤–∞—Å! -100HP", "–ü—Ä–∏–∑—Ä–∞—á–Ω—ã–π –≤—Å–∞–¥–Ω–∏–∫ –∞—Ç–∞–∫—É–µ—Ç! -100HP"],
}

CONTRATTACK_DAMAGE = {
    "–û–ø–∞—Å–Ω": 25,
    "–¢—è–∂–µ–ª": 50, 
    "–¢–∏—Ç–∞–Ω": 100
}

# ================== –ù–ê–ì–†–ê–î–´ –ó–ê –ü–†–ï–°–¢–ò–ñ ==================
PRESTIGE_REWARDS = {
    1: {
        "name": "ü•â –ë—Ä–æ–Ω–∑–∞",
        "reward_coins": 5000,
        "reward_exp": 2000,
        "title": "ü•â –ë—Ä–æ–Ω–∑–æ–≤—ã–π –æ—Ö–æ—Ç–Ω–∏–∫",
        "bonus": {"exp_bonus": 5}
    },
    2: {
        "name": "ü•à –°–µ—Ä–µ–±—Ä–æ",
        "reward_coins": 10000,
        "reward_exp": 5000,
        "title": "ü•à –°–µ—Ä–µ–±—Ä—è–Ω—ã–π —Å—Ç—Ä–µ–ª–æ–∫",
        "bonus": {"coins_bonus": 10}
    },
    3: {
        "name": "ü•á –ó–æ–ª–æ—Ç–æ",
        "reward_coins": 25000,
        "reward_exp": 10000,
        "title": "ü•á –ó–æ–ª–æ—Ç–æ–π –∏—Å—Ç—Ä–µ–±–∏—Ç–µ–ª—å",
        "bonus": {"exp_bonus": 15, "coins_bonus": 10},
        "special": "golden_bullet:5"
    },
    4: {
        "name": "üíé –ü–ª–∞—Ç–∏–Ω–∞",
        "reward_coins": 50000,
        "reward_exp": 20000,
        "title": "üíé –ü–ª–∞—Ç–∏–Ω–æ–≤—ã–π –≤–µ—Ç–µ—Ä–∞–Ω",
        "bonus": {"collectible_chance": 10}
    },
    5: {
        "name": "üîÆ –°–∞–ø—Ñ–∏—Ä",
        "reward_coins": 75000,
        "reward_exp": 30000,
        "title": "üîÆ –°–∞–ø—Ñ–∏—Ä–æ–≤—ã–π –º–∞–≥",
        "bonus": {"titan_hit": 20},
        "special": "sapphire_sight"
    },
    6: {
        "name": "‚ùÑÔ∏è –ö—Ä–∏—Å—Ç–∞–ª–ª",
        "reward_coins": 100000,
        "reward_exp": 40000,
        "title": "‚ùÑÔ∏è –ö—Ä–∏—Å—Ç–∞–ª—å–Ω—ã–π –ª–æ—Ä–¥",
        "bonus": {"discount": 15}
    },
    7: {
        "name": "üåô –û–±—Å–∏–¥–∏–∞–Ω",
        "reward_coins": 150000,
        "reward_exp": 50000,
        "title": "üåô –û–±—Å–∏–¥–∏–∞–Ω–æ–≤—ã–π —Ç–µ–Ω—å",
        "bonus": {"healing_bonus": 25},
        "special": "obsidian_amulet"
    },
    8: {
        "name": "‚òÄÔ∏è –ê–º–µ—Ç–∏—Å—Ç",
        "reward_coins": 200000,
        "reward_exp": 75000,
        "title": "‚òÄÔ∏è –ê–º–µ—Ç–∏—Å—Ç–æ–≤—ã–π –ø–æ–≤–µ–ª–∏—Ç–µ–ª—å",
        "bonus": {"collectible_chance": 100}
    },
    9: {
        "name": "‚≠ê –¢–æ–ø–∞–∑",
        "reward_coins": 300000,
        "reward_exp": 100000,
        "title": "‚≠ê –¢–æ–ø–∞–∑–æ–≤—ã–π –±–æ–≥",
        "bonus": {"exp_bonus": 30, "coins_bonus": 20},
        "special": "topaz_heart"
    },
    10: {
        "name": "üëë –ê–ª–º–∞–∑",
        "reward_coins": 500000,
        "reward_exp": 150000,
        "title": "üëë –ê–ª–º–∞–∑–Ω—ã–π –∏–º–ø–µ—Ä–∞—Ç–æ—Ä",
        "bonus": {"all_bonus": 50},
        "special": "imperial_crown"
    }
}

# ================== –î–û–°–¢–ò–ñ–ï–ù–ò–Ø ==================
ACHIEVEMENTS = {
    "üêá–ó–∞–π—á—å—è —à–∫—É—Ä–∞": {
        "description": "–£–±–∏—Ç—å 20 –∑–∞–π—Ü–µ–≤",
        "reward_coins": 500,
        "reward_exp": 1000,
        "title": "üêá –ó–∞–π—Ü–µ–ª–æ–≤",
        "condition_type": "animal_kills",
        "condition_value": ("–ó–∞—è—Ü", 20)
    },
    "üíé–¢–∏—Ç–∞–Ω–æ–≤—ã–π –±–æ–≥": {
        "description": "–£–±–∏—Ç—å 3 —Ç–∏—Ç–∞–Ω–∞",
        "reward_coins": 10000,
        "reward_exp": 5000,
        "title": "üî™ –£–±–∏–π—Ü–∞ —Ç–∏—Ç–∞–Ω–æ–≤",
        "condition_type": "titan_kills",
        "condition_value": 3
    },
    "ü§ë–ë–æ–≥–∞—á": {
        "description": "–ù–∞–∫–æ–ø–∏—Ç—å 50,000 –º–æ–Ω–µ—Ç",
        "reward_coins": 10000,
        "reward_exp": 0,
        "title": "üí∞ –ë–æ–≥–∞—á",
        "condition_type": "coins",
        "condition_value": 50000
    },
    "‚ùÑÔ∏è–ü–æ–ª—è—Ä–Ω—ã–π —Ä–µ–π–Ω–¥–∂–µ—Ä": {
        "description": "–£–±–∏—Ç—å 30 –∞—Ä–∫—Ç–∏—á–µ—Å–∫–∏—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö",
        "reward_coins": 5000,
        "reward_exp": 3000,
        "title": "‚ùÑÔ∏è –ü–æ–ª—è—Ä–Ω—ã–π —Ä–µ–π–Ω–¥–∂–µ—Ä",
        "condition_type": "location_kills",
        "condition_value": ("–ê—Ä–∫—Ç–∏–∫–∞", 30)
    },
    "üìö–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä": {
        "description": "–£–±–∏—Ç—å 75 —Ä–∞–∑–Ω—ã—Ö –≤–∏–¥–æ–≤ –∂–∏–≤–æ—Ç–Ω—ã—Ö",
        "reward_coins": 15000,
        "reward_exp": 1500,
        "title": "üìö –ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä",
        "condition_type": "unique_animals",
        "condition_value": 75
    },
    "üî´–°–Ω–∞–π–ø–µ—Ä": {
        "description": "10 —É—Å–ø–µ—à–Ω—ã—Ö –≤—ã—Å—Ç—Ä–µ–ª–æ–≤ –ø–æ–¥—Ä—è–¥ –±–µ–∑ –ø—Ä–æ–º–∞—Ö–∞",
        "reward_coins": 5000,
        "reward_exp": 350,
        "title": "üî´ –ú–µ—Ç–∫–∏–π —Å—Ç—Ä–µ–ª–æ–∫",
        "condition_type": "streak",
        "condition_value": 10
    },
    "üí™ –ó–¥–æ—Ä–æ–≤—è–∫": {
        "description": "–ò–º–µ—Ç—å 200 –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ HP",
        "reward_coins": 2500,
        "reward_exp": 200,
        "title": "üí™ –ö–∞—á–æ–∫",
        "condition_type": "max_health",
        "condition_value": 200
    },
    "üõ°Ô∏è –ù–µ–ø—Ä–æ–±–∏–≤–∞–µ–º—ã–π": {
        "description": "–í—ã–¥–µ—Ä–∂–∞—Ç—å 10 –∫–æ–Ω—Ç—Ä–∞—Ç–∞–∫ –ø–æ–¥—Ä—è–¥ –±–µ–∑ –ª–µ—á–µ–Ω–∏—è",
        "reward_coins": 5000,
        "reward_exp": 500,
        "title": "üõ°Ô∏è –ù–µ–ø—Ä–æ–±–∏–≤–∞–µ–º—ã–π",
        "condition_type": "counterattack_streak",
        "condition_value": 10
    },
    "üèÉ –ú–∞—Å—Ç–µ—Ä –ø–æ–±–µ–≥–∞": {
        "description": "–£–±–µ–∂–∞—Ç—å –æ—Ç 5 —Ç–∏—Ç–∞–Ω–æ–≤ –ø–æ–¥—Ä—è–¥",
        "reward_coins": 20000,
        "reward_exp": 1500,
        "title": "üëª –ü—Ä–∏–∑—Ä–∞–∫",
        "condition_type": "titan_escape_streak",
        "condition_value": 5
    },
    "üíÄ –°–º–µ—Ä—Ç–Ω–∏–∫": {
        "description": "–£–º–µ—Ä–µ—Ç—å 15 —Ä–∞–∑",
        "reward_coins": 4000,
        "reward_exp": 1,
        "title": "ü™ñ –ü–∞–≤—à–∏–π –≤–æ–∏–Ω",
        "condition_type": "deaths",
        "condition_value": 15
    },
    "üéØ –õ–æ–≤–µ—Ü —É–¥–∞—á–∏": {
        "description": "–ü–æ–π–º–∞—Ç—å —Ç—è–∂—ë–ª–æ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ –≤ –ª–æ–≤—É—à–∫—É",
        "reward_coins": 4000,
        "reward_exp": 500,
        "title": "üéØ –°—á–∞—Å—Ç–ª–∏–≤—á–∏–∫",
        "condition_type": "trap_heavy",
        "condition_value": 1
    },
    "üêü –†—ã–±–∞–∫": {
        "description": "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–≤—É—à–∫–∏ 30 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥",
        "reward_coins": 8000,
        "reward_exp": 1000,
        "title": "üêü –†—ã–±–∞–∫",
        "condition_type": "trap_days_streak",
        "condition_value": 30
    },
    "üå¥ –î–∂—É–Ω–≥–ª–µ–≤–∏–∫": {
        "description": "–£–±–∏—Ç—å 50 –∂–∏–≤–æ—Ç–Ω—ã—Ö –≤ –î–∂—É–Ω–≥–ª—è—Ö",
        "reward_coins": 8000,
        "reward_exp": 2500,
        "title": "üå¥ –î–∂—É–Ω–≥–ª–µ–≤–∏–∫",
        "condition_type": "location_kills",
        "condition_value": ("–î–∂—É–Ω–≥–ª–∏", 40)
    },
    "‚ö° –ë—ã—Å—Ç—Ä–∞—è —Ä—É–∫–∞": {
        "description": "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ö–∞–Ω—Ç 750 —Ä–∞–∑",
        "reward_coins": 7500,
        "reward_exp": 2000,
        "title": "‚ö° –ú–æ–ª–Ω–∏—è",
        "condition_type": "hunt_count",
        "condition_value": 750
    },
    "üéñÔ∏è –í–µ—Ç–µ—Ä–∞–Ω": {
        "description": "–î–æ—Å—Ç–∏—á—å 500 —É—Ä–æ–≤–Ω—è",
        "reward_coins": 25000,
        "reward_exp": 10000,
        "title": "üéñÔ∏è –í–µ—Ç–µ—Ä–∞–Ω –æ—Ö–æ—Ç—ã",
        "condition_type": "level",
        "condition_value": 500
    },
    "üëë –ü–æ–≤–µ–ª–∏—Ç–µ–ª—å –æ—Ä—É–∂–∏—è": {
        "description": "–ö—É–ø–∏—Ç—å –≤—Å–µ –≤–∏–¥—ã –æ—Ä—É–∂–∏—è",
        "reward_coins": 200000,
        "reward_exp": 10000,
        "title": "üßù‚Äç‚ôÇÔ∏è –û—Ä—É–∂–µ–π–Ω—ã–π –º–∞–≥",
        "condition_type": "all_weapons",
        "condition_value": 8
    },
    "üåü –ò—Å–∫–∞—Ç–µ–ª—å –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π": {
        "description": "–ü–æ–±—ã–≤–∞—Ç—å –≤–æ –≤—Å–µ—Ö 8 –ª–æ–∫–∞—Ü–∏—è—Ö",
        "reward_coins": 15000,
        "reward_exp": 4000,
        "title": "üåü –ò—Å–∫–∞—Ç–µ–ª—å –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π",
        "condition_type": "all_locations",
        "condition_value": 8
    }
}

RANKS = {
    0: {"name": "üê£ –ù–æ–≤–∏—á–æ–∫", "bonus_exp": 0, "bonus_coins": 0},
    20: {"name": "üéØ –ù–∞—á–∏–Ω–∞—é—â–∏–π –æ—Ö–æ—Ç–Ω–∏–∫", "bonus_exp": 1, "bonus_coins": 0},
    50: {"name": "üèπ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –æ—Ö–æ—Ç–Ω–∏–∫", "bonus_exp": 3, "bonus_coins": 0},
    100: {"name": "‚öîÔ∏è –ú–∞—Å—Ç–µ—Ä –æ—Ö–æ—Ç—ã", "bonus_exp": 5, "bonus_coins": 2},
    250: {"name": "üêâ –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –æ—Ö–æ—Ç–Ω–∏–∫", "bonus_exp": 10, "bonus_coins": 5},
    500: {"name": "üëë –ö–æ—Ä–æ–ª—å –∑–≤–µ—Ä–µ–π", "bonus_exp": 15, "bonus_coins": 8},
    1000: {"name": "‚ú® –ë–æ–∂–µ—Å—Ç–≤–æ –æ—Ö–æ—Ç—ã", "bonus_exp": 20, "bonus_coins": 10},
    3000: {"name": "üî• –í–ª–∞—Å—Ç–µ–ª–∏–Ω –¥–∏–∫–æ–π –ø—Ä–∏—Ä–æ–¥—ã", "bonus_exp": 35, "bonus_coins": 15},
    5000: {"name": "üåå –ü–æ–≤–µ–ª–∏—Ç–µ–ª—å –±–µ–∑–¥–Ω—ã", "bonus_exp": 50, "bonus_coins": 25},
    10000: {"name": "ü™ê –ú–µ–∂–≥–∞–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –•–∏—â–Ω–∏–∫", "bonus_exp": 75, "bonus_coins": 50},
    50000: {"name": "‚ôæÔ∏è –í–æ–ø–ª–æ—â–µ–Ω–∏–µ –°–º–µ—Ä—Ç–∏", "bonus_exp": 150, "bonus_coins": 100},
    100000: {"name": "üëÅÔ∏è –ò—Å—Ç–∏–Ω–Ω—ã–π –ö–æ—à–º–∞—Ä –ú–∏—Ä–æ–∑–¥–∞–Ω–∏—è", "bonus_exp": 400, "bonus_coins": 250}
}

PRESTIGES = {
    1: {"name": "ü•â –ë—Ä–æ–Ω–∑–∞", "requirements": {"level": 45, "kills": 150, "coins": 50000}},
    2: {"name": "ü•à –°–µ—Ä–µ–±—Ä–æ", "requirements": {"level": 75, "kills": 250, "coins": 100000, "unique_animals": 15}},
    3: {"name": "ü•á –ó–æ–ª–æ—Ç–æ", "requirements": {"level": 100, "kills": 500, "coins": 200000, "titans": 1}},
    4: {"name": "üíé –ü–ª–∞—Ç–∏–Ω–∞", "requirements": {"level": 150, "kills": 750, "coins": 300000, "dangerous": 5}},
    5: {"name": "üîÆ –°–∞–ø—Ñ–∏—Ä", "requirements": {"level": 200, "kills": 1000, "coins": 400000, "titans": 3}},
    6: {"name": "‚ùÑÔ∏è –ö—Ä–∏—Å—Ç–∞–ª–ª", "requirements": {"level": 250, "kills": 1500, "coins": 500000, "arctic": 10}},
    7: {"name": "üåô –û–±—Å–∏–¥–∏–∞–Ω", "requirements": {"level": 300, "kills": 2000, "coins": 750000, "all_locations": True}},
    8: {"name": "‚òÄÔ∏è –ê–º–µ—Ç–∏—Å—Ç", "requirements": {"level": 350, "kills": 3000, "coins": 1000000, "titans": 15}},
    9: {"name": "‚≠ê –¢–æ–ø–∞–∑", "requirements": {"level": 400, "kills": 5000, "coins": 2000000, "all_weapons": True}},
    10: {"name": "üëë –ê–ª–º–∞–∑", "requirements": {"level": 500, "kills": 10000, "coins": 5000000, "all_titans": 5}}
}

# ================== –ë–ê–ó–ê –î–ê–ù–ù–´–• ==================
db = sqlite3.connect("hunt.db", check_same_thread=False)
sql = db.cursor()

# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü —Å –ø–æ–ª–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
sql.execute("""
CREATE TABLE IF NOT EXISTS users (
    user_id INTEGER PRIMARY KEY,
    coins INTEGER DEFAULT 0,
    exp INTEGER DEFAULT 0,
    weapon TEXT DEFAULT '–†–µ–≤–æ–ª—å–≤–µ—Ä',
    location TEXT DEFAULT '–¢–∞–π–≥–∞',
    last_hunt INTEGER DEFAULT 0,
    daily_kills INTEGER DEFAULT 0,
    total_kills INTEGER DEFAULT 0,
    username TEXT,
    current_title TEXT DEFAULT '',
    prestige INTEGER DEFAULT 0,
    achievement_streak INTEGER DEFAULT 0,
    achievements_completed TEXT DEFAULT '{}',
    health INTEGER DEFAULT 100,
    max_health INTEGER DEFAULT 100,
    deaths INTEGER DEFAULT 0,
    counterattack_streak INTEGER DEFAULT 0,
    titan_escape_streak INTEGER DEFAULT 0,
    trap_days_streak INTEGER DEFAULT 0,
    last_trap_use INTEGER DEFAULT 0,
    traps_used INTEGER DEFAULT 0,
    heavy_traps INTEGER DEFAULT 0,
    last_achievement_check INTEGER DEFAULT 0,
    golden_bullet INTEGER DEFAULT 0,
    drone_target TEXT DEFAULT '',
    drone_expires INTEGER DEFAULT 0,
    last_daily_gift INTEGER DEFAULT 0,
    survival_hunt_count INTEGER DEFAULT 0,
    survival_damage_count INTEGER DEFAULT 0,
    diamond_bullet INTEGER DEFAULT 0,
    immortality_staff INTEGER DEFAULT 0,
    energy_drink INTEGER DEFAULT 0,
    hunt_counter INTEGER DEFAULT 0
)
""")

sql.execute("""
CREATE TABLE IF NOT EXISTS trophies (
    user_id INTEGER,
    animal TEXT,
    count INTEGER DEFAULT 0,
    UNIQUE(user_id, animal),
    FOREIGN KEY (user_id) REFERENCES users(user_id)
)
""")

sql.execute("""
CREATE TABLE IF NOT EXISTS user_weapons (
    user_id INTEGER,
    weapon TEXT,
    UNIQUE(user_id, weapon),
    FOREIGN KEY (user_id) REFERENCES users(user_id)
)
""")

sql.execute("""
CREATE TABLE IF NOT EXISTS user_equipment (
    user_id INTEGER,
    equipment TEXT,
    UNIQUE(user_id, equipment),
    FOREIGN KEY (user_id) REFERENCES users(user_id)
)
""")

sql.execute("""
CREATE TABLE IF NOT EXISTS stats_daily (
    user_id INTEGER,
    date TEXT,
    kills INTEGER DEFAULT 0,
    UNIQUE(user_id, date),
    FOREIGN KEY (user_id) REFERENCES users(user_id)
)
""")

sql.execute("""
CREATE TABLE IF NOT EXISTS survival_items (
    user_id INTEGER,
    item_name TEXT,
    location TEXT,
    UNIQUE(user_id, item_name),
    FOREIGN KEY (user_id) REFERENCES users(user_id)
)
""")

# ================== –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï HP ==================
class HealthRegenerator:
    """–ö–ª–∞—Å—Å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è"""
    
    def __init__(self):
        self.is_running = False
        self.regeneration_thread = None
    
    def start_regeneration(self):
        """–ó–∞–ø—É—Å–∫ –ø–æ—Ç–æ–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è"""
        if self.is_running:
            return
        
        self.is_running = True
        self.regeneration_thread = threading.Thread(target=self._regeneration_loop, daemon=True)
        self.regeneration_thread.start()
        print("ü©∫ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ HP –∑–∞–ø—É—â–µ–Ω–æ")
    
    def stop_regeneration(self):
        """–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è"""
        self.is_running = False
        if self.regeneration_thread:
            self.regeneration_thread.join(timeout=2)
        print("ü©∫ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ HP –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ")
    
    def _regeneration_loop(self):
        """–û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è"""
        while self.is_running:
            try:
                self._regenerate_all_players()
                time.sleep(60)  # –ñ–¥–µ–º 1 –º–∏–Ω—É—Ç—É
            except Exception as e:
                print(f"‚ùå –û—à–∏–±–∫–∞ –≤ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ HP: {e}")
                time.sleep(60)
    
    def _regenerate_all_players(self):
        """–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å HP –≤—Å–µ–º –∏–≥—Ä–æ–∫–∞–º"""
        try:
            all_users = sql.execute("SELECT user_id, health, max_health FROM users").fetchall()
            
            for user in all_users:
                user_id, current_hp, max_hp = user
                
                # –ü–æ–ª—É—á–∞–µ–º –±–æ–Ω—É—Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç –≤–∏—Ç–∞–º–∏–Ω–æ–≤
                healing_rate = 1  # –±–∞–∑–æ–≤–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
                equipment = get_user_equipment(user_id)
                if "–í–∏—Ç–∞–º–∏–Ω—ã" in equipment:
                    healing_rate = 1.5  # x1.5 —Å–∫–æ—Ä–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
                
                # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º HP —Å —É—á–µ—Ç–æ–º –±–æ–Ω—É—Å–∞
                if current_hp < max_hp:
                    new_hp = current_hp + healing_rate
                    if new_hp > max_hp:
                        new_hp = max_hp
                    
                    sql.execute("UPDATE users SET health = ? WHERE user_id = ?", (new_hp, user_id))
            
            db.commit()
            
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ HP: {e}")
            db.rollback()

# –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ–ª—è –∑–¥–æ—Ä–æ–≤—å—è
health_regenerator = HealthRegenerator()

# ================== –§–£–ù–ö–¶–ò–ò ==================
def get_level(exp: int) -> int:
    return exp // EXP_PER_LEVEL

def ensure_user(user_id: int, username: str = None):
    user = sql.execute("SELECT * FROM users WHERE user_id = ?", (user_id,)).fetchone()
    if not user:
        sql.execute(
            """INSERT INTO users 
               (user_id, username, coins, exp, weapon, location, last_hunt, 
                daily_kills, total_kills, current_title, prestige, 
                achievement_streak, achievements_completed, health, max_health,
                deaths, counterattack_streak, titan_escape_streak, trap_days_streak,
                last_trap_use, traps_used, heavy_traps, last_achievement_check,
                golden_bullet, drone_target, drone_expires, last_daily_gift,
                survival_hunt_count, survival_damage_count, diamond_bullet,
                immortality_staff, energy_drink, hunt_counter) 
               VALUES (?, ?, 0, 0, '–†–µ–≤–æ–ª—å–≤–µ—Ä', '–¢–∞–π–≥–∞', 0, 0, 0, '', 0, 0, '{}', 100, 100, 0, 0, 0, 0, 0, 0, 0, 0, 0, '', 0, 0, 0, 0, 0, 0, 0, 0)""",
            (user_id, username)
        )
        sql.execute(
            "INSERT OR IGNORE INTO user_weapons VALUES (?, ?)",
            (user_id, "–†–µ–≤–æ–ª—åver")
        )
        db.commit()
        user = sql.execute("SELECT * FROM users WHERE user_id = ?", (user_id,)).fetchone()
    elif username and username != user[8]:
        sql.execute("UPDATE users SET username = ? WHERE user_id = ?", (username, user_id))
        db.commit()
    return user

def get_user_health(user_id: int):
    """–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ –∏–≥—Ä–æ–∫–∞"""
    user = ensure_user(user_id)
    return user[13], user[14]

def update_health(user_id: int, change: int):
    """–ò–∑–º–µ–Ω–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ –∏–≥—Ä–æ–∫–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º)"""
    user = ensure_user(user_id)
    current_hp = user[13]
    max_hp = user[14]
    
    new_hp = current_hp + change
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–µ—Å—Å–º–µ—Ä—Ç–∏–µ
    if change < 0 and user[30] == 1:  # immortality_staff
        sql.execute("UPDATE users SET immortality_staff = 0 WHERE user_id = ?", (user_id,))
        db.commit()
        return current_hp  # HP –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
    
    if new_hp > max_hp:
        new_hp = max_hp
    
    # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–∞: –µ—Å–ª–∏ —É—Ä–æ–Ω –ø—Ä–µ–≤—ã—à–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ HP, –∏–≥—Ä–æ–∫ –¥–æ–ª–∂–µ–Ω —É–º–µ—Ä–µ—Ç—å
    if new_hp < 0:
        new_hp = 0
    
    sql.execute("UPDATE users SET health = ? WHERE user_id = ?", (new_hp, user_id))
    
    # –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ —É–º–µ—Ä
    if new_hp <= 0:
        sql.execute("UPDATE users SET deaths = deaths + 1 WHERE user_id = ?", (user_id,))
        db.commit()
        print(f"üíÄ –ò–≥—Ä–æ–∫ {user_id} —É–º–µ—Ä. –¢–µ–∫—É—â–µ–µ –∑–¥–æ—Ä–æ–≤—å–µ: 0/{max_hp}")
    
    return new_hp

def heal_user(user_id: int, amount: int = None):
    """–ü–æ–ª–Ω–æ—Å—Ç—å—é –≤—ã–ª–µ—á–∏—Ç—å –∏–≥—Ä–æ–∫–∞ –∏–ª–∏ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ"""
    user = ensure_user(user_id)
    max_hp = user[14]
    
    if amount is None:
        sql.execute("UPDATE users SET health = ? WHERE user_id = ?", (max_hp, user_id))
    else:
        current_hp = user[13]
        new_hp = current_hp + amount
        if new_hp > max_hp:
            new_hp = max_hp
        sql.execute("UPDATE users SET health = ? WHERE user_id = ?", (new_hp, user_id))
    
    db.commit()

def can_hunt(user_id: int) -> tuple:
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –º–æ–∂–µ—Ç –ª–∏ –∏–≥—Ä–æ–∫ –æ—Ö–æ—Ç–∏—Ç—å—Å—è - –ï–°–õ–ò HP ‚â§ 25"""
    user = ensure_user(user_id)
    current_hp = user[13]
    
    # –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 1: –ù–µ–ª—å–∑—è –æ—Ö–æ—Ç–∏—Ç—å—Å—è –ø—Ä–∏ HP ‚â§ 25
    if current_hp <= 25:
        return False, "‚ùå –£ –≤–∞—Å —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ –∑–¥–æ—Ä–æ–≤—å—è (‚â§25 HP)! –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ –¥–æ 26 HP –∏–ª–∏ –±–æ–ª—å—à–µ.\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–ø—Ç–µ—á–∫—É –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞ –∏–ª–∏ –ø–æ–¥–æ–∂–¥–∏—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è."
    else:
        return True, "‚úÖ –ú–æ–∂–Ω–æ –æ—Ö–æ—Ç–∏—Ç—å—Å—è"

def get_user_equipment(user_id: int):
    equipment = sql.execute(
        "SELECT equipment FROM user_equipment WHERE user_id = ?", 
        (user_id,)
    ).fetchall()
    return [eq[0] for eq in equipment]

def get_equipment_bonuses(user_id: int):
    equipment = get_user_equipment(user_id)
    bonuses = {"–ú–µ–ª–æ—á—å": 0, "–°—Ä–µ–¥–Ω": 0, "–û–ø–∞—Å–Ω": 0, "–¢—è–∂–µ–ª": 0, "–¢–∏—Ç–∞–Ω": 0}
    
    for eq_name in equipment:
        if eq_name in EQUIPMENT:
            for group, bonus in EQUIPMENT[eq_name].get("bonus", {}).items():
                if group in bonuses:
                    bonuses[group] += bonus
    return bonuses

def get_max_health_from_equipment(user_id: int):
    """–ü–æ–ª—É—á–∏—Ç—å –±–æ–Ω—É—Å –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º—É –∑–¥–æ—Ä–æ–≤—å—é –æ—Ç —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è"""
    equipment = get_user_equipment(user_id)
    bonus_hp = 100  # –±–∞–∑–æ–≤–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ
    
    for eq_name in equipment:
        if eq_name in EQUIPMENT and "bonus" in EQUIPMENT[eq_name]:
            if "health" in EQUIPMENT[eq_name]["bonus"]:
                bonus_hp += EQUIPMENT[eq_name]["bonus"]["health"]
    
    return bonus_hp

def update_max_health(user_id: int):
    """–û–±–Ω–æ–≤–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è"""
    new_max_hp = get_max_health_from_equipment(user_id)
    sql.execute("UPDATE users SET max_health = ? WHERE user_id = ?", (new_max_hp, user_id))
    
    current_hp, _ = get_user_health(user_id)
    if current_hp > new_max_hp:
        sql.execute("UPDATE users SET health = ? WHERE user_id = ?", (new_max_hp, user_id))
    
    db.commit()
    return new_max_hp

def choose_animal(location: str, user_id: int):
    available_groups = [g for g in SEARCH_CHANCES if LOCATIONS[location]["animals"].get(g) and LOCATIONS[location]["animals"][g]]
    if not available_groups:
        return None, None
    
    bonuses = get_equipment_bonuses(user_id)
    equipment = get_user_equipment(user_id)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥—Ä–æ–Ω-–±–æ–Ω—É—Å
    user = ensure_user(user_id)
    drone_target = user[24] if len(user) > 24 else ''
    drone_expires = user[25] if len(user) > 25 else 0
    
    if drone_target and drone_expires > int(time.time()):
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ü–µ–ª–µ–≤–æ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ –≤ —ç—Ç–æ–π –ª–æ–∫–∞—Ü–∏–∏
        target_in_location = False
        target_group = None
        for group, animals in LOCATIONS[location]["animals"].items():
            if drone_target in animals:
                target_in_location = True
                target_group = group
                break
        
        if target_in_location:
            # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —à–∞–Ω—Å –Ω–∞–π—Ç–∏ —Ü–µ–ª–µ–≤–æ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ –Ω–∞ 10%
            if random.randint(1, 100) <= 10:
                return target_group, drone_target
    
    # –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∏—Å–∫–∞—Ç–µ–ª—å - –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –Ω–∞—Ö–æ–¥–∏–º –∂–∏–≤–æ—Ç–Ω–æ–µ
    if "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∏—Å–∫–∞—Ç–µ–ª—å" in equipment:
        group = random.choice(available_groups)
        animal = random.choice(LOCATIONS[location]["animals"][group])
        return group, animal
    
    # –û–±—ã—á–Ω—ã–π –ø–æ–∏—Å–∫ —Å —É—á–µ—Ç–æ–º –±–æ–Ω—É—Å–æ–≤
    weights = []
    for g in available_groups:
        base_chance = SEARCH_CHANCES[g]
        bonus = bonuses.get(g, 0)
        weights.append(base_chance + bonus)
    
    group = random.choices(available_groups, weights=weights)[0]
    
    search_chance = SEARCH_CHANCES[group] + bonuses.get(group, 0)
    if random.randint(1, 100) > search_chance:
        return None, None
    
    animal = random.choice(LOCATIONS[location]["animals"][group])
    return group, animal

def check_hit(weapon: str, group: str, user_id: int = None):
    groups = ["–ú–µ–ª–æ—á—å", "–°—Ä–µ–¥–Ω", "–û–ø–∞—Å–Ω", "–¢—è–∂–µ–ª", "–¢–∏—Ç–∞–Ω"]
    if group not in groups:
        return False
    
    idx = groups.index(group)
    
    # –ü–æ–ª—É—á–∞–µ–º –±–∞–∑–æ–≤—ã–π —à–∞–Ω—Å
    weapon_data = WEAPONS.get(weapon, WEAPONS["–†–µ–≤–æ–ª—å–≤–µ—Ä"])
    base_chance = weapon_data["chances"][idx]
    
    # –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
    final_chance = base_chance
    
    # –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 3: –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ –ë–î –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞—Ñ—Ñ–æ–≤
    if user_id:
        # –ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π –±–∞—Ñ—Ñ–æ–≤
        user_data = sql.execute("SELECT golden_bullet, diamond_bullet FROM users WHERE user_id = ?", (user_id,)).fetchone()
        
        if user_data:
            has_golden_bullet, has_diamond_bullet = user_data
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–æ–ª–æ—Ç—É—é –ø—É–ª—é
            if has_golden_bullet:
                final_chance *= 2  # x2 —à–∞–Ω—Å –ø–æ–ø–∞–¥–∞–Ω–∏—è
                # –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∑–æ–ª–æ—Ç—É—é –ø—É–ª—é —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
                sql.execute("UPDATE users SET golden_bullet = 0 WHERE user_id = ?", (user_id,))
                db.commit()
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–ª–º–∞–∑–Ω—É—é –ø—É–ª—é
            if has_diamond_bullet:
                final_chance += 20  # +20% —à–∞–Ω—Å –ø–æ–ø–∞–¥–∞–Ω–∏—è
                # –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∞–ª–º–∞–∑–Ω—É—é –ø—É–ª—é —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
                sql.execute("UPDATE users SET diamond_bullet = 0 WHERE user_id = ?", (user_id,))
                db.commit()
    
    return random.uniform(0, 100) <= final_chance

def can_use_location(user_level: int, location_name: str) -> bool:
    return user_level >= LOCATIONS[location_name]["level"]

def reset_daily_stats():
    today = datetime.now().strftime("%Y-%m-%d")
    sql.execute("UPDATE users SET daily_kills = 0")
    sql.execute("DELETE FROM stats_daily WHERE date != ?", (today,))
    db.commit()

def get_user_rank(total_kills: int):
    sorted_thresholds = sorted(RANKS.keys(), reverse=True)
    for threshold in sorted_thresholds:
        if total_kills >= threshold:
            return RANKS[threshold]
    return RANKS[0]

def get_completed_achievements(user_id: int):
    result = sql.execute("SELECT achievements_completed FROM users WHERE user_id = ?", (user_id,)).fetchone()
    if result and result[0]:
        try:
            return eval(result[0])
        except:
            return {}
    return {}

def check_prestige_requirements(user_id: int, prestige_level: int):
    if prestige_level not in PRESTIGES:
        return False, "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –ø—Ä–µ—Å—Ç–∏–∂–∞"
    
    user = ensure_user(user_id)
    requirements = PRESTIGES[prestige_level]["requirements"]
    total_kills = user[7]
    level = get_level(user[2])
    coins = user[1]
    
    if level < requirements.get("level", 0):
        return False, f"–¢—Ä–µ–±—É–µ—Ç—Å—è —É—Ä–æ–≤–µ–Ω—å {requirements.get('level', 0)}"
    if total_kills < requirements.get("kills", 0):
        return False, f"–¢—Ä–µ–±—É–µ—Ç—Å—è {requirements.get('kills', 0)} —É–±–∏–π—Å—Ç–≤"
    if coins < requirements.get("coins", 0):
        return False, f"–¢—Ä–µ–±—É–µ—Ç—Å—è {requirements.get('coins', 0)} –º–æ–Ω–µ—Ç"
    
    if "unique_animals" in requirements:
        unique_count = len(sql.execute("SELECT DISTINCT animal FROM trophies WHERE user_id = ?", (user_id,)).fetchall())
        if unique_count < requirements["unique_animals"]:
            return False, f"–¢—Ä–µ–±—É–µ—Ç—Å—è {requirements['unique_animals']} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö"
    
    if "titans" in requirements:
        titan_animals = []
        for loc in LOCATIONS.values():
            titan_animals.extend(loc["animals"].get("–¢–∏—Ç–∞–Ω", []))
        titan_kills = 0
        for animal in titan_animals:
            result = sql.execute("SELECT count FROM trophies WHERE user_id = ? AND animal = ?", (user_id, animal)).fetchone()
            if result:
                titan_kills += result[0]
        if titan_kills < requirements["titans"]:
            return False, f"–¢—Ä–µ–±—É–µ—Ç—Å—è —É–±–∏—Ç—å {requirements['titans']} —Ç–∏—Ç–∞–Ω–æ–≤"
    
    if "all_locations" in requirements and requirements["all_locations"]:
        locations_visited = set()
        for animal_data in sql.execute("SELECT animal FROM trophies WHERE user_id = ?", (user_id,)).fetchall():
            animal = animal_data[0]
            for loc_name, loc_data in LOCATIONS.items():
                for group_animals in loc_data["animals"].values():
                    if animal in group_animals:
                        locations_visited.add(loc_name)
                        break
        if len(locations_visited) < len(LOCATIONS):
            return False, "–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–±—ã–≤–∞—Ç—å –≤–æ –≤—Å–µ—Ö –ª–æ–∫–∞—Ü–∏—è—Ö"
    
    if "all_weapons" in requirements and requirements["all_weapons"]:
        user_weapons = sql.execute("SELECT COUNT(DISTINCT weapon) FROM user_weapons WHERE user_id = ?", (user_id,)).fetchone()[0]
        if user_weapons < len(WEAPONS):
            return False, "–¢—Ä–µ–±—É–µ—Ç—Å—è –∫—É–ø–∏—Ç—å –≤—Å–µ –≤–∏–¥—ã –æ—Ä—É–∂–∏—è"
    
    return True, "–í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã"

def use_traps(user_id: int):
    now = int(time.time())
    user = ensure_user(user_id)
    last_use = user[19] if len(user) > 19 else 0
    
    if last_use > 0 and (now - last_use) < 86400:
        hours_left = (86400 - (now - last_use)) // 3600
        minutes_left = ((86400 - (now - last_use)) % 3600) // 60
        return False, f"‚è≥ –õ–æ–≤—É—à–∫–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ {hours_left}—á {minutes_left}–º"
    
    animal_count = 3
    if "–£–ª—É—á—à–µ–Ω–Ω—ã–µ –ª–æ–≤—É—à–∫–∏" in get_user_equipment(user_id):
        animal_count = 5
    
    location = user[4]
    caught_animals = []
    
    for _ in range(animal_count):
        rand = random.randint(1, 100)
        if rand <= 50:
            group = "–ú–µ–ª–æ—á—å"
        elif rand <= 90:
            group = "–°—Ä–µ–¥–Ω"
        elif rand <= 98:
            group = "–û–ø–∞—Å–Ω"
        else:
            group = "–¢—è–∂–µ–ª"
        
        if group in LOCATIONS[location]["animals"] and LOCATIONS[location]["animals"][group]:
            animal = random.choice(LOCATIONS[location]["animals"][group])
            caught_animals.append((group, animal))
            
            if group == "–¢—è–∂–µ–ª":
                sql.execute("UPDATE users SET heavy_traps = heavy_traps + 1 WHERE user_id = ?", (user_id,))
    
    sql.execute("UPDATE users SET last_trap_use = ?, traps_used = traps_used + 1, trap_days_streak = trap_days_streak + 1 WHERE user_id = ?", 
                (now, user_id))
    db.commit()
    
    return True, caught_animals

def get_animal_attack_phrase(animal: str) -> str:
    """–ü–æ–ª—É—á–∏—Ç—å —Ñ—Ä–∞–∑—É –∞—Ç–∞–∫–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∂–∏–≤–æ—Ç–Ω–æ–≥–æ"""
    phrases = ANIMAL_ATTACK_PHRASES.get(animal, [])
    if phrases:
        return random.choice(phrases)
    
    # –ï—Å–ª–∏ –Ω–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π —Ñ—Ä–∞–∑—ã, —Å–æ–∑–¥–∞–µ–º –æ–±—â—É—é
    group = None
    for loc in LOCATIONS.values():
        for g, animals in loc["animals"].items():
            if animal in animals:
                group = g
                break
        if group:
            break
    
    damage = CONTRATTACK_DAMAGE.get(group, 25)
    return f"{animal} –∞—Ç–∞–∫—É–µ—Ç! -{damage}HP"

def check_achievements(user_id: int):
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –≤—ã–¥–∞—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏–≥—Ä–æ–∫—É"""
    user = ensure_user(user_id)
    completed = get_completed_achievements(user_id)
    new_achievements = []
    
    # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞
    coins = user[1]
    exp = user[2]
    total_kills = user[7]
    current_hp, max_hp = get_user_health(user_id)
    deaths = user[15] if len(user) > 15 else 0
    counterattack_streak = user[16] if len(user) > 16 else 0
    titan_escape_streak = user[17] if len(user) > 17 else 0
    trap_days_streak = user[18] if len(user) > 18 else 0
    heavy_traps = user[21] if len(user) > 21 else 0
    achievement_streak = user[11] if len(user) > 11 else 0
    level = get_level(exp)
    hunt_counter = user[32] if len(user) > 32 else 0
    
    # –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∂–∏–≤–æ—Ç–Ω—ã–µ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
    unique_animals_result = sql.execute("SELECT COUNT(DISTINCT animal) FROM trophies WHERE user_id = ?", (user_id,)).fetchone()
    unique_animals = unique_animals_result[0] if unique_animals_result else 0
    
    # –í—Å–µ –æ—Ä—É–∂–∏—è
    user_weapons_result = sql.execute("SELECT COUNT(DISTINCT weapon) FROM user_weapons WHERE user_id = ?", (user_id,)).fetchone()
    all_weapons = user_weapons_result[0] if user_weapons_result else 0
    
    # –í—Å–µ –ª–æ–∫–∞—Ü–∏–∏
    locations_visited = set()
    for animal_data in sql.execute("SELECT animal FROM trophies WHERE user_id = ?", (user_id,)).fetchall():
        animal = animal_data[0]
        for loc_name, loc_data in LOCATIONS.items():
            for group_animals in loc_data["animals"].values():
                if animal in group_animals:
                    locations_visited.add(loc_name)
                    break
    
    all_locations_count = len(locations_visited)
    
    # –£–±–∏–π—Å—Ç–≤–∞ –ø–æ –ª–æ–∫–∞—Ü–∏—è–º
    location_kills = {}
    for loc_name in LOCATIONS:
        location_kills[loc_name] = 0
    
    for animal_data, count in sql.execute("SELECT animal, count FROM trophies WHERE user_id = ?", (user_id,)).fetchall():
        animal = animal_data
        for loc_name, loc_data in LOCATIONS.items():
            for group_animals in loc_data["animals"].values():
                if animal in group_animals:
                    location_kills[loc_name] += count
                    break
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
    for achievement_name, achievement_data in ACHIEVEMENTS.items():
        if achievement_name in completed:
            continue
            
        condition_met = False
        
        if achievement_data["condition_type"] == "animal_kills":
            animal_name, required_count = achievement_data["condition_value"]
            result = sql.execute("SELECT count FROM trophies WHERE user_id = ? AND animal = ?", (user_id, animal_name)).fetchone()
            if result and result[0] >= required_count:
                condition_met = True
                
        elif achievement_data["condition_type"] == "titan_kills":
            titan_animals = []
            for loc in LOCATIONS.values():
                titan_animals.extend(loc["animals"].get("–¢–∏—Ç–∞–Ω", []))
            titan_kills = 0
            for animal in titan_animals:
                result = sql.execute("SELECT count FROM trophies WHERE user_id = ? AND animal = ?", (user_id, animal)).fetchone()
                if result:
                    titan_kills += result[0]
            if titan_kills >= achievement_data["condition_value"]:
                condition_met = True
                
        elif achievement_data["condition_type"] == "coins":
            if coins >= achievement_data["condition_value"]:
                condition_met = True
                
        elif achievement_data["condition_type"] == "location_kills":
            location_name, required_count = achievement_data["condition_value"]
            if location_kills.get(location_name, 0) >= required_count:
                condition_met = True
                
        elif achievement_data["condition_type"] == "unique_animals":
            if unique_animals >= achievement_data["condition_value"]:
                condition_met = True
                
        elif achievement_data["condition_type"] == "streak":
            if achievement_streak >= achievement_data["condition_value"]:
                condition_met = True
                
        elif achievement_data["condition_type"] == "max_health":
            if max_hp >= achievement_data["condition_value"]:
                condition_met = True
                
        elif achievement_data["condition_type"] == "counterattack_streak":
            if counterattack_streak >= achievement_data["condition_value"]:
                condition_met = True
                
        elif achievement_data["condition_type"] == "titan_escape_streak":
            if titan_escape_streak >= achievement_data["condition_value"]:
                condition_met = True
                
        elif achievement_data["condition_type"] == "deaths":
            if deaths >= achievement_data["condition_value"]:
                condition_met = True
                
        elif achievement_data["condition_type"] == "trap_heavy":
            if heavy_traps >= achievement_data["condition_value"]:
                condition_met = True
                
        elif achievement_data["condition_type"] == "trap_days_streak":
            if trap_days_streak >= achievement_data["condition_value"]:
                condition_met = True
                
        elif achievement_data["condition_type"] == "hunt_count":
            if hunt_counter >= achievement_data["condition_value"]:
                condition_met = True
                
        elif achievement_data["condition_type"] == "level":
            if level >= achievement_data["condition_value"]:
                condition_met = True
                
        elif achievement_data["condition_type"] == "all_weapons":
            if all_weapons >= achievement_data["condition_value"]:
                condition_met = True
                
        elif achievement_data["condition_type"] == "all_locations":
            if all_locations_count >= achievement_data["condition_value"]:
                condition_met = True
        
        # –ï—Å–ª–∏ —É—Å–ª–æ–≤–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ, –≤—ã–¥–∞–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ
        if condition_met:
            # –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–ø–∏—Å–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö
            completed[achievement_name] = {
                "completed_at": int(time.time()),
                "reward_coins": achievement_data["reward_coins"],
                "reward_exp": achievement_data["reward_exp"],
                "title": achievement_data["title"]
            }
            
            # –í—ã–¥–∞–µ–º –Ω–∞–≥—Ä–∞–¥—ã
            sql.execute("UPDATE users SET coins = coins + ?, exp = exp + ? WHERE user_id = ?", 
                       (achievement_data["reward_coins"], achievement_data["reward_exp"], user_id))
            
            new_achievements.append(achievement_name)
    
    # –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
    if new_achievements:
        sql.execute("UPDATE users SET achievements_completed = ? WHERE user_id = ?", 
                   (str(completed), user_id))
        sql.execute("UPDATE users SET last_achievement_check = ? WHERE user_id = ?", 
                   (int(time.time()), user_id))
        db.commit()
    
    return new_achievements

def get_daily_gift(user_id: int):
    """–ü–æ–ª—É—á–∏—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫"""
    user = ensure_user(user_id)
    last_gift = user[26] if len(user) > 26 else 0
    now = int(time.time())
    
    if last_gift > 0 and (now - last_gift) < 86400:
        hours_left = (86400 - (now - last_gift)) // 3600
        minutes_left = ((86400 - (now - last_gift)) % 3600) // 60
        return False, f"‚è≥ –°–ª–µ–¥—É—é—â–∏–π –ø–æ–¥–∞—Ä–æ–∫ —á–µ—Ä–µ–∑ {hours_left}—á {minutes_left}–º"
    
    # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é –Ω–∞–≥—Ä–∞–¥—É
    rewards = [
        ("üí∞ 100 –º–æ–Ω–µ—Ç", 100, 0),
        ("üí∞ 200 –º–æ–Ω–µ—Ç", 200, 0),
        ("üí∞ 250 –º–æ–Ω–µ—Ç", 250, 0),
        ("‚≠ê 200 –æ–ø—ã—Ç–∞", 0, 200),
        ("‚≠ê 300 –æ–ø—ã—Ç–∞", 0, 300),
        ("‚≠ê 400 –æ–ø—ã—Ç–∞", 0, 400),
    ]
    
    reward_text, coins, exp = random.choice(rewards)
    
    # –í—ã–¥–∞–µ–º –Ω–∞–≥—Ä–∞–¥—É
    sql.execute("UPDATE users SET coins = coins + ?, exp = exp + ?, last_daily_gift = ? WHERE user_id = ?",
                (coins, exp, now, user_id))
    db.commit()
    
    return True, reward_text

# ================== –§–£–ù–ö–¶–ò–ò –í–´–ñ–ò–í–ê–ù–ò–Ø ==================
def get_user_survival_items(user_id: int):
    """–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç—ã –≤—ã–∂–∏–≤–∞–Ω–∏—è –∏–≥—Ä–æ–∫–∞"""
    items = sql.execute(
        "SELECT item_name FROM survival_items WHERE user_id = ?", 
        (user_id,)
    ).fetchall()
    return [item[0] for item in items]

def has_survival_item(user_id: int, location: str):
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ —É –∏–≥—Ä–æ–∫–∞ –ø—Ä–µ–¥–º–µ—Ç –≤—ã–∂–∏–≤–∞–Ω–∏—è –¥–ª—è –ª–æ–∫–∞—Ü–∏–∏"""
    survival_items = get_user_survival_items(user_id)
    
    for item_name in survival_items:
        if item_name in SURVIVAL_ITEMS and SURVIVAL_ITEMS[item_name]["location"] == location:
            if "survival" in SURVIVAL_ITEMS[item_name] and SURVIVAL_ITEMS[item_name]["survival"]:
                return True, item_name
    
    return False, None

def check_survival_damage(user_id: int, location: str):
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –Ω–∞–Ω–µ—Å—Ç–∏ —É—Ä–æ–Ω –∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞ –≤—ã–∂–∏–≤–∞–Ω–∏—è - —Ä–æ–≤–Ω–æ –∫–∞–∂–¥—ã–µ 5 –æ—Ö–æ—Ç"""
    if location == "–¢–∞–π–≥–∞":
        return False, None  # –¢–∞–π–≥–∞ - –Ω–∞—á–∞–ª—å–Ω–∞—è –ª–æ–∫–∞—Ü–∏—è, –±–µ–∑ —É—Ä–æ–Ω–∞
    
    has_item, item_name = has_survival_item(user_id, location)
    
    if not has_item:
        # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π —Å—á–µ—Ç—á–∏–∫ –æ—Ö–æ—Ç
        user = ensure_user(user_id)
        survival_hunt_count = user[27] if len(user) > 27 else 0
        
        # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –æ—Ö–æ—Ç
        survival_hunt_count += 1
        
        # –ö–∞–∂–¥—ã–µ 5 –æ—Ö–æ—Ç - —É—Ä–æ–Ω
        if survival_hunt_count >= 3:
            # –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –¥–æ 0
            survival_hunt_count = 0
            
            # –ù–∞–Ω–æ—Å–∏–º —É—Ä–æ–Ω
            damage = 80
            new_hp = update_health(user_id, -damage)
            
            # –í—ã–±–∏—Ä–∞–µ–º —Ñ—Ä–∞–∑—É
            phrases = SURVIVAL_DAMAGE_PHRASES.get(location, ["–û–∫—Ä—É–∂–∞—é—â–∞—è —Å—Ä–µ–¥–∞ –≤—Ä–µ–¥–∏—Ç –≤–∞—à–µ–º—É –∑–¥–æ—Ä–æ–≤—å—é! -50HP"])
            phrase = random.choice(phrases)
            
            # –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏
            sql.execute("UPDATE users SET survival_hunt_count = ? WHERE user_id = ?",
                       (survival_hunt_count, user_id))
            db.commit()
            
            return True, phrase
        else:
            # –ü—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
            sql.execute("UPDATE users SET survival_hunt_count = ? WHERE user_id = ?",
                       (survival_hunt_count, user_id))
            db.commit()
            return False, None
    else:
        # –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –æ—Ö–æ—Ç –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–µ–¥–º–µ—Ç
        sql.execute("UPDATE users SET survival_hunt_count = 0 WHERE user_id = ?", (user_id,))
        db.commit()
        
        return False, None

# ================== –ë–û–¢ ==================
bot = Bot(TOKEN)
dp = Dispatcher()

# ================== –ê–î–ú–ò–ù –ö–û–ú–ê–ù–î–´ ==================
@dp.message(lambda msg: msg.text and msg.text.startswith("–¥–∏–ø—Å–∫–∏–ø"))
async def admin_skip(msg: Message):
    """–°–±—Ä–æ—Å–∏—Ç—å —Ç–∞–π–º–µ—Ä –æ—Ö–æ—Ç—ã –¥–ª—è –∏–≥—Ä–æ–∫–∞"""
    try:
        if msg.from_user.id != ADMIN_ID and msg.from_user.username != ADMIN_USERNAME:
            await msg.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã")
            return
            
        parts = msg.text.split()
        
        if len(parts) >= 2 and parts[1].lower() == "–∞–ª–ª":
            # –°–±—Ä–æ—Å –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
            sql.execute("UPDATE users SET last_hunt = 0")
            db.commit()
            await msg.answer("‚úÖ –¢–∞–π–º–µ—Ä –æ—Ö–æ—Ç—ã —Å–±—Ä–æ—à–µ–Ω –¥–ª—è –í–°–ï–• –∏–≥—Ä–æ–∫–æ–≤!")
            print(f"üîß –ê–¥–º–∏–Ω {msg.from_user.id} —Å–±—Ä–æ—Å–∏–ª —Ç–∞–π–º–µ—Ä –¥–ª—è –í–°–ï–• –∏–≥—Ä–æ–∫–æ–≤")
            
            # –£–≤–µ–¥–æ–º–ª—è–µ–º –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
            all_users = sql.execute("SELECT user_id, username FROM users WHERE username IS NOT NULL").fetchall()
            for user_id, username in all_users:
                try:
                    await bot.send_message(user_id, "üîÑ –í–∞—à —Ç–∞–π–º–µ—Ä –æ—Ö–æ—Ç—ã –±—ã–ª —Å–±—Ä–æ—à–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º!")
                except:
                    pass
                    
        elif len(parts) >= 2 and "@" in parts[1]:
            username = parts[1].replace("@", "").strip()
            user = sql.execute("SELECT user_id FROM users WHERE username = ?", (username,)).fetchone()
            if user:
                sql.execute("UPDATE users SET last_hunt = 0 WHERE user_id = ?", (user[0],))
                db.commit()
                await msg.answer(f"‚úÖ –¢–∞–π–º–µ—Ä –æ—Ö–æ—Ç—ã —Å–±—Ä–æ—à–µ–Ω –¥–ª—è @{username}")
                print(f"üîß –ê–¥–º–∏–Ω {msg.from_user.id} —Å–±—Ä–æ—Å–∏–ª —Ç–∞–π–º–µ—Ä –¥–ª—è @{username}")
                
                # –£–≤–µ–¥–æ–º–ª—è–µ–º –∏–≥—Ä–æ–∫–∞
                try:
                    await bot.send_message(user[0], "üîÑ –í–∞—à —Ç–∞–π–º–µ—Ä –æ—Ö–æ—Ç—ã –±—ã–ª —Å–±—Ä–æ—à–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º!")
                except:
                    pass
            else:
                await msg.answer(f"‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å @{username} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ")
        else:
            await msg.answer("‚ùå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –¥–∏–ø—Å–∫–∏–ø @username\n–ò–ª–∏: –¥–∏–ø—Å–∫–∏–ø –∞–ª–ª - –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤")
    except Exception as e:
        await msg.answer(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

@dp.message(lambda msg: msg.text and msg.text.startswith("–¥–∏–ø–º–æ–Ω–µ—Ç—ã"))
async def admin_coins(msg: Message):
    """–í—ã–¥–∞—Ç—å –º–æ–Ω–µ—Ç—ã –∏–≥—Ä–æ–∫—É"""
    try:
        if msg.from_user.id != ADMIN_ID and msg.from_user.username != ADMIN_USERNAME:
            await msg.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã")
            return
            
        parts = msg.text.split()
        if len(parts) >= 2:
            try:
                amount = int(parts[1])
            except ValueError:
                await msg.answer("‚ùå –û—à–∏–±–∫–∞: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–Ω–µ—Ç –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–∏—Å–ª–æ–º")
                return
                
            if len(parts) >= 3 and parts[2].lower() == "–∞–ª–ª":
                # –í—ã–¥–∞—Ç—å –≤—Å–µ–º –∏–≥—Ä–æ–∫–∞–º
                sql.execute("UPDATE users SET coins = coins + ?", (amount,))
                db.commit()
                await msg.answer(f"‚úÖ –í—ã–¥–∞–Ω–æ {amount} –º–æ–Ω–µ—Ç –í–°–ï–ú –∏–≥—Ä–æ–∫–∞–º!")
                print(f"üîß –ê–¥–º–∏–Ω {msg.from_user.id} –≤—ã–¥–∞–ª {amount} –º–æ–Ω–µ—Ç –í–°–ï–ú –∏–≥—Ä–æ–∫–∞–º")
                
                # –£–≤–µ–¥–æ–º–ª—è–µ–º –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
                all_users = sql.execute("SELECT user_id, username FROM users WHERE username IS NOT NULL").fetchall()
                for user_id, username in all_users:
                    try:
                        await bot.send_message(user_id, f"üí∞ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤—ã–¥–∞–ª –≤–∞–º {amount} –º–æ–Ω–µ—Ç!")
                    except:
                        pass
                        
            elif len(parts) >= 3 and "@" in parts[2]:
                username = parts[2].replace("@", "").strip()
                user = sql.execute("SELECT user_id FROM users WHERE username = ?", (username,)).fetchone()
                if user:
                    sql.execute("UPDATE users SET coins = coins + ? WHERE user_id = ?", (amount, user[0]))
                    db.commit()
                    await msg.answer(f"‚úÖ –í—ã–¥–∞–Ω–æ {amount} –º–æ–Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é @{username}")
                    print(f"üîß –ê–¥–º–∏–Ω {msg.from_user.id} –≤—ã–¥–∞–ª {amount} –º–æ–Ω–µ—Ç @{username}")
                    
                    # –£–≤–µ–¥–æ–º–ª—è–µ–º –∏–≥—Ä–æ–∫–∞
                    try:
                        await bot.send_message(user[0], f"üí∞ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤—ã–¥–∞–ª –≤–∞–º {amount} –º–æ–Ω–µ—Ç!")
                    except:
                        pass
                else:
                    await msg.answer(f"‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å @{username} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ")
            else:
                await msg.answer("‚ùå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –¥–∏–ø–º–æ–Ω–µ—Ç—ã <—Å—É–º–º–∞> @username\n–ò–ª–∏: –¥–∏–ø–º–æ–Ω–µ—Ç—ã <—Å—É–º–º–∞> –∞–ª–ª - –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤")
        else:
            await msg.answer("‚ùå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –¥–∏–ø–º–æ–Ω–µ—Ç—ã <—Å—É–º–º–∞> @username\n–ü—Ä–∏–º–µ—Ä: –¥–∏–ø–º–æ–Ω–µ—Ç—ã 500 @player123")
    except Exception as e:
        await msg.answer(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

@dp.message(lambda msg: msg.text and msg.text.startswith("–¥–∏–ø–æ–ø—ã—Ç"))
async def admin_exp(msg: Message):
    """–í—ã–¥–∞—Ç—å –æ–ø—ã—Ç –∏–≥—Ä–æ–∫—É"""
    try:
        if msg.from_user.id != ADMIN_ID and msg.from_user.username != ADMIN_USERNAME:
            await msg.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã")
            return
            
        parts = msg.text.split()
        if len(parts) >= 2:
            try:
                amount = int(parts[1])
            except ValueError:
                await msg.answer("‚ùå –û—à–∏–±–∫–∞: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø—ã—Ç–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–∏—Å–ª–æ–º")
                return
                
            if len(parts) >= 3 and parts[2].lower() == "–∞–ª–ª":
                # –í—ã–¥–∞—Ç—å –≤—Å–µ–º –∏–≥—Ä–æ–∫–∞–º
                sql.execute("UPDATE users SET exp = exp + ?", (amount,))
                db.commit()
                await msg.answer(f"‚úÖ –í—ã–¥–∞–Ω–æ {amount} –æ–ø—ã—Ç–∞ –í–°–ï–ú –∏–≥—Ä–æ–∫–∞–º!")
                print(f"üîß –ê–¥–º–∏–Ω {msg.from_user.id} –≤—ã–¥–∞–ª {amount} –æ–ø—ã—Ç–∞ –í–°–ï–ú –∏–≥—Ä–æ–∫–∞–º")
                
                # –£–≤–µ–¥–æ–º–ª—è–µ–º –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
                all_users = sql.execute("SELECT user_id, username FROM users WHERE username IS NOT NULL").fetchall()
                for user_id, username in all_users:
                    try:
                        await bot.send_message(user_id, f"‚≠ê –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤—ã–¥–∞–ª –≤–∞–º {amount} –æ–ø—ã—Ç–∞!")
                    except:
                        pass
                        
            elif len(parts) >= 3 and "@" in parts[2]:
                username = parts[2].replace("@", "").strip()
                user = sql.execute("SELECT user_id FROM users WHERE username = ?", (username,)).fetchone()
                if user:
                    sql.execute("UPDATE users SET exp = exp + ? WHERE user_id = ?", (amount, user[0]))
                    db.commit()
                    await msg.answer(f"‚úÖ –í—ã–¥–∞–Ω–æ {amount} –æ–ø—ã—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é @{username}")
                    print(f"üîß –ê–¥–º–∏–Ω {msg.from_user.id} –≤—ã–¥–∞–ª {amount} –æ–ø—ã—Ç–∞ @{username}")
                    
                    # –£–≤–µ–¥–æ–º–ª—è–µ–º –∏–≥—Ä–æ–∫–∞
                    try:
                        await bot.send_message(user[0], f"‚≠ê –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤—ã–¥–∞–ª –≤–∞–º {amount} –æ–ø—ã—Ç–∞!")
                    except:
                        pass
                else:
                    await msg.answer(f"‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å @{username} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ")
            else:
                await msg.answer("‚ùå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –¥–∏–ø–æ–ø—ã—Ç <—Å—É–º–º–∞> @username\n–ò–ª–∏: –¥–∏–ø–æ–ø—ã—Ç <—Å—É–º–º–∞> –∞–ª–ª - –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤")
        else:
            await msg.answer("‚ùå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –¥–∏–ø–æ–ø—ã—Ç <—Å—É–º–º–∞> @username\n–ü—Ä–∏–º–µ—Ä: –¥–∏–ø–æ–ø—ã—Ç 1000 @player123")
    except Exception as e:
        await msg.answer(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

@dp.message(lambda msg: msg.text and msg.text.startswith("–¥–∏–ø—É—Ä–æ–≤–Ω–∏"))
async def admin_level(msg: Message):
    """–í—ã–¥–∞—Ç—å —É—Ä–æ–≤–Ω–∏ –∏–≥—Ä–æ–∫—É"""
    try:
        if msg.from_user.id != ADMIN_ID and msg.from_user.username != ADMIN_USERNAME:
            await msg.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã")
            return
            
        parts = msg.text.split()
        if len(parts) >= 2:
            try:
                levels = int(parts[1])
            except ValueError:
                await msg.answer("‚ùå –û—à–∏–±–∫–∞: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Ä–æ–≤–Ω–µ–π –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–∏—Å–ª–æ–º")
                return
                
            exp_needed = levels * EXP_PER_LEVEL
            
            if len(parts) >= 3 and parts[2].lower() == "–∞–ª–ª":
                # –í—ã–¥–∞—Ç—å –≤—Å–µ–º –∏–≥—Ä–æ–∫–∞–º
                sql.execute("UPDATE users SET exp = exp + ?", (exp_needed,))
                db.commit()
                await msg.answer(f"‚úÖ –í—ã–¥–∞–Ω–æ {levels} —É—Ä–æ–≤–Ω–µ–π ({exp_needed} –æ–ø—ã—Ç–∞) –í–°–ï–ú –∏–≥—Ä–æ–∫–∞–º!")
                print(f"üîß –ê–¥–º–∏–Ω {msg.from_user.id} –≤—ã–¥–∞–ª {levels} —É—Ä–æ–≤–Ω–µ–π –í–°–ï–ú –∏–≥—Ä–æ–∫–∞–º")
                
                # –£–≤–µ–¥–æ–º–ª—è–µ–º –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
                all_users = sql.execute("SELECT user_id, username FROM users WHERE username IS NOT NULL").fetchall()
                for user_id, username in all_users:
                    try:
                        await bot.send_message(user_id, f"üìà –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤—ã–¥–∞–ª –≤–∞–º {levels} —É—Ä–æ–≤–Ω–µ–π!")
                    except:
                        pass
                        
            elif len(parts) >= 3 and "@" in parts[2]:
                username = parts[2].replace("@", "").strip()
                user = sql.execute("SELECT user_id FROM users WHERE username = ?", (username,)).fetchone()
                if user:
                    sql.execute("UPDATE users SET exp = exp + ? WHERE user_id = ?", (exp_needed, user[0]))
                    db.commit()
                    await msg.answer(f"‚úÖ –í—ã–¥–∞–Ω–æ {levels} —É—Ä–æ–≤–Ω–µ–π ({exp_needed} –æ–ø—ã—Ç–∞) –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é @{username}")
                    print(f"üîß –ê–¥–º–∏–Ω {msg.from_user.id} –≤—ã–¥–∞–ª {levels} —É—Ä–æ–≤–Ω–∏ @{username}")
                    
                    # –£–≤–µ–¥–æ–º–ª—è–µ–º –∏–≥—Ä–æ–∫–∞
                    try:
                        await bot.send_message(user[0], f"üìà –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤—ã–¥–∞–ª –≤–∞–º {levels} —É—Ä–æ–≤–Ω–µ–π!")
                    except:
                        pass
                else:
                    await msg.answer(f"‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å @{username} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ")
            else:
                await msg.answer("‚ùå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –¥–∏–ø—É—Ä–æ–≤–Ω–∏ <—É—Ä–æ–≤–Ω–∏> @username\n–ò–ª–∏: –¥–∏–ø—É—Ä–æ–≤–Ω–∏ <—É—Ä–æ–≤–Ω–∏> –∞–ª–ª - –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤")
        else:
            await msg.answer("‚ùå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –¥–∏–ø—É—Ä–æ–≤–Ω–∏ <—É—Ä–æ–≤–Ω–∏> @username\n–ü—Ä–∏–º–µ—Ä: –¥–∏–ø—É—Ä–æ–≤–Ω–∏ 3 @player123")
    except Exception as e:
        await msg.answer(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

@dp.message(lambda msg: msg.text and msg.text.startswith("–¥–∏–ø–∑–¥"))
async def admin_hp(msg: Message):
    """–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ –∏–≥—Ä–æ–∫—É"""
    try:
        if msg.from_user.id != ADMIN_ID and msg.from_user.username != ADMIN_USERNAME:
            await msg.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã")
            return
            
        parts = msg.text.split()
        if len(parts) >= 2:
            try:
                hp_amount = int(parts[1])
            except ValueError:
                await msg.answer("‚ùå –û—à–∏–±–∫–∞: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ HP –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–∏—Å–ª–æ–º")
                return
                
            if len(parts) >= 3 and parts[2].lower() == "–∞–ª–ª":
                # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ–º –∏–≥—Ä–æ–∫–∞–º
                all_users = sql.execute("SELECT user_id, max_health FROM users").fetchall()
                for user_id, max_hp in all_users:
                    if hp_amount > max_hp:
                        sql.execute("UPDATE users SET health = ? WHERE user_id = ?", (max_hp, user_id))
                    else:
                        sql.execute("UPDATE users SET health = ? WHERE user_id = ?", (hp_amount, user_id))
                db.commit()
                await msg.answer(f"‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ {hp_amount} HP –¥–ª—è –í–°–ï–• –∏–≥—Ä–æ–∫–æ–≤!")
                print(f"üîß –ê–¥–º–∏–Ω {msg.from_user.id} —É—Å—Ç–∞–Ω–æ–≤–∏–ª {hp_amount} HP –¥–ª—è –í–°–ï–• –∏–≥—Ä–æ–∫–æ–≤")
                
                # –£–≤–µ–¥–æ–º–ª—è–µ–º –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
                all_users = sql.execute("SELECT user_id, username FROM users WHERE username IS NOT NULL").fetchall()
                for user_id, username in all_users:
                    try:
                        await bot.send_message(user_id, f"‚ù§Ô∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —É—Å—Ç–∞–Ω–æ–≤–∏–ª –≤–∞–º {hp_amount} HP!")
                    except:
                        pass
                        
            elif len(parts) >= 3 and "@" in parts[2]:
                username = parts[2].replace("@", "").strip()
                user = sql.execute("SELECT user_id FROM users WHERE username = ?", (username,)).fetchone()
                if user:
                    max_hp_result = sql.execute("SELECT max_health FROM users WHERE user_id = ?", (user[0],)).fetchone()
                    max_hp = max_hp_result[0] if max_hp_result else 100
                    
                    if hp_amount > max_hp:
                        hp_amount = max_hp
                    
                    sql.execute("UPDATE users SET health = ? WHERE user_id = ?", (hp_amount, user[0]))
                    db.commit()
                    await msg.answer(f"‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ {hp_amount} HP –¥–ª—è @{username}")
                    print(f"üîß –ê–¥–º–∏–Ω {msg.from_user.id} —É—Å—Ç–∞–Ω–æ–≤–∏–ª {hp_amount} HP –¥–ª—è @{username}")
                    
                    # –£–≤–µ–¥–æ–º–ª—è–µ–º –∏–≥—Ä–æ–∫–∞
                    try:
                        await bot.send_message(user[0], f"‚ù§Ô∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —É—Å—Ç–∞–Ω–æ–≤–∏–ª –≤–∞–º {hp_amount} HP!")
                    except:
                        pass
                else:
                    await msg.answer(f"‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å @{username} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ")
            else:
                await msg.answer("‚ùå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –¥–∏–ø–∑–¥ <HP> @username\n–ò–ª–∏: –¥–∏–ø–∑–¥ <HP> –∞–ª–ª - –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤")
        else:
            await msg.answer("‚ùå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –¥–∏–ø–∑–¥ <HP> @username\n–ü—Ä–∏–º–µ—Ä: –¥–∏–ø–∑–¥ 1000 @player123")
    except Exception as e:
        await msg.answer(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

@dp.message(lambda msg: msg.text and msg.text.startswith("–¥–∏–ø–Ω–æ–ª—å"))
async def admin_reset(msg: Message):
    """–ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å –ø—Ä–æ—Ñ–∏–ª—è –∏–≥—Ä–æ–∫–∞"""
    try:
        if msg.from_user.id != ADMIN_ID and msg.from_user.username != ADMIN_USERNAME:
            await msg.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã")
            return
            
        parts = msg.text.split()
        if len(parts) >= 2:
            if parts[1].lower() == "–∞–ª–ª":
                # –°–±—Ä–æ—Å –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤ (–û–ü–ê–°–ù–û!)
                confirm_kb = InlineKeyboardMarkup(inline_keyboard=[
                    [InlineKeyboardButton(text="‚úÖ –î–∞, —Å–±—Ä–æ—Å–∏—Ç—å –í–°–ï–•", callback_data="confirm_reset_all")],
                    [InlineKeyboardButton(text="‚ùå –û—Ç–º–µ–Ω–∞", callback_data="cancel_reset")]
                ])
                await msg.answer("‚ö†Ô∏è –í–´ –£–í–ï–†–ï–ù–´, –ß–¢–û –•–û–¢–ò–¢–ï –°–ë–†–û–°–ò–¢–¨ –í–°–ï–• –ò–ì–†–û–ö–û–í?\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –ù–ï–û–ë–†–ê–¢–ò–ú–û!", reply_markup=confirm_kb)
                
            elif "@" in parts[1]:
                username = parts[1].replace("@", "").strip()
                user = sql.execute("SELECT user_id FROM users WHERE username = ?", (username,)).fetchone()
                if user:
                    confirm_kb = InlineKeyboardMarkup(inline_keyboard=[
                        [InlineKeyboardButton(text="‚úÖ –î–∞, —Å–±—Ä–æ—Å–∏—Ç—å", callback_data=f"confirm_reset:{user[0]}")],
                        [InlineKeyboardButton(text="‚ùå –û—Ç–º–µ–Ω–∞", callback_data="cancel_reset")]
                    ])
                    await msg.answer(f"‚ö†Ô∏è –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å @{username}?\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –ù–ï–û–ë–†–ê–¢–ò–ú–û!", reply_markup=confirm_kb)
                else:
                    await msg.answer(f"‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å @{username} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ")
            else:
                await msg.answer("‚ùå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –¥–∏–ø–Ω–æ–ª—å @username\n–ò–ª–∏: –¥–∏–ø–Ω–æ–ª—å –∞–ª–ª - –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤ (–û–ü–ê–°–ù–û!)")
        else:
            await msg.answer("‚ùå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –¥–∏–ø–Ω–æ–ª—å @username\n–ü—Ä–∏–º–µ—Ä: –¥–∏–ø–Ω–æ–ª—å @player123")
    except Exception as e:
        await msg.answer(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

@dp.callback_query(lambda c: c.data == "confirm_reset_all")
async def confirm_reset_all(call: CallbackQuery):
    if call.from_user.id != ADMIN_ID and call.from_user.username != ADMIN_USERNAME:
        await call.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤", show_alert=True)
        return
    
    try:
        # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        all_users = sql.execute("SELECT user_id, username FROM users WHERE username IS NOT NULL").fetchall()
        
        # –°–±—Ä–æ—Å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        sql.execute("""
            UPDATE users SET 
            coins = 0, exp = 0, weapon = '–†–µ–≤–æ–ª—å–≤–µ—Ä', location = '–¢–∞–π–≥–∞',
            last_hunt = 0, daily_kills = 0, total_kills = 0, current_title = '',
            prestige = 0, achievement_streak = 0, achievements_completed = '{}',
            health = 100, max_health = 100, deaths = 0, counterattack_streak = 0,
            titan_escape_streak = 0, trap_days_streak = 0, last_trap_use = 0,
            traps_used = 0, heavy_traps = 0, last_achievement_check = 0,
            golden_bullet = 0, drone_target = '', drone_expires = 0, last_daily_gift = 0,
            survival_hunt_count = 0, survival_damage_count = 0, diamond_bullet = 0,
            immortality_staff = 0, energy_drink = 0, hunt_counter = 0
        """)
        
        sql.execute("DELETE FROM trophies")
        sql.execute("DELETE FROM user_equipment")
        sql.execute("DELETE FROM user_weapons WHERE weapon != '–†–µ–≤–æ–ª—å–≤–µ—Ä'")
        sql.execute("DELETE FROM stats_daily")
        sql.execute("DELETE FROM survival_items")
        
        db.commit()
        
        await call.message.edit_text("‚úÖ –ü—Ä–æ—Ñ–∏–ª–∏ –í–°–ï–• –∏–≥—Ä–æ–∫–æ–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–±—Ä–æ—à–µ–Ω—ã!")
        print(f"üîß –ê–¥–º–∏–Ω {call.from_user.id} —Å–±—Ä–æ—Å–∏–ª –ø—Ä–æ—Ñ–∏–ª–∏ –í–°–ï–• –∏–≥—Ä–æ–∫–æ–≤")
        
        # –£–≤–µ–¥–æ–º–ª—è–µ–º –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
        for user_id, username in all_users:
            try:
                await bot.send_message(user_id, "‚ö†Ô∏è –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å –±—ã–ª —Å–±—Ä–æ—à–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º!")
            except:
                pass
                
    except Exception as e:
        await call.message.edit_text(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

@dp.callback_query(lambda c: c.data.startswith("confirm_reset:"))
async def confirm_reset_user(call: CallbackQuery):
    if call.from_user.id != ADMIN_ID and call.from_user.username != ADMIN_USERNAME:
        await call.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤", show_alert=True)
        return
    
    try:
        user_id = int(call.data.split(":")[1])
        
        user = sql.execute("SELECT username FROM users WHERE user_id = ?", (user_id,)).fetchone()
        if not user:
            await call.message.edit_text("‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω")
            return
        
        username = user[0]
        
        # –°–±—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        sql.execute("""
            UPDATE users SET 
            coins = 0, exp = 0, weapon = '–†–µ–≤–æ–ª—å–≤–µ—Ä', location = '–¢–∞–π–≥–∞',
            last_hunt = 0, daily_kills = 0, total_kills = 0, current_title = '',
            prestige = 0, achievement_streak = 0, achievements_completed = '{}',
            health = 100, max_health = 100, deaths = 0, counterattack_streak = 0,
            titan_escape_streak = 0, trap_days_streak = 0, last_trap_use = 0,
            traps_used = 0, heavy_traps = 0, last_achievement_check = 0,
            golden_bullet = 0, drone_target = '', drone_expires = 0, last_daily_gift = 0,
            survival_hunt_count = 0, survival_damage_count = 0, diamond_bullet = 0,
            immortality_staff = 0, energy_drink = 0, hunt_counter = 0
            WHERE user_id = ?
        """, (user_id,))
        
        sql.execute("DELETE FROM trophies WHERE user_id = ?", (user_id,))
        sql.execute("DELETE FROM user_equipment WHERE user_id = ?", (user_id,))
        sql.execute("DELETE FROM user_weapons WHERE user_id = ? AND weapon != '–†–µ–≤–æ–ª—å–≤–µ—Ä'", (user_id,))
        sql.execute("DELETE FROM stats_daily WHERE user_id = ?", (user_id,))
        sql.execute("DELETE FROM survival_items WHERE user_id = ?", (user_id,))
        
        db.commit()
        
        await call.message.edit_text(f"‚úÖ –ü—Ä–æ—Ñ–∏–ª—å @{username} –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–±—Ä–æ—à–µ–Ω!")
        print(f"üîß –ê–¥–º–∏–Ω {call.from_user.id} —Å–±—Ä–æ—Å–∏–ª –ø—Ä–æ—Ñ–∏–ª—å @{username}")
        
        # –£–≤–µ–¥–æ–º–ª—è–µ–º –∏–≥—Ä–æ–∫–∞
        try:
            await bot.send_message(user_id, "‚ö†Ô∏è –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å –±—ã–ª —Å–±—Ä–æ—à–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º!")
        except:
            pass
            
    except Exception as e:
        await call.message.edit_text(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

@dp.callback_query(lambda c: c.data == "cancel_reset")
async def cancel_reset(call: CallbackQuery):
    if call.from_user.id != ADMIN_ID and call.from_user.username != ADMIN_USERNAME:
        await call.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤", show_alert=True)
        return
    
    await call.message.edit_text("‚ùå –°–±—Ä–æ—Å –æ—Ç–º–µ–Ω–µ–Ω")

@dp.message(lambda msg: msg.text and msg.text.startswith("–¥–∏–ø–ª"))
async def admin_reset_traps(msg: Message):
    """–°–±—Ä–æ—Å–∏—Ç—å –ª–æ–≤—É—à–∫–∏ –¥–ª—è –∏–≥—Ä–æ–∫–∞"""
    try:
        if msg.from_user.id != ADMIN_ID and msg.from_user.username != ADMIN_USERNAME:
            await msg.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã")
            return
            
        parts = msg.text.split()
        
        if len(parts) >= 2 and parts[1].lower() == "–∞–ª–ª":
            # –°–±—Ä–æ—Å –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
            sql.execute("UPDATE users SET last_trap_use = 0")
            db.commit()
            await msg.answer("‚úÖ –õ–æ–≤—É—à–∫–∏ —Å–±—Ä–æ—à–µ–Ω—ã –¥–ª—è –í–°–ï–• –∏–≥—Ä–æ–∫–æ–≤!")
            print(f"üîß –ê–¥–º–∏–Ω {msg.from_user.id} —Å–±—Ä–æ—Å–∏–ª –ª–æ–≤—É—à–∫–∏ –¥–ª—è –í–°–ï–• –∏–≥—Ä–æ–∫–æ–≤")
            
            # –£–≤–µ–¥–æ–º–ª—è–µ–º –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
            all_users = sql.execute("SELECT user_id, username FROM users WHERE username IS NOT NULL").fetchall()
            for user_id, username in all_users:
                try:
                    await bot.send_message(user_id, "ü™§ –í–∞—à–∏ –ª–æ–≤—É—à–∫–∏ –±—ã–ª–∏ —Å–±—Ä–æ—à–µ–Ω—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º!")
                except:
                    pass
                    
        elif len(parts) >= 2 and "@" in parts[1]:
            username = parts[1].replace("@", "").strip()
            user = sql.execute("SELECT user_id FROM users WHERE username = ?", (username,)).fetchone()
            if user:
                sql.execute("UPDATE users SET last_trap_use = 0 WHERE user_id = ?", (user[0],))
                db.commit()
                await msg.answer(f"‚úÖ –õ–æ–≤—É—à–∫–∏ —Å–±—Ä–æ—à–µ–Ω—ã –¥–ª—è @{username}")
                print(f"üîß –ê–¥–º–∏–Ω {msg.from_user.id} —Å–±—Ä–æ—Å–∏–ª –ª–æ–≤—É—à–∫–∏ –¥–ª—è @{username}")
                
                # –£–≤–µ–¥–æ–º–ª—è–µ–º –∏–≥—Ä–æ–∫–∞
                try:
                    await bot.send_message(user[0], "ü™§ –í–∞—à–∏ –ª–æ–≤—É—à–∫–∏ –±—ã–ª–∏ —Å–±—Ä–æ—à–µ–Ω—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º!")
                except:
                    pass
            else:
                await msg.answer(f"‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å @{username} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ")
        else:
            await msg.answer("‚ùå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –¥–∏–ø–ª @username\n–ò–ª–∏: –¥–∏–ø–ª –∞–ª–ª - –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤")
    except Exception as e:
        await msg.answer(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

@dp.message(lambda msg: msg.text and msg.text.startswith("–¥–∏–ø–ø–æ–¥"))
async def admin_reset_gift(msg: Message):
    """–°–±—Ä–æ—Å–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫ –¥–ª—è –∏–≥—Ä–æ–∫–∞"""
    try:
        if msg.from_user.id != ADMIN_ID and msg.from_user.username != ADMIN_USERNAME:
            await msg.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã")
            return
            
        parts = msg.text.split()
        
        if len(parts) >= 2 and parts[1].lower() == "–∞–ª–ª":
            # –°–±—Ä–æ—Å –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
            sql.execute("UPDATE users SET last_daily_gift = 0")
            db.commit()
            await msg.answer("‚úÖ –ü–æ–¥–∞—Ä–∫–∏ —Å–±—Ä–æ—à–µ–Ω—ã –¥–ª—è –í–°–ï–• –∏–≥—Ä–æ–∫–æ–≤!")
            print(f"üîß –ê–¥–º–∏–Ω {msg.from_user.id} —Å–±—Ä–æ—Å–∏–ª –ø–æ–¥–∞—Ä–∫–∏ –¥–ª—è –í–°–ï–• –∏–≥—Ä–æ–∫–æ–≤")
            
            # –£–≤–µ–¥–æ–º–ª—è–µ–º –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
            all_users = sql.execute("SELECT user_id, username FROM users WHERE username IS NOT NULL").fetchall()
            for user_id, username in all_users:
                try:
                    await bot.send_message(user_id, "üéÅ –í–∞—à –ø–æ–¥–∞—Ä–æ–∫ –±—ã–ª —Å–±—Ä–æ—à–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º!")
                except:
                    pass
                    
        elif len(parts) >= 2 and "@" in parts[1]:
            username = parts[1].replace("@", "").strip()
            user = sql.execute("SELECT user_id FROM users WHERE username = ?", (username,)).fetchone()
            if user:
                sql.execute("UPDATE users SET last_daily_gift = 0 WHERE user_id = ?", (user[0],))
                db.commit()
                await msg.answer(f"‚úÖ –ü–æ–¥–∞—Ä–æ–∫ —Å–±—Ä–æ—à–µ–Ω –¥–ª—è @{username}")
                print(f"üîß –ê–¥–º–∏–Ω {msg.from_user.id} —Å–±—Ä–æ—Å–∏–ª –ø–æ–¥–∞—Ä–æ–∫ –¥–ª—è @{username}")
                
                # –£–≤–µ–¥–æ–º–ª—è–µ–º –∏–≥—Ä–æ–∫–∞
                try:
                    await bot.send_message(user[0], "üéÅ –í–∞—à –ø–æ–¥–∞—Ä–æ–∫ –±—ã–ª —Å–±—Ä–æ—à–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º!")
                except:
                    pass
            else:
                await msg.answer(f"‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å @{username} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ")
        else:
            await msg.answer("‚ùå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –¥–∏–ø–ø–æ–¥ @username\n–ò–ª–∏: –¥–∏–ø–ø–æ–¥ –∞–ª–ª - –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤")
    except Exception as e:
        await msg.answer(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

@dp.message(lambda msg: msg.text and msg.text.startswith("–¥–∏–ø–∫–∏–ª"))
async def admin_add_kills(msg: Message):
    """–î–æ–±–∞–≤–∏—Ç—å —É–±–∏–π—Å—Ç–≤–∞ –∏–≥—Ä–æ–∫—É"""
    try:
        if msg.from_user.id != ADMIN_ID and msg.from_user.username != ADMIN_USERNAME:
            await msg.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã")
            return
            
        parts = msg.text.split()
        if len(parts) >= 2:
            try:
                amount = int(parts[1])
            except ValueError:
                await msg.answer("‚ùå –û—à–∏–±–∫–∞: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–±–∏–π—Å—Ç–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–∏—Å–ª–æ–º")
                return
                
            if len(parts) >= 3 and parts[2].lower() == "–∞–ª–ª":
                # –î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ–º –∏–≥—Ä–æ–∫–∞–º
                sql.execute("UPDATE users SET total_kills = total_kills + ?", (amount,))
                sql.execute("UPDATE users SET daily_kills = daily_kills + ?", (amount,))
                db.commit()
                await msg.answer(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ {amount} —É–±–∏–π—Å—Ç–≤ –í–°–ï–ú –∏–≥—Ä–æ–∫–∞–º!")
                print(f"üîß –ê–¥–º–∏–Ω {msg.from_user.id} –¥–æ–±–∞–≤–∏–ª {amount} —É–±–∏–π—Å—Ç–≤ –í–°–ï–ú –∏–≥—Ä–æ–∫–∞–º")
                
                # –£–≤–µ–¥–æ–º–ª—è–µ–º –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
                all_users = sql.execute("SELECT user_id, username FROM users WHERE username IS NOT NULL").fetchall()
                for user_id, username in all_users:
                    try:
                        await bot.send_message(user_id, f"üéØ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –¥–æ–±–∞–≤–∏–ª –≤–∞–º {amount} —É–±–∏–π—Å—Ç–≤!")
                    except:
                        pass
                        
            elif len(parts) >= 3 and "@" in parts[2]:
                username = parts[2].replace("@", "").strip()
                user = sql.execute("SELECT user_id FROM users WHERE username = ?", (username,)).fetchone()
                if user:
                    sql.execute("UPDATE users SET total_kills = total_kills + ?, daily_kills = daily_kills + ? WHERE user_id = ?", 
                               (amount, amount, user[0]))
                    db.commit()
                    await msg.answer(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ {amount} —É–±–∏–π—Å—Ç–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é @{username}")
                    print(f"üîß –ê–¥–º–∏–Ω {msg.from_user.id} –¥–æ–±–∞–≤–∏–ª {amount} —É–±–∏–π—Å—Ç–≤ @{username}")
                    
                    # –£–≤–µ–¥–æ–º–ª—è–µ–º –∏–≥—Ä–æ–∫–∞
                    try:
                        await bot.send_message(user[0], f"üéØ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –¥–æ–±–∞–≤–∏–ª –≤–∞–º {amount} —É–±–∏–π—Å—Ç–≤!")
                    except:
                        pass
                else:
                    await msg.answer(f"‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å @{username} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ")
            else:
                await msg.answer("‚ùå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –¥–∏–ø–∫–∏–ª <–∫–æ–ª-–≤–æ> @username\n–ò–ª–∏: –¥–∏–ø–∫–∏–ª <–∫–æ–ª-–≤–æ> –∞–ª–ª - –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤")
        else:
            await msg.answer("‚ùå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –¥–∏–ø–∫–∏–ª <–∫–æ–ª-–≤–æ> @username\n–ü—Ä–∏–º–µ—Ä: –¥–∏–ø–∫–∏–ª 10 @player123")
    except Exception as e:
        await msg.answer(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

@dp.message(lambda msg: msg.text and msg.text.startswith("–¥–∏–ø–∂–∏–≤"))
async def admin_add_animal(msg: Message):
    """–î–æ–±–∞–≤–∏—Ç—å –∂–∏–≤–æ—Ç–Ω–æ–µ –∏–≥—Ä–æ–∫—É"""
    try:
        if msg.from_user.id != ADMIN_ID and msg.from_user.username != ADMIN_USERNAME:
            await msg.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã")
            return
            
        parts = msg.text.split()
        if len(parts) >= 3:
            animal = parts[1].strip('"\'')
            
            try:
                count = 1
                if len(parts) >= 4:
                    count = int(parts[2])
                    username_part = parts[3]
                else:
                    username_part = parts[2]
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∂–∏–≤–æ—Ç–Ω–æ–≥–æ
                animal_exists = False
                for location in LOCATIONS.values():
                    for animal_list in location["animals"].values():
                        if animal in animal_list:
                            animal_exists = True
                            break
                    if animal_exists:
                        break
                
                if not animal_exists:
                    await msg.answer(f"‚ùå –ñ–∏–≤–æ—Ç–Ω–æ–µ '{animal}' –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –∏–≥—Ä–µ")
                    return
                
                if username_part.lower() == "–∞–ª–ª":
                    # –î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ–º –∏–≥—Ä–æ–∫–∞–º
                    all_users = sql.execute("SELECT user_id FROM users").fetchall()
                    for user_data in all_users:
                        user_id = user_data[0]
                        trophy = sql.execute("SELECT count FROM trophies WHERE user_id = ? AND animal = ?", 
                                           (user_id, animal)).fetchone()
                        if trophy:
                            sql.execute("UPDATE trophies SET count = count + ? WHERE user_id = ? AND animal = ?", 
                                       (count, user_id, animal))
                        else:
                            sql.execute("INSERT INTO trophies VALUES (?, ?, ?)", (user_id, animal, count))
                    
                    db.commit()
                    await msg.answer(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –∂–∏–≤–æ—Ç–Ω–æ–µ '{animal}' (x{count}) –í–°–ï–ú –∏–≥—Ä–æ–∫–∞–º!")
                    print(f"üîß –ê–¥–º–∏–Ω {msg.from_user.id} –¥–æ–±–∞–≤–∏–ª '{animal}' x{count} –í–°–ï–ú –∏–≥—Ä–æ–∫–∞–º")
                    
                    # –£–≤–µ–¥–æ–º–ª—è–µ–º –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
                    all_users = sql.execute("SELECT user_id, username FROM users WHERE username IS NOT NULL").fetchall()
                    for user_id, username in all_users:
                        try:
                            await bot.send_message(user_id, f"üêæ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –¥–æ–±–∞–≤–∏–ª –≤–∞–º –∂–∏–≤–æ—Ç–Ω–æ–µ: {animal} (x{count})!")
                        except:
                            pass
                            
                elif "@" in username_part:
                    username = username_part.replace("@", "").strip()
                    user = sql.execute("SELECT user_id FROM users WHERE username = ?", (username,)).fetchone()
                    if user:
                        trophy = sql.execute("SELECT count FROM trophies WHERE user_id = ? AND animal = ?", 
                                           (user[0], animal)).fetchone()
                        if trophy:
                            sql.execute("UPDATE trophies SET count = count + ? WHERE user_id = ? AND animal = ?", 
                                       (count, user[0], animal))
                        else:
                            sql.execute("INSERT INTO trophies VALUES (?, ?, ?)", (user[0], animal, count))
                        
                        db.commit()
                        await msg.answer(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –∂–∏–≤–æ—Ç–Ω–æ–µ '{animal}' (x{count}) –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é @{username}")
                        print(f"üîß –ê–¥–º–∏–Ω {msg.from_user.id} –¥–æ–±–∞–≤–∏–ª '{animal}' x{count} @{username}")
                        
                        # –£–≤–µ–¥–æ–º–ª—è–µ–º –∏–≥—Ä–æ–∫–∞
                        try:
                            await bot.send_message(user[0], f"üêæ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –¥–æ–±–∞–≤–∏–ª –≤–∞–º –∂–∏–≤–æ—Ç–Ω–æ–µ: {animal} (x{count})!")
                        except:
                            pass
                    else:
                        await msg.answer(f"‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å @{username} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ")
                else:
                    await msg.answer("‚ùå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –¥–∏–ø–∂–∏–≤ \"–∂–∏–≤–æ—Ç–Ω–æ–µ\" <–∫–æ–ª-–≤–æ> @username\n–ò–ª–∏: –¥–∏–ø–∂–∏–≤ \"–∂–∏–≤–æ—Ç–Ω–æ–µ\" <–∫–æ–ª-–≤–æ> –∞–ª–ª")
            except ValueError:
                await msg.answer("‚ùå –û—à–∏–±–∫–∞: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–∏—Å–ª–æ–º")
        else:
            await msg.answer("‚ùå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –¥–∏–ø–∂–∏–≤ \"–∂–∏–≤–æ—Ç–Ω–æ–µ\" <–∫–æ–ª-–≤–æ> @username\n–ü—Ä–∏–º–µ—Ä: –¥–∏–ø–∂–∏–≤ \"–ó–∞—è—Ü\" 5 @player123")
    except Exception as e:
        await msg.answer(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

# ================== –û–°–ù–û–í–ù–´–ï –ö–û–ú–ê–ù–î–´ ==================
@dp.message(Command("start"))
async def start(msg: Message):
    ensure_user(msg.from_user.id, msg.from_user.username)
    await msg.answer(
        "üèπ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –æ—Ö–æ—Ç—É!\n\n"
        "üìã –ö–æ–º–∞–Ω–¥—ã:\n"
        "‚Ä¢ –•–∞–Ω—Ç ‚Äî –Ω–∞—á–∞—Ç—å –æ—Ö–æ—Ç—É\n"
        "‚Ä¢ –°–æ—Å—Ç–æ—è–Ω–∏–µ ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ\n" 
        "‚Ä¢ –ò–Ω–≤ ‚Äî –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å\n"
        "‚Ä¢ –ú–∞–≥–∞–∑–∏–Ω ‚Äî –∫—É–ø–∏—Ç—å –æ—Ä—É–∂–∏–µ –∏ —Å–Ω–∞—Ä—è–∂–µ–Ω–∏–µ\n"
        "‚Ä¢ –õ–æ–∫–∞—Ü–∏–∏ ‚Äî –≤—ã–±—Ä–∞—Ç—å –ª–æ–∫–∞—Ü–∏—é\n"
        "‚Ä¢ –¢–æ–ø—ã ‚Äî —Ç–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤\n"
        "‚Ä¢ –°–ø—Ä–∞–≤–∫–∞ ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ\n"
        "‚Ä¢ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è ‚Äî –≤–∞—à–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è\n"
        "‚Ä¢ –¢–∏—Ç—É–ª—ã ‚Äî –≤—ã–±—Ä–∞—Ç—å —Ç–∏—Ç—É–ª\n"
        "‚Ä¢ –ü—Ä–µ—Å—Ç–∏–∂ ‚Äî –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–µ—Å—Ç–∏–∂\n"
        "‚Ä¢ –õ–æ–≤—É—à–∫–∏ ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–≤—É—à–∫–∏ (—Ä–∞–∑ –≤ 24 —á–∞—Å–∞)\n"
        "‚Ä¢ –ü–æ–¥–∞—Ä–æ–∫ ‚Äî –ø–æ–ª—É—á–∏—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫ (—Ä–∞–∑ 24 —á–∞—Å–∞)\n"
        "‚Ä¢ –í—ã–∂–∏–≤–∞–Ω–∏–µ ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –≤—ã–∂–∏–≤–∞–Ω–∏—è\n"
    )

@dp.message(lambda msg: msg.text and msg.text.lower() == "—Å–ø—Ä–∞–≤–∫–∞")
async def help_command(msg: Message):
    await msg.answer("–ï—Å–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã/–ø—Ä–æ–±–ª–µ–º—ã —Å –±–æ—Ç–æ–º/–∏–¥–µ–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Ç–æ –Ω–∞–ø–∏—à–∏ @DeepSleep01")

@dp.message(lambda msg: msg.text and msg.text.lower() == "—Å–æ—Å—Ç–æ—è–Ω–∏–µ")
async def health_status(msg: Message):
    """–ü–æ–∫–∞–∑–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—å—è –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏"""
    user = ensure_user(msg.from_user.id, msg.from_user.username)
    current_hp, max_hp = get_user_health(msg.from_user.id)
    deaths = user[15] if len(user) > 15 else 0
    
    status_text = f"‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ: {current_hp}/{max_hp}\n"
    
    if current_hp <= 25:
        status_text += f"üíÄ –°–ª–∏—à–∫–æ–º –º–∞–ª–æ –∑–¥–æ—Ä–æ–≤—å—è! –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ –¥–æ 26 HP –∏–ª–∏ –±–æ–ª—å—à–µ.\n"
        hp_needed = 26 - current_hp
        status_text += f"üìâ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ: 1 HP –≤ –º–∏–Ω—É—Ç—É\n"
        status_text += "üí° –°–æ–≤–µ—Ç: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–ø—Ç–µ—á–∫—É –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ª–µ—á–µ–Ω–∏—è!"
    elif current_hp < max_hp:
        status_text += f""
        healing_rate = 1
        equipment = get_user_equipment(msg.from_user.id)
        if "–í–∏—Ç–∞–º–∏–Ω—ã" in equipment:
            healing_rate = 1.5
            status_text += "üíä –ë–æ–Ω—É—Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: x1.5 (–≤–∏—Ç–∞–º–∏–Ω—ã)\n"
        
        minutes_to_full = (max_hp - current_hp) / healing_rate
        status_text += f"üìà –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ: {healing_rate} HP –≤ –º–∏–Ω—É—Ç—É\n"
        status_text += f"üïê –î–æ –ø–æ–ª–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: {int(minutes_to_full)} –º–∏–Ω—É—Ç\n"
    else:
        status_text += "‚úÖ –í—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–¥–æ—Ä–æ–≤—ã!\n"
    
    status_text += f"\nüìä –°–º–µ—Ä—Ç–µ–π: {deaths}"
    
    await msg.answer(status_text)

@dp.message(lambda msg: msg.text and msg.text.lower() == "–ø–æ–¥–∞—Ä–æ–∫")
async def daily_gift(msg: Message):
    """–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫"""
    success, result = get_daily_gift(msg.from_user.id)
    if success:
        await msg.answer(f"üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫!\n\n–í—ã –ø–æ–ª—É—á–∏–ª–∏: {result}")
    else:
        await msg.answer(result)

@dp.message(lambda msg: msg.text and msg.text.lower() == "–≤—ã–∂–∏–≤–∞–Ω–∏–µ")
async def survival_command(msg: Message):
    """–ü–æ–∫–∞–∑–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –≤—ã–∂–∏–≤–∞–Ω–∏—è"""
    user_id = msg.from_user.id
    user = ensure_user(user_id)
    location = user[4]
    
    items = get_user_survival_items(user_id)
    
    if not items:
        await msg.answer("üõ°Ô∏è –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥–ª—è –≤—ã–∂–∏–≤–∞–Ω–∏—è.\n\n"
                        "üè™ –ö—É–ø–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç—ã –≤ —Ä–∞–∑–¥–µ–ª–µ '–í—ã–∂–∏–≤–∞–Ω–∏–µ' –º–∞–≥–∞–∑–∏–Ω–∞!")
        return
    
    text = "üõ°Ô∏è –í–∞—à–∏ –ø—Ä–µ–¥–º–µ—Ç—ã –¥–ª—è –≤—ã–∂–∏–≤–∞–Ω–∏—è:\n\n"
    
    for item_name in items:
        item_data = SURVIVAL_ITEMS.get(item_name, {})
        location_name = item_data.get("location", "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ")
        
        text += f"‚Ä¢ {item_name}\n"
        text += f"  üìç –õ–æ–∫–∞—Ü–∏—è: {location_name}\n"
        
        if "survival" in item_data and item_data["survival"]:
            text += f"  üõ°Ô∏è –ó–∞—â–∏—Ç–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç\n"
        else:
            text += f"  ‚ú® –ë–æ–Ω—É—Å–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç\n"
        
        text += f"  üìù {item_data.get('description', '')}\n\n"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â—É—é –ª–æ–∫–∞—Ü–∏—é
    if location != "–¢–∞–π–≥–∞":
        has_item, item_name = has_survival_item(user_id, location)
        if has_item:
            text += f"üìç –¢–µ–∫—É—â–∞—è –ª–æ–∫–∞—Ü–∏—è: {location}\n"
            text += f"‚úÖ –£ –≤–∞—Å –µ—Å—Ç—å –ø—Ä–µ–¥–º–µ—Ç –¥–ª—è –≤—ã–∂–∏–≤–∞–Ω–∏—è: {item_name}\n"
            text += f"üõ°Ô∏è –í—ã –∑–∞—â–∏—â–µ–Ω—ã –æ—Ç —É—Ä–æ–Ω–∞ —Å—Ä–µ–¥—ã\n"
        else:
            text += f"üìç –¢–µ–∫—É—â–∞—è –ª–æ–∫–∞—Ü–∏—è: {location}\n"
            text += f"‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–µ–¥–º–µ—Ç–∞ –¥–ª—è –≤—ã–∂–∏–≤–∞–Ω–∏—è!\n"
            text += f"‚ö†Ô∏è –ö–∞–∂–¥—ã–µ 5 –æ—Ö–æ—Ç –±—É–¥–µ—Ç –æ—Ç–Ω–∏–º–∞—Ç—å—Å—è 50HP\n"
    
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üè™ –ú–∞–≥–∞–∑–∏–Ω –≤—ã–∂–∏–≤–∞–Ω–∏—è", callback_data=f"shop_survival:{user_id}")]
    ])
    
    await msg.answer(text, reply_markup=kb)

# ================== –•–ê–ù–¢ ==================
@dp.message(lambda msg: msg.text and msg.text.lower() == "—Ö–∞–Ω—Ç")
async def hunt(msg: Message):
    can_hunt_result, message = can_hunt(msg.from_user.id)
    if not can_hunt_result:
        await msg.answer(message)
        return
    
    user = ensure_user(msg.from_user.id, msg.from_user.username)
    now = int(time.time())
    
    if now - user[5] < HUNT_COOLDOWN:
        wait = HUNT_COOLDOWN - (now - user[5])
        minutes = wait // 60
        seconds = wait % 60
        
        kb = InlineKeyboardMarkup(inline_keyboard=[[
            InlineKeyboardButton(text=f"üîÑ –û–±–Ω—É–ª–∏—Ç—å —Ç–∞–π–º–µ—Ä –∑–∞ 450üí∞", callback_data=f"reset_cooldown:{msg.from_user.id}")
        ]])
        
        await msg.answer(f"‚è≥ –ü–æ–¥–æ–∂–¥–∏ {minutes} –º–∏–Ω {seconds} —Å–µ–∫.", reply_markup=kb)
        return
    
    sql.execute("UPDATE users SET last_hunt = ?, hunt_counter = hunt_counter + 1 WHERE user_id = ?", (now, msg.from_user.id))
    db.commit()
    
    group, animal = choose_animal(user[4], msg.from_user.id)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∏—Å–∫–∞—Ç–µ–ª—å
    equipment = get_user_equipment(msg.from_user.id)
    if "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∏—Å–∫–∞—Ç–µ–ª—å" in equipment and not animal:
        # –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –Ω–∞—Ö–æ–¥–∏–º –∂–∏–≤–æ—Ç–Ω–æ–µ
        available_groups = [g for g in SEARCH_CHANCES if LOCATIONS[user[4]]["animals"].get(g) and LOCATIONS[user[4]]["animals"][g]]
        if available_groups:
            group = random.choice(available_groups)
            animal = random.choice(LOCATIONS[user[4]]["animals"][group])
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Ä–æ–Ω –∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞ –≤—ã–∂–∏–≤–∞–Ω–∏—è
    location = user[4]
    damage_taken, damage_phrase = check_survival_damage(msg.from_user.id, location)
    
    if not animal:
        await msg.answer(f"–¢—ã –±–ª—É–∂–¥–∞–µ—à—å –ø–æ {user[4]}, –Ω–æ –ø–æ–∏—Å–∫–∏ –±–µ–∑—É—Å–ø–µ—à–Ω—ã.")
        return
    
    if damage_taken:
        await msg.answer(f"{damage_phrase}")
        # –ñ–¥–µ–º —Å–µ–∫—É–Ω–¥—É –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º –∂–∏–≤–æ—Ç–Ω–æ–≥–æ
        await asyncio.sleep(1)
    
    # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö
    hunt_data = f"{msg.from_user.id}|{group}|{animal}|{int(time.time())}"
    
    kb = InlineKeyboardMarkup(inline_keyboard=[[InlineKeyboardButton(
        text="üî´ –í—ã—Å—Ç—Ä–µ–ª",
        callback_data=f"shoot|{hunt_data}"
    )]])
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞—Ñ—Ñ—ã
    user_data = sql.execute("SELECT golden_bullet, diamond_bullet, immortality_staff FROM users WHERE user_id = ?", (msg.from_user.id,)).fetchone()
    if user_data:
        has_golden_bullet, has_diamond_bullet, has_immortality_staff = user_data
    
    buff_text = ""
    if has_golden_bullet:
        buff_text += "üí´ –ó–æ–ª–æ—Ç–∞—è –ø—É–ª—è –∞–∫—Ç–∏–≤–Ω–∞! –®–∞–Ω—Å –ø–æ–ø–∞–¥–∞–Ω–∏—è x2\n"
    if has_diamond_bullet:
        buff_text += "üíé –ê–ª–º–∞–∑–Ω–∞—è –ø—É–ª—è –∞–∫—Ç–∏–≤–Ω–∞! +20% –∫ —à–∞–Ω—Å—É –ø–æ–ø–∞–¥–∞–Ω–∏—è\n"
    if has_immortality_staff:
        buff_text += "ü™Ñ –ü–æ—Å–æ—Ö –±–µ—Å—Å–º–µ—Ä—Ç–∏—è –∞–∫—Ç–∏–≤–µ–Ω! –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–æ–Ω—Ç—Ä–∞—Ç–∞–∫–∏\n"
    
    if buff_text:
        await msg.answer(f"{buff_text}–¢—ã –±–ª—É–∂–¥–∞–µ—à—å –ø–æ {user[4]} –∏ –≤–Ω–µ–∑–∞–ø–Ω–æ –∑–∞–º–µ—á–∞–µ—à—å {animal}!", reply_markup=kb)
    else:
        await msg.answer(f"–¢—ã –±–ª—É–∂–¥–∞–µ—à—å –ø–æ {user[4]} –∏ –≤–Ω–µ–∑–∞–ø–Ω–æ –∑–∞–º–µ—á–∞–µ—à—å {animal}!", reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("reset_cooldown"))
async def reset_cooldown(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 2:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id = int(data_parts[1])
    
    if user_id != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à —Ç–∞–π–º–µ—Ä!", show_alert=True)
        return
    
    user = ensure_user(call.from_user.id)
    
    if user[1] < 450:
        await call.answer("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç! –ù—É–∂–Ω–æ 450üí∞", show_alert=True)
        return
    
    sql.execute("UPDATE users SET coins = coins - 450, last_hunt = 0 WHERE user_id = ?", (call.from_user.id,))
    db.commit()
    
    await call.message.edit_text("‚úÖ –¢–∞–π–º–µ—Ä –æ—Ö–æ—Ç—ã –æ–±–Ω—É–ª–µ–Ω! –ú–æ–∂–µ—Ç–µ —Å–Ω–æ–≤–∞ –æ—Ö–æ—Ç–∏—Ç—å—Å—è.")
    
    group, animal = choose_animal(user[4], call.from_user.id)
    if not animal:
        await call.message.answer(f"–¢—ã –±–ª—É–∂–¥–∞–µ—à—å –ø–æ {user[4]}, –Ω–æ –ø–æ–∏—Å–∫–∏ –±–µ–∑—É—Å–ø–µ—à–Ω—ã.")
        return
    
    hunt_data = f"{call.from_user.id}|{group}|{animal}|{int(time.time())}"
    
    kb = InlineKeyboardMarkup(inline_keyboard=[[InlineKeyboardButton(
        text="üî´ –í—ã—Å—Ç—Ä–µ–ª",
        callback_data=f"shoot|{hunt_data}"
    )]])
    await call.message.answer(f"–¢—ã –±–ª—É–∂–¥–∞–µ—à—å –ø–æ {user[4]} –∏ –≤–Ω–µ–∑–∞–ø–Ω–æ –∑–∞–º–µ—á–∞–µ—à—å {animal}!", reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("shoot|"))
async def shoot(call: CallbackQuery):
    try:
        data_part = call.data.split("|", 1)[1]
        parts = data_part.split("|")
        
        if len(parts) < 4:
            await call.answer("‚ùå –û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
            return
        
        user_id_str, group, animal, hunt_time = parts
        user_id = int(user_id_str)
        
        if user_id != call.from_user.id:
            await call.answer("‚ùå –≠—Ç–æ –Ω–µ —Ç–≤–æ—è –æ—Ö–æ—Ç–∞!", show_alert=True)
            return
        
        user = ensure_user(call.from_user.id)
        current_hp, max_hp = get_user_health(call.from_user.id)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ö–æ—Ç—ã (–Ω—É–∂–Ω–æ HP > 25)
        if current_hp <= 25:
            await call.message.edit_text("‚ùå –£ –≤–∞—Å —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ –∑–¥–æ—Ä–æ–≤—å—è (‚â§25 HP)! –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ.")
            return
        
        # –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 3: –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –±–∞—Ñ—Ñ–∞—Ö –∏–∑ –ë–î
        user_data = sql.execute("SELECT golden_bullet, diamond_bullet FROM users WHERE user_id = ?", (call.from_user.id,)).fetchone()
        if not user_data:
            await call.answer("‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
            return
        
        has_golden_bullet, has_diamond_bullet = user_data
        
        hit_success = check_hit(user[3], group, call.from_user.id)
        
        if hit_success:
            # –£–°–ü–ï–®–ù–´–ô –í–´–°–¢–†–ï–õ
            sql.execute("UPDATE users SET achievement_streak = achievement_streak + 1 WHERE user_id = ?", (call.from_user.id,))
            
            if group not in REWARDS:
                await call.message.edit_text("‚ùå –û—à–∏–±–∫–∞ –Ω–∞–≥—Ä–∞–¥—ã")
                return
            
            rank = get_user_rank(user[7])
            coins_bonus = rank["bonus_coins"]
            exp_bonus = rank["bonus_exp"]
            
            base_coins, base_exp = REWARDS[group]
            coins = base_coins + int(base_coins * coins_bonus / 100)
            exp = base_exp + int(base_exp * exp_bonus / 100)
            
            # –î–æ–±–∞–≤–ª—è–µ–º –∂–∏–≤–æ—Ç–Ω–æ–µ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
            trophy = sql.execute("SELECT count FROM trophies WHERE user_id = ? AND animal = ?", 
                               (call.from_user.id, animal)).fetchone()
            if trophy:
                sql.execute("UPDATE trophies SET count = count + 1 WHERE user_id = ? AND animal = ?", 
                           (call.from_user.id, animal))
            else:
                sql.execute("INSERT INTO trophies VALUES (?, ?, ?)", (call.from_user.id, animal, 1))
            
            # –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏ —É–±–∏–π—Å—Ç–≤
            sql.execute("UPDATE users SET total_kills = total_kills + 1, daily_kills = daily_kills + 1 WHERE user_id = ?", 
                       (call.from_user.id,))
            
            # –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–Ω–µ—Ç—ã –∏ –æ–ø—ã—Ç
            sql.execute("UPDATE users SET coins = coins + ?, exp = exp + ? WHERE user_id = ?", 
                       (coins, exp, call.from_user.id))
            
            # –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–Ω—è
            today = datetime.now().strftime("%Y-%m-%d")
            stats = sql.execute("SELECT kills FROM stats_daily WHERE user_id = ? AND date = ?", 
                              (call.from_user.id, today)).fetchone()
            if stats:
                sql.execute("UPDATE stats_daily SET kills = kills + 1 WHERE user_id = ? AND date = ?", 
                          (call.from_user.id, today))
            else:
                sql.execute("INSERT INTO stats_daily VALUES (?, ?, ?)", (call.from_user.id, today, 1))
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
            new_achievements = check_achievements(call.from_user.id)
            
            db.commit()
            
            result_text = f"üéØ –ü—Ä—è–º–æ–µ –ø–æ–ø–∞–¥–∞–Ω–∏–µ!\n\n–¢—Ä–æ—Ñ–µ–π: \"{animal}\"\nüí∞ –ú–æ–Ω–µ—Ç—ã: +{coins}\n‚≠ê –û–ø—ã—Ç: +{exp}"
            
            if has_golden_bullet:
                result_text += f"\nüí´ –ó–æ–ª–æ—Ç–∞—è –ø—É–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞!"
            
            if has_diamond_bullet:
                result_text += f"\nüíé –ê–ª–º–∞–∑–Ω–∞—è –ø—É–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞!"
            
            if new_achievements:
                achievements_text = "\n\nüéâ –ù–æ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:\n"
                for achievement_name in new_achievements:
                    achievements_text += f"‚Ä¢ {achievement_name}\n"
                result_text += achievements_text
            
            await call.message.edit_text(result_text)
            
        else:
            # –ü–†–û–ú–ê–•
            sql.execute("UPDATE users SET achievement_streak = 0 WHERE user_id = ?", (call.from_user.id,))
            
            if group in ["–û–ø–∞—Å–Ω", "–¢—è–∂–µ–ª", "–¢–∏—Ç–∞–Ω"]:
                # –ö–û–ù–¢–†–ê–¢–ê–ö–ê
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Å–æ—Ö –±–µ—Å—Å–º–µ—Ä—Ç–∏—è
                user_data = sql.execute("SELECT immortality_staff FROM users WHERE user_id = ?", (call.from_user.id,)).fetchone()
                has_immortality_staff = user_data[0] if user_data else 0
                
                if has_immortality_staff:
                    # –ò–≥—Ä–æ–∫ –∑–∞—â–∏—â–µ–Ω –ø–æ—Å–æ—Ö–æ–º –±–µ—Å—Å–º–µ—Ä—Ç–∏—è
                    sql.execute("UPDATE users SET immortality_staff = 0 WHERE user_id = ?", (call.from_user.id,))
                    db.commit()
                    
                    await call.message.edit_text(
                        f"ü™Ñ –ü–æ—Å–æ—Ö –±–µ—Å—Å–º–µ—Ä—Ç–∏—è –∑–∞—â–∏—Ç–∏–ª –≤–∞—Å –æ—Ç –∫–æ–Ω—Ç—Ä–∞—Ç–∞–∫–∏!\n"
                        f"‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ: {current_hp}/{max_hp}\n\n"
                        f"–ß—Ç–æ –±—É–¥–µ—Ç–µ –¥–µ–ª–∞—Ç—å?"
                    )
                    return
                
                damage = CONTRATTACK_DAMAGE.get(group, 0)
                new_hp = update_health(call.from_user.id, -damage)
                current_hp, max_hp = get_user_health(call.from_user.id)
                
                if new_hp > 0:
                    sql.execute("UPDATE users SET counterattack_streak = counterattack_streak + 1 WHERE user_id = ?", 
                              (call.from_user.id,))
                else:
                    sql.execute("UPDATE users SET counterattack_streak = 0 WHERE user_id = ?", 
                              (call.from_user.id,))
                
                # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é —Ñ—Ä–∞–∑—É –¥–ª—è –∂–∏–≤–æ—Ç–Ω–æ–≥–æ
                attack_phrase = get_animal_attack_phrase(animal)
                
                if current_hp <= 25:
                    await call.message.edit_text(
                        f"{attack_phrase}\n\n"
                        f"üíÄ –£ –≤–∞—Å —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ –∑–¥–æ—Ä–æ–≤—å—è (‚â§25 HP)! –ó–¥–æ—Ä–æ–≤—å–µ: {current_hp}/{max_hp}\n"
                        f"–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –æ—Ö–æ—Ç–∏—Ç—å—Å—è –¥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è.\n"
                        f"–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–ø—Ç–µ—á–∫—É –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞ –∏–ª–∏ –ø–æ–¥–æ–∂–¥–∏—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è."
                    )
                    db.commit()
                    return
                
                # –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –æ—Ç–≤–µ—Ç–∞
                hunt_data_new = f"{call.from_user.id}|{group}|{animal}|{hunt_time}"
                
                if group == "–¢–∏—Ç–∞–Ω":
                    kb = InlineKeyboardMarkup(inline_keyboard=[
                        [InlineKeyboardButton(text="‚öîÔ∏è –î–æ–±–∏—Ç—å (—Ä–∏—Å–∫!)", callback_data=f"finish|{hunt_data_new}|1")],
                        [InlineKeyboardButton(text="üèÉ –ë–µ–∂–∞—Ç—å (50% —à–∞–Ω—Å)", callback_data=f"run|{hunt_data_new}")]
                    ])
                else:
                    kb = InlineKeyboardMarkup(inline_keyboard=[
                        [InlineKeyboardButton(text="‚öîÔ∏è –î–æ–±–∏—Ç—å (—Ä–∏—Å–∫!)", callback_data=f"finish|{hunt_data_new}|1")],
                        [InlineKeyboardButton(text="üèÉ –ë–µ–∂–∞—Ç—å", callback_data=f"run|{hunt_data_new}")]
                    ])
                
                await call.message.edit_text(
                    f"{attack_phrase}\n"
                    f"‚ù§Ô∏è –û—Å—Ç–∞–ª–æ—Å—å –∑–¥–æ—Ä–æ–≤—å—è: {current_hp}/{max_hp}\n\n"
                    f"–ß—Ç–æ –±—É–¥–µ—Ç–µ –¥–µ–ª–∞—Ç—å?",
                    reply_markup=kb
                )
            else:
                # –î–ª—è –º–µ–ª–æ—á–∏ –∏ —Å—Ä–µ–¥–Ω–∏—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ—Ä–∞–∑—É –ø—Ä–æ–º–∞—Ö–∞
                miss_phrase = random.choice(MISS_PHRASES)
                await call.message.edit_text(f"{miss_phrase}")
        
        db.commit()
        
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –≤ shoot: {e}")
        import traceback
        traceback.print_exc()
        await call.answer("‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Å—Ç—Ä–µ–ª–µ", show_alert=True)

@dp.callback_query(lambda c: c.data.startswith("finish|"))
async def finish_animal(call: CallbackQuery):
    try:
        data_part = call.data.split("|", 1)[1]
        parts = data_part.split("|")
        
        if len(parts) < 5:
            await call.answer("‚ùå –û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
            return
        
        user_id_str, group, animal, hunt_time, try_count_str = parts
        user_id = int(user_id_str)
        try_count = int(try_count_str)
        
        if user_id != call.from_user.id:
            await call.answer("‚ùå –≠—Ç–æ –Ω–µ —Ç–≤–æ—è –æ—Ö–æ—Ç–∞!", show_alert=True)
            return
        
        user = ensure_user(call.from_user.id)
        current_hp, max_hp = get_user_health(call.from_user.id)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ö–æ—Ç—ã (–Ω—É–∂–Ω–æ HP > 25)
        if current_hp <= 25:
            await call.message.edit_text("‚ùå –£ –≤–∞—Å —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ –∑–¥–æ—Ä–æ–≤—å—è (‚â§25 HP)! –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ.")
            return
        
        hit_success = check_hit(user[3], group, call.from_user.id)
        
        if hit_success:
            # –£–°–ü–ï–®–ù–û–ï –î–û–ë–ò–í–ê–ù–ò–ï
            if group not in REWARDS:
                await call.message.edit_text("‚ùå –û—à–∏–±–∫–∞ –Ω–∞–≥—Ä–∞–¥—ã")
                return
            
            rank = get_user_rank(user[7])
            coins_bonus = rank["bonus_coins"]
            exp_bonus = rank["bonus_exp"]
            
            base_coins, base_exp = REWARDS[group]
            coins = (base_coins // 2) + int((base_coins // 2) * coins_bonus / 100)
            exp = (base_exp // 2) + int((base_exp // 2) * exp_bonus / 100)
            
            # –î–æ–±–∞–≤–ª—è–µ–º –∂–∏–≤–æ—Ç–Ω–æ–µ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
            trophy = sql.execute("SELECT count FROM trophies WHERE user_id = ? AND animal = ?", 
                               (call.from_user.id, animal)).fetchone()
            if trophy:
                sql.execute("UPDATE trophies SET count = count + 1 WHERE user_id = ? AND animal = ?", 
                           (call.from_user.id, animal))
            else:
                sql.execute("INSERT INTO trophies VALUES (?, ?, ?)", (call.from_user.id, animal, 1))
            
            # –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏ —É–±–∏–π—Å—Ç–≤
            sql.execute("UPDATE users SET total_kills = total_kills + 1, daily_kills = daily_kills + 1 WHERE user_id = ?", 
                       (call.from_user.id,))
            
            # –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–Ω–µ—Ç—ã –∏ –æ–ø—ã—Ç
            sql.execute("UPDATE users SET coins = coins + ?, exp = exp + ? WHERE user_id = ?", 
                       (coins, exp, call.from_user.id))
            
            # –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–Ω—è
            today = datetime.now().strftime("%Y-%m-%d")
            stats = sql.execute("SELECT kills FROM stats_daily WHERE user_id = ? AND date = ?", 
                              (call.from_user.id, today)).fetchone()
            if stats:
                sql.execute("UPDATE stats_daily SET kills = kills + 1 WHERE user_id = ? AND date = ?", 
                          (call.from_user.id, today))
            else:
                sql.execute("INSERT INTO stats_daily VALUES (?, ?, ?)", (call.from_user.id, today, 1))
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
            new_achievements = check_achievements(call.from_user.id)
            
            db.commit()
            
            result_text = f"üéØ –í—ã –¥–æ–±–∏–ª–∏ –∂–∏–≤–æ—Ç–Ω–æ–µ!\n\n–¢—Ä–æ—Ñ–µ–π: \"{animal}\"\nüí∞ –ú–æ–Ω–µ—Ç—ã: +{coins}\n‚≠ê –û–ø—ã—Ç: +{exp}"
            
            if new_achievements:
                achievements_text = "\n\nüéâ –ù–æ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:\n"
                for achievement_name in new_achievements:
                    achievements_text += f"‚Ä¢ {achievement_name}\n"
                result_text += achievements_text
            
            await call.message.edit_text(result_text)
            
        else:
            # –ù–û–í–ê–Ø –ö–û–ù–¢–†–ê–¢–ê–ö–ê
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Å–æ—Ö –±–µ—Å—Å–º–µ—Ä—Ç–∏—è
            user_data = sql.execute("SELECT immortality_staff FROM users WHERE user_id = ?", (call.from_user.id,)).fetchone()
            has_immortality_staff = user_data[0] if user_data else 0
            
            if has_immortality_staff:
                # –ò–≥—Ä–æ–∫ –∑–∞—â–∏—â–µ–Ω –ø–æ—Å–æ—Ö–æ–º –±–µ—Å—Å–º–µ—Ä—Ç–∏—è
                sql.execute("UPDATE users SET immortality_staff = 0 WHERE user_id = ?", (call.from_user.id,))
                db.commit()
                
                hunt_data_new = f"{call.from_user.id}|{group}|{animal}|{hunt_time}"
                try_count += 1
                
                kb = InlineKeyboardMarkup(inline_keyboard=[
                    [InlineKeyboardButton(text=f"‚öîÔ∏è –î–æ–±–∏—Ç—å (–µ—â–µ —Ä–∏—Å–∫!)", callback_data=f"finish|{hunt_data_new}|{try_count}")],
                    [InlineKeyboardButton(text="üèÉ –ë–µ–∂–∞—Ç—å", callback_data=f"run|{hunt_data_new}")]
                ])
                
                await call.message.edit_text(
                    f"ü™Ñ –ü–æ—Å–æ—Ö –±–µ—Å—Å–º–µ—Ä—Ç–∏—è –∑–∞—â–∏—Ç–∏–ª –≤–∞—Å –æ—Ç –∫–æ–Ω—Ç—Ä–∞—Ç–∞–∫–∏!\n"
                    f"‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ: {current_hp}/{max_hp}\n\n"
                    f"–ß—Ç–æ –±—É–¥–µ—Ç–µ –¥–µ–ª–∞—Ç—å?",
                    reply_markup=kb
                )
                return
            
            damage = CONTRATTACK_DAMAGE.get(group, 0) + (25 * try_count)
            new_hp = update_health(call.from_user.id, -damage)
            current_hp, max_hp = get_user_health(call.from_user.id)
            
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é —Ñ—Ä–∞–∑—É –¥–ª—è –∂–∏–≤–æ—Ç–Ω–æ–≥–æ
            attack_phrase = get_animal_attack_phrase(animal)
            
            if current_hp <= 25:
                await call.message.edit_text(
                    f"{attack_phrase}\n\n"
                    f"üíÄ –£ –≤–∞—Å —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ –∑–¥–æ—Ä–æ–≤—å—è (‚â§25 HP)! –ó–¥–æ—Ä–æ–≤—å–µ: {current_hp}/{max_hp}\n"
                    f"–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –æ—Ö–æ—Ç–∏—Ç—å—Å—è –¥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è."
                )
                return
            
            try_count += 1
            hunt_data_new = f"{call.from_user.id}|{group}|{animal}|{hunt_time}"
            
            if group == "–¢–∏—Ç–∞–Ω":
                kb = InlineKeyboardMarkup(inline_keyboard=[
                    [InlineKeyboardButton(text=f"‚öîÔ∏è –î–æ–±–∏—Ç—å (–µ—â–µ —Ä–∏—Å–∫!)", callback_data=f"finish|{hunt_data_new}|{try_count}")],
                    [InlineKeyboardButton(text="üèÉ –ë–µ–∂–∞—Ç—å (50% —à–∞–Ω—Å)", callback_data=f"run|{hunt_data_new}")]
                ])
            else:
                kb = InlineKeyboardMarkup(inline_keyboard=[
                    [InlineKeyboardButton(text=f"‚öîÔ∏è –î–æ–±–∏—Ç—å (–µ—â–µ —Ä–∏—Å–∫!)", callback_data=f"finish|{hunt_data_new}|{try_count}")],
                    [InlineKeyboardButton(text="üèÉ –ë–µ–∂–∞—Ç—å", callback_data=f"run|{hunt_data_new}")]
                ])
            
            await call.message.edit_text(
                f"{attack_phrase}\n"
                f"‚ù§Ô∏è –û—Å—Ç–∞–ª–æ—Å—å –∑–¥–æ—Ä–æ–≤—å—è: {current_hp}/{max_hp}\n\n"
                f"–ß—Ç–æ –±—É–¥–µ—Ç–µ –¥–µ–ª–∞—Ç—å?",
                reply_markup=kb
            )
            
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –≤ finish_animal: {e}")
        import traceback
        traceback.print_exc()
        await call.answer("‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞", show_alert=True)

@dp.callback_query(lambda c: c.data.startswith("run|"))
async def run_from_animal(call: CallbackQuery):
    try:
        data_part = call.data.split("|", 1)[1]
        parts = data_part.split("|")
        
        if len(parts) < 4:
            await call.answer("‚ùå –û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
            return
        
        user_id_str, group, animal, hunt_time = parts
        user_id = int(user_id_str)
        
        if user_id != call.from_user.id:
            await call.answer("‚ùå –≠—Ç–æ –Ω–µ —Ç–≤–æ—è –æ—Ö–æ—Ç–∞!", show_alert=True)
            return
        
        user = ensure_user(call.from_user.id)
        
        if group == "–¢–∏—Ç–∞–Ω":
            if random.random() < 0.5:
                sql.execute("UPDATE users SET titan_escape_streak = titan_escape_streak + 1 WHERE user_id = ?", 
                          (call.from_user.id,))
                await call.message.edit_text("üèÉ –í–∞–º —É–¥–∞–ª–æ—Å—å —É–±–µ–∂–∞—Ç—å –æ—Ç —Ç–∏—Ç–∞–Ω–∞! –≠—Ç–æ –±—ã–ª–æ –æ–ø–∞—Å–Ω–æ...")
            else:
                damage = 100
                update_health(call.from_user.id, -damage)
                sql.execute("UPDATE users SET titan_escape_streak = 0 WHERE user_id = ?", 
                          (call.from_user.id,))
                
                current_hp, max_hp = get_user_health(call.from_user.id)
                if current_hp <= 25:
                    await call.message.edit_text(
                        f"üíÄ –¢–∏—Ç–∞–Ω –¥–æ–≥–Ω–∞–ª –≤–∞—Å! –£ –≤–∞—Å —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ –∑–¥–æ—Ä–æ–≤—å—è (‚â§25 HP)\n"
                        f"–ó–¥–æ—Ä–æ–≤—å–µ: {current_hp}/{max_hp}\n"
                        f"–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –æ—Ö–æ—Ç–∏—Ç—å—Å—è –¥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è."
                    )
                else:
                    await call.message.edit_text(
                        f"üí• –¢–∏—Ç–∞–Ω –¥–æ–≥–æ–Ω–∞–ª –≤–∞—Å! -100HP\n"
                        f"‚ù§Ô∏è –û—Å—Ç–∞–ª–æ—Å—å –∑–¥–æ—Ä–æ–≤—å—è: {current_hp}/{max_hp}\n"
                        f"–í–∞–º —É–¥–∞–ª–æ—Å—å –≤—ã–∂–∏—Ç—å, –Ω–æ —ç—Ç–æ –±—ã–ª–æ –±–ª–∏–∑–∫–æ..."
                    )
        else:
            await call.message.edit_text("üèÉ –í—ã —É—Å–ø–µ—à–Ω–æ —É–±–µ–∂–∞–ª–∏.")
            
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –≤ run: {e}")
        import traceback
        traceback.print_exc()
        await call.answer("‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞", show_alert=True)

# ================== –ò–ù–í–ï–ù–¢–ê–†–¨ ==================
@dp.message(lambda msg: msg.text and msg.text.lower() in ["–∏–Ω–≤", "–∏–Ω–≤–µ–Ω", "–∏–Ω–≤–µ–Ω—Ç–∞—Ä—å"])
async def inventory(msg: Message):
    user = ensure_user(msg.from_user.id, msg.from_user.username)
    
    rank = get_user_rank(user[7])
    prestige_level = user[10] if len(user) > 10 else 0
    current_title = user[9] if len(user) > 9 and user[9] else "‚ùå –ù–µ—Ç"
    
    current_hp, max_hp = get_user_health(msg.from_user.id)
    
    trophies = sql.execute("SELECT animal, count FROM trophies WHERE user_id = ?", (msg.from_user.id,)).fetchall()
    
    equipment = get_user_equipment(msg.from_user.id)
    equipment_bonuses = get_equipment_bonuses(msg.from_user.id)
    
    groups = ["–ú–µ–ª–æ—á—å", "–°—Ä–µ–¥–Ω", "–û–ø–∞—Å–Ω", "–¢—è–∂–µ–ª", "–¢–∏—Ç–∞–Ω"]
    grouped_trophies = {g: [] for g in groups}
    
    for animal, count in trophies:
        animal_found = False
        for location_name, location_data in LOCATIONS.items():
            for group, animals_list in location_data["animals"].items():
                if animal in animals_list:
                    grouped_trophies[group].append((animal, count))
                    animal_found = True
                    break
            if animal_found:
                break
    
    text = f"üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å\n\n"
    text += f"{rank['name']}\n"
    if current_title != "‚ùå –ù–µ—Ç":
        text += f"{current_title}\n"
    text += f"‚≠ê –ü—Ä–µ—Å—Ç–∏–∂: {prestige_level}\n\n"
    text += f"‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ: {current_hp}/{max_hp}\n"
    
    text += f"üî´ –û—Ä—É–∂–∏–µ: {user[3]}\n"
    text += f"üìç –õ–æ–∫–∞—Ü–∏—è: {user[4]}\n"
    text += f"üí∞ –ú–æ–Ω–µ—Ç—ã: {user[1]}\n"
    text += f"üìä –£—Ä–æ–≤–µ–Ω—å: {get_level(user[2])}\n"
    text += f"üéØ –£–±–∏–π—Å—Ç–≤ —Å–µ–≥–æ–¥–Ω—è: {user[6]}\n"
    text += f"üéØ –í—Å–µ–≥–æ —É–±–∏–π—Å—Ç–≤: {user[7]}\n"
    text += f"üíÄ –°–º–µ—Ä—Ç–µ–π: {user[15] if len(user) > 15 else 0}\n\n"
    
    if equipment:
        text += f"üé© –°–Ω–∞—Ä—è–∂–µ–Ω–∏–µ: {', '.join(equipment)}\n\n"
        
        has_bonuses = False
        bonus_text = "üìà –ë–æ–Ω—É—Å—ã –æ—Ç —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è:\n"
        for group in groups:
            bonus = equipment_bonuses.get(group, 0)
            if bonus > 0:
                bonus_text += f"‚Ä¢ {group}: +{bonus}%\n"
                has_bonuses = True
        
        if has_bonuses:
            text += bonus_text + "\n"
    else:
        text += "üé© –°–Ω–∞—Ä—è–∂–µ–Ω–∏–µ: –Ω–µ—Ç\n\n"
    
    if rank["bonus_exp"] > 0 or rank["bonus_coins"] > 0:
        text += f"üìä –ë–æ–Ω—É—Å—ã –æ—Ç –∑–≤–∞–Ω–∏—è:\n"
        if rank["bonus_exp"] > 0:
            text += f"‚Ä¢ +{rank['bonus_exp']}% –∫ –æ–ø—ã—Ç—É\n"    
        if rank["bonus_coins"] > 0:
            text += f"‚Ä¢ +{rank['bonus_coins']}% –∫ –º–æ–Ω–µ—Ç–∞–º\n"
        text += "\n"
    
    text += "üèÜ –¢—Ä–æ—Ñ–µ–∏:\n"
    
    has_trophies = False
    for group in groups:
        if grouped_trophies[group]:
            has_trophies = True
            text += f"\n{group}:\n"
            for animal_name, count in grouped_trophies[group]:
                text += f"  \"{animal_name}\" ‚Äî {count} —à—Ç.\n"
    
    if not has_trophies:
        text += "\n‚Äî –ø–æ–∫–∞ –Ω–µ—Ç —Ç—Ä–æ—Ñ–µ–µ–≤ ‚Äî"
    
    await msg.answer(text)

# ================== –î–û–°–¢–ò–ñ–ï–ù–ò–Ø ==================
@dp.message(lambda msg: msg.text and msg.text.lower() == "–¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è")
async def achievements_command(msg: Message):
    user = ensure_user(msg.from_user.id, msg.from_user.username)
    completed = get_completed_achievements(msg.from_user.id)
    
    check_achievements(msg.from_user.id)
    completed = get_completed_achievements(msg.from_user.id)
    
    text = "üèÜ –í–∞—à–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:\n\n"
    
    for achievement_name, achievement_data in ACHIEVEMENTS.items():
        status = "‚úÖ" if achievement_name in completed else "‚ùå"
        
        progress = ""
        if achievement_name not in completed:
            if achievement_data["condition_type"] == "animal_kills":
                animal_name, required_count = achievement_data["condition_value"]
                result = sql.execute("SELECT count FROM trophies WHERE user_id = ? AND animal = ?", 
                                   (msg.from_user.id, animal_name)).fetchone()
                current = result[0] if result else 0
                progress = f" [{current}/{required_count}]"
                
            elif achievement_data["condition_type"] == "titan_kills":
                titan_animals = []
                for loc in LOCATIONS.values():
                    titan_animals.extend(loc["animals"].get("–¢–∏—Ç–∞–Ω", []))
                titan_kills = 0
                for animal in titan_animals:
                    result = sql.execute("SELECT count FROM trophies WHERE user_id = ? AND animal = ?", 
                                       (msg.from_user.id, animal)).fetchone()
                    if result:
                        titan_kills += result[0]
                progress = f" [{titan_kills}/{achievement_data['condition_value']}]"
                
            elif achievement_data["condition_type"] == "coins":
                progress = f" [{user[1]}/{achievement_data['condition_value']}]"
                
            elif achievement_data["condition_type"] == "location_kills":
                location_name, required_count = achievement_data["condition_value"]
                location_kills = 0
                for animal_data, count in sql.execute("SELECT animal, count FROM trophies WHERE user_id = ?", (msg.from_user.id,)).fetchall():
                    animal = animal_data
                    for loc_name, loc_data in LOCATIONS.items():
                        if loc_name == location_name:
                            for group_animals in loc_data["animals"].values():
                                if animal in group_animals:
                                    location_kills += count
                                    break
                progress = f" [{location_kills}/{required_count}]"
                
            elif achievement_data["condition_type"] == "unique_animals":
                unique_result = sql.execute("SELECT COUNT(DISTINCT animal) FROM trophies WHERE user_id = ?", 
                                          (msg.from_user.id,)).fetchone()
                unique_count = unique_result[0] if unique_result else 0
                progress = f" [{unique_count}/{achievement_data['condition_value']}]"
                
            elif achievement_data["condition_type"] == "streak":
                progress = f" [{user[11] if len(user) > 11 else 0}/{achievement_data['condition_value']}]"
                
            elif achievement_data["condition_type"] == "max_health":
                current_hp, max_hp = get_user_health(msg.from_user.id)
                progress = f" [{max_hp}/{achievement_data['condition_value']}]"
                
            elif achievement_data["condition_type"] == "counterattack_streak":
                progress = f" [{user[16] if len(user) > 16 else 0}/{achievement_data['condition_value']}]"
                
            elif achievement_data["condition_type"] == "titan_escape_streak":
                progress = f" [{user[17] if len(user) > 17 else 0}/{achievement_data['condition_value']}]"
                
            elif achievement_data["condition_type"] == "deaths":
                progress = f" [{user[15] if len(user) > 15 else 0}/{achievement_data['condition_value']}]"
                
            elif achievement_data["condition_type"] == "trap_heavy":
                progress = f" [{user[21] if len(user) > 21 else 0}/{achievement_data['condition_value']}]"
                
            elif achievement_data["condition_type"] == "trap_days_streak":
                progress = f" [{user[18] if len(user) > 18 else 0}/{achievement_data['condition_value']}]"
                
            elif achievement_data["condition_type"] == "hunt_count":
                progress = f" [{user[32] if len(user) > 32 else 0}/{achievement_data['condition_value']}]"
                
            elif achievement_data["condition_type"] == "level":
                level = get_level(user[2])
                progress = f" [{level}/{achievement_data['condition_value']}]"
                
            elif achievement_data["condition_type"] == "all_weapons":
                weapons_result = sql.execute("SELECT COUNT(DISTINCT weapon) FROM user_weapons WHERE user_id = ?", 
                                          (msg.from_user.id,)).fetchone()
                weapons_count = weapons_result[0] if weapons_result else 0
                progress = f" [{weapons_count}/{achievement_data['condition_value']}]"
                
            elif achievement_data["condition_type"] == "all_locations":
                locations_visited = set()
                for animal_data in sql.execute("SELECT animal FROM trophies WHERE user_id = ?", (msg.from_user.id,)).fetchall():
                    animal = animal_data[0]
                    for loc_name, loc_data in LOCATIONS.items():
                        for group_animals in loc_data["animals"].values():
                            if animal in group_animals:
                                locations_visited.add(loc_name)
                                break
                progress = f" [{len(locations_visited)}/{achievement_data['condition_value']}]"
        
        text += f"{status} {achievement_name}{progress}\n"
        text += f"   –£—Å–ª–æ–≤–∏–µ: {achievement_data['description']}\n"
        text += f"   –ù–∞–≥—Ä–∞–¥–∞: {achievement_data['reward_coins']}üí∞"
        if achievement_data['reward_exp'] > 0:
            text += f", {achievement_data['reward_exp']}‚≠ê"
        if achievement_data['title']:
            text += f"\n   –¢–∏—Ç—É–ª: {achievement_data['title']}"
        text += "\n\n"
    
    text += f"üìä –í—ã–ø–æ–ª–Ω–µ–Ω–æ: {len(completed)}/{len(ACHIEVEMENTS)}"
    
    await msg.answer(text)

# ================== –¢–ò–¢–£–õ–´ ==================
@dp.message(lambda msg: msg.text and msg.text.lower() == "—Ç–∏—Ç—É–ª—ã")
async def titles_command(msg: Message):
    user = ensure_user(msg.from_user.id, msg.from_user.username)
    completed = get_completed_achievements(msg.from_user.id)
    current_title = user[9] if len(user) > 9 and user[9] else "‚ùå –ù–µ—Ç"
    
    # –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∏—Ç—É–ª—ã
    available_titles = []
    
    for achievement_name, achievement_data in ACHIEVEMENTS.items():
        if achievement_name in completed and achievement_data['title']:
            available_titles.append({
                'title': achievement_data['title'],
                'achievement_name': achievement_name
            })
    
    if not available_titles:
        text = "üëë –í–∞—à–∏ —Ç–∏—Ç—É–ª—ã\n\n"
        text += "–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ç–∏—Ç—É–ª–æ–≤. –í—ã–ø–æ–ª–Ω—è–π—Ç–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è!\n\n"
        text += "–î–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É: –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è"
        await msg.answer(text)
        return
    
    # –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 2: –ü–∞–≥–∏–Ω–∞—Ü–∏—è: 3 —Ç–∏—Ç—É–ª–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
    page = 0
    titles_per_page = 3
    total_pages = (len(available_titles) + titles_per_page - 1) // titles_per_page
    
    await show_titles_page(msg.from_user.id, available_titles, current_title, page, total_pages, msg)

async def show_titles_page(user_id: int, available_titles: list, current_title: str, page: int, total_pages: int, msg: Message):
    """–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å —Ç–∏—Ç—É–ª–∞–º–∏"""
    titles_per_page = 3
    start_idx = page * titles_per_page
    end_idx = start_idx + titles_per_page
    page_titles = available_titles[start_idx:end_idx]
    
    buttons = []
    
    for title_data in page_titles:
        title = title_data['title']
        if title == current_title:
            buttons.append([InlineKeyboardButton(text=f"‚úÖ {title} (–≤—ã–±—Ä–∞–Ω)", callback_data="no_action")])
        else:
            buttons.append([InlineKeyboardButton(text=f"üëë {title}", 
                callback_data=f"select_title:{user_id}:{title}:{page}")])
    
    # –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    nav_buttons = []
    if page > 0:
        nav_buttons.append(InlineKeyboardButton(text="‚óÄÔ∏è –ù–∞–∑–∞–¥", callback_data=f"titles_page:{user_id}:{page-1}"))
    
    if current_title != "‚ùå –ù–µ—Ç":
        nav_buttons.append(InlineKeyboardButton(text="‚ùå –°–Ω—è—Ç—å —Ç–∏—Ç—É–ª", callback_data=f"remove_title:{user_id}"))
    
    if page < total_pages - 1:
        nav_buttons.append(InlineKeyboardButton(text="–í–ø–µ—Ä–µ–¥ ‚ñ∂Ô∏è", callback_data=f"titles_page:{user_id}:{page+1}"))
    
    if nav_buttons:
        buttons.append(nav_buttons)
    
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
    
    text = f"üëë –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏—Ç—É–ª (—Ç–µ–∫—É—â–∏–π: {current_title})\n"
    text += f"–°—Ç—Ä–∞–Ω–∏—Ü–∞ {page + 1}/{total_pages}"
    
    await msg.answer(text, reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("titles_page:"))
async def titles_page_callback(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, page_str = data_parts[1:]
    page = int(page_str)
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à–µ –º–µ–Ω—é!", show_alert=True)
        return
    
    user = ensure_user(call.from_user.id)
    completed = get_completed_achievements(call.from_user.id)
    current_title = user[9] if len(user) > 9 and user[9] else "‚ùå –ù–µ—Ç"
    
    # –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∏—Ç—É–ª—ã
    available_titles = []
    for achievement_name, achievement_data in ACHIEVEMENTS.items():
        if achievement_name in completed and achievement_data['title']:
            available_titles.append({
                'title': achievement_data['title'],
                'achievement_name': achievement_name
            })
    
    if not available_titles:
        await call.message.edit_text("üëë –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ç–∏—Ç—É–ª–æ–≤.")
        return
    
    titles_per_page = 3
    total_pages = (len(available_titles) + titles_per_page - 1) // titles_per_page
    
    if page >= total_pages:
        page = total_pages - 1
    if page < 0:
        page = 0
    
    await show_titles_page(call.from_user.id, available_titles, current_title, page, total_pages, call.message)

@dp.callback_query(lambda c: c.data.startswith("select_title:"))
async def select_title_callback(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 4:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, title, page_str = data_parts[1:]
    page = int(page_str)
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à —Ç–∏—Ç—É–ª!", show_alert=True)
        return
    
    sql.execute("UPDATE users SET current_title = ? WHERE user_id = ?", (title, call.from_user.id))
    db.commit()
    
    await call.answer(f"‚úÖ –¢–∏—Ç—É–ª –∏–∑–º–µ–Ω—ë–Ω –Ω–∞: {title}", show_alert=True)
    
    # –û–±–Ω–æ–≤–ª—è–µ–º –º–µ–Ω—é
    user = ensure_user(call.from_user.id)
    completed = get_completed_achievements(call.from_user.id)
    current_title = title
    
    available_titles = []
    for achievement_name, achievement_data in ACHIEVEMENTS.items():
        if achievement_name in completed and achievement_data['title']:
            available_titles.append({
                'title': achievement_data['title'],
                'achievement_name': achievement_name
            })
    
    if available_titles:
        titles_per_page = 3
        total_pages = (len(available_titles) + titles_per_page - 1) // titles_per_page
        
        if page >= total_pages:
            page = total_pages - 1
        
        await show_titles_page(call.from_user.id, available_titles, current_title, page, total_pages, call.message)

@dp.callback_query(lambda c: c.data.startswith("remove_title:"))
async def remove_title_callback(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 2:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id = data_parts[1]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à —Ç–∏—Ç—É–ª!", show_alert=True)
        return
    
    sql.execute("UPDATE users SET current_title = '' WHERE user_id = ?", (call.from_user.id,))
    db.commit()
    
    await call.answer("‚úÖ –¢–∏—Ç—É–ª —Å–Ω—è—Ç", show_alert=True)
    
    # –û–±–Ω–æ–≤–ª—è–µ–º –º–µ–Ω—é
    user = ensure_user(call.from_user.id)
    completed = get_completed_achievements(call.from_user.id)
    current_title = "‚ùå –ù–µ—Ç"
    
    available_titles = []
    for achievement_name, achievement_data in ACHIEVEMENTS.items():
        if achievement_name in completed and achievement_data['title']:
            available_titles.append({
                'title': achievement_data['title'],
                'achievement_name': achievement_name
            })
    
    if available_titles:
        titles_per_page = 3
        total_pages = (len(available_titles) + titles_per_page - 1) // titles_per_page
        page = 0
        await show_titles_page(call.from_user.id, available_titles, current_title, page, total_pages, call.message)
    else:
        await call.message.edit_text("üëë –¢–∏—Ç—É–ª —Å–Ω—è—Ç. –£ –≤–∞—Å –±–æ–ª—å—à–µ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–∏—Ç—É–ª–æ–≤.")

@dp.callback_query(lambda c: c.data == "no_action")
async def no_action(call: CallbackQuery):
    await call.answer("‚úÖ –≠—Ç–æ—Ç —Ç–∏—Ç—É–ª —É–∂–µ –≤—ã–±—Ä–∞–Ω", show_alert=True)

# ================== –ü–†–ï–°–¢–ò–ñ ==================
@dp.message(lambda msg: msg.text and msg.text.lower() == "–ø—Ä–µ—Å—Ç–∏–∂")
async def prestige_command(msg: Message):
    user = ensure_user(msg.from_user.id, msg.from_user.username)
    prestige_level = user[10] if len(user) > 10 else 0
    
    if prestige_level >= 10:
        await msg.answer("üéñÔ∏è –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –ø—Ä–µ—Å—Ç–∏–∂–∞ (10)!")
        return
    
    next_prestige = prestige_level + 1
    prestige_data = PRESTIGES.get(next_prestige, {})
    
    if not prestige_data:
        await msg.answer("‚ùå –û—à–∏–±–∫–∞: —Å–ª–µ–¥—É—é—â–∏–π –ø—Ä–µ—Å—Ç–∏–∂ –Ω–µ –Ω–∞–π–¥–µ–Ω")
        return
    
    requirements = prestige_data.get("requirements", {})
    
    text = f"üéñÔ∏è –ü—Ä–µ—Å—Ç–∏–∂ {next_prestige}: {prestige_data['name']}\n\n"
    text += "üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:\n"
    text += f"‚Ä¢ –£—Ä–æ–≤–µ–Ω—å: {requirements.get('level', 0)}+\n"
    text += f"‚Ä¢ –£–±–∏–π—Å—Ç–≤: {requirements.get('kills', 0)}+\n"
    text += f"‚Ä¢ –ú–æ–Ω–µ—Ç: {requirements.get('coins', 0)}+\n"
    
    if "unique_animals" in requirements:
        text += f"‚Ä¢ –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö: {requirements['unique_animals']}+\n"
    if "titans" in requirements:
        text += f"‚Ä¢ –¢–∏—Ç–∞–Ω–æ–≤: {requirements['titans']}+\n"
    if "dangerous" in requirements:
        text += f"‚Ä¢ –û–ø–∞—Å–Ω—ã—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö: {requirements['dangerous']}+\n"
    if "arctic" in requirements:
        text += f"‚Ä¢ –ê—Ä–∫—Ç–∏—á–µ—Å–∫–∏—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö: {requirements['arctic']}+\n"
    if "all_locations" in requirements:
        text += f"‚Ä¢ –ñ–∏–≤–æ—Ç–Ω—ã–µ –∏–∑ –≤—Å–µ—Ö –ª–æ–∫–∞—Ü–∏–π: –î–∞\n"
    if "all_weapons" in requirements:
        text += f"‚Ä¢ –í—Å–µ –≤–∏–¥—ã –æ—Ä—É–∂–∏—è: –î–∞\n"
    if "all_titans" in requirements:
        text += f"‚Ä¢ –ü–æ 5 –∫–∞–∂–¥–æ–≥–æ —Ç–∏—Ç–∞–Ω–∞: –î–∞\n"
    
    text += f"\nüèÜ –í–∞—à —Ç–µ–∫—É—â–∏–π –ø—Ä–µ—Å—Ç–∏–∂: {prestige_level}"
    
    can_prestige, message = check_prestige_requirements(msg.from_user.id, next_prestige)
    
    if can_prestige:
        kb = InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="üéñÔ∏è –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–µ—Å—Ç–∏–∂", callback_data=f"get_prestige:{msg.from_user.id}:{next_prestige}")],
            [InlineKeyboardButton(text="üèÜ –¢–æ–ø –ø–æ –ø—Ä–µ—Å—Ç–∏–∂—É", callback_data=f"top_prestige:{msg.from_user.id}")]
        ])
        text += f"\n\n‚úÖ {message}"
        await msg.answer(text, reply_markup=kb)
    else:
        kb = InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="üèÜ –¢–æ–ø –ø–æ –ø—Ä–µ—Å—Ç–∏–∂—É", callback_data=f"top_prestige:{msg.from_user.id}")]
        ])
        text += f"\n\n‚ùå {message}"
        await msg.answer(text, reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("get_prestige"))
async def get_prestige_callback(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, prestige_level = data_parts[1:]
    prestige_level = int(prestige_level)
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à –ø—Ä–µ—Å—Ç–∏–∂!", show_alert=True)
        return
    
    can_prestige, message = check_prestige_requirements(call.from_user.id, prestige_level)
    
    if not can_prestige:
        await call.answer(f"‚ùå {message}", show_alert=True)
        return
    
    # –í—ã–¥–∞–µ–º –Ω–∞–≥—Ä–∞–¥—ã –∑–∞ –ø—Ä–µ—Å—Ç–∏–∂
    if prestige_level in PRESTIGE_REWARDS:
        reward_data = PRESTIGE_REWARDS[prestige_level]
        
        # –í—ã–¥–∞–µ–º –º–æ–Ω–µ—Ç—ã –∏ –æ–ø—ã—Ç
        coins = reward_data["reward_coins"]
        exp = reward_data["reward_exp"]
        
        sql.execute("UPDATE users SET coins = coins + ?, exp = exp + ?, prestige = ? WHERE user_id = ?", 
                   (coins, exp, prestige_level, call.from_user.id))
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Ç–∏—Ç—É–ª, –µ—Å–ª–∏ –µ–≥–æ –µ—â–µ –Ω–µ—Ç
        current_title = sql.execute("SELECT current_title FROM users WHERE user_id = ?", (call.from_user.id,)).fetchone()[0]
        if not current_title and "title" in reward_data:
            sql.execute("UPDATE users SET current_title = ? WHERE user_id = ?", (reward_data["title"], call.from_user.id))
        
        db.commit()
        
        reward_text = f"üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –ø–æ–ª—É—á–∏–ª–∏ –ø—Ä–µ—Å—Ç–∏–∂ {prestige_level}: {reward_data['name']}\n\n"
        reward_text += f"üéÅ –ù–∞–≥—Ä–∞–¥—ã:\n"
        reward_text += f"‚Ä¢ –ú–æ–Ω–µ—Ç—ã: +{coins}üí∞\n"
        reward_text += f"‚Ä¢ –û–ø—ã—Ç: +{exp}‚≠ê\n"
        
        if "title" in reward_data:
            reward_text += f"‚Ä¢ –¢–∏—Ç—É–ª: {reward_data['title']}\n"
        
        if "bonus" in reward_data:
            bonus_text = ""
            for bonus_type, bonus_value in reward_data["bonus"].items():
                if bonus_type == "exp_bonus":
                    bonus_text += f"‚Ä¢ +{bonus_value}% –∫ –æ–ø—ã—Ç—É\n"
                elif bonus_type == "coins_bonus":
                    bonus_text += f"‚Ä¢ +{bonus_value}% –∫ –º–æ–Ω–µ—Ç–∞–º\n"
                elif bonus_type == "collectible_chance":
                    bonus_text += f"‚Ä¢ +{bonus_value}% –∫ —à–∞–Ω—Å—É –∫–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤\n"
                elif bonus_type == "titan_hit":
                    bonus_text += f"‚Ä¢ +{bonus_value}% –∫ —à–∞–Ω—Å—É –ø–æ–ø–∞–¥–∞–Ω–∏—è –ø–æ —Ç–∏—Ç–∞–Ω–∞–º\n"
                elif bonus_type == "discount":
                    bonus_text += f"‚Ä¢ –°–∫–∏–¥–∫–∞ {bonus_value}% –Ω–∞ –ø–æ–∫—É–ø–∫–∏\n"
                elif bonus_type == "healing_bonus":
                    bonus_text += f"‚Ä¢ +{bonus_value}% –∫ —Å–∫–æ—Ä–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è HP\n"
                elif bonus_type == "all_bonus":
                    bonus_text += f"‚Ä¢ –í—Å–µ –±–æ–Ω—É—Å—ã —É—Å–∏–ª–µ–Ω—ã –Ω–∞ {bonus_value}%\n"
            
            if bonus_text:
                reward_text += f"\nüìà –ü–µ—Ä–º–∞–Ω–µ–Ω—Ç–Ω—ã–µ –±–æ–Ω—É—Å—ã:\n{bonus_text}"
        
        if "special" in reward_data:
            special = reward_data["special"]
            if special == "golden_bullet:5":
                sql.execute("UPDATE users SET golden_bullet = golden_bullet + 5 WHERE user_id = ?", (call.from_user.id,))
                reward_text += f"\nüí´ –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞: 5 –∑–æ–ª–æ—Ç—ã—Ö –ø—É–ª—å!\n"
        
        await call.message.edit_text(reward_text)
    else:
        sql.execute("UPDATE users SET prestige = ? WHERE user_id = ?", (prestige_level, call.from_user.id))
        db.commit()
        await call.message.edit_text(f"üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –ø–æ–ª—É—á–∏–ª–∏ –ø—Ä–µ—Å—Ç–∏–∂ {prestige_level}: {PRESTIGES[prestige_level].get('name', '')}")

@dp.callback_query(lambda c: c.data.startswith("top_prestige"))
async def top_prestige_callback(call: CallbackQuery):
    user_id = call.data.split(":")[1]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à —Ç–æ–ø!", show_alert=True)
        return
    
    top_users = sql.execute(
        "SELECT username, prestige FROM users WHERE username IS NOT NULL AND prestige > 0 ORDER BY prestige DESC, exp DESC LIMIT 10"
    ).fetchall()
    
    if not top_users:
        await call.message.edit_text("üèÜ –ü–æ–∫–∞ –Ω–∏–∫—Ç–æ –Ω–µ –ø–æ–ª—É—á–∏–ª –ø—Ä–µ—Å—Ç–∏–∂.")
        return
    
    text = "üèÜ –¢–æ–ø –ø–æ –ø—Ä–µ—Å—Ç–∏–∂—É:\n\n"
    for i, (username, prestige) in enumerate(top_users, 1):
        prestige_name = PRESTIGES.get(prestige, {}).get("name", f"–ü—Ä–µ—Å—Ç–∏–∂ {prestige}")
        text += f"{i}. @{username} ‚Äî {prestige_name}\n"
    
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"prestige_back:{call.from_user.id}")]
    ])
    
    await call.message.edit_text(text, reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("prestige_back"))
async def prestige_back(call: CallbackQuery):
    user_id = call.data.split(":")[1]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à–µ –º–µ–Ω—é!", show_alert=True)
        return
    
    user = ensure_user(call.from_user.id)
    prestige_level = user[10] if len(user) > 10 else 0
    
    if prestige_level >= 10:
        await call.message.edit_text("üéñÔ∏è –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –ø—Ä–µ—Å—Ç–∏–∂–∞ (10)!")
        return
    
    next_prestige = prestige_level + 1
    prestige_data = PRESTIGES.get(next_prestige, {})
    
    if not prestige_data:
        await call.message.edit_text("‚ùå –û—à–∏–±–∫–∞: —Å–ª–µ–¥—É—é—â–∏–π –ø—Ä–µ—Å—Ç–∏–∂ –Ω–µ –Ω–∞–π–¥–µ–Ω")
        return
    
    requirements = prestige_data.get("requirements", {})
    
    text = f"üéñÔ∏è –ü—Ä–µ—Å—Ç–∏–∂ {next_prestige}: {prestige_data['name']}\n\n"
    text += "üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:\n"
    text += f"‚Ä¢ –£—Ä–æ–≤–µ–Ω—å: {requirements.get('level', 0)}+\n"
    text += f"‚Ä¢ –£–±–∏–π—Å—Ç–≤: {requirements.get('kills', 0)}+\n"
    text += f"‚Ä¢ –ú–æ–Ω–µ—Ç: {requirements.get('coins', 0)}+\n"
    
    if "unique_animals" in requirements:
        text += f"‚Ä¢ –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö: {requirements['unique_animals']}+\n"
    if "titans" in requirements:
        text += f"‚Ä¢ –¢–∏—Ç–∞–Ω–æ–≤: {requirements['titans']}+\n"
    if "dangerous" in requirements:
        text += f"‚Ä¢ –û–ø–∞—Å–Ω—ã—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö: {requirements['dangerous']}+\n"
    if "arctic" in requirements:
        text += f"‚Ä¢ –ê—Ä–∫—Ç–∏—á–µ—Å–∫–∏—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö: {requirements['arctic']}+\n"
    if "all_locations" in requirements:
        text += f"‚Ä¢ –ñ–∏–≤–æ—Ç–Ω—ã–µ –∏–∑ –≤—Å–µ—Ö –ª–æ–∫–∞—Ü–∏–π: –î–∞\n"
    if "all_weapons" in requirements:
        text += f"‚Ä¢ –í—Å–µ –≤–∏–¥—ã –æ—Ä—É–∂–∏—è: –î–∞\n"
    if "all_titans" in requirements:
        text += f"‚Ä¢ –ü–æ 5 –∫–∞–∂–¥–æ–≥–æ —Ç–∏—Ç–∞–Ω–∞: –î–∞\n"
    
    text += f"\nüèÜ –í–∞—à —Ç–µ–∫—É—â–∏–π –ø—Ä–µ—Å—Ç–∏–∂: {prestige_level}"
    
    can_prestige, message = check_prestige_requirements(call.from_user.id, next_prestige)
    
    if can_prestige:
        kb = InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="üéñÔ∏è –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–µ—Å—Ç–∏–∂", callback_data=f"get_prestige:{call.from_user.id}:{next_prestige}")],
            [InlineKeyboardButton(text="üèÜ –¢–æ–ø –ø–æ –ø—Ä–µ—Å—Ç–∏–∂—É", callback_data=f"top_prestige:{call.from_user.id}")]
        ])
        text += f"\n\n‚úÖ {message}"
        await call.message.edit_text(text, reply_markup=kb)
    else:
        kb = InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="üèÜ –¢–æ–ø –ø–æ –ø—Ä–µ—Å—Ç–∏–∂—É", callback_data=f"top_prestige:{call.from_user.id}")]
        ])
        text += f"\n\n‚ùå {message}"
        await call.message.edit_text(text, reply_markup=kb)

# ================== –ú–ê–ì–ê–ó–ò–ù ==================
@dp.message(lambda msg: msg.text and msg.text.lower() == "–º–∞–≥–∞–∑–∏–Ω")
async def shop(msg: Message):
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üî´ –û—Ä—É–∂–∏–µ", callback_data=f"shop_weapons:{msg.from_user.id}")],
        [InlineKeyboardButton(text="üé© –°–Ω–∞—Ä—è–∂–µ–Ω–∏–µ", callback_data=f"shop_equipment:{msg.from_user.id}")],
        [InlineKeyboardButton(text="‚ö° –ë–∞—Ñ—Ñ—ã", callback_data=f"shop_buffs:{msg.from_user.id}")],
        [InlineKeyboardButton(text="üõ°Ô∏è –í—ã–∂–∏–≤–∞–Ω–∏–µ", callback_data=f"shop_survival:{msg.from_user.id}")]
    ])
    await msg.answer("–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:", reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("shop_weapons"))
async def shop_weapons(call: CallbackQuery):
    user_id = call.data.split(":")[1]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à –º–∞–≥–∞–∑–∏–Ω!", show_alert=True)
        return
    
    user = ensure_user(call.from_user.id)
    
    buttons = []
    for weapon, price in WEAPON_PRICES.items():
        owned = sql.execute("SELECT 1 FROM user_weapons WHERE user_id = ? AND weapon = ?", 
                          (call.from_user.id, weapon)).fetchone()
        status = "‚úÖ " if owned else ""
        buttons.append([InlineKeyboardButton(
            text=f"{status}{weapon} ‚Äî {price}üí∞",
            callback_data=f"view_weapon:{call.from_user.id}:{weapon}"
        )])
    
    buttons.append([InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"shop_back:{call.from_user.id}")])
    
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
    await call.message.edit_text(f"üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å: {user[1]} –º–æ–Ω–µ—Ç\n\nüî´ –í—ã–±–µ—Ä–∏—Ç–µ –æ—Ä—É–∂–∏–µ:", reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("view_weapon"))
async def view_weapon(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, weapon = data_parts[1:]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à –º–∞–≥–∞–∑–∏–Ω!", show_alert=True)
        return
    
    if weapon not in WEAPONS:
        await call.message.edit_text("‚ùå –≠—Ç–æ –æ—Ä—É–∂–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.")
        return
    
    weapon_data = WEAPONS[weapon]
    user = ensure_user(call.from_user.id)
    price = WEAPON_PRICES.get(weapon, 0)
    
    owned = sql.execute("SELECT 1 FROM user_weapons WHERE user_id = ? AND weapon = ?", 
                       (call.from_user.id, weapon)).fetchone()
    
    chances = weapon_data["chances"]
    description = weapon_data["description"]
    
    if owned:
        kb = InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="‚úÖ –£–∂–µ –∫—É–ø–ª–µ–Ω–æ", callback_data="no_action")],
            [InlineKeyboardButton(text="üîÑ –í—ã–±—Ä–∞—Ç—å –æ—Ä—É–∂–∏–µ", callback_data=f"select_weapon:{call.from_user.id}:{weapon}")],
            [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"shop_weapons:{call.from_user.id}")]
        ])
        status_text = "‚úÖ –≠—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç —É–∂–µ –∫—É–ø–ª–µ–Ω"
    else:
        kb = InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text=f"üí∞ –ö—É–ø–∏—Ç—å –∑–∞ {price} –º–æ–Ω–µ—Ç", callback_data=f"buy_weapon:{call.from_user.id}:{weapon}")],
            [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"shop_weapons:{call.from_user.id}")]
        ])
        status_text = f"üí≥ –í–∞—à –±–∞–ª–∞–Ω—Å: {user[1]} –º–æ–Ω–µ—Ç\n{'‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤' if user[1] < price else '‚úÖ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤'}"
    
    await call.message.edit_text(
        f"üî´ {weapon}\n\n"
        f"üìù –û–ø–∏—Å–∞–Ω–∏–µ: {description}\n"
        f"üéØ –®–∞–Ω—Å—ã –ø–æ–ø–∞–¥–∞–Ω–∏—è:\n"
        f"‚Ä¢ –ú–µ–ª–æ—á—å: {chances[0]}%\n"
        f"‚Ä¢ –°—Ä–µ–¥–Ω: {chances[1]}%\n"
        f"‚Ä¢ –û–ø–∞—Å–Ω: {chances[2]}%\n"
        f"‚Ä¢ –¢—è–∂–µ–ª: {chances[3]}%\n"
        f"‚Ä¢ –¢–∏—Ç–∞–Ω: {chances[4]}%\n\n"
        f"üí∞ –¶–µ–Ω–∞: {price} –º–æ–Ω–µ—Ç\n"
        f"{status_text}",
        reply_markup=kb
    )

@dp.callback_query(lambda c: c.data.startswith("select_weapon"))
async def select_weapon(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, weapon = data_parts[1:]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à –º–∞–≥–∞–∑–∏–Ω!", show_alert=True)
        return
    
    sql.execute("UPDATE users SET weapon = ? WHERE user_id = ?", (weapon, call.from_user.id))
    db.commit()
    
    await call.message.edit_text(f"üîÑ –í—ã –≤—ã–±—Ä–∞–ª–∏ –æ—Ä—É–∂–∏–µ: {weapon}")

@dp.callback_query(lambda c: c.data.startswith("buy_weapon"))
async def buy_weapon(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, weapon = data_parts[1:]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à–∞ –ø–æ–∫—É–ø–∫–∞!", show_alert=True)
        return
    
    user = ensure_user(call.from_user.id)
    
    owned = sql.execute("SELECT 1 FROM user_weapons WHERE user_id = ? AND weapon = ?", 
                       (call.from_user.id, weapon)).fetchone()

    if owned:
        await call.message.edit_text("‚úÖ –í—ã —É–∂–µ –∫—É–ø–∏–ª–∏ —ç—Ç–æ –æ—Ä—É–∂–∏–µ!")
        return

    price = WEAPON_PRICES.get(weapon, 0)
    if user[1] < price:
        await call.message.edit_text("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç.")
        return

    # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="‚úÖ –î–∞, –∫—É–ø–∏—Ç—å", callback_data=f"confirm_buy_weapon:{call.from_user.id}:{weapon}")],
        [InlineKeyboardButton(text="‚ùå –û—Ç–º–µ–Ω–∞", callback_data=f"view_weapon:{call.from_user.id}:{weapon}")]
    ])
    
    await call.message.edit_text(
        f"‚ùì –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∫—É–ø–∏—Ç—å {weapon} –∑–∞ {price} –º–æ–Ω–µ—Ç?\n\n"
        f"üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å: {user[1]} –º–æ–Ω–µ—Ç\n"
        f"üí∞ –ü–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏: {user[1] - price} –º–æ–Ω–µ—Ç",
        reply_markup=kb
    )

@dp.callback_query(lambda c: c.data.startswith("confirm_buy_weapon"))
async def confirm_buy_weapon(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, weapon = data_parts[1:]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à–∞ –ø–æ–∫—É–ø–∫–∞!", show_alert=True)
        return
    
    user = ensure_user(call.from_user.id)
    price = WEAPON_PRICES.get(weapon, 0)
    
    if user[1] < price:
        await call.message.edit_text("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç.")
        return

    sql.execute("UPDATE users SET coins = coins - ? WHERE user_id = ?", (price, call.from_user.id))
    sql.execute("INSERT OR IGNORE INTO user_weapons VALUES (?, ?)", (call.from_user.id, weapon))
    sql.execute("UPDATE users SET weapon = ? WHERE user_id = ?", (weapon, call.from_user.id))
    db.commit()

    await call.message.edit_text(f"‚úÖ –í—ã –∫—É–ø–∏–ª–∏ {weapon} –∑–∞ {price} –º–æ–Ω–µ—Ç –∏ –≤—ã–±—Ä–∞–ª–∏ –µ–≥–æ!")

@dp.callback_query(lambda c: c.data.startswith("shop_equipment"))
async def shop_equipment(call: CallbackQuery):
    user_id = call.data.split(":")[1]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à –º–∞–≥–∞–∑–∏–Ω!", show_alert=True)
        return
    
    user = ensure_user(call.from_user.id)
    owned_equipment = get_user_equipment(call.from_user.id)
    
    buttons = []
    for eq_name, eq_data in EQUIPMENT.items():
        owned = "‚úÖ " if eq_name in owned_equipment else ""
        buttons.append([InlineKeyboardButton(
            text=f"{owned}{eq_name} ‚Äî {eq_data['price']}üí∞",
            callback_data=f"view_eq:{call.from_user.id}:{eq_name}"
        )])
    
    buttons.append([InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"shop_back:{call.from_user.id}")])
    
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
    await call.message.edit_text(f"üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å: {user[1]} –º–æ–Ω–µ—Ç\n\nüé© –í—ã–±–µ—Ä–∏—Ç–µ —Å–Ω–∞—Ä—è–∂–µ–Ω–∏–µ:", reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("view_eq"))
async def view_equipment(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, eq_name = data_parts[1:]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à –º–∞–≥–∞–∑–∏–Ω!", show_alert=True)
        return
    
    if eq_name not in EQUIPMENT:
        await call.message.edit_text("‚ùå –≠—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω.")
        return
    
    eq_data = EQUIPMENT[eq_name]
    user = ensure_user(call.from_user.id)
    owned_equipment = get_user_equipment(call.from_user.id)
    
    if eq_name in owned_equipment:
        kb = InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="‚úÖ –£–∂–µ –∫—É–ø–ª–µ–Ω–æ", callback_data="no_action")],
            [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"shop_equipment:{call.from_user.id}")]
        ])
        status_text = "‚úÖ –≠—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç —É–∂–µ –∫—É–ø–ª–µ–Ω"
    else:
        kb = InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text=f"üí∞ –ö—É–ø–∏—Ç—å –∑–∞ {eq_data['price']} –º–æ–Ω–µ—Ç", callback_data=f"buy_eq:{call.from_user.id}:{eq_name}")],
            [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"shop_equipment:{call.from_user.id}")]
        ])
        status_text = f"üí≥ –í–∞—à –±–∞–ª–∞–Ω—Å: {user[1]} –º–æ–Ω–µ—Ç\n{'‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤' if user[1] < eq_data['price'] else '‚úÖ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤'}"
    
    await call.message.edit_text(
        f"üé© {eq_name}\n\n"
        f"üìù –û–ø–∏—Å–∞–Ω–∏–µ: {eq_data['description']}\n\n"
        f"üí∞ –¶–µ–Ω–∞: {eq_data['price']} –º–æ–Ω–µ—Ç\n"
        f"{status_text}",
        reply_markup=kb
    )

@dp.callback_query(lambda c: c.data.startswith("buy_eq"))
async def buy_equipment(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, eq_name = data_parts[1:]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à–∞ –ø–æ–∫—É–ø–∫–∞!", show_alert=True)
        return
    
    if eq_name not in EQUIPMENT:
        await call.message.edit_text("‚ùå –≠—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω.")
        return
    
    eq_data = EQUIPMENT[eq_name]
    user = ensure_user(call.from_user.id)
    
    owned = sql.execute("SELECT 1 FROM user_equipment WHERE user_id = ? AND equipment = ?",
                       (call.from_user.id, eq_name)).fetchone()
    
    if owned:
        await call.message.edit_text("‚úÖ –í—ã —É–∂–µ –∫—É–ø–∏–ª–∏ —ç—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç!")
        return
    
    if user[1] < eq_data['price']:
        await call.message.edit_text("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç.")
        return
    
    # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="‚úÖ –î–∞, –∫—É–ø–∏—Ç—å", callback_data=f"confirm_buy_eq:{call.from_user.id}:{eq_name}")],
        [InlineKeyboardButton(text="‚ùå –û—Ç–º–µ–Ω–∞", callback_data=f"view_eq:{call.from_user.id}:{eq_name}")]
    ])
    
    await call.message.edit_text(
        f"‚ùì –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∫—É–ø–∏—Ç—å {eq_name} –∑–∞ {eq_data['price']} –º–æ–Ω–µ—Ç?\n\n"
        f"üìù {eq_data['description']}\n\n"
        f"üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å: {user[1]} –º–æ–Ω–µ—Ç\n"
        f"üí∞ –ü–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏: {user[1] - eq_data['price']} –º–æ–Ω–µ—Ç",
        reply_markup=kb
    )

@dp.callback_query(lambda c: c.data.startswith("confirm_buy_eq"))
async def confirm_buy_eq(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, eq_name = data_parts[1:]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à–∞ –ø–æ–∫—É–ø–∫–∞!", show_alert=True)
        return
    
    if eq_name not in EQUIPMENT:
        await call.message.edit_text("‚ùå –≠—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω.")
        return
    
    eq_data = EQUIPMENT[eq_name]
    user = ensure_user(call.from_user.id)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫—É–ø–ª–µ–Ω –ª–∏ —É–∂–µ –ø—Ä–µ–¥–º–µ—Ç
    owned = sql.execute("SELECT 1 FROM user_equipment WHERE user_id = ? AND equipment = ?",
                       (call.from_user.id, eq_name)).fetchone()
    
    if owned:
        await call.message.edit_text("‚úÖ –í—ã —É–∂–µ –∫—É–ø–∏–ª–∏ —ç—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç!")
        return
    
    if user[1] < eq_data['price']:
        await call.message.edit_text("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç.")
        return
    
    # –ü–û–ö–£–ü–ö–ê
    sql.execute("UPDATE users SET coins = coins - ? WHERE user_id = ?",
               (eq_data['price'], call.from_user.id))
    sql.execute("INSERT INTO user_equipment VALUES (?, ?)",
               (call.from_user.id, eq_name))
    db.commit()
    
    # –û–±–Ω–æ–≤–ª—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ –µ—Å–ª–∏ —ç—Ç–æ —Ä—é–∫–∑–∞–∫
    if "–†—é–∫–∑–∞–∫" in eq_name:
        update_max_health(call.from_user.id)
    
    await call.message.edit_text(f"‚úÖ –í—ã –∫—É–ø–∏–ª–∏ {eq_name}!\n\n{eq_data['description']}\n\n–ë–æ–Ω—É—Å—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.")

@dp.callback_query(lambda c: c.data.startswith("shop_buffs"))
async def shop_buffs(call: CallbackQuery):
    user_id = call.data.split(":")[1]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à –º–∞–≥–∞–∑–∏–Ω!", show_alert=True)
        return
    
    user = ensure_user(call.from_user.id)
    
    buttons = []
    for buff_name, buff_data in BUFFS.items():
        buttons.append([InlineKeyboardButton(
            text=f"{buff_name} ‚Äî {buff_data['price']}üí∞",
            callback_data=f"view_buff:{call.from_user.id}:{buff_name}"
        )])
    
    buttons.append([InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"shop_back:{call.from_user.id}")])
    
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
    await call.message.edit_text(f"üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å: {user[1]} –º–æ–Ω–µ—Ç\n\n‚ö° –í—ã–±–µ—Ä–∏—Ç–µ –±–∞—Ñ—Ñ:", reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("view_buff"))
async def view_buff(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, buff_name = data_parts[1:]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à –º–∞–≥–∞–∑–∏–Ω!", show_alert=True)
        return
    
    if buff_name not in BUFFS:
        await call.message.edit_text("‚ùå –≠—Ç–æ—Ç –±–∞—Ñ—Ñ –Ω–µ –Ω–∞–π–¥–µ–Ω.")
        return
    
    buff_data = BUFFS[buff_name]
    user = ensure_user(call.from_user.id)
    
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text=f"üí∞ –ö—É–ø–∏—Ç—å –∑–∞ {buff_data['price']} –º–æ–Ω–µ—Ç", callback_data=f"buy_buff:{call.from_user.id}:{buff_name}")],
        [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"shop_buffs:{call.from_user.id}")]
    ])
    
    status_text = f"üí≥ –í–∞—à –±–∞–ª–∞–Ω—Å: {user[1]} –º–æ–Ω–µ—Ç\n{'‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤' if user[1] < buff_data['price'] else '‚úÖ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤'}"
    
    await call.message.edit_text(
        f"‚ö° {buff_name}\n\n"
        f"üìù –û–ø–∏—Å–∞–Ω–∏–µ: {buff_data['description']}\n\n"
        f"üí∞ –¶–µ–Ω–∞: {buff_data['price']} –º–æ–Ω–µ—Ç\n"
        f"{status_text}",
        reply_markup=kb
    )

@dp.callback_query(lambda c: c.data.startswith("buy_buff"))
async def buy_buff(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, buff_name = data_parts[1:]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à–∞ –ø–æ–∫—É–ø–∫–∞!", show_alert=True)
        return
    
    if buff_name not in BUFFS:
        await call.message.edit_text("‚ùå –≠—Ç–æ—Ç –±–∞—Ñ—Ñ –Ω–µ –Ω–∞–π–¥–µ–Ω.")
        return
    
    buff_data = BUFFS[buff_name]
    user = ensure_user(call.from_user.id)
    
    if user[1] < buff_data['price']:
        await call.message.edit_text("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç.")
        return
    
    # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="‚úÖ –î–∞, –∫—É–ø–∏—Ç—å", callback_data=f"confirm_buy_buff:{call.from_user.id}:{buff_name}")],
        [InlineKeyboardButton(text="‚ùå –û—Ç–º–µ–Ω–∞", callback_data=f"view_buff:{call.from_user.id}:{buff_name}")]
    ])
    
    await call.message.edit_text(
        f"‚ùì –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∫—É–ø–∏—Ç—å {buff_name} –∑–∞ {buff_data['price']} –º–æ–Ω–µ—Ç?\n\n"
        f"üìù {buff_data['description']}\n\n"
        f"üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å: {user[1]} –º–æ–Ω–µ—Ç\n"
        f"üí∞ –ü–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏: {user[1] - buff_data['price']} –º–æ–Ω–µ—Ç",
        reply_markup=kb
    )

@dp.callback_query(lambda c: c.data.startswith("confirm_buy_buff"))
async def confirm_buy_buff(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, buff_name = data_parts[1:]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à–∞ –ø–æ–∫—É–ø–∫–∞!", show_alert=True)
        return
    
    if buff_name not in BUFFS:
        await call.message.edit_text("‚ùå –≠—Ç–æ—Ç –±–∞—Ñ—Ñ –Ω–µ –Ω–∞–π–¥–µ–Ω.")
        return
    
    buff_data = BUFFS[buff_name]
    user = ensure_user(call.from_user.id)
    
    if user[1] < buff_data['price']:
        await call.message.edit_text("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç.")
        return
    
    # –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç –±–∞—Ñ—Ñ–∞
    effect_text = ""
    
    if buff_data['effect'] == "full_heal":
        heal_user(call.from_user.id)
        effect_text = "‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!"
    
    elif buff_data['effect'] == "golden_bullet":
        sql.execute("UPDATE users SET golden_bullet = 1 WHERE user_id = ?", (call.from_user.id,))
        effect_text = "üí´ –ó–æ–ª–æ—Ç–∞—è –ø—É–ª—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞! –°–ª–µ–¥—É—é—â–∏–π –≤—ã—Å—Ç—Ä–µ–ª –±—É–¥–µ—Ç —Å x2 —à–∞–Ω—Å–æ–º –ø–æ–ø–∞–¥–∞–Ω–∏—è."
    
    elif buff_data['effect'] == "drone":
        # –î—Ä–æ–Ω - –Ω–∞—Ö–æ–¥–∏–º 3 –∂–∏–≤–æ—Ç–Ω—ã—Ö –Ω–∞ –≤—ã–±–æ—Ä
        user_data = ensure_user(call.from_user.id)
        location = user_data[4]
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º 3 –∂–∏–≤–æ—Ç–Ω—ã—Ö –ø–æ –∑–∞–¥–∞–Ω–Ω—ã–º —à–∞–Ω—Å–∞–º
        found_animals = []
        for _ in range(3):
            rand = random.randint(1, 1000)  # –î–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏ –¥–æ 0.1%
            if rand <= 600:  # 60% - –°—Ä–µ–¥–Ω
                group = "–°—Ä–µ–¥–Ω"
            elif rand <= 950:  # 35% - –û–ø–∞—Å–Ω (600+350=950)
                group = "–û–ø–∞—Å–Ω"
            elif rand <= 999:  # 4.9% - –¢—è–∂–µ–ª (950+49=999)
                group = "–¢—è–∂–µ–ª"
            else:  # 0.1% - –¢–∏—Ç–∞–Ω
                group = "–¢–∏—Ç–∞–Ω"
            
            if group in LOCATIONS[location]["animals"] and LOCATIONS[location]["animals"][group]:
                animal = random.choice(LOCATIONS[location]["animals"][group])
                found_animals.append((group, animal))
        
        # –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞
        buttons = []
        for i, (group, animal) in enumerate(found_animals):
            buttons.append([InlineKeyboardButton(
                text=f"{animal} ({group})",
                callback_data=f"select_drone:{call.from_user.id}:{animal}"
            )])
        
        kb = InlineKeyboardMarkup(inline_keyboard=buttons)
        
        sql.execute("UPDATE users SET coins = coins - ? WHERE user_id = ?",
                   (buff_data['price'], call.from_user.id))
        db.commit()
        
        await call.message.edit_text(
            "üõ∏ –î—Ä–æ–Ω –∑–∞–ø—É—â–µ–Ω! –ù–∞–π–¥–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –∂–∏–≤–æ—Ç–Ω—ã–µ:\n\n"
            "–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω–æ –∂–∏–≤–æ—Ç–Ω–æ–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è (+10% —à–∞–Ω—Å –Ω–∞–π—Ç–∏ –µ–≥–æ –≤ —Ç–µ—á–µ–Ω–∏–µ 30 –º–∏–Ω—É—Ç):",
            reply_markup=kb
        )
        return
    
    elif buff_data['effect'] == "immortality_staff":
        sql.execute("UPDATE users SET immortality_staff = 1 WHERE user_id = ?", (call.from_user.id,))
        effect_text = "ü™Ñ –ü–æ—Å–æ—Ö –±–µ—Å—Å–º–µ—Ä—Ç–∏—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –í—ã –∑–∞—â–∏—â–µ–Ω—ã –æ—Ç –∫–æ–Ω—Ç—Ä–∞—Ç–∞–∫–∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ –∂–∏–≤–æ—Ç–Ω–æ–≥–æ."
    
    elif buff_data['effect'] == "diamond_bullet":
        sql.execute("UPDATE users SET diamond_bullet = 1 WHERE user_id = ?", (call.from_user.id,))
        effect_text = "üíé –ê–ª–º–∞–∑–Ω–∞—è –ø—É–ª—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞! +20% –∫ —à–∞–Ω—Å—É –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ —Å–ª–µ–¥—É—é—â–µ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ."
    
    sql.execute("UPDATE users SET coins = coins - ? WHERE user_id = ?",
               (buff_data['price'], call.from_user.id))
    db.commit()
    
    await call.message.edit_text(f"‚úÖ –í—ã –∫—É–ø–∏–ª–∏ {buff_name}!\n\n{effect_text}")

@dp.callback_query(lambda c: c.data.startswith("select_drone"))
async def select_drone_target(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, animal = data_parts[1:]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à –≤—ã–±–æ—Ä!", show_alert=True)
        return
    
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–µ–ª—å –¥—Ä–æ–Ω–∞ –Ω–∞ 30 –º–∏–Ω—É—Ç
    expires_at = int(time.time()) + 1800  # 30 –º–∏–Ω—É—Ç
    
    sql.execute("UPDATE users SET drone_target = ?, drone_expires = ? WHERE user_id = ?",
               (animal, expires_at, call.from_user.id))
    db.commit()
    
    await call.message.edit_text(f"‚úÖ –î—Ä–æ–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ {animal}!\n\n"
                               f"üìà +10% —à–∞–Ω—Å –Ω–∞–π—Ç–∏ —ç—Ç–æ –∂–∏–≤–æ—Ç–Ω–æ–µ –≤ —Ç–µ—á–µ–Ω–∏–µ 30 –º–∏–Ω—É—Ç.")

@dp.callback_query(lambda c: c.data.startswith("shop_survival"))
async def shop_survival(call: CallbackQuery):
    user_id = call.data.split(":")[1]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à –º–∞–≥–∞–∑–∏–Ω!", show_alert=True)
        return
    
    user = ensure_user(call.from_user.id)
    level = get_level(user[2])
    
    buttons = []
    
    for location_name, location_data in LOCATIONS.items():
        if can_use_location(level, location_name):
            buttons.append([InlineKeyboardButton(
                text=f"üìç {location_name} (—É—Ä. {location_data['level']}+)",
                callback_data=f"survival_location:{call.from_user.id}:{location_name}"
            )])
        else:
            buttons.append([InlineKeyboardButton(
                text=f"üîí {location_name} (—É—Ä. {location_data['level']}+)",
                callback_data="no_action"
            )])
    
    buttons.append([InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"shop_back:{call.from_user.id}")])
    
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
    await call.message.edit_text(f"üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å: {user[1]} –º–æ–Ω–µ—Ç\n\nüõ°Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ –ª–æ–∫–∞—Ü–∏—é –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –≤—ã–∂–∏–≤–∞–Ω–∏—è:", reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("survival_location"))
async def survival_location(call: CallbackQuery):
    data_parts = call.data.split(":")[1:]
    if len(data_parts) < 2:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, location_name = data_parts
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à –º–∞–≥–∞–∑–∏–Ω!", show_alert=True)
        return
    
    user = ensure_user(call.from_user.id)
    level = get_level(user[2])
    
    if not can_use_location(level, location_name):
        await call.answer(f"‚ùå –≠—Ç–∞ –ª–æ–∫–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Å —É—Ä–æ–≤–Ω—è {LOCATIONS[location_name]['level']}!", show_alert=True)
        return
    
    # –ü–æ–ª—É—á–∞–µ–º –ø—Ä–µ–¥–º–µ—Ç—ã –¥–ª—è —ç—Ç–æ–π –ª–æ–∫–∞—Ü–∏–∏
    location_items = {}
    for item_name, item_data in SURVIVAL_ITEMS.items():
        if item_data["location"] == location_name:
            location_items[item_name] = item_data
    
    if not location_items:
        await call.message.edit_text(f"‚ùå –î–ª—è –ª–æ–∫–∞—Ü–∏–∏ {location_name} –Ω–µ—Ç –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –≤—ã–∂–∏–≤–∞–Ω–∏—è.")
        return
    
    buttons = []
    
    for item_name, item_data in location_items.items():
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ç–∞–∫–æ–π –ø—Ä–µ–¥–º–µ—Ç —É –∏–≥—Ä–æ–∫–∞
        has_item = sql.execute(
            "SELECT 1 FROM survival_items WHERE user_id = ? AND item_name = ?",
            (call.from_user.id, item_name)
        ).fetchone()
        
        if has_item:
            status = "‚úÖ "
        else:
            status = ""
        
        buttons.append([InlineKeyboardButton(
            text=f"{status}{item_name} ‚Äî {item_data['price']}üí∞",
            callback_data=f"view_survival:{call.from_user.id}:{item_name}"
        )])
    
    buttons.append([InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"shop_survival:{call.from_user.id}")])
    
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
    await call.message.edit_text(f"üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å: {user[1]} –º–æ–Ω–µ—Ç\n\nüõ°Ô∏è –ü—Ä–µ–¥–º–µ—Ç—ã –¥–ª—è –≤—ã–∂–∏–≤–∞–Ω–∏—è –≤ {location_name}:", reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("view_survival"))
async def view_survival(call: CallbackQuery):
    data_parts = call.data.split(":")[1:]
    if len(data_parts) < 2:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, item_name = data_parts
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à –º–∞–≥–∞–∑–∏–Ω!", show_alert=True)
        return
    
    if item_name not in SURVIVAL_ITEMS:
        await call.message.edit_text("‚ùå –≠—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω.")
        return
    
    item_data = SURVIVAL_ITEMS[item_name]
    user = ensure_user(call.from_user.id)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ç–∞–∫–æ–π –ø—Ä–µ–¥–º–µ—Ç —É –∏–≥—Ä–æ–∫–∞
    has_item = sql.execute(
        "SELECT 1 FROM survival_items WHERE user_id = ? AND item_name = ?",
        (call.from_user.id, item_name)
    ).fetchone()
    
    if has_item:
        kb = InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="‚úÖ –£–∂–µ –∫—É–ø–ª–µ–Ω–æ", callback_data="no_action")],
            [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"survival_location:{call.from_user.id}:{item_data['location']}")]
        ])
        status_text = "‚úÖ –£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å —ç—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç"
    else:
        kb = InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text=f"üí∞ –ö—É–ø–∏—Ç—å –∑–∞ {item_data['price']}üí∞", callback_data=f"buy_survival:{call.from_user.id}:{item_name}")],
            [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"survival_location:{call.from_user.id}:{item_data['location']}")]
        ])
        status_text = f"üí≥ –í–∞—à –±–∞–ª–∞–Ω—Å: {user[1]} –º–æ–Ω–µ—Ç\n{'‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤' if user[1] < item_data['price'] else '‚úÖ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤'}"
    
    description = item_data.get('description', '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è')
    location = item_data.get('location', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')
    
    await call.message.edit_text(
        f"üõ°Ô∏è {item_name}\n\n"
        f"üìù –û–ø–∏—Å–∞–Ω–∏–µ: {description}\n"
        f"üìç –õ–æ–∫–∞—Ü–∏—è: {location}\n\n"
        f"üí∞ –¶–µ–Ω–∞: {item_data['price']} –º–æ–Ω–µ—Ç\n"
        f"{status_text}",
        reply_markup=kb
    )

@dp.callback_query(lambda c: c.data.startswith("buy_survival"))
async def buy_survival(call: CallbackQuery):
    data_parts = call.data.split(":")[1:]
    if len(data_parts) < 2:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, item_name = data_parts
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à–∞ –ø–æ–∫—É–ø–∫–∞!", show_alert=True)
        return
    
    if item_name not in SURVIVAL_ITEMS:
        await call.message.edit_text("‚ùå –≠—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω.")
        return
    
    item_data = SURVIVAL_ITEMS[item_name]
    user = ensure_user(call.from_user.id)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ç–∞–∫–æ–π –ø—Ä–µ–¥–º–µ—Ç —É –∏–≥—Ä–æ–∫–∞
    has_item = sql.execute(
        "SELECT 1 FROM survival_items WHERE user_id = ? AND item_name = ?",
        (call.from_user.id, item_name)
    ).fetchone()
    
    # –ï—Å–ª–∏ –ø—Ä–µ–¥–º–µ—Ç —É–∂–µ –µ—Å—Ç—å
    if has_item:
        await call.message.edit_text("‚úÖ –£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å —ç—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç!")
        return
    
    if user[1] < item_data['price']:
        await call.message.edit_text("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç.")
        return
    
    # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="‚úÖ –î–∞, –∫—É–ø–∏—Ç—å", callback_data=f"confirm_buy_survival:{call.from_user.id}:{item_name}")],
        [InlineKeyboardButton(text="‚ùå –û—Ç–º–µ–Ω–∞", callback_data=f"view_survival:{call.from_user.id}:{item_name}")]
    ])
    
    location_text = f"üìç –õ–æ–∫–∞—Ü–∏—è: {item_data.get('location', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')}"
    description_text = f"üìù {item_data.get('description', '')}"
    
    await call.message.edit_text(
        f"‚ùì –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∫—É–ø–∏—Ç—å {item_name} –∑–∞ {item_data['price']} –º–æ–Ω–µ—Ç?\n\n"
        f"{location_text}\n{description_text}\n\n"
        f"üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å: {user[1]} –º–æ–Ω–µ—Ç\n"
        f"üí∞ –ü–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏: {user[1] - item_data['price']} –º–æ–Ω–µ—Ç",
        reply_markup=kb
    )

@dp.callback_query(lambda c: c.data.startswith("confirm_buy_survival"))
async def confirm_buy_survival(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    user_id, item_name = data_parts[1:]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à–∞ –ø–æ–∫—É–ø–∫–∞!", show_alert=True)
        return
    
    if item_name not in SURVIVAL_ITEMS:
        await call.message.edit_text("‚ùå –≠—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω.")
        return
    
    item_data = SURVIVAL_ITEMS[item_name]
    user = ensure_user(call.from_user.id)
    
    if user[1] < item_data['price']:
        await call.message.edit_text("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç.")
        return
    
    # –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–¥–º–µ—Ç
    sql.execute(
        "INSERT INTO survival_items (user_id, item_name, location) VALUES (?, ?, ?)",
        (call.from_user.id, item_name, item_data['location'])
    )
    
    # –°–ø–∏—Å–∞–Ω–∏–µ –¥–µ–Ω–µ–≥
    sql.execute("UPDATE users SET coins = coins - ? WHERE user_id = ?", (item_data['price'], call.from_user.id))
    db.commit()
    
    description = item_data.get('description', '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è')
    await call.message.edit_text(f"‚úÖ –í—ã –∫—É–ø–∏–ª–∏ {item_name}!\n\n{description}\n\n–ü—Ä–µ–¥–º–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≤–∞—à –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –≤—ã–∂–∏–≤–∞–Ω–∏—è.")

@dp.callback_query(lambda c: c.data.startswith("shop_back"))
async def shop_back(call: CallbackQuery):
    user_id = call.data.split(":")[1]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à –º–∞–≥–∞–∑–∏–Ω!", show_alert=True)
        return
    
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üî´ –û—Ä—É–∂–∏–µ", callback_data=f"shop_weapons:{call.from_user.id}")],
        [InlineKeyboardButton(text="üé© –°–Ω–∞—Ä—è–∂–µ–Ω–∏–µ", callback_data=f"shop_equipment:{call.from_user.id}")],
        [InlineKeyboardButton(text="‚ö° –ë–∞—Ñ—Ñ—ã", callback_data=f"shop_buffs:{call.from_user.id}")],
        [InlineKeyboardButton(text="üõ°Ô∏è –í—ã–∂–∏–≤–∞–Ω–∏–µ", callback_data=f"shop_survival:{call.from_user.id}")]
    ])
    await call.message.edit_text("–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:", reply_markup=kb)

# ================== –¢–û–ü ==================
@dp.message(lambda msg: msg.text and msg.text.lower() == "—Ç–æ–ø—ã")
async def top(msg: Message):
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üèÜ –¢–æ–ø –ø–æ —É–±–∏–π—Å—Ç–≤–∞–º (–≤—Å–µ –≤—Ä–µ–º—è)", callback_data=f"top_total:{msg.from_user.id}")],
        [InlineKeyboardButton(text="üìä –¢–æ–ø –ø–æ —É–±–∏–π—Å—Ç–≤–∞–º (–∑–∞ –¥–µ–Ω—å)", callback_data=f"top_daily:{msg.from_user.id}")],
        [InlineKeyboardButton(text="‚≠ê –¢–æ–ø –ø–æ –æ–ø—ã—Ç—É", callback_data=f"top_exp:{msg.from_user.id}")],
        [InlineKeyboardButton(text="üí∞ –¢–æ–ø –ø–æ –º–æ–Ω–µ—Ç–∞–º", callback_data=f"top_coins:{msg.from_user.id}")],
        [InlineKeyboardButton(text="üéØ –¢–æ–ø –ø–æ —Ç–∏—Ç–∞–Ω–∞–º", callback_data=f"top_titans:{msg.from_user.id}")],
        [InlineKeyboardButton(text="üéñÔ∏è –¢–æ–ø –ø–æ –ø—Ä–µ—Å—Ç–∏–∂—É", callback_data=f"top_prestige_list:{msg.from_user.id}")]
    ])
    await msg.answer("–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç–æ–ø–∞:", reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("top_total"))
async def top_total(call: CallbackQuery):
    user_id = call.data.split(":")[1]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à —Ç–æ–ø!", show_alert=True)
        return
    
    top_users = sql.execute(
        "SELECT username, total_kills FROM users WHERE username IS NOT NULL AND total_kills > 0 ORDER BY total_kills DESC LIMIT 10"
    ).fetchall()
    
    if not top_users:
        await call.message.edit_text("üì≠ –ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.")
        return
    
    text = "üèÜ –¢–æ–ø –ø–æ —É–±–∏–π—Å—Ç–≤–∞–º (–≤—Å–µ –≤—Ä–µ–º—è):\n\n"
    for i, (username, kills) in enumerate(top_users, 1):
        text += f"{i}. @{username} ‚Äî {kills} —É–±–∏–π—Å—Ç–≤\n"
    
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"top_back:{call.from_user.id}")]
    ])
    
    await call.message.edit_text(text, reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("top_daily"))
async def top_daily(call: CallbackQuery):
    user_id = call.data.split(":")[1]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à —Ç–æ–ø!", show_alert=True)
        return
    
    today = datetime.now().strftime("%Y-%m-%d")
    top_users = sql.execute(
        "SELECT u.username, s.kills FROM users u "
        "JOIN stats_daily s ON u.user_id = s.user_id "
        "WHERE s.date = ? AND u.username IS NOT NULL AND s.kills > 0 "
        "ORDER BY s.kills DESC LIMIT 10",
        (today,)
    ).fetchall()
    
    if not top_users:
        await call.message.edit_text("üì≠ –ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.")
        return
    
    text = f"üìä –¢–æ–ø –ø–æ —É–±–∏–π—Å—Ç–≤–∞–º (–∑–∞ –¥–µ–Ω—å, {today}):\n\n"
    for i, (username, kills) in enumerate(top_users, 1):
        text += f"{i}. @{username} ‚Äî {kills} —É–±–∏–π—Å—Ç–≤\n"
    
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"top_back:{call.from_user.id}")]
    ])
    
    await call.message.edit_text(text, reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("top_exp"))
async def top_exp(call: CallbackQuery):
    user_id = call.data.split(":")[1]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à —Ç–æ–ø!", show_alert=True)
        return
    
    top_users = sql.execute(
        "SELECT username, exp, exp/500 as level FROM users "
        "WHERE username IS NOT NULL AND exp > 0 ORDER BY exp DESC LIMIT 10"
    ).fetchall()
    
    if not top_users:
        await call.message.edit_text("üì≠ –ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.")
        return
    
    text = "‚≠ê –¢–æ–ø –ø–æ –æ–ø—ã—Ç—É (–∏ —É—Ä–æ–≤–Ω—é):\n\n"
    for i, (username, exp, level) in enumerate(top_users, 1):
        text += f"{i}. @{username} ‚Äî –û–ø—ã—Ç: {exp} (–£—Ä–æ–≤–µ–Ω—å: {int(level)})\n"
    
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"top_back:{call.from_user.id}")]
    ])
    
    await call.message.edit_text(text, reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("top_coins"))
async def top_coins(call: CallbackQuery):
    user_id = call.data.split(":")[1]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à —Ç–æ–ø!", show_alert=True)
        return
    
    top_users = sql.execute(
        "SELECT username, coins FROM users "
        "WHERE username IS NOT NULL AND coins > 0 ORDER BY coins DESC LIMIT 10"
    ).fetchall()
    
    if not top_users:
        await call.message.edit_text("üì≠ –ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.")
        return
    
    text = "üí∞ –¢–æ–ø –ø–æ –º–æ–Ω–µ—Ç–∞–º:\n\n"
    for i, (username, coins) in enumerate(top_users, 1):
        text += f"{i}. @{username} ‚Äî {coins} –º–æ–Ω–µ—Ç\n"
    
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"top_back:{call.from_user.id}")]
    ])
    
    await call.message.edit_text(text, reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("top_titans"))
async def top_titans(call: CallbackQuery):
    user_id = call.data.split(":")[1]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à —Ç–æ–ø!", show_alert=True)
        return
    
    titan_animals = []
    for location_name, location_data in LOCATIONS.items():
        if "–¢–∏—Ç–∞–Ω" in location_data["animals"]:
            titan_animals.extend(location_data["animals"]["–¢–∏—Ç–∞–Ω"])
    
    if not titan_animals:
        await call.message.edit_text("üéØ –í –∏–≥—Ä–µ –ø–æ–∫–∞ –Ω–µ—Ç —Ç–∏—Ç–∞–Ω–æ–≤.")
        return
    
    titan_counts = {}
    
    for username, user_id_db in sql.execute("SELECT username, user_id FROM users WHERE username IS NOT NULL").fetchall():
        total_titans = 0
        for animal in titan_animals:
            result = sql.execute("SELECT count FROM trophies WHERE user_id = ? AND animal = ?",
                               (user_id_db, animal)).fetchone()
            if result:
                total_titans += result[0]
        
        if total_titans > 0:
            titan_counts[username] = total_titans
    
    if not titan_counts:
        await call.message.edit_text("üéØ –ü–æ–∫–∞ –Ω–∏–∫—Ç–æ –Ω–µ —É–±–∏–ª –Ω–∏ –æ–¥–Ω–æ–≥–æ —Ç–∏—Ç–∞–Ω–∞.")
        return
    
    sorted_titans = sorted(titan_counts.items(), key=lambda x: x[1], reverse=True)[:10]
    
    text = "üéØ –¢–æ–ø –ø–æ —É–±–∏–π—Å—Ç–≤—É —Ç–∏—Ç–∞–Ω–æ–≤:\n\n"
    for i, (username, count) in enumerate(sorted_titans, 1):
        text += f"{i}. @{username} ‚Äî {count} —Ç–∏—Ç–∞–Ω–æ–≤\n"
    
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"top_back:{call.from_user.id}")]
    ])
    
    await call.message.edit_text(text, reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("top_prestige_list"))
async def top_prestige_list(call: CallbackQuery):
    user_id = call.data.split(":")[1]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à —Ç–æ–ø!", show_alert=True)
        return
    
    top_users = sql.execute(
        "SELECT username, prestige FROM users WHERE username IS NOT NULL AND prestige > 0 ORDER BY prestige DESC, exp DESC LIMIT 10"
    ).fetchall()
    
    if not top_users:
        await call.message.edit_text("üéñÔ∏è –ü–æ–∫–∞ –Ω–∏–∫—Ç–æ –Ω–µ –ø–æ–ª—É—á–∏–ª –ø—Ä–µ—Å—Ç–∏–∂.")
        return
    
    text = "üéñÔ∏è –¢–æ–ø –ø–æ –ø—Ä–µ—Å—Ç–∏–∂—É:\n\n"
    for i, (username, prestige) in enumerate(top_users, 1):
        prestige_name = PRESTIGES.get(prestige, {}).get("name", f"–ü—Ä–µ—Å—Ç–∏–∂ {prestige}")
        text += f"{i}. @{username} ‚Äî {prestige_name}\n"
    
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"top_back:{call.from_user.id}")]
    ])
    
    await call.message.edit_text(text, reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("top_back"))
async def top_back(call: CallbackQuery):
    user_id = call.data.split(":")[1]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à —Ç–æ–ø!", show_alert=True)
        return
    
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üèÜ –¢–æ–ø –ø–æ —É–±–∏–π—Å—Ç–≤–∞–º (–≤—Å–µ –≤—Ä–µ–º—è)", callback_data=f"top_total:{call.from_user.id}")],
        [InlineKeyboardButton(text="üìä –¢–æ–ø –ø–æ —É–±–∏–π—Å—Ç–≤–∞–º (–∑–∞ –¥–µ–Ω—å)", callback_data=f"top_daily:{call.from_user.id}")],
        [InlineKeyboardButton(text="‚≠ê –¢–æ–ø –ø–æ –æ–ø—ã—Ç—É", callback_data=f"top_exp:{call.from_user.id}")],
        [InlineKeyboardButton(text="üí∞ –¢–æ–ø –ø–æ –º–æ–Ω–µ—Ç–∞–º", callback_data=f"top_coins:{call.from_user.id}")],
        [InlineKeyboardButton(text="üéØ –¢–æ–ø –ø–æ —Ç–∏—Ç–∞–Ω–∞–º", callback_data=f"top_titans:{call.from_user.id}")],
        [InlineKeyboardButton(text="üéñÔ∏è –¢–æ–ø –ø–æ –ø—Ä–µ—Å—Ç–∏–∂—É", callback_data=f"top_prestige_list:{call.from_user.id}")]
    ])
    await call.message.edit_text("–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç–æ–ø–∞:", reply_markup=kb)

# ================== –õ–û–ö–ê–¶–ò–ò ==================
@dp.message(lambda msg: msg.text and msg.text.lower() == "–ª–æ–∫–∞—Ü–∏–∏")
async def choose_location(msg: Message):
    user = ensure_user(msg.from_user.id, msg.from_user.username)
    level = get_level(user[2])
    
    buttons = []
    for name, data in LOCATIONS.items():
        available = level >= data["level"]
        status = "üìç " if user[4] == name else ""
        lock = "üîí " if not available else ""
        level_req = f" (—É—Ä. {data['level']}+)" if not available else ""
        
        if available:
            buttons.append([InlineKeyboardButton(
                text=f"{status}{lock}{name}{level_req}",
                callback_data=f"loc_set:{msg.from_user.id}:{name}"
            )])
        else:
            buttons.append([InlineKeyboardButton(
                text=f"{lock}{name}{level_req}",
                callback_data="loc_locked"
            )])
    
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
    await msg.answer(f"üìç –í—ã–±–µ—Ä–∏—Ç–µ –ª–æ–∫–∞—Ü–∏—é (–í–∞—à —É—Ä–æ–≤–µ–Ω—å: {level}):", reply_markup=kb)

@dp.callback_query(lambda c: c.data.startswith("loc_set"))
async def set_location(call: CallbackQuery):
    data_parts = call.data.split(":")
    if len(data_parts) < 3:
        await call.answer("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö", show_alert=True)
        return
    
    owner_id, location = data_parts[1:]
    
    if int(owner_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ —Ç–≤–æ—è –ª–æ–∫–∞—Ü–∏—è!", show_alert=True)
        return
    
    user = ensure_user(call.from_user.id)
    level = get_level(user[2])
    
    if location not in LOCATIONS:
        await call.message.edit_text("‚ùå –≠—Ç–∞ –ª–æ–∫–∞—Ü–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.")
        return
    
    if not can_use_location(level, location):
        await call.message.edit_text(f"‚ùå –≠—Ç–∞ –ª–æ–∫–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Å —É—Ä–æ–≤–Ω—è {LOCATIONS[location]['level']}.")
        return
    
    sql.execute("UPDATE users SET location = ? WHERE user_id = ?", (location, call.from_user.id))
    db.commit()
    
    animals_text = "\n\nüêæ –ñ–∏–≤–æ—Ç–Ω—ã–µ –≤ —ç—Ç–æ–π –ª–æ–∫–∞—Ü–∏–∏:\n"
    
    for group_name, animals_list in LOCATIONS[location]["animals"].items():
        if animals_list:
            animals_text += f"\n{group_name}:\n"
            animals_text += "‚Ä¢ " + "\n‚Ä¢ ".join(animals_list) + "\n"
    
    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥ –∫ –ª–æ–∫–∞—Ü–∏—è–º", callback_data=f"loc_back:{call.from_user.id}")]
    ])
    
    await call.message.edit_text(
        f"‚úÖ –õ–æ–∫–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞ {location}!\n\n"
        f"üìä –£—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–∞: {LOCATIONS[location]['level']}+"
        f"{animals_text}",
        reply_markup=kb
    )

@dp.callback_query(lambda c: c.data == "loc_locked")
async def loc_locked(call: CallbackQuery):
    await call.answer("‚ùå –≠—Ç–∞ –ª–æ–∫–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ –≤–∞—à–µ–º —É—Ä–æ–≤–Ω–µ!", show_alert=True)

@dp.callback_query(lambda c: c.data.startswith("loc_back"))
async def location_back(call: CallbackQuery):
    user_id = call.data.split(":")[1]
    
    if int(user_id) != call.from_user.id:
        await call.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à–µ –º–µ–Ω—é!", show_alert=True)
        return
    
    user = ensure_user(call.from_user.id)
    level = get_level(user[2])
    
    buttons = []
    for name, data in LOCATIONS.items():
        available = level >= data["level"]
        status = "üìç " if user[4] == name else ""
        lock = "üîí " if not available else ""
        level_req = f" (—É—Ä. {data['level']}+)" if not available else ""
        
        if available:
            buttons.append([InlineKeyboardButton(
                text=f"{status}{lock}{name}{level_req}",
                callback_data=f"loc_set:{call.from_user.id}:{name}"
            )])
        else:
            buttons.append([InlineKeyboardButton(
                text=f"{lock}{name}{level_req}",
                callback_data="loc_locked"
            )])
    
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
    await call.message.edit_text(f"üìç –í—ã–±–µ—Ä–∏—Ç–µ –ª–æ–∫–∞—Ü–∏—é (–í–∞—à —É—Ä–æ–≤–µ–Ω—å: {level}):", reply_markup=kb)

# ================== –õ–û–í–£–®–ö–ò ==================
@dp.message(lambda msg: msg.text and msg.text.lower() in ["–ª–æ–≤—É—à–∫–∏", "–ª–æ–≤—É—à–∫–∞"])
async def traps_command(msg: Message):
    user = ensure_user(msg.from_user.id, msg.from_user.username)
    
    success, result = use_traps(msg.from_user.id)
    
    if not success:
        await msg.answer(result)
        return
    
    caught_animals = result
    
    if not caught_animals:
        await msg.answer("ü™§ –í—ã –ø–æ—Å—Ç–∞–≤–∏–ª–∏ –ª–æ–≤—É—à–∫–∏, –Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–π–º–∞–ª–∏.")
        return
    
    total_coins = 0
    total_exp = 0
    animals_text = "ü™§ –í—ã –ø–æ–π–º–∞–ª–∏ –≤ –ª–æ–≤—É—à–∫–∏:\n\n"
    
    for group, animal in caught_animals:
        if group in REWARDS:
            base_coins, base_exp = REWARDS[group]
            coins = base_coins // 2
            exp = base_exp // 2
            
            total_coins += coins
            total_exp += exp
            
            animals_text += f"‚Ä¢ {animal} ({group}) ‚Äî {coins}üí∞, {exp}‚≠ê\n"
            
            trophy = sql.execute("SELECT count FROM trophies WHERE user_id = ? AND animal = ?", (msg.from_user.id, animal)).fetchone()
            if trophy:
                sql.execute("UPDATE trophies SET count = count + 1 WHERE user_id = ? AND animal = ?", (msg.from_user.id, animal))
            else:
                sql.execute("INSERT INTO trophies VALUES (?, ?, ?)", (msg.from_user.id, animal, 1))
    
    sql.execute("UPDATE users SET coins = coins + ?, exp = exp + ? WHERE user_id = ?", 
                (total_coins, total_exp, msg.from_user.id))
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ª–æ–≤—É—à–µ–∫
    new_achievements = check_achievements(msg.from_user.id)
    
    db.commit()
    
    if new_achievements:
        achievements_text = "\n\nüéâ –ù–æ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:\n"
        for achievement_name in new_achievements:
            achievements_text += f"‚Ä¢ {achievement_name}\n"
        animals_text += achievements_text
    
    animals_text += f"\nüí∞ –í—Å–µ–≥–æ: {total_coins} –º–æ–Ω–µ—Ç, {total_exp} –æ–ø—ã—Ç–∞"
    
    await msg.answer(animals_text)

# ================== –§–£–ù–ö–¶–ò–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø –ë–î ==================
def update_database():
    """–û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø"""
    # –í—Å–µ –∫–æ–ª–æ–Ω–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Ç–∞–±–ª–∏—Ü–µ users
    columns_to_add = [
        ("survival_hunt_count", "INTEGER DEFAULT 0"),
        ("survival_damage_count", "INTEGER DEFAULT 0"),
        ("diamond_bullet", "INTEGER DEFAULT 0"),
        ("immortality_staff", "INTEGER DEFAULT 0"),
        ("energy_drink", "INTEGER DEFAULT 0"),
        ("hunt_counter", "INTEGER DEFAULT 0"),
        ("golden_bullet", "INTEGER DEFAULT 0"),
        ("drone_target", "TEXT DEFAULT ''"),
        ("drone_expires", "INTEGER DEFAULT 0"),
        ("last_daily_gift", "INTEGER DEFAULT 0"),
        ("counterattack_streak", "INTEGER DEFAULT 0"),
        ("titan_escape_streak", "INTEGER DEFAULT 0"),
        ("trap_days_streak", "INTEGER DEFAULT 0"),
        ("last_trap_use", "INTEGER DEFAULT 0"),
        ("traps_used", "INTEGER DEFAULT 0"),
        ("heavy_traps", "INTEGER DEFAULT 0"),
        ("last_achievement_check", "INTEGER DEFAULT 0"),
        ("achievement_streak", "INTEGER DEFAULT 0"),
        ("deaths", "INTEGER DEFAULT 0"),
        ("current_title", "TEXT DEFAULT ''"),
        ("achievements_completed", "TEXT DEFAULT '{}'")
    ]
    
    print("üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...")
    
    for column_name, column_type in columns_to_add:
        try:
            sql.execute(f"SELECT {column_name} FROM users LIMIT 1")
            print(f"‚úì –ö–æ–ª–æ–Ω–∫–∞ {column_name} —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
        except sqlite3.OperationalError:
            try:
                sql.execute(f"ALTER TABLE users ADD COLUMN {column_name} {column_type}")
                db.commit()
                print(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ {column_name}")
            except Exception as e:
                print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫–æ–ª–æ–Ω–∫–∏ {column_name}: {e}")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
    tables_to_check = [
        ("survival_items", "CREATE TABLE IF NOT EXISTS survival_items (user_id INTEGER, item_name TEXT, location TEXT, UNIQUE(user_id, item_name), FOREIGN KEY (user_id) REFERENCES users(user_id))")
    ]
    
    for table_name, create_sql in tables_to_check:
        try:
            sql.execute(f"SELECT 1 FROM {table_name} LIMIT 1")
            print(f"‚úì –¢–∞–±–ª–∏—Ü–∞ {table_name} —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
        except sqlite3.OperationalError:
            try:
                sql.execute(create_sql)
                db.commit()
                print(f"‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ {table_name}")
            except Exception as e:
                print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü—ã {table_name}: {e}")
    
    print("‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î –∑–∞–≤–µ—Ä—à–µ–Ω–∞")
    db.commit()

# ================== –ó–ê–ü–£–°–ö ==================
async def main():
    print("=" * 50)
    print("üîß –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...")
    update_database()
    
    print("üîÑ –°–±—Ä–æ—Å –¥–Ω–µ–≤–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...")
    reset_daily_stats()
    
    print("ü©∫ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—å—è –∏–≥—Ä–æ–∫–æ–≤...")
    all_users = sql.execute("SELECT user_id FROM users").fetchall()
    for user in all_users:
        update_max_health(user[0])
    
    print("üíñ –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è...")
    health_regenerator.start_regeneration()
    
    print("ü§ñ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω! –û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π...")
    print(f"üëë –ê–¥–º–∏–Ω ID: {ADMIN_ID}")
    print(f"üëë –ê–¥–º–∏–Ω Username: @{ADMIN_USERNAME}")
    print("=" * 50)
    print("üìä –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:")
    print("‚Ä¢ /start - –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã")
    print("‚Ä¢ –°–æ—Å—Ç–æ—è–Ω–∏–µ - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ")
    print("‚Ä¢ –•–∞–Ω—Ç - –ù–∞—á–∞—Ç—å –æ—Ö–æ—Ç—É (—Å –∫–Ω–æ–ø–∫–æ–π –æ–±–Ω—É–ª–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞ –∑–∞ 450üí∞)")
    print("‚Ä¢ –ò–Ω–≤ - –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç)")
    print("‚Ä¢ –ú–∞–≥–∞–∑–∏–Ω - –ú–∞–≥–∞–∑–∏–Ω –æ—Ä—É–∂–∏—è –∏ —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è")
    print("‚Ä¢ –õ–æ–∫–∞—Ü–∏–∏ - –í—ã–±–æ—Ä –ª–æ–∫–∞—Ü–∏–∏")
    print("‚Ä¢ –¢–æ–ø—ã - –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤")
    print("‚Ä¢ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è - –í–∞—à–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)")
    print("‚Ä¢ –¢–∏—Ç—É–ª—ã - –í—ã–±—Ä–∞—Ç—å —Ç–∏—Ç—É–ª")
    print("‚Ä¢ –ü—Ä–µ—Å—Ç–∏–∂ - –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–µ—Å—Ç–∏–∂")
    print("‚Ä¢ –õ–æ–≤—É—à–∫–∏ - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–≤—É—à–∫–∏ (—Ä–∞–∑ –≤ –¥–µ–Ω—å –ø–æ—Å–ª–µ 00:00 –ò—Ä–∫—É—Ç—Å–∫)")
    print("‚Ä¢ –ü–æ–¥–∞—Ä–æ–∫ - –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫ (—Ä–∞–∑ –≤ –¥–µ–Ω—å –ø–æ—Å–ª–µ 00:00 –ò—Ä–∫—É—Ç—Å–∫)")
    print("‚Ä¢ –í—ã–∂–∏–≤–∞–Ω–∏–µ - –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –≤—ã–∂–∏–≤–∞–Ω–∏—è")
    print("‚Ä¢ –°–ø—Ä–∞–≤–∫–∞ - –ü–æ–º–æ—â—å")
    print("=" * 50)
    print("üÜï –ù–û–í–´–ï –§–£–ù–ö–¶–ò–ò –ò –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:")
    print("‚úÖ –ñ–∏–≤–æ—Ç–Ω—ã–µ —Ç–µ–ø–µ—Ä—å –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—Ä–∏ —É–±–∏–π—Å—Ç–≤–µ")
    print("‚úÖ –ù–∞–≥—Ä–∞–¥—ã (–º–æ–Ω–µ—Ç—ã –∏ –æ–ø—ã—Ç) –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è")
    print("‚úÖ –ú–µ–Ω—é —Ç–∏—Ç—É–ª–æ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π (–º–∞–∫—Å–∏–º—É–º 3 –∫–Ω–æ–ø–∫–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É)")
    print("‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ù–µ–ª—å–∑—è –æ—Ö–æ—Ç–∏—Ç—å—Å—è –ø—Ä–∏ HP ‚â§ 25")
    print("‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –í—Å–µ –±–∞—Ñ—Ñ—ã –∞–∫—Ç–∏–≤–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ, –Ω–µ —Å–∞–º–æ–ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ")
    print("‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ —Å –∂–∏–≤–æ—Ç–Ω—ã–º–∏: –ë—É—Ä—ã–π –º–µ–¥–≤–µ–¥—å, –ë–µ–ª—ã–π –º–µ–¥–≤–µ–¥—å, –ö–æ–º–æ–¥—Å–∫–∏–π –≤–∞—Ä–∞–Ω")
    print("‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –≤—ã–∂–∏–≤–∞–Ω–∏—è: —É—Ä–æ–Ω —Ä–æ–≤–Ω–æ –∫–∞–∂–¥—ã–µ 5 –æ—Ö–æ—Ç")
    print("‚úÖ –ü—Ä–∏–≤—è–∑–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ñ—Ä–∞–∑—ã –∞—Ç–∞–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∂–∏–≤–æ—Ç–Ω–æ–≥–æ")
    print("‚úÖ –£–±—Ä–∞–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ —Ñ—Ä–∞–∑—ã –ø—Ä–∏ –∫–æ–Ω—Ç—Ä–∞—Ç–∞–∫–µ (—Ç–æ–ª—å–∫–æ —Ñ—Ä–∞–∑–∞ –∂–∏–≤–æ—Ç–Ω–æ–≥–æ)")
    print("‚úÖ –õ–æ–≤—É—à–∫–∏ –∏ –ø–æ–¥–∞—Ä–æ–∫ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ 00:00 –ø–æ –ò—Ä–∫—É—Ç—Å–∫–æ–º—É –≤—Ä–µ–º–µ–Ω–∏")
    print("‚úÖ –í—Å–µ –∞–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç '–∞–ª–ª' –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤")
    print("‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞–∑–≤–∞–Ω–∏—è –∂–∏–≤–æ—Ç–Ω—ã—Ö –∏ —Ñ—Ä–∞–∑—ã –∞—Ç–∞–∫–∏")
    print("=" * 50)
    print("üîß –ê–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥—ã:")
    print("‚Ä¢ –¥–∏–ø—Å–∫–∏–ø [@username|–∞–ª–ª] - –°–±—Ä–æ—Å–∏—Ç—å —Ç–∞–π–º–µ—Ä –æ—Ö–æ—Ç—ã")
    print("‚Ä¢ –¥–∏–ø–º–æ–Ω–µ—Ç—ã <—Å—É–º–º–∞> [@username|–∞–ª–ª] - –í—ã–¥–∞—Ç—å –º–æ–Ω–µ—Ç—ã")
    print("‚Ä¢ –¥–∏–ø–æ–ø—ã—Ç <—Å—É–º–º–∞> [@username|–∞–ª–ª] - –í—ã–¥–∞—Ç—å –æ–ø—ã—Ç")
    print("‚Ä¢ –¥–∏–ø—É—Ä–æ–≤–Ω–∏ <—É—Ä–æ–≤–Ω–∏> [@username|–∞–ª–ª] - –í—ã–¥–∞—Ç—å —É—Ä–æ–≤–Ω–∏")
    print("‚Ä¢ –¥–∏–ø–∑–¥ <HP> [@username|–∞–ª–ª] - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ")
    print("‚Ä¢ –¥–∏–ø–Ω–æ–ª—å [@username|–∞–ª–ª] - –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å –ø—Ä–æ—Ñ–∏–ª—è")
    print("‚Ä¢ –¥–∏–ø–ª [@username|–∞–ª–ª] - –°–±—Ä–æ—Å–∏—Ç—å –ª–æ–≤—É—à–∫–∏")
    print("‚Ä¢ –¥–∏–ø–ø–æ–¥ [@username|–∞–ª–ª] - –°–±—Ä–æ—Å–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫")
    print("‚Ä¢ –¥–∏–ø–∫–∏–ª <–∫–æ–ª-–≤–æ> [@username|–∞–ª–ª] - –î–æ–±–∞–≤–∏—Ç—å —É–±–∏–π—Å—Ç–≤–∞")
    print("‚Ä¢ –¥–∏–ø–∂–∏–≤ \"–∂–∏–≤–æ—Ç–Ω–æ–µ\" <–∫–æ–ª-–≤–æ> [@username|–∞–ª–ª] - –î–æ–±–∞–≤–∏—Ç—å –∂–∏–≤–æ—Ç–Ω–æ–µ")
    print("=" * 50)
    
    try:
        await dp.start_polling(bot)
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞: {e}")
        import traceback
        traceback.print_exc()
    finally:
        health_regenerator.stop_regeneration()
        await bot.session.close()

if __name__ == "__main__":
    asyncio.run(main())

